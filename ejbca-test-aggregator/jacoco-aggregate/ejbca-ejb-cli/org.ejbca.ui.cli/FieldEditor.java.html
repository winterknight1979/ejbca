<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>FieldEditor.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Unit Test Aggregator</a> &gt; <a href="../index.html" class="el_bundle">ejbca-ejb-cli</a> &gt; <a href="index.source.html" class="el_package">org.ejbca.ui.cli</a> &gt; <span class="el_source">FieldEditor.java</span></div><h1>FieldEditor.java</h1><pre class="source lang-java linenums">/*************************************************************************
 *                                                                       *
 *  EJBCA Community: The OpenSource Certificate Authority                *
 *                                                                       *
 *  This software is free software; you can redistribute it and/or       *
 *  modify it under the terms of the GNU Lesser General Public           *
 *  License as published by the Free Software Foundation; either         *
 *  version 2.1 of the License, or any later version.                    *
 *                                                                       *
 *  See terms of license at gnu.org.                                     *
 *                                                                       *
 *************************************************************************/
package org.ejbca.ui.cli;

import java.util.ArrayList;
import java.util.List;

import org.apache.commons.beanutils.ConvertingWrapDynaBean;
import org.apache.commons.beanutils.DynaBean;
import org.apache.commons.beanutils.DynaProperty;
import org.apache.commons.beanutils.WrapDynaBean;
import org.apache.commons.lang.math.NumberUtils;
import org.apache.log4j.Logger;

/**
 *
 * @version $Id: FieldEditor.java 23457 2016-05-16 17:18:31Z mikekushner $
 */
public class FieldEditor {

    private final Logger logger;

<span class="nc" id="L33">    public FieldEditor(Logger logger) {</span>
<span class="nc" id="L34">        this.logger = logger;</span>
<span class="nc" id="L35">    }</span>
    
    /** List of fields that should be excluded from bean lists. This should contain fields that should never be changed by a user */
<span class="nc" id="L38">    private static final ArrayList&lt;String&gt; excluded = new ArrayList&lt;String&gt;();</span>
    static {
<span class="nc" id="L40">        excluded.add(&quot;type&quot;);</span>
<span class="nc" id="L41">        excluded.add(&quot;version&quot;);</span>
<span class="nc" id="L42">        excluded.add(&quot;class&quot;);</span>
<span class="nc" id="L43">        excluded.add(&quot;latestVersion&quot;);</span>
<span class="nc" id="L44">        excluded.add(&quot;upgraded&quot;);</span>
<span class="nc" id="L45">        excluded.add(&quot;CAId&quot;);</span>
<span class="nc" id="L46">        excluded.add(&quot;CAType&quot;);</span>
<span class="nc" id="L47">        excluded.add(&quot;CAToken&quot;);</span>
<span class="nc" id="L48">        excluded.add(&quot;hidden&quot;);</span>
<span class="nc" id="L49">    }</span>
    /** Lists methods in a class the has &quot;setXyz&quot;, and prints them as &quot;Xyz&quot;.
     * Ignores (does not list) type, version, latestVersion, upgrade and class
     * 
     * @param obj the Object where to look for setMethods
     */
    public void listSetMethods(final Object obj) {
<span class="nc" id="L56">        DynaBean wrapper = new WrapDynaBean(obj);</span>
<span class="nc" id="L57">        DynaProperty[] props = wrapper.getDynaClass().getDynaProperties();</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">        for (DynaProperty dynaProperty : props) {</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">            if (!excluded.contains(dynaProperty.getName())) {</span>
<span class="nc" id="L60">                logger.info(dynaProperty.getName()+&quot;, &quot;+dynaProperty.getType());                </span>
            }
        }
<span class="nc" id="L63">    }</span>
    
    public List&lt;String&gt; getSetMethodNames(final Object obj) {
<span class="nc" id="L66">        List&lt;String&gt; result = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L67">        DynaBean wrapper = new WrapDynaBean(obj);</span>
<span class="nc" id="L68">        DynaProperty[] props = wrapper.getDynaClass().getDynaProperties();</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">        for (DynaProperty dynaProperty : props) {</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">            if (!excluded.contains(dynaProperty.getName())) {</span>
<span class="nc" id="L71">                result.add(dynaProperty.getName());</span>
            }
        }
<span class="nc" id="L74">        return result;</span>
    }
    
    /** gets a field value from a bean
     * 
     * @param field the field to get
     * @param obj the bran to get the value from
     * @return the value
     * @throws FieldNotFoundException if field doesn't exist.
     */
    public Object getBeanValue(final String field, final Object obj) throws FieldNotFoundException {
<span class="nc" id="L85">        final DynaBean moddb = new WrapDynaBean(obj);</span>
<span class="nc" id="L86">        DynaProperty prop = moddb.getDynaClass().getDynaProperty(field);</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">        if (prop == null) {</span>
<span class="nc" id="L88">            throw new FieldNotFoundException(&quot;Field '&quot; + field + &quot;' does not exist. Did you use correct case for every character of the field?&quot;);</span>
        }
<span class="nc" id="L90">        final Object gotValue = moddb.get(field);</span>
<span class="nc" id="L91">        logger.info(field+&quot; returned value '&quot;+gotValue+&quot;'.&quot;);</span>
<span class="nc" id="L92">        return gotValue;</span>
    }
    
    /** Lists, Gets or sets fields in a Bean.
     * 
     * @param name the name of the Bean to be modified
     * @param field the field name to get or set
     * @param value the value to set, of we should set a new value
     * @param obj the Bean to list, get or set fields
     * 
     * @throws FieldNotFoundException if field was not found. 
     */
    public void setValue(final String name, final String field, final String value, final Object obj) throws FieldNotFoundException {

<span class="nc" id="L106">        Object val = value;</span>
<span class="nc" id="L107">        logger.info(&quot;Modifying '&quot; + name + &quot;'...&quot;);</span>
<span class="nc" id="L108">        final ConvertingWrapDynaBean db = new ConvertingWrapDynaBean(obj);</span>
<span class="nc" id="L109">        DynaProperty prop = db.getDynaClass().getDynaProperty(field);</span>
<span class="nc bnc" id="L110" title="All 2 branches missed.">        if (prop == null) {</span>
<span class="nc" id="L111">            throw new FieldNotFoundException(&quot;Field '&quot; + field + &quot;' does not exist. Did you use correct case for every character of the field?&quot;);</span>
        }
<span class="nc bnc" id="L113" title="All 2 branches missed.">        if (prop.getType().isInterface()) {</span>
<span class="nc" id="L114">            logger.info(&quot;Converting value '&quot; + value + &quot;' to type '&quot; + ArrayList.class + &quot;', &quot;);</span>
            // If the value can be converted into an integer, we will use an ArrayList&lt;Integer&gt;
            // Our problem here is that the type of a collection (&lt;Integer&gt;, &lt;String&gt;) is only compile time, it can not be determined in runtime.
<span class="nc" id="L117">            List&lt;Object&gt; arr = new ArrayList&lt;Object&gt;();</span>

<span class="nc bnc" id="L119" title="All 2 branches missed.">            if (NumberUtils.isNumber(value)) {</span>
<span class="nc" id="L120">                logger.info(&quot;using Integer value.&quot;);</span>
<span class="nc" id="L121">                arr.add(Integer.valueOf(value));</span>
            } else {
                // Make it into an array of String
<span class="nc" id="L124">                logger.info(&quot;using String value.&quot;);</span>
<span class="nc" id="L125">                arr.add(value);</span>
            }
<span class="nc" id="L127">            val = arr;</span>
        }
<span class="nc" id="L129">        final Object gotValue = db.get(field);</span>
<span class="nc" id="L130">        logger.info(&quot;Current value of &quot; + field + &quot; is '&quot; + gotValue + &quot;'.&quot;);</span>
<span class="nc" id="L131">        db.set(field, val);</span>
<span class="nc" id="L132">    }</span>


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>