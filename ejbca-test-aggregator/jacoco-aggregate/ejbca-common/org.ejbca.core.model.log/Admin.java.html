<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>Admin.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Unit Test Aggregator</a> &gt; <a href="../index.html" class="el_bundle">ejbca-common</a> &gt; <a href="index.source.html" class="el_package">org.ejbca.core.model.log</a> &gt; <span class="el_source">Admin.java</span></div><h1>Admin.java</h1><pre class="source lang-java linenums">/*************************************************************************
 *                                                                       *
 *  EJBCA Community: The OpenSource Certificate Authority                *
 *                                                                       *
 *  This software is free software; you can redistribute it and/or       *
 *  modify it under the terms of the GNU Lesser General Public           *
 *  License as published by the Free Software Foundation; either         *
 *  version 2.1 of the License, or any later version.                    *
 *                                                                       *
 *  See terms of license at gnu.org.                                     *
 *                                                                       *
 *************************************************************************/

/*
 * Admin.java
 *
 * Created on den 25 august 2002, 10:02
 */

package org.ejbca.core.model.log;

import java.io.Serializable;
import java.security.cert.Certificate;

import org.cesecore.util.CertTools;
import org.ejbca.core.model.authorization.AdminInformation;

/**
 * This is a class containing information about the administrator or admin performing the event.
 * Data contained in the class is preferably
 *
 * @author TomSelleck
 * @version $Id: Admin.java 22117 2015-10-29 10:53:42Z mikekushner $
 * @deprecated Use org.cesecore.authentication.tokens.AuthenticationToken instead.
 */
public class Admin implements Serializable {

    /**
     * Determines if a de-serialized file is compatible with this class.
     *
     * Maintainers must change this value if and only if the new version
     * of this class is not compatible with old versions. See Sun docs
     * for &lt;a href=http://java.sun.com/products/jdk/1.1/docs/guide
     * /serialization/spec/version.doc.html&gt; details. &lt;/a&gt;
     *
     */
    private static final long serialVersionUID = -9221031402622809524L;
    
    /** Default CA Id for non-certificate administrators */
    private static final int INTERNALCAID = 0;
    
    // Indicates the type of administrator.
    /** An administrator authenticated with client certificate */
    private static final int TYPE_CLIENTCERT_USER = 0;
    /** A user of the public web pages */
    /** Internal user in EJBCA, such as automatic job */
    private static final int TYPE_INTERNALUSER = 5;

<span class="nc" id="L59">    public static final String[] ADMINTYPETEXTS = {&quot;CLIENTCERT&quot;, &quot;PUBLICWEBUSER&quot;, &quot;RACMDLINE&quot;, &quot;CACMDLINE&quot;, &quot;BATCHCMDLINE&quot;, &quot;INTERNALUSER&quot;};</span>

    // Special Users. (Constants cannot have 0 value).
    private static final int SPECIALADMIN_PUBLICWEBUSER             = 2000;
    private static final int SPECIALADMIN_CACOMMANDLINEADMIN        = 2001;
    private static final int SPECIALADMIN_RAADMIN                   = 2002;
    private static final int SPECIALADMIN_BATCHCOMMANDLINEADMIN     = 2003;
    private static final int SPECIALADMIN_INTERNALUSER              = 2004;

<span class="nc" id="L68">    private static final int[] ADMINTYPETOADMINENTITY = {0, Admin.SPECIALADMIN_PUBLICWEBUSER, Admin.SPECIALADMIN_RAADMIN,</span>
    	Admin.SPECIALADMIN_CACOMMANDLINEADMIN, Admin.SPECIALADMIN_BATCHCOMMANDLINEADMIN,
    	Admin.SPECIALADMIN_INTERNALUSER};

<span class="nc" id="L72">    private static Admin internalAdmin = null;</span>
    
<span class="nc" id="L74">    protected int type = -1;</span>
    protected String data;
    protected Certificate certificate;
<span class="nc" id="L77">    protected String username = null;</span>
<span class="nc" id="L78">    protected String email = null;</span>
    
    /** transient authToken should _not_ be serialized. **/
<span class="nc" id="L81">    protected transient byte[] authToken = AdminInformation.getRandomToken();</span>
    
    // We want to cache the AdminInformation, but we crete it on the fly after deserialization..
<span class="nc" id="L84">    protected transient AdminInformation adminInformation = null;</span>

    // Public Constructors
    public Admin(Certificate certificate, String username, String email) {
<span class="nc" id="L88">        this(TYPE_CLIENTCERT_USER, CertTools.getSerialNumberAsString(certificate) + &quot; : DN : \&quot;&quot; + CertTools.getIssuerDN(certificate)+&quot;\&quot;&quot;);</span>
<span class="nc" id="L89">        this.certificate = certificate;</span>
<span class="nc" id="L90">        this.username = username;</span>
<span class="nc" id="L91">        this.email = email;</span>
<span class="nc" id="L92">    }</span>

    /**
     * @param type type
     * @param ipOrCertIssuerSerno
     * 		ip address of publib web users etc or certserno and issuerDN for certificate authenticated admins (see other constructor above)
     */
<span class="nc" id="L99">    public Admin(int type, String ipOrCertIssuerSerno) {</span>
<span class="nc" id="L100">        this.type = type;</span>
<span class="nc" id="L101">        this.data = ipOrCertIssuerSerno;</span>
<span class="nc" id="L102">    }</span>
    

    public Admin(int type) {
<span class="nc" id="L106">        this(type, null);</span>
<span class="nc" id="L107">    }</span>


    // Public Methods

    public int getAdminType() {
<span class="nc" id="L113">        return this.type;</span>
    }

    public String getAdminData() {
<span class="nc" id="L117">        return this.data;</span>
    }

    // Method that takes the internal data and returns a AdminInformation object required by the Authorization module.
    public AdminInformation getAdminInformation() {
<span class="nc bnc" id="L122" title="All 2 branches missed.">    	if (adminInformation==null) {</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">            if (type == TYPE_CLIENTCERT_USER) {</span>
<span class="nc" id="L124">            	adminInformation = new AdminInformation(certificate, authToken);</span>
            } else {
<span class="nc" id="L126">            	adminInformation = new AdminInformation(ADMINTYPETOADMINENTITY[type], authToken);</span>
            }
    	}
<span class="nc" id="L129">        return adminInformation;</span>
    }

    /**
     * Method that returns the caid of the CA, the admin belongs to.
     * Doesn't work properly for public web and special users so use with care.
     * @return ID
     */
    public int getCaId() {
<span class="nc" id="L138">        int returnval = INTERNALCAID;</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">        if (type == TYPE_CLIENTCERT_USER) {</span>
<span class="nc" id="L140">            returnval = CertTools.getIssuerDN(certificate).hashCode();</span>
        }
<span class="nc" id="L142">        return returnval;</span>
    }

    public String toString() {
<span class="nc" id="L146">    	String ret =  &quot;UNKNOWN&quot;;</span>
<span class="nc bnc" id="L147" title="All 4 branches missed.">    	if ((type &gt; -1) &amp;&amp; (type &lt; ADMINTYPETEXTS.length-1)) {</span>
<span class="nc" id="L148">        	ret = ADMINTYPETEXTS[type];    		</span>
    	}
<span class="nc" id="L150">    	return ret;</span>
    }
    
    /**
     * @return this administrator's email address or null if none is available
     */
    public String getEmail() {
<span class="nc" id="L157">    	return email;</span>
    }

    /**
     * @return this administrator's username or null if none is available
     */
    public String getUsername() {
<span class="nc" id="L164">    	return username;</span>
    }
    

    /**
     * Manually sets the authToken. This should only be done in special cases 
     * such as when restoring an Approval from the database.
     * Note: Setting this to AdminInformation.getRandomToken() means that 
     * this object is treated as it were created internal in EJBCA. Do not do
     * that unless trusting the object!
     * @param authToken Value of the authtoken.
     */
    public void setAuthToken(final byte[] authToken) {
<span class="nc" id="L177">    	this.authToken = authToken;</span>
<span class="nc" id="L178">    }</span>

    /** Instead of creating a new Admin(TYPE_INTERNALUSER), this can be used to use a shared instance of the object. 
     * @return Admin */
    public static Admin getInternalAdmin() {
<span class="nc bnc" id="L183" title="All 2 branches missed.">    	if (internalAdmin == null) {</span>
<span class="nc" id="L184">    		internalAdmin = new Admin(TYPE_INTERNALUSER);</span>
    	}
<span class="nc" id="L186">    	return internalAdmin;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>