<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>RaEndEntitySearchRequest.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Unit Test Aggregator</a> &gt; <a href="../index.html" class="el_bundle">ejbca-ejb-interface</a> &gt; <a href="index.source.html" class="el_package">org.ejbca.core.model.era</a> &gt; <span class="el_source">RaEndEntitySearchRequest.java</span></div><h1>RaEndEntitySearchRequest.java</h1><pre class="source lang-java linenums">/*************************************************************************
 *                                                                       *
 *  EJBCA Community: The OpenSource Certificate Authority                *
 *                                                                       *
 *  This software is free software; you can redistribute it and/or       *
 *  modify it under the terms of the GNU Lesser General Public           *
 *  License as published by the Free Software Foundation; either         *
 *  version 2.1 of the License, or any later version.                    *
 *                                                                       *
 *  See terms of license at gnu.org.                                     *
 *                                                                       *
 *************************************************************************/
package org.ejbca.core.model.era;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.List;

import org.apache.commons.lang.builder.HashCodeBuilder;

/**
 * Search request for end entities from RA UI.
 *
 * @version $Id: RaEndEntitySearchRequest.java 26524 2017-09-11 09:12:49Z bastianf $
 */
public class RaEndEntitySearchRequest implements Serializable, Comparable&lt;RaEndEntitySearchRequest&gt; {

    private static final long serialVersionUID = 1L;
    //private static final Logger log = Logger.getLogger(RaEndEntitySearchRequest.class);
<span class="nc" id="L30">    public static int DEFAULT_MAX_RESULTS = 25;</span>

<span class="nc" id="L32">    private int maxResults = DEFAULT_MAX_RESULTS;</span>
<span class="nc" id="L33">    private List&lt;Integer&gt; eepIds = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L34">    private List&lt;Integer&gt; cpIds = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L35">    private List&lt;Integer&gt; caIds = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L36">    private String subjectDnSearchString = &quot;&quot;;</span>
<span class="nc" id="L37">    private boolean subjectDnSearchExact = false;</span>
<span class="nc" id="L38">    private String subjectAnSearchString = &quot;&quot;;</span>
<span class="nc" id="L39">    private boolean subjectAnSearchExact = false;</span>
<span class="nc" id="L40">    private String usernameSearchString = &quot;&quot;;</span>
<span class="nc" id="L41">    private boolean usernameSearchExact = false;</span>
<span class="nc" id="L42">    private long modifiedAfter = 0L;</span>
<span class="nc" id="L43">    private long modifiedBefore = Long.MAX_VALUE;</span>
<span class="nc" id="L44">    private List&lt;Integer&gt; statuses = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L45">    private int pageNumber = 0;</span>

    /** Default constructor */
<span class="nc" id="L48">    public RaEndEntitySearchRequest() {}</span>

    /** Copy constructor 
     * @param request req */
<span class="nc" id="L52">    public RaEndEntitySearchRequest(final RaEndEntitySearchRequest request) {</span>
<span class="nc" id="L53">        maxResults = request.maxResults;</span>
<span class="nc" id="L54">        pageNumber = request.pageNumber;</span>
<span class="nc" id="L55">        eepIds.addAll(request.eepIds);</span>
<span class="nc" id="L56">        cpIds.addAll(request.cpIds);</span>
<span class="nc" id="L57">        caIds.addAll(request.caIds);</span>
<span class="nc" id="L58">        subjectDnSearchString = request.subjectDnSearchString;</span>
<span class="nc" id="L59">        subjectDnSearchExact = request.subjectDnSearchExact;</span>
<span class="nc" id="L60">        subjectAnSearchString = request.subjectAnSearchString;</span>
<span class="nc" id="L61">        subjectAnSearchExact = request.subjectAnSearchExact;</span>
<span class="nc" id="L62">        usernameSearchString = request.usernameSearchString;</span>
<span class="nc" id="L63">        usernameSearchExact = request.usernameSearchExact;</span>
<span class="nc" id="L64">        modifiedAfter = request.modifiedAfter;</span>
<span class="nc" id="L65">        modifiedBefore = request.modifiedBefore;</span>
<span class="nc" id="L66">        statuses.addAll(request.statuses);</span>
<span class="nc" id="L67">    }</span>

<span class="nc" id="L69">    public int getMaxResults() { return maxResults; }</span>

    public int getPageNumber() {
<span class="nc" id="L72">        return pageNumber;</span>
    }

    public void setPageNumber(final int pageNumber) {
<span class="nc" id="L76">        this.pageNumber = pageNumber;</span>
<span class="nc" id="L77">    }</span>

<span class="nc" id="L79">    public void setMaxResults(final int maxResults) { this.maxResults = maxResults; }</span>
<span class="nc" id="L80">    public List&lt;Integer&gt; getEepIds() { return eepIds; }</span>
<span class="nc" id="L81">    public void setEepIds(final List&lt;Integer&gt; eepIds) { this.eepIds = eepIds; }</span>
<span class="nc" id="L82">    public List&lt;Integer&gt; getCpIds() { return cpIds; }</span>
<span class="nc" id="L83">    public void setCpIds(final List&lt;Integer&gt; cpIds) { this.cpIds = cpIds; }</span>
<span class="nc" id="L84">    public List&lt;Integer&gt; getCaIds() { return caIds; }</span>
<span class="nc" id="L85">    public void setCaIds(final List&lt;Integer&gt; caIds) { this.caIds = caIds; }</span>
<span class="nc" id="L86">    public String getSubjectDnSearchString() { return subjectDnSearchString; }</span>
<span class="nc" id="L87">    public void setSubjectDnSearchString(final String subjectDnSearchString) { this.subjectDnSearchString = subjectDnSearchString; }</span>
<span class="nc" id="L88">    public boolean isSubjectDnSearchExact() { return subjectDnSearchExact; }</span>
<span class="nc" id="L89">    public void setSubjectDnSearchExact(final boolean subjectDnSearchExact) { this.subjectDnSearchExact = subjectDnSearchExact; }</span>
<span class="nc" id="L90">    public String getSubjectAnSearchString() { return subjectAnSearchString; }</span>
<span class="nc" id="L91">    public void setSubjectAnSearchString(final String subjectAnSearchString) { this.subjectAnSearchString = subjectAnSearchString; }</span>
<span class="nc" id="L92">    public boolean isSubjectAnSearchExact() { return subjectAnSearchExact; }</span>
<span class="nc" id="L93">    public void setSubjectAnSearchExact(final boolean subjectAnSearchExact) { this.subjectAnSearchExact = subjectAnSearchExact; }</span>
<span class="nc" id="L94">    public String getUsernameSearchString() { return usernameSearchString; }</span>
<span class="nc" id="L95">    public void setUsernameSearchString(final String usernameSearchString) { this.usernameSearchString = usernameSearchString; }</span>
<span class="nc" id="L96">    public boolean isUsernameSearchExact() { return usernameSearchExact; }</span>
<span class="nc" id="L97">    public void setUsernameSearchExact(final boolean usernameSearchExact) { this.usernameSearchExact = usernameSearchExact; }</span>

<span class="nc" id="L99">    public long getModifiedAfter() { return modifiedAfter; }</span>
<span class="nc" id="L100">    public void setModifiedAfter(final long modifiedAfter) { this.modifiedAfter = modifiedAfter; }</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">    public boolean isModifiedAfterUsed() { return modifiedAfter&gt;0L; }</span>
<span class="nc" id="L102">    public void resetModifiedAfter() { this.modifiedAfter = 0L; }</span>

<span class="nc" id="L104">    public long getModifiedBefore() { return modifiedBefore; }</span>
<span class="nc" id="L105">    public void setModifiedBefore(final long modifiedBefore) { this.modifiedBefore = modifiedBefore; }</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">    public boolean isModifiedBeforeUsed() { return modifiedBefore&lt;Long.MAX_VALUE; }</span>
<span class="nc" id="L107">    public void resetModifiedBefore() { this.modifiedBefore = Long.MAX_VALUE; }</span>

<span class="nc" id="L109">    public List&lt;Integer&gt; getStatuses() { return statuses; }</span>
<span class="nc" id="L110">    public void setStatuses(final List&lt;Integer&gt; statuses) { this.statuses = statuses; }</span>

    @Override
    public int hashCode() {
<span class="nc" id="L114">        return HashCodeBuilder.reflectionHashCode(this);</span>
    }

    @Override
    public boolean equals(final Object object) {
<span class="nc bnc" id="L119" title="All 2 branches missed.">        if (!(object instanceof RaEndEntitySearchRequest)) {</span>
<span class="nc" id="L120">            return false;</span>
        }
<span class="nc" id="L122">        final RaEndEntitySearchRequest request = (RaEndEntitySearchRequest) object;</span>
<span class="nc bnc" id="L123" title="All 4 branches missed.">        return compareTo(request) == 0 &amp;&amp; this.pageNumber == request.getPageNumber();</span>
    }

    // negative = this object is less (more narrow) than other. E.g. only when other contains this and more.
    // positive = this object is greater (wider) than other
    // zero = this object is equal to other
    @Override
    public int compareTo(final RaEndEntitySearchRequest other) {
<span class="nc bnc" id="L131" title="All 2 branches missed.">        if (other==null) {</span>
<span class="nc" id="L132">            return 1;</span>
        }
        // First check if there is any there is any indication that this does not contain the whole other
<span class="nc bnc" id="L135" title="All 2 branches missed.">        if (maxResults&gt;other.maxResults ||</span>
<span class="nc bnc" id="L136" title="All 10 branches missed.">                isWider(eepIds, other.eepIds) || isWider(cpIds, other.cpIds) || isWider(caIds, other.caIds) ||</span>
                modifiedAfter&lt;other.modifiedAfter || modifiedBefore&gt;other.modifiedBefore ||
<span class="nc bnc" id="L138" title="All 2 branches missed.">                isWider(subjectDnSearchString, other.subjectDnSearchString) ||</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">                isWider(subjectDnSearchExact, other.subjectDnSearchExact) ||</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">                isWider(subjectAnSearchString, other.subjectAnSearchString) ||</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">                isWider(subjectAnSearchExact, other.subjectAnSearchExact) ||</span>
<span class="nc bnc" id="L142" title="All 2 branches missed.">                isWider(usernameSearchString, other.usernameSearchString) ||</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">                isWider(usernameSearchExact, other.usernameSearchExact) ||</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">                isWider(statuses, other.statuses)) {</span>
            // This does not contain whole other → wider
<span class="nc" id="L146">            return 1;</span>
        }
        // Next check if this object is more narrow than the other
<span class="nc bnc" id="L149" title="All 2 branches missed.">        if (maxResults&lt;other.maxResults ||</span>
<span class="nc bnc" id="L150" title="All 10 branches missed.">                isMoreNarrow(eepIds, other.eepIds) || isMoreNarrow(cpIds, other.cpIds) || isMoreNarrow(caIds, other.caIds) ||</span>
                modifiedAfter&gt;other.modifiedAfter || modifiedBefore&lt;other.modifiedBefore ||
<span class="nc bnc" id="L152" title="All 2 branches missed.">                isMoreNarrow(subjectDnSearchString, other.subjectDnSearchString) ||</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">                isMoreNarrow(subjectDnSearchExact, other.subjectDnSearchExact) ||</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">                isMoreNarrow(subjectAnSearchString, other.subjectAnSearchString) ||</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">                isMoreNarrow(subjectAnSearchExact, other.subjectAnSearchExact) ||</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">                isMoreNarrow(usernameSearchString, other.usernameSearchString) ||</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">                isMoreNarrow(usernameSearchExact, other.usernameSearchExact) ||</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">                isMoreNarrow(statuses, other.statuses)) {</span>
            // This does contain whole other, but other does not contain whole this → more narrow
<span class="nc" id="L160">            return -1;</span>
        }
<span class="nc" id="L162">        return 0;</span>
    }

    /** @param thisObject obj
     * @param otherObject obj
     * @return true if thisObject does contain whole other, but other does not contain whole this → more narrow */
    private boolean isMoreNarrow(final List&lt;Integer&gt; thisObject, final List&lt;Integer&gt; otherObject) {
<span class="nc bnc" id="L169" title="All 4 branches missed.">        return thisObject.containsAll(otherObject) &amp;&amp; !otherObject.containsAll(thisObject);</span>
    }
    /** @param thisObject obj
     * @param otherObject obj
     * @return true if thisObject does contain whole other, but other does not contain whole this → more narrow */
    private boolean isMoreNarrow(final String thisObject, final String otherObject) {
<span class="nc bnc" id="L175" title="All 4 branches missed.">        return thisObject.contains(otherObject) &amp;&amp; !otherObject.contains(thisObject);</span>
    }
    /** @param thisObjectExact obj
     * @param otherObjectExact obj
     * @return true if thisObject does contain whole other, but other does not contain whole this → more narrow */
    private boolean isMoreNarrow(final boolean thisObjectExact, final boolean otherObjectExact) {
<span class="nc bnc" id="L181" title="All 4 branches missed.">        return thisObjectExact &amp;&amp; !otherObjectExact;</span>
    }
    /** @param thisObject obj
     * @param otherObject obj
     * @return true if thisObject does not contain whole other → wider */
    private boolean isWider(final List&lt;Integer&gt; thisObject, final List&lt;Integer&gt; otherObject) {
<span class="nc bnc" id="L187" title="All 2 branches missed.">        return !thisObject.containsAll(otherObject);</span>
    }
    /** @param thisObject obj
     * @param otherObject obj
     * @return true if thisObject does not contain whole other → wider */
    private boolean isWider(final String thisObject, final String otherObject) {
<span class="nc bnc" id="L193" title="All 2 branches missed.">        return !thisObject.contains(otherObject);</span>
    }
    /** @param thisObjectExact obj
     * @param otherObjectExact obj
     * @return true if thisObject does not contain whole other → wider */
    private boolean isWider(final boolean thisObjectExact, final boolean otherObjectExact) {
<span class="nc bnc" id="L199" title="All 4 branches missed.">        return !thisObjectExact &amp;&amp; otherObjectExact;</span>
    }

    /** @param endEntityProfileId ID
     * @return true if the endEntityProfileId is matched by this search. */
<span class="nc bnc" id="L204" title="All 4 branches missed.">    public boolean matchEep(final int endEntityProfileId) { return eepIds.isEmpty() || eepIds.contains(Integer.valueOf(endEntityProfileId)); }</span>
    /** @param certificateProfileId ID
     * @return true if the certificateId is matched by this search. */
<span class="nc bnc" id="L207" title="All 4 branches missed.">    public boolean matchCp(final int certificateProfileId) { return cpIds.isEmpty() || cpIds.contains(Integer.valueOf(certificateProfileId)); }</span>
    /** @param caId ID
     * @return true if the endEntityProfileId is matched by this search. */
<span class="nc bnc" id="L210" title="All 4 branches missed.">    public boolean matchCa(final int caId) { return caIds.isEmpty() || caIds.contains(Integer.valueOf(caId)); }</span>

    /** @param modified mod
     * @return true if the notBefore is matched by this search. */
    public boolean matchModifiedInterval(final Long modified) {
<span class="nc bnc" id="L215" title="All 6 branches missed.">        if (isModifiedAfterUsed() &amp;&amp; (modified==null || modified.longValue()&lt;modifiedAfter)) {</span>
<span class="nc" id="L216">            return false;</span>
        }
<span class="nc bnc" id="L218" title="All 6 branches missed.">        if (isModifiedBeforeUsed() &amp;&amp; (modified==null || modified.longValue()&gt;modifiedBefore)) {</span>
<span class="nc" id="L219">            return false;</span>
        }
<span class="nc" id="L221">        return true;</span>
    }

    /** @param username user
     * @return true if the username is matched by this search. */
    public boolean matchUsername(final String username) {
<span class="nc bnc" id="L227" title="All 8 branches missed.">        return username != null &amp;&amp; ((!usernameSearchExact &amp;&amp; username.toUpperCase().contains(usernameSearchString.toUpperCase())) ||</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">                                    (usernameSearchExact &amp;&amp; username.equalsIgnoreCase(usernameSearchString)));</span>
    }
    /** @param subjectDn DN
     * @return true if the subjectDn is matched by this search. */
    public boolean matchSubjectDn(final String subjectDn) {
<span class="nc bnc" id="L233" title="All 8 branches missed.">        return subjectDn != null &amp;&amp; ((!subjectDnSearchExact &amp;&amp; subjectDn.toUpperCase().contains(subjectDnSearchString.toUpperCase())) ||</span>
<span class="nc bnc" id="L234" title="All 2 branches missed.">                                    (subjectDnSearchExact &amp;&amp; subjectDn.equalsIgnoreCase(subjectDnSearchString)));</span>
    }
    /** @param subjectAn An
     * @return true if the subjectAn is matched by this search. */
    public boolean matchSubjectAn(final String subjectAn) {
<span class="nc bnc" id="L239" title="All 10 branches missed.">        return subjectAn != null &amp;&amp; ((!subjectAnSearchExact &amp;&amp; subjectAn.contains(subjectAnSearchString)) || (subjectAnSearchExact &amp;&amp; subjectAn.equals(subjectAnSearchString)));</span>
    }

    /** @param status Status
     * @return true if the EE status is matched by this search. */
    public boolean matchStatus(final int status) {
<span class="nc bnc" id="L245" title="All 4 branches missed.">        if (!statuses.isEmpty() &amp;&amp; !statuses.contains(status)) {</span>
<span class="nc" id="L246">            return false;</span>
        }
<span class="nc" id="L248">        return true;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>