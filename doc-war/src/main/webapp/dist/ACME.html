<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ACME - EJBCA - Documentation Space</title>

    
            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="85921598">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_6.15.2.6_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=16237454"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_6.15.2.6_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Documentation.html">EJBCA Documentation</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Operations.html">EJBCA Operations</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Concept_Guide.html">EJBCA Concept Guide</a></li>
                                                                                     <li><a href="Protocols.html">Protocols</a></li>
                                                            </ul>
</div>            <h1 id="src-16237454"> <span>ACME</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
></p>
<p   
><span class="status blue " >ENTERPRISE</span>
 This is an EJBCA Enterprise feature.</p>
        </div>
    </div>
<p   
></p>
<ul class="toc-indentation "></ul>    <div class="section section-1" id="src-16237454_id-.ACMEv6.15.0-ACMEOverview">
        <h1 class="heading "><span>ACME Overview</span></h1>
<p   
>The Automatic Certificate Management Environment (ACME) is a protocol that a Certificate Authority (CA) and an applicant can use to automate the process of verification and certificate issuance.</p>
    </div>
    <div class="section section-1" id="src-16237454_id-.ACMEv6.15.0-SupportedOperationssupported_operations">
        <h1 class="heading "><span id="src-16237454_id-.ACMEv6.15.0-supported_operations" class="confluence-anchor-link"></span><span>Supported Operations </span></h1>
<p   
>The ACME RFC Internet-Draft is a working document. The EJBCA implementation currently complies with <a  class="external-link" href="https://tools.ietf.org/html/draft-ietf-acme-acme-12">IETF - ACME Draft 12</a>.</p>
    <div  class="tablewrap">
        <table class="wrapped relative-table confluenceTable">
                    <colgroup>
                                    <col  width="10%"/>
                                    <col  width="31%"/>
                                    <col  width="46%"/>
                                    <col  width="12%"/>
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Operation</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>URL</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Description</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Draft Reference</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>directory</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>/ejbca/acme/directory</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Provides a JSON object describing the other commands.</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
><a  class="external-link" href="https://tools.ietf.org/html/draft-ietf-acme-acme-12#section-7.1.1">7.1.1</a></p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>newNonce</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>/ejbca/acme/newNonce</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Before any POST action is performed, the client needs to retrieve an anti-replay nonce from the server.</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
><a  class="external-link" href="https://tools.ietf.org/html/draft-ietf-acme-acme-12#section-7.2">7.2</a></p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>newAccount</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>/ejbca/acme/newAccount</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
></p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
><a  class="external-link" href="https://tools.ietf.org/html/draft-ietf-acme-acme-12#section-7.3">7.3</a></p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>updateAccount</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>/ejbca/acme/acct/{accountId}</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
></p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
><a  class="external-link" href="https://tools.ietf.org/html/draft-ietf-acme-acme-12#section-7.3.2">7.3.2</a></p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>newOrder</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>/ejbca/acme/newOrder</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
></p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
><a  class="external-link" href="https://tools.ietf.org/html/draft-ietf-acme-acme-12#section-7.4">7.4</a></p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>challengeResponse</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>/ejbca/acme/acct/{accountId}/authz/{authorizationId}/{challengeId}</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
></p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
><a  class="external-link" href="https://tools.ietf.org/html/draft-ietf-acme-acme-12#section-7.5.1">7.5.1</a></p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>newAuthz</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>/ejbca/acme/newAuthz</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Only if <strong class=" ">Pre-Authorization Allowed</strong> is enabled in the Alias configuration.</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
><a  class="external-link" href="https://tools.ietf.org/html/draft-ietf-acme-acme-12#section-7.4.1">7.4.1</a></p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>finalizeOrder</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>/ejbca/acme/acct/{accountId}/orders/{orderId}/finalize</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
></p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
><a  class="external-link" href="https://tools.ietf.org/html/draft-ietf-acme-acme-12#section-7.1.3">7.1.3</a></p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>revokeCert</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>/ejbca/acme/revokeCert</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
></p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
><a  class="external-link" href="https://tools.ietf.org/html/draft-ietf-acme-acme-12#section-7.6">7.6</a></p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>keyChange</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>/ejbca/acme/keyChange</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
></p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
><a  class="external-link" href="https://tools.ietf.org/html/draft-ietf-acme-acme-12#section-7.3.6">7.3.6</a></p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    <div class="section section-1" id="src-16237454_id-.ACMEv6.15.0-URLEndpointsandAliases">
        <h1 class="heading "><span>URL Endpoints and Aliases</span></h1>
<p   
>The ACME service is available on the following URLs.</p>
    <div  class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col />
                                    <col />
                            </colgroup>
        <thead class=" "></thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Default alias with client authentication</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>https://&lt;server&gt;:8443/ejbca/acme/directory</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Default alias without client authentication</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>https://&lt;server&gt;:8442/ejbca/acme/directory</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Custom alias &lt;alias_name&gt; with client authentication</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>https://&lt;server&gt;:8443/ejbca/acme/directory?configurationId=&lt;alias_name&gt;</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Custom alias &lt;alias_name&gt; without client authentication</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>https://&lt;server&gt;:8442/ejbca/acme/directory?configurationId=&lt;alias_name&gt;</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    <div class="section section-1" id="src-16237454_id-.ACMEv6.15.0-EJBCASpecifics">
        <h1 class="heading "><span>EJBCA Specifics</span></h1>
<ul class=" "><li class=" "><p   
>Approvals in EJBCA for certificate issuance and revocation cannot be used with ACME.</p>
</li><li class=" "><p   
>All ACME operations are performed over the peers protocol. Thus it is perfectly possible to use an external RA running EJBCA as an ACME proxy.</p>
</li><li class=" "><p   
>Validators for CAA checking etc. are configured as described in <a   href="Validators.html">Validators</a>.</p>
</li><li class=" "><p   
>You need to set up separate aliases for each end entity profile/certificate profile and CA.</p>
</li></ul>    </div>
    <div class="section section-1" id="src-16237454_id-.ACMEv6.15.0-Configurationoverview">
        <h1 class="heading "><span id="src-16237454_id-.ACMEv6.15.0-overview" class="confluence-anchor-link"></span><span>Configuration </span></h1>
    <div class="section section-2" id="src-16237454_id-.ACMEv6.15.0-EnablingACME">
        <h2 class="heading "><span>Enabling ACME</span></h2>
<p   
>    <span style="color: #000000;">
The ACME protocol is by default disabled. To enable the service, go to <strong class=" ">Admin Web &gt; System Configuration &gt; Protocol Configuration</strong> and select <strong class=" ">Enable</strong> for <strong class=" ">ACME</strong>.    </span>
</p>
<p   
>    <span style="color: #000000;">
<strong class=" "><img  class="confluence-embedded-image"  src="images/download/attachments/16237454/Screen_Shot_2018-08-02_at_14.41.27.png" alt="images/download/attachments/16237454/Screen_Shot_2018-08-02_at_14.41.27.png"  height="250" />
<br/></strong>    </span>
</p>
    </div>
    <div class="section section-2" id="src-16237454_id-.ACMEv6.15.0-ManagingACMEConfigurations">
        <h2 class="heading "><span>Managing ACME Configurations</span></h2>
<p   
>    <span style="color: #000000;">
Much like other protocols in EJBCA, several different ACME configurations can be maintained at the same time using aliases.<br/>    </span>
</p>
<p   
>    <span style="color: #000000;">
To configure ACME, select <strong class=" ">ACME Configuration</strong>    <span style="color: #000000;">
 under the     </span>
    <span style="color: #000000;">
    <span style="color: #000000;">
<strong class=" ">System Configuration </strong>menu.    </span>
    </span>
    </span>
</p>
<p   
>    <span style="color: #000000;">
    <span style="color: #000000;">
    <span style="color: #000000;">
<img  class="confluence-embedded-image confluence-content-image-border image-center"                 style="display:block; margin-left: auto; margin-right: auto;"
     src="images/download/attachments/16237454/Screen_Shot_2018-08-02_at_14.44.14.png" alt="images/download/attachments/16237454/Screen_Shot_2018-08-02_at_14.44.14.png" width="600" height="168" />
    </span>
    </span>
    </span>
</p>
    <div class="section section-3" id="src-16237454_id-.ACMEv6.15.0-GlobalFields">
        <h3 class="heading "><span>Global Fields</span></h3>
<p   
>    <span style="color: #000000;">
The following fields are defined globally for all ACME operations.    </span>
</p>
    <div  class="tablewrap">
        <table class="relative-table wrapped confluenceTable">
                    <colgroup>
                                    <col  width="31%"/>
                                    <col  width="68%"/>
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Field</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Description</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Default ACME Configuration</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>The configuration to use if the specified alias doesn't exist.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Replay Nonce Validity Number</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Defines the validity in milliseconds of a generated replay nonce.</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    <div class="section section-3" id="src-16237454_id-.ACMEv6.15.0-AliasSpecificFieldsAliasSpecificFields">
        <h3 class="heading "><span>Alias Specific Fields </span></h3>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image confluence-content-image-border image-center"                 style="display:block; margin-left: auto; margin-right: auto;"
     src="images/download/attachments/16237454/Screen_Shot_2018-08-02_at_15.43.57.png" alt="images/download/attachments/16237454/Screen_Shot_2018-08-02_at_15.43.57.png" width="647" height="250" />
<br/>    </span>
</p>
<p   
>    <span style="color: #000000;">
The following table lists ACME specific fields for each individual alias.    </span>
</p>
    <div  class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col />
                                    <col />
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Field</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Description</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>End Entity Profile</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>The end entity profile to use for end entities enrolled using this alias. The CA signing the certificate is the default CA of this end entity profile, and the certificate profile used for the certificate is the default certificate profile of this end entity profile.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Pre-Authorization Allowed</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Pre-authorization, as defined in <a  class="external-link" href="https://tools.ietf.org/html/draft-ietf-acme-acme-12#section-7.4.1">section 7.4.1 of the draft</a>.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Wildcard Certificate Issuance Allowed</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Whether this alias can be used to issue certificates with wildcard DNS names in their SANs. See <a  class="external-link" href="https://tools.ietf.org/html/draft-ietf-acme-acme-12#section-7.1.3">section 7.1.3 of the draft</a>.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Site URL</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>URL to a website describing this CA. Optional. See <a  class="external-link" href="https://tools.ietf.org/html/draft-ietf-acme-acme-12#section-7.1.1">section 7.1.1 of the draft</a>.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Terms of Service URL</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>URL to your terms of service for ACME. Optional. See <a  class="external-link" href="https://tools.ietf.org/html/draft-ietf-acme-acme-12#section-7.1.1">section 7.1.1 of the draft</a>.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p  class="p1" 
>Require client approval for Terms of Service changes</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>    <span style="color: #212121;">
Specifies whether users must approve the new version if the Terms of Service URL is changed.    </span>
</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>DNS Resolver</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>A specified DNS resolver, used when processing dns01 challenges.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>DNS Port</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Port used for DNS communications.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>DNSSEC Trust Anchor</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>The ICANN trust anchor, configurable should it ever change.</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
<p   
></p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>The optional feature External Account Binding is not supported in this release. The corresponding field in the directory output (<strong class=" ">externalAccountRequired</strong>) is disabled by default and not editable.</p>
        </div>
    </div>
    </div>
    </div>
    <div class="section section-2" id="src-16237454_id-.ACMEv6.15.0-EndEntityProfileConfiguration">
        <h2 class="heading "><span>End Entity Profile Configuration</span></h2>
<p   
>The following settings should be used for an end entity profile used with ACME.</p>
    <div  class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col />
                                    <col />
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Field</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Value</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Username</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Auto-generated</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>    <span style="color: #000000;">
Password (or Enrollment Code)    </span>
</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Leave empty</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>    <span style="color: #000000;">
Batch generation (clear text pwd storage)    </span>
</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Use</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>    <span style="color: #000000;">
End Entity E-mail    </span>
</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Use, Required, Modifiable</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
><strong class=" ">Subject DN Attributes</strong></p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
></p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>    <span style="color: #000000;">
CN, Common name    </span>
</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Required, Modifiable</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Default Certificate Profile</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&lt;The certificate profile to use&gt;</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Default CA</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&lt;The CA signing the certificate&gt;</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Default Token</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>User Generated</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
<p   
></p>
    </div>
    </div>
    <div class="section section-1" id="src-16237454_id-.ACMEv6.15.0-AuthenticationandValidationauthentication">
        <h1 class="heading "><span id="src-16237454_id-.ACMEv6.15.0-authentication" class="confluence-anchor-link"></span><span>Authentication and Validation </span></h1>
<p   
>EJBCA currently supports the two validation methods http01 and dns01, defined in <a  class="external-link" href="https://tools.ietf.org/html/draft-ietf-acme-acme-12#section-8">section 8 </a>of the draft<i class=" ">.</i></p>
    <div class="section section-2" id="src-16237454_safe-id-aWQtLkFDTUV2Ni4xNS4wLUhUVFBDaGFsbGVuZ2UoaHR0cDAxKQ">
        <h2 class="heading "><span>HTTP Challenge (http01)</span></h2>
<p   
>If the client chooses to use the http01<i class=" "> </i>challenge type, it intends to prove that it controls the domain requested in the certificate by provisioning a resource under the same domain name. As per the draft, EJBCA will send out a challenge to the client, which the client will sign using its private key and provide on the domain in a known location for EJBCA to retrieve. EJBCA will then be able to use the public key provided in the original request to verify domain control.</p>
    </div>
    <div class="section section-2" id="src-16237454_safe-id-aWQtLkFDTUV2Ni4xNS4wLUROU0NoYWxsZW5nZShkbnMwMSk">
        <h2 class="heading "><span>DNS Challenge (dns01)</span></h2>
<p   
>If the client chooses to use the dns01 challenge type, it instead obligates itself to supply a TXT record containing the same token response as described above. As per the draft, DNSSEC is required for dns01 challenges.</p>
    </div>
    </div>
    <div class="section section-1" id="src-16237454_id-.ACMEv6.15.0-CompatibilitywithACMEClients">
        <h1 class="heading "><span>Compatibility with ACME Clients</span></h1>
<p   
>EJBCA is compatible with the following ACME clients (taken from <a  class="external-link" href="https://letsencrypt.org/docs/client-options/">Letsencrypt's list of compatible ACME clients</a>):</p>
<ul class=" "><li class=" "><p   
><a  class="external-link" href="https://certbot.eff.org/">Certbot</a></p>
</li><li class=" "><p   
><a  class="external-link" href="https://github.com/diafygi/acme-tiny">ACME Tiny</a></p>
</li><li class=" "><p   
><a  class="external-link" href="https://github.com/porunov/acme_client">PJAC</a></p>
</li></ul>    <div class="section section-2" id="src-16237454_id-.ACMEv6.15.0-EJBCAACMEwithCertbot">
        <h2 class="heading "><span>EJBCA ACME with Certbot</span></h2>
<p   
><a  class="external-link" href="https://certbot.eff.org/">Certbot</a> used to be Let's Encrypt's official client but is now maintained by the Electronic Frontier Foundation. It is one of the most used ACME clients, supporting issuance, renewal and revocation operations, which are all supported by EJBCA. For more information, refer to the <a  class="external-link" href="https://certbot.eff.org/docs/">Certbot Documentation</a>.</p>
<p   
>Certbot by default uses Let's Encrypts servers. To specify an alternative server URL, use the <tt class=" ">--server</tt> option:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">--server https:</code><code class="comments">//localhost:8442/ejbca/acme/directory</code></div>
</div>
    </div>
<p   
>Note that you can also use the <tt class=" ">server</tt> option in cli.ini.</p>
    <div class="section section-3" id="src-16237454_id-.ACMEv6.15.0-CertbotExamples">
        <h3 class="heading "><span>Certbot Examples</span></h3>
<p   
>The following HTTP Validation and DNS Validation examples assume that a Ubuntu machine with JBoss 6.4 is used and that EJBCA is accessible under https://localhost:8442 public HTTPS, using certbot 0.26.1.</p>
<p   
>First, run the following command in the command line to ensure that a connection to the ACME server is up and running:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">curl -k https:</code><code class="comments">//localhost:8442/ejbca/acme/directory</code></div>
</div>
    </div>
<p   
>The successful output of the above command should be as follows (showing the resources available in the EJBCA ACME server), otherwise the scenarios will fail:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">{</code><code class="string">"newNonce"</code><code class="plain">:</code><code class="string">"https://localhost:8442/ejbca/acme/newNonce"</code><code class="plain">,</code><code class="string">"newAccount"</code><code class="plain">:</code><code class="string">"https://localhost:8442/ejbca/acme/newAccount"</code><code class="plain">,</code><code class="string">"newOrder"</code><code class="plain">:</code><code class="string">"https://localhost:8442/ejbca/acme/newOrder"</code><code class="plain">,</code><code class="string">"revokeCert"</code><code class="plain">:</code><code class="string">"https://localhost:8442/ejbca/acme/revokeCert"</code><code class="plain">,</code><code class="string">"keyChange"</code><code class="plain">:</code><code class="string">"https://localhost:8442/ejbca/acme/keyChange"</code><code class="plain">,</code><code class="string">"meta"</code><code class="plain">:{</code><code class="string">"termsOfService"</code><code class="plain">:</code><code class="string">"https://example.com/acme/terms"</code><code class="plain">,</code><code class="string">"website"</code><code class="plain">:</code><code class="string">"https://www.example.com/"</code><code class="plain">,</code><code class="string">"caaIdentities"</code><code class="plain">:[],</code><code class="string">"externalAccountRequired"</code><code class="plain">:</code><code class="keyword">false</code><code class="plain">}}</code></div>
</div>
    </div>
    <div class="section section-4" id="src-16237454_id-.ACMEv6.15.0-HTTPValidationExample">
        <h4 class="heading "><span>HTTP Validation Example</span></h4>
<p   
>This example covers setting up a local HTTP server, issuing a certificate for an identifier using HTTP validation, and also shows how to revoke the certificate.</p>
    <div class="section section-5" id="src-16237454_safe-id-aWQtLkFDTUV2Ni4xNS4wLTEpU2V0dXBhTG9jYWxIVFRQU2VydmVy">
        <h5 class="heading "><span>1) Setup a Local HTTP Server</span></h5>
<p   
>The following describes setting up a local HTTP server. Note that you can optionally use the temporary web server (or any other supported HTTP server plugins) provided by Certbot. For more information, refer to the Certbot Documentation on <a  class="external-link" href="https://certbot.eff.org/docs/using.html#getting-certificates-and-choosing-plugins">Getting certificates (and choosing plugins)</a>.</p>
<p   
>Follow the steps below to setup a local HTTP server (for example Apache with the default working directory <tt class=" ">/var/www/html</tt>):</p>
<ol class=" "><li class=" "><p   
>Add the following virtual host under     <span style="color: #242729;">
    <span style="color: #242729;">
<tt class=" ">/etc/apache2/sites-available/example.com.conf</tt>:<br/>    </span>
    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;VirtualHost *:</code><code class="value">80</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">  ServerName example.com</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">  DocumentRoot </code><code class="string">"/var/www/html/"</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">&lt;/VirtualHost&gt; </code></div>
</div>
    </div>
<p   
>    <span style="color: #242729;">
<br/>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #242729;">
    <span style="color: #242729;">
Enable the site using the <tt class=" ">a2ensite</tt> command:<br/>    </span>
    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">sudo a2ensite example.com </code></div>
</div>
    </div>
<p   
>    <span style="color: #242729;">
<br/>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #242729;">
    <span style="color: #242729;">
Reload the Apache configuration using the reload command:<br/>    </span>
    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">sudo service apache2 reload</code></div>
</div>
    </div>
<p   
>    <span style="color: #242729;">
<br/>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #242729;">
    <span style="color: #242729;">
Next, restart Apache:    </span>
    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">sudo /etc/init.d/apache2 restart</code></div>
</div>
    </div>
<p   
>    <span style="color: #242729;">
<br/>    </span>
</p>
</li><li class=" "><p   
>Then add the following line to your <tt class=" ">/etc/hosts</tt> file:    <span style="color: #242729;">
    <span style="color: #242729;">
<br/>    </span>
    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="value">127.0</code><code class="plain">.</code><code class="value">0.1</code><code class="plain">       example.com</code></div>
</div>
    </div>
<p   
>    <span style="color: #242729;">
<br/>    </span>
</p>
</li></ol>    </div>
    <div class="section section-5" id="src-16237454_safe-id-aWQtLkFDTUV2Ni4xNS4wLTIpT2J0YWluYUNlcnRpZmljYXRldXNpbmdDZXJ0Ym90">
        <h5 class="heading "><span>2) Obtain a Certificate using Certbot </span></h5>
<p   
>    <span style="color: #242729;">
To     <span style="color: #242729;">
issue a certificate for an identifier (in this case example.com)     </span>
using Certbot, do the following. It requires that you have     </span>
Certbot installed on your machine, and that EJBCA is up and running with ACME enabled and with an ACME alias configured with an appropriate end entity profile.</p>
<ol class=" "><li class=" "><p   
>To obtain the certificate, run the Certbot <tt class=" ">certonly</tt> sub command:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">sudo certbot --no-verify-ssl certonly --webroot -w /var/www/html/ -d example.com --server https:</code><code class="comments">//localhost:8442/ejbca/acme/directory</code></div>
</div>
    </div>
<p   
></p>
<p   
>Alternatively, to instead issue a certificate for a wildcard domain, enable the <strong class=" ">Wildcard Certificate Issuance Allowed</strong> option on the <strong class=" ">ACME Configuration Alias</strong> page (see <a   href="#src-16237454_id-.ACMEv6.15.0-AliasSpecificFields">Alias Specific Fields</a>) and run the Certbot <tt class=" ">certonly</tt> sub command providing a wildcard domain as identifier:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">sudo certbot --no-verify-ssl certonly --webroot -w /var/www/html/ -d *.example.com --server https:</code><code class="comments">//localhost:8442/ejbca/acme/directory</code></div>
</div>
    </div>
<p   
></p>
</li><li class=" "><p   
>If successful, a message similar to the following is displayed:</p>
    <div  class="confbox programlisting">
                <div class="content">
        <pre><code>IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at:
 /etc/letsencrypt/live/example.com/fullchain.pem
 Your key file has been saved at:
 /etc/letsencrypt/live/example.com/privkey.pem
 
  Your cert will expire on 2020-08-21. To obtain a new or tweaked version of this certificate in the future, 
  simply run certbot again. To non-interactively renew *all* of your certificates, run &quot;certbot renew&quot;</code></pre>
        </div>
    </div>
<p   
></p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>If you run the same <tt class=" ">certbot certonly</tt> command twice, Certbot asks if you want to renew the current certificate. To allow renewal using the same Subject DN name, the <strong class=" ">    <span style="color: #000000;">
Enforce Unique DN    </span>
</strong> field on the <strong class=" ">Edit CA</strong> page must be cleared. For more information, see <a   href="CA_Fields.html">CA Fields</a>.</p>
        </div>
    </div>
</li><li class=" "><p   
>To verify the obtained certificate, go to the EJBCA Admin Web, search for End Entities, and check that there is a End Entity certificate    <span style="color: #000000;">
 with the status    </span>
 <strong class=" ">Generated</strong> and <strong class=" ">CN = example.com</strong>.</p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>The error message<i class=" "> The client lacks sufficient authorization :: The client lacks sufficient authorization</i> indicates a conflict between the new account creation and existing ACME accounts. To resolve, remove everything under /etc/letsencrypt/live, /etc/letsencrypt/accounts and /etc/letsencrypt/keys and try again.</p>
        </div>
    </div>
</li></ol>    </div>
    <div class="section section-5" id="src-16237454_safe-id-aWQtLkFDTUV2Ni4xNS4wLTMpUmV2b2tlQ2VydGlmaWNhdGU">
        <h5 class="heading "><span>3) Revoke Certificate</span></h5>
<p   
>This example covers how to revoke the certificate issued in the previous step.</p>
<ol class=" "><li class=" "><p   
>To revoke the issued certificate, run the Certbot <tt class=" ">revoke</tt> command:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">sudo certbot --no-verify-ssl --server https:</code><code class="comments">//localhost:8442/ejbca/acme/directory revoke --cert-path /etc/letsencrypt/live/example.com/fullchain.pem</code></div>
</div>
    </div>
</li><li class=" "><p   
>When asked to verify deleting the issued certificate, reply with <strong class=" ">Y</strong>. The following success message displays:</p>
    <div  class="confbox programlisting">
                <div class="content">
        <pre><code>Congratulations! You have successfully revoked the certificate that was located at /etc/letsencrypt/live/example.com/fullchain.pem</code></pre>
        </div>
    </div>
</li><li class=" "><p   
>To verify, go to EJBCA Admin Web and check the status for the corresponding End Entity certificate and ensure that it is revoked.</p>
</li></ol>    </div>
    </div>
    <div class="section section-4" id="src-16237454_id-.ACMEv6.15.0-DNSValidationExample">
        <h4 class="heading "><span>DNS Validation Example</span></h4>
<p   
>This example covers verifying your DNS server setup, issuing a certificate for an identifier using Domain Name System Security Extensions    <span style="color: #222222;">
 (    </span>
DNSSEC    <span style="color: #222222;">
)    </span>
 validation, and also shows how to revoke the certificate.</p>
    <div class="section section-5" id="src-16237454_safe-id-aWQtLkFDTUV2Ni4xNS4wLTEpVmVyaWZ5aW5nRE5TU2VydmVyU2V0dXA">
        <h5 class="heading "><span>1) Verifying DNS Server Setup</span></h5>
<p   
>Ensure that you have a DNS server setup which you can add TXT records to. In this example, dnsmasq is used,     <span style="color: #222222;">
included in most     </span>
Linux distributions.</p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>The EJBCA ACME server currently supports DNSSEC validation and this example uses allow.klaan.nu to be able to pass DNSSEC validation.</p>
        </div>
    </div>
    </div>
    <div class="section section-5" id="src-16237454_safe-id-aWQtLkFDTUV2Ni4xNS4wLTIpT2J0YWluYUNlcnRpZmljYXRldXNpbmdDZXJ0Ym90LjE">
        <h5 class="heading "><span>2) Obtain a Certificate using Certbot </span></h5>
<p   
>    <span style="color: #242729;">
To     <span style="color: #242729;">
issue a certificate for an identifier (in this case allow.klaan.nu) using Domain Name System Security Extensions    <span style="color: #222222;">
 (    </span>
DNSSEC    <span style="color: #222222;">
)    </span>
 validation    </span>
, do the following.    </span>
</p>
<ol class=" "><li class=" "><p   
>To obtain the certificate, run the Certbot <tt class=" ">certonly</tt> sub command and specify the <tt class=" ">--manual</tt> flag to run Certbot interactively and allow preparing the DNS server with the DNS challenge offered by the ACME server:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">sudo certbot --no-verify-ssl certonly --manual --preferred-challenges=dns -d allow.klaan.nu --server https:</code><code class="comments">//localhost:8442/ejbca/acme/directory</code></div>
</div>
    </div>
<p   
></p>
<p   
>Alternatively, to instead issue a certificate for a wildcard domain, enable the <strong class=" ">Wildcard Certificate Issuance Allowed</strong> option on the <strong class=" ">ACME Configuration Alias</strong> page (see <a   href="#src-16237454_id-.ACMEv6.15.0-AliasSpecificFields">Alias Specific Fields</a>) and run the Certbot <tt class=" ">certonly</tt> sub command providing a wildcard domain as identifier:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">sudo certbot --no-verify-ssl certonly --manual --preferred-challenges=dns -d *.allow.klaan.nu --server https:</code><code class="comments">//localhost:8442/ejbca/acme/directory</code></div>
</div>
    </div>
</li><li class=" "><p   
>Agree to your IP being logged by replying <strong class=" ">Yes</strong> to the following:</p>
    <div  class="confbox programlisting">
                <div class="content">
        <pre><code>Are you OK with your IP being logged?
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
(Y)es/(N)o:</code></pre>
        </div>
    </div>
</li><li class=" "><p   
>Certbot displays the TXT record challenge offered by the ACME server which have to be provisioned in the DNS server. Before pressing <strong class=" ">Enter,</strong> run the following command to provision the TXT record in dnsmasq:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">sudo dnsmasq --port=</code><code class="string">"1453"</code><code class="plain"> --txt-record=</code><code class="string">"_acme-challenge.allow.klaan.nu, pULO3RjCbzqjWH0JK2FQ5BDe-5SI2Eo2Vn1l_fmrtdk"</code><code class="plain"> --listen-address=</code><code class="string">"127.0.0.1"</code><code class="plain">  --</code><code class="keyword">interface</code><code class="plain">=</code><code class="string">"lo"</code><code class="plain"> --bind-interfaces</code></div>
</div>
    </div>
<p   
></p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>The port number used above is just an example. Note that the port number must equal the port set for the ACME Alias currently used by the EJBCA ACME server, configured in <strong class=" ">Admin Web&gt;System Configuration&gt;ACME Configuration</strong>. In addition, the <strong class=" ">DNS Resolver</strong> field needs to be set to localhost in the ACME Configuration Alias page, see <a   href="#src-16237454_id-.ACMEv6.15.0-AliasSpecificFields">Alias Specific Fields</a>.</p>
        </div>
    </div>
</li><li class=" "><p   
>After running the above command, press <strong class=" ">Enter</strong> in the Certbot command prompt to continue. A message similar to the following is displayed for a successful certificate issuance:</p>
    <div  class="confbox programlisting">
                <div class="content">
        <pre><code>IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at:
   /etc/letsencrypt/live/allow.klaan.nu/fullchain.pem
   Your key file has been saved at:
   /etc/letsencrypt/live/allow.klaan.nu/privkey.pem
   
   Your cert will expire on 2020-08-21. To obtain a new or tweaked version of this certificate in the future, 
   simply run certbot again. To non-interactively renew *all* of your certificates, run &quot;certbot renew&quot;</code></pre>
        </div>
    </div>
</li><li class=" "><p   
>To verify that the certificate is issued in EJBCA, go to the EJBCA Admin Web, and check that the End Entity Search page includes a row with <strong class=" ">CN = allow.klaan.nu</strong> and a valid certificate.</p>
</li></ol>    </div>
    <div class="section section-5" id="src-16237454_safe-id-aWQtLkFDTUV2Ni4xNS4wLTMpUmV2b2tlQ2VydGlmaWNhdGUuMQ">
        <h5 class="heading "><span>3) Revoke Certificate</span></h5>
<p   
>This example covers how to revoke the certificate issued in the previous step.</p>
<ol class=" "><li class=" "><p   
>To revoke the issued certificate, run the Certbot <tt class=" ">revoke</tt> command:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">sudo certbot --no-verify-ssl --server https:</code><code class="comments">//localhost:8442/ejbca/acme/directory revoke --cert-path /etc/letsencrypt/live/allow.klaan.nu/fullchain.pem</code></div>
</div>
    </div>
</li><li class=" "><p   
>If successful, the following message displays:</p>
    <div  class="confbox programlisting">
                <div class="content">
        <pre><code>Congratulations! You have successfully revoked the certificate that was located at /etc/letsencrypt/live/allow.klaan.nu/fullchain.pem</code></pre>
        </div>
    </div>
</li><li class=" "><p   
>To verify, ensure that the certificate is revoked with the reason <strong class=" ">    <span style="color: #000000;">
Unspecified    </span>
</strong> by checking its status in the EJBCA Admin Web End Entity Search page.</p>
</li></ol><p   
></p>
    </div>
    </div>
    </div>
    </div>
    <div class="section section-2" id="src-16237454_id-.ACMEv6.15.0-EJBCAACMEwithPJAC">
        <h2 class="heading "><span>EJBCA ACME with PJAC</span></h2>
<p   
>Porunov Java ACME Client (PJAC) is an     <span style="color: #24292e;">
application based on     </span>
<a  class="external-link" href="https://github.com/shred/acme4j">acme4j</a>    <span style="color: #24292e;">
, a Java ACME library implementation.     </span>
To try out EJBCA with PJAC, just follow these guides for <a  class="external-link" href="https://github.com/porunov/acme_client/wiki/Example-scenarios">Example scenarios</a>.</p>
<p   
>EJBCA is tested with the following PJAC flows:</p>
<ul class=" "><li class=" "><p   
>Get a certificate for multiple domains</p>
</li><li class=" "><p   
>Renew a certificate for multiple domains</p>
</li><li class=" "><p   
>Get a wildcard certificate</p>
</li><li class=" "><p   
>Revoke certificate</p>
</li><li class=" "><p   
>Deactivate account</p>
</li><li class=" "><p   
>HTTP01 and DNS01 challenge types</p>
</li></ul><p   
><img  class="emoticon emoticon-warning"  src="images/s/en_US/8100/b0984b7297905b7c7bd946458f753ce0130bfc8c/_/images/icons/emoticons/warning.svg" alt="images/s/en_US/8100/b0984b7297905b7c7bd946458f753ce0130bfc8c/_/images/icons/emoticons/warning.svg"   />
 Note that you need to configure PJAC to have the EJBCA instance as its ACME service, by adding the following extra parameter to every <tt class=" ">acme_client.jar</tt> command execution:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">-u https:</code><code class="comments">//localhost:8442/ejbca/acme/directory</code></div>
</div>
    </div>
<p   
>For example, the 5th step in the <a  class="external-link" href="https://github.com/porunov/acme_client/wiki/Get-a-certificate-for-multiple-domains">Get a certificate for multiple domains</a> guide would look like this:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Step 5 from the PJAC guide</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Step 5 from the PJAC guide" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">java -jar acme_client.jar --</code><code class="functions">command</code><code class="plain"> register -a </code><code class="plain">/etc/pjac/account</code><code class="plain">.key </code></div>
<div class="line"><code class="plain">  --with-agreement-update -u https:</code><code class="plain">//localhost</code><code class="plain">:8442</code><code class="plain">/ejbca/acme/directory</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-16237454_id-.ACMEv6.15.0-EJBCAACMEwithACMETiny">
        <h2 class="heading "><span>EJBCA ACME with ACME Tiny</span></h2>
<ol class=" "><li class=" "><p   
>Clone the repository:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">git clone https:</code><code class="comments">//github.com/diafygi/acme-tiny.git</code></div>
</div>
    </div>
</li><li class=" "><p   
>Change EJBCA ACME URLs:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">-DEFAULT_CA = </code><code class="string">"https://acme-v02.api.letsencrypt.org"</code><code class="plain"> # DEPRECATED! USE DEFAULT_DIRECTORY_URL INSTEAD</code></div>
<div class="line"><code class="plain">-DEFAULT_DIRECTORY_URL = </code><code class="string">"https://acme-v02.api.letsencrypt.org/directory"</code></div>
<div class="line"><code class="plain">+</code></div>
<div class="line"><code class="plain">+DEFAULT_CA = </code><code class="string">"https://{ejbca_url}:8442"</code><code class="plain"> # DEPRECATED! USE DEFAULT_DIRECTORY_URL INSTEAD</code></div>
<div class="line"><code class="plain">+DEFAULT_DIRECTORY_URL = </code><code class="string">"https://{ejbca_url}:8442/ejbca/acme/directory"</code></div>
</div>
    </div>
</li><li class=" "><p   
>Prepare input for ACME:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain"># Generate </code><code class="keyword">private</code><code class="plain"> key</code></div>
<div class="line"><code class="plain">openssl genrsa </code><code class="value">4096</code><code class="plain"> &gt; account.key</code></div>
<div class="line"><code class="plain"># Generate CSR</code></div>
<div class="line"><code class="plain">openssl req -</code><code class="keyword">new</code><code class="plain"> -sha256 -key account.key -subj </code><code class="string">"/emailAddress=acme_test@primekey.com/CN=my.acme"</code><code class="plain"> &gt; account.csr</code></div>
</div>
    </div>
</li><li class=" "><p   
>Launch ACME Tiny (Tested with Python2):</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">sudo python acme_tiny.py --account-key ./account.key --csr ./account.csr --acme-dir ./acme-dir/ --contact </code><code class="string">'mailto:acme@primekey.com'</code><code class="plain"> &gt; ./signed_chain.crt</code></div>
</div>
    </div>
</li></ol><p   
>where <tt class=" ">--acme-dir ./acme-dir/</tt> might be integrated and/or point to your current web server, for example Apache2 /var/www/html/.well-known/acme-challenge/.</p>
    </div>
    </div>
    <div class="section section-1" id="src-16237454_id-.ACMEv6.15.0-WorkflowExamplesexamples">
        <h1 class="heading "><span id="src-16237454_id-.ACMEv6.15.0-examples" class="confluence-anchor-link"></span><span>Workflow Examples </span></h1>
<p   
>The following lists ACME calls to perform in order to get a certificate.</p>
    <div class="section section-2" id="src-16237454_id-.ACMEv6.15.0-getDirectoryrequest">
        <h2 class="heading "><span>getDirectory request</span></h2>
<p   
>Verifies that the EJBCA ACME service is up and running.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">GET /acme/directory HTTP/</code><code class="value">1.1</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">{  </code></div>
<div class="line"><code class="plain">   </code><code class="string">"newNonce"</code><code class="plain">:</code><code class="string">"https://footrust.local:8443/ejbca/acme/newNonce"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">   </code><code class="string">"newAccount"</code><code class="plain">:</code><code class="string">"https://footrust.local:8443/ejbca/acme/newAccount"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">   </code><code class="string">"newOrder"</code><code class="plain">:</code><code class="string">"https://footrust.local:8443/ejbca/acme/newOrder"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">   </code><code class="string">"newAuthz"</code><code class="plain">:</code><code class="string">"https://footrust.local:8443/ejbca/acme/newAuthz"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">   </code><code class="string">"revokeCert"</code><code class="plain">:</code><code class="string">"https://footrust.local:8443/ejbca/acme/revokeCert"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">   </code><code class="string">"keyChange"</code><code class="plain">:</code><code class="string">"https://footrust.local:8443/ejbca/acme/keyChange"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">   </code><code class="string">"meta"</code><code class="plain">:{  </code></div>
<div class="line"><code class="plain">      </code><code class="string">"termsOfService"</code><code class="plain">:</code><code class="string">"https://footrust.com/acme/terms"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">      </code><code class="string">"website"</code><code class="plain">:</code><code class="string">"https://footrust.com"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">      </code><code class="string">"caaIdentities"</code><code class="plain">:[  </code></div>
<div class="line"><code class="plain">         </code><code class="string">"footrust.com"</code></div>
<div class="line"><code class="plain">      ],</code></div>
<div class="line"><code class="plain">      </code><code class="string">"externalAccountRequired"</code><code class="plain">:</code><code class="keyword">false</code></div>
<div class="line"><code class="plain">   }</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-16237454_id-.ACMEv6.15.0-newAccount">
        <h2 class="heading "><span>newAccount</span></h2>
<p   
>Creates a new ACME account to EJBCA. EJBCA uses a public key to verify the JWS (that is, the <tt class=" ">jwk</tt> element of the JWS header) to authenticate future requests from the account. EJBCA supports RSA and EC key types.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">POST https:</code><code class="comments">//localhost:8442/ejbca/acme/newAccount HTTP/1.1</code></div>
<div class="line"><code class="plain">Content-Type: application/jose+json</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">  </code><code class="string">"protected"</code><code class="plain">: base64url({</code></div>
<div class="line"><code class="plain">    </code><code class="string">"alg"</code><code class="plain">: </code><code class="string">"ES256"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"jwk"</code><code class="plain">: {...},</code></div>
<div class="line"><code class="plain">    </code><code class="string">"nonce"</code><code class="plain">: </code><code class="string">"6S8IqOGY7eL2lsGoTZYifg"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"url"</code><code class="plain">: </code><code class="string">"https://example.com/acme/newAccount"</code></div>
<div class="line"><code class="plain">  }),</code></div>
<div class="line"><code class="plain">  </code><code class="string">"payload"</code><code class="plain">: base64url({</code></div>
<div class="line"><code class="plain">    </code><code class="string">"termsOfServiceAgreed"</code><code class="plain">: </code><code class="keyword">true</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"contact"</code><code class="plain">: [</code></div>
<div class="line"><code class="plain">      </code><code class="string">"mailto:cert-admin@example.com"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">      </code><code class="string">"tel:+12025551212"</code></div>
<div class="line"><code class="plain">    ]</code></div>
<div class="line"><code class="plain">  }),</code></div>
<div class="line"><code class="plain">  </code><code class="string">"signature"</code><code class="plain">: </code><code class="string">"RZPOnYoPs1PhjszF...-nh6X1qtOFPB519I"</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-16237454_id-.ACMEv6.15.0-newOrderrequest">
        <h2 class="heading "><span>newOrder request</span></h2>
<p   
>To create a new ACME order.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">POST /acme/newOrder HTTP/</code><code class="value">1.1</code></div>
<div class="line"><code class="plain">Content-Type: application/jose+json</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain"> </code><code class="string">"protected"</code><code class="plain">: base64url({</code></div>
<div class="line"><code class="plain">   </code><code class="string">"alg"</code><code class="plain">: </code><code class="string">"ES256"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">   </code><code class="string">"kid"</code><code class="plain">: </code><code class="string">"https://example.com/acme/acct/1"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">   </code><code class="string">"nonce"</code><code class="plain">: </code><code class="string">"5XJ1L3lEkMG7tR6pA00clA"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">   </code><code class="string">"url"</code><code class="plain">: </code><code class="string">"https://example.com/acme/new-order"</code></div>
<div class="line"><code class="plain"> }),</code></div>
<div class="line"><code class="plain"> </code><code class="string">"payload"</code><code class="plain">: base64url({</code></div>
<div class="line"><code class="plain">   </code><code class="string">"identifiers"</code><code class="plain">: [</code></div>
<div class="line"><code class="plain">	 { </code><code class="string">"type"</code><code class="plain">: </code><code class="string">"dns"</code><code class="plain">, </code><code class="string">"value"</code><code class="plain">: </code><code class="string">"example.com"</code><code class="plain"> }</code></div>
<div class="line"><code class="plain">   ],</code></div>
<div class="line"><code class="plain">   </code><code class="string">"notBefore"</code><code class="plain">: </code><code class="string">"2016-01-01T00:00:00Z"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">   </code><code class="string">"notAfter"</code><code class="plain">: </code><code class="string">"2016-01-08T00:00:00Z"</code></div>
<div class="line"><code class="plain"> }),</code></div>
<div class="line"><code class="plain"> </code><code class="string">"signature"</code><code class="plain">: </code><code class="string">"H6ZXtGjTZyUnPeKn...wEA4TklBdh3e454g"</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>The newOrder response contains information about challenges. For more information, refer to the <a  class="external-link" href="https://tools.ietf.org/html/draft-ietf-acme-acme-12#section-7.5.1">section 7.5.1 of the draft.</a></p>
    </div>
    <div class="section section-2" id="src-16237454_id-.ACMEv6.15.0-newAuthzrequest">
        <h2 class="heading "><span>newAuthz request</span></h2>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">POST /acme/newAuthz HTTP/</code><code class="value">1.1</code></div>
<div class="line"><code class="plain">Host: example.com</code></div>
<div class="line"><code class="plain">Content-Type: application/jose+json</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">  </code><code class="string">"protected"</code><code class="plain">: base64url({</code></div>
<div class="line"><code class="plain">    </code><code class="string">"alg"</code><code class="plain">: </code><code class="string">"ES256"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"jwk"</code><code class="plain">: {...},</code></div>
<div class="line"><code class="plain">    </code><code class="string">"nonce"</code><code class="plain">: </code><code class="string">"uQpSjlRb4vQVCjVYAyyUWg"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"url"</code><code class="plain">: </code><code class="string">"https://example.com/acme/newAuthz"</code></div>
<div class="line"><code class="plain">  }),</code></div>
<div class="line"><code class="plain">  </code><code class="string">"payload"</code><code class="plain">: base64url({</code></div>
<div class="line"><code class="plain">    </code><code class="string">"identifier"</code><code class="plain">: {</code></div>
<div class="line"><code class="plain">      </code><code class="string">"type"</code><code class="plain">: </code><code class="string">"dns"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">      </code><code class="string">"value"</code><code class="plain">: </code><code class="string">"example.net"</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">  }),</code></div>
<div class="line"><code class="plain">  </code><code class="string">"signature"</code><code class="plain">: </code><code class="string">"nuSDISbWG8mMgE7H...QyVUL68yzf3Zawps"</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-16237454_id-.ACMEv6.15.0-challengeResponserequest">
        <h2 class="heading "><span>challengeResponse request</span></h2>
<p   
>To prove to EJBCA's ACME service that you possess control over the domain.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">POST /acme/acct/{accountId}/authz/{authorizationId}/{challengeId} HTTP/</code><code class="value">1.1</code></div>
<div class="line"><code class="plain">Content-Type: application/jose+json</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain"> </code><code class="string">"protected"</code><code class="plain">: base64url({</code></div>
<div class="line"><code class="plain">   </code><code class="string">"alg"</code><code class="plain">: </code><code class="string">"ES256"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">   </code><code class="string">"kid"</code><code class="plain">: </code><code class="string">"https://example.com/acme/acct/1"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">   </code><code class="string">"nonce"</code><code class="plain">: </code><code class="string">"Q_s3MWoqT05TrdkM2MTDcw"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">   </code><code class="string">"url"</code><code class="plain">: </code><code class="string">"https://example.com/acme/authz/1234/0"</code></div>
<div class="line"><code class="plain"> }),</code></div>
<div class="line"><code class="plain"> </code><code class="string">"payload"</code><code class="plain">: base64url({}),</code></div>
<div class="line"><code class="plain"> </code><code class="string">"signature"</code><code class="plain">: </code><code class="string">"9cbg5JO1Gf5YLjjz...SpkUfcdPai9uVYYQ"</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-16237454_id-.ACMEv6.15.0-finalizeOrderrequest">
        <h2 class="heading "><span>finalizeOrder request</span></h2>
<p   
>To generate the certificate.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">POST /acme/acct/{accountId}/orders/{orderId}/finalize HTTP </code><code class="value">1.1</code></div>
<div class="line"><code class="plain">Content-Type: application/jose+json</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain"> </code><code class="string">"protected"</code><code class="plain">: base64url({</code></div>
<div class="line"><code class="plain">   </code><code class="string">"alg"</code><code class="plain">: </code><code class="string">"ES256"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">   </code><code class="string">"kid"</code><code class="plain">: </code><code class="string">"https://example.com/acme/acct/1"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">   </code><code class="string">"nonce"</code><code class="plain">: </code><code class="string">"MSF2j2nawWHPxxkE3ZJtKQ"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">   </code><code class="string">"url"</code><code class="plain">: </code><code class="string">"https://example.com/acme/order/asdf/finalize"</code></div>
<div class="line"><code class="plain"> }),</code></div>
<div class="line"><code class="plain"> </code><code class="string">"payload"</code><code class="plain">: base64url({</code></div>
<div class="line"><code class="plain">   </code><code class="string">"csr"</code><code class="plain">: </code><code class="string">"MIIBPTCBxAIBADBFMQ...FS6aKdZeGsysoCo4H9P"</code><code class="plain">,</code></div>
<div class="line"><code class="plain"> }),</code></div>
<div class="line"><code class="plain"> </code><code class="string">"signature"</code><code class="plain">: </code><code class="string">"uOrUfIIk5RyQ...nw62Ay1cl6AB"</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>The response to the <tt class=" ">finalizeOrder</tt> call is the certificate.</p>
    </div>
    </div>
    <div class="section section-1" id="src-16237454_id-.ACMEv6.15.0-StatusCodesstatus_codes">
        <h1 class="heading "><span id="src-16237454_id-.ACMEv6.15.0-status_codes" class="confluence-anchor-link"></span><span>Status Codes </span></h1>
    <div  class="tablewrap">
        <table class="wrapped relative-table confluenceTable">
                    <colgroup>
                                    <col  width="31%"/>
                                    <col  width="68%"/>
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>HTTP Status Code</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Description</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>200</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Success</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>201</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Created</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>204</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>No content</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>400</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Bad request</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>401</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Unauthorized</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>403</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Forbidden</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>404</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Not found</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>409</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Conflict</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="Protocols.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Protocols</span>
        </a>
                <a href="Certificate_Management_REST_Interface.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Certificate Management REST Interface</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

</body>
</html>
