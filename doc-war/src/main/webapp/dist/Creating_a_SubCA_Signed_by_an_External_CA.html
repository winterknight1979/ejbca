<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Creating a SubCA Signed by an External CA - EJBCA - Documentation Space</title>

    
            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="85921598">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_6.15.2.6_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=16230030"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_6.15.2.6_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Documentation.html">EJBCA Documentation</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Operations.html">EJBCA Operations</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_User_Guide.html">EJBCA User Guide</a></li>
                                                                                                         <li class="shortcut"><a href="CA_Operations_Guide.html">CA Operations Guide</a></li>
                                                                                     <li><a href="Managing_CAs.html">Managing CAs</a></li>
                                                            </ul>
</div>            <h1 id="src-16230030"> <span>Creating a SubCA Signed by an External CA</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

<p   
>Some CA hierarchies have the requirement of being signed by an external Certificate Authority and sometimes other external CAs need to be signed by your CA.</p>
<p   
>When creating a CA that is signed by an external CA, you create a PKCS10 certificate request that is sent to the external CA. When the external CA returns your CAs certificate, this is processed, and the CA becomes activated.</p>
<p   
>The following describes how to create a CA signed by an external CA, either using the GUI or the CLI.</p>
    <div class="section section-1" id="src-16230030_id-.CreatingaSubCASignedbyanExternalCAv6.13.0-CreatingaCASignedbyanExternalCAUsingtheGUI">
        <h1 class="heading "><span>Creating a CA Signed by an External CA Using the GUI</span></h1>
<p   
>To have your CA signed by an external CA, perform the following steps:</p>
<ol class=" "><li class=" "><p   
>Select <strong class=" ">Admin GUI &gt; Certificate Authorities</strong>.</p>
</li><li class=" "><p   
>Create a new CA in the same way as internal CAs, but when selecting signing CA, instead select <strong class=" ">External CA</strong>. The fields <strong class=" ">Certificate Profile</strong>, <strong class=" ">Validity</strong>,<strong class=" "> Subject Alternative Name</strong> and <strong class=" ">Policy Id</strong> will become unavailable.</p>
</li><li class=" "><p   
>Specify the <strong class=" ">Description</strong> and <strong class=" ">CRL Specific</strong> data.</p>
</li><li class=" "><p   
>Make sure that the certificate chain is available, in one of the following ways:</p>
<ul class=" "><li class=" "><p   
>Select a (PEM encoded) file containing the CA certificate chain of the signing CA. If there is more than one top CA certificate, all their certificates should be appended into one single file in plain PEM format without blank lines before or after (see <a   href="#src-16230030_id-.CreatingaSubCASignedbyanExternalCAv6.13.0-PEMFileExample">PEM File Example</a>).</p>
</li><li class=" "><p   
>Append the chain to the signed certificate file in the same way as when receiving the request (see below).</p>
</li><li class=" "><p   
>Import the complete certificate chain beforehand as External CAs (under <strong class=" ">Certificate Authorities-&gt;Import CA Certificate</strong>).</p>
</li></ul></li><li class=" "><p   
>Click <strong class=" ">Make Certificate Request</strong> to display the generated PKCS10 certificate request. You can copy and paste it to the signing CA or download the PEM file.</p>
</li><li class=" "><p   
>The external CA should sign the certificate request and return a certificate. Note that the newly created CA meanwhile will have the status <strong class=" ">Waiting for Certificate Response</strong> and only appear on the <strong class=" ">Edit CA</strong> page.</p>
</li><li class=" "><p   
>When the Certificate Response has arrived, activate the new CA by selecting the waiting CA and click <strong class=" ">Edit</strong> on the <strong class=" ">Edit CA</strong> page.</p>
</li><li class=" "><p   
>Click <strong class=" ">Receive Certificate Response</strong> (optionally specifying a password), upload the received certificate, and again click <strong class=" ">Receive Certificate Response</strong>.</p>
</li><li class=" "><p   
>If the received certificate forms a valid certificate chain with the previously uploaded chain or contained a full chain, the status of the CA is set to <strong class=" ">Active</strong>.</p>
</li><li class=" "><p   
>To optionally activate OCSP functionality for this new CA, edit it again and mark the OCSP functionality as active.</p>
</li><li class=" "><p   
>The new externally signed CA is ready to use.</p>
</li></ol><p   
>When uploading a chain, the certificates must be converted to PEM format if not already. To convert at file in DER encoding (.cer) using the following OpenSLL command:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">openssl x509 -inform DER -in filename.cer -outform PEM -out filename.pem </code></div>
</div>
    </div>
    <div class="section section-2" id="src-16230030_id-.CreatingaSubCASignedbyanExternalCAv6.13.0-PEMFileExample">
        <h2 class="heading "><span>PEM File Example</span></h2>
<p   
>The following displays an example of a plain PEM file for uploading as a certificate chain:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">-----BEGIN CERTIFICATE-----</code></div>
<div class="line"><code class="plain">MIIDSjCCAjKgAwIBAgIIEvabM2CgLZcwDQYJKoZIhvcNAQEFBQAwMzETMBEGA1UE</code></div>
<div class="line"><code class="plain">AxMKV2FsdGVyIENBMTEPMA0GA1UEChMGV2FsdGVyMQswCQYDVQQGEwJTRTAeFw0w</code></div>
<div class="line"><code class="plain">MzA5MjkwOTI2MzRaFw0wNDA5MjgwOTM2MzRaMDMxEzARBgNVBAMTCldhbHRlciBD</code></div>
<div class="line"><code class="plain">QTExDzANBgNVBAoTBldhbHRlcjELMAkGA1UEBhMCU0UwggEgMA0GCSqGSIb3DQEB</code></div>
<div class="line"><code class="plain">AQUAA4IBDQAwggEIAoIBAQC3hXksEud68WwPWWHLJQQkTCuX/K32KHPPn/uPUzab</code></div>
<div class="line"><code class="plain">Cpc/FnaTmF9yEHmpFdAUr0v5ZPnxVQpcuwrDZc4YfaTLfyUHicQbkftsPAj/2hE4</code></div>
<div class="line"><code class="plain">UukS2j+nQQcJEnIY0vSZOAOLU3j4bf/RlS6Jl7TPFFfWTxuQF8AruQ+YhaE52JFi</code></div>
<div class="line"><code class="plain">SapGGXKQJxhsvKT91rLaWSFWNMTTLSDPaBXYEYFuFhLNclDJWf4whfxHSHHkARB/</code></div>
<div class="line"><code class="plain">3Z0XlT4sFj0fmqEQ6yQb6/WqMFK+1XAIBXZO2MXe26IigWkXw1GfkIx1+fbUPrzu</code></div>
<div class="line"><code class="plain">8EI2jb0TWl21j1+Mvh3APZtVj5FJNuZN9bgdbrq88hLXAgERo2QwYjAPBgNVHRMB</code></div>
<div class="line"><code class="plain">Af8EBTADAQH/MA8GA1UdDwEB/wQFAwMHBgAwHQYDVR0OBBYEFNhHOtAwo8MOE/nI</code></div>
<div class="line"><code class="plain">zzg9KFxCYs8YMB8GA1UdIwQYMBaAFNhHOtAwo8MOE/nIzzg9KFxCYs8YMA0GCSqG</code></div>
<div class="line"><code class="plain">Sib3DQEBBQUAA4IBAQBHpvicbuJTACtpdwe6cF1nQ57FHnnYr+aAe+ZpH43R6R9d</code></div>
<div class="line"><code class="plain">eMps02nFAMSs5o8sbPokrpwAtk2yYwCohEFDkZ5JPzIBkgNlNnVHNNRHQTRJ6v6Q</code></div>
<div class="line"><code class="plain">F2MWUEPc1u5kxSjXEVMmZerG9oknMwpYFmkOnKF46vP3Njt/ExOeRAvCEQq2b8pz</code></div>
<div class="line"><code class="plain">2QGg8/IK6Omfi7IwxtVYUpgvhdcWekbFIlxkXZiEdlHNBIV1GzzPK1VEzg5kugD/</code></div>
<div class="line"><code class="plain">h6jeykrsKASx+55AkkBPt2kI+ZikVtp3SVhfZQMGY86c5QMQGlPWYNsr4ociyhfX</code></div>
<div class="line"><code class="plain">I52Qby+/HNG1ijpx66Z30lUMmXTtWtL4Cu8s7UvC</code></div>
<div class="line"><code class="plain">-----END CERTIFICATE-----</code></div>
<div class="line"><code class="plain">-----BEGIN CERTIFICATE-----</code></div>
<div class="line"><code class="plain">MIICxzCCAa+gAwIBAgIIBfqGjbQu14swDQYJKoZIhvcNAQEFBQAwMzETMBEGA1UE</code></div>
<div class="line"><code class="plain">AxMKV2FsdGVyIENBMTEPMA0GA1UEChMGV2FsdGVyMQswCQYDVQQGEwJTRTAeFw0w</code></div>
<div class="line"><code class="plain">MzA5MjkwOTMzMDFaFw0wNDAxMDcwOTQzMDFaMDQxETAPBgNVBAMTCER1ZGUgQ0Ex</code></div>
<div class="line"><code class="plain">MRIwEAYDVQQKEwlEdWRlIEluYy4xCzAJBgNVBAYTAlNFMIGdMA0GCSqGSIb3DQEB</code></div>
<div class="line"><code class="plain">AQUAA4GLADCBhwKBgQCM1hR/DYPXfKDa3oVJbppV4OcYtn2XP9W5Kc1d0+U4qLOm</code></div>
<div class="line"><code class="plain">JsqIFHDWR07o1QFiPhc9z0UGtwYeE3CpQ8fG8zeur5e286PYptZIST77B9vOdQdl</code></div>
<div class="line"><code class="plain">PA+dFKFIaEwdzcS7H3Lf38WTE4D1OnyRX5jsiUe+YIQRtjv/Bmem+kSR84G9TwIB</code></div>
<div class="line"><code class="plain">EaNkMGIwDwYDVR0TAQH/BAUwAwEB/zAPBgNVHQ8BAf8EBQMDBwYAMB0GA1UdDgQW</code></div>
<div class="line"><code class="plain">BBTDrXZGYXS9GyIUBOZrglhwNjjcnTAfBgNVHSMEGDAWgBTYRzrQMKPDDhP5yM84</code></div>
<div class="line"><code class="plain">PshcQmLPGDANBgkqhkiG9w0BAQUFAAOCAQEAdmTP1qVUcAKOf+/zvb2lcLKvFwKT</code></div>
<div class="line"><code class="plain">6KqDlO5NofjqCIfNgCjO2mO176cslnFIbEZQqgGIUnJ3AwfHKHj+U3kM3n5T29kF</code></div>
<div class="line"><code class="plain">xiLKxIDfjsY6qC03KHeGAgxI92XZyPsO1is6Y6qUnAmiwhIp5HS6E0+xIP1shmtJ</code></div>
<div class="line"><code class="plain">ZvqU8bueKUWSjx3JDzq+UNLX5pFkK0P0R90TCUEkBx1FNWqoWwb8zfAuO5zcNTEj</code></div>
<div class="line"><code class="plain">5E9esLjwxJQnIVPiA2l3FfZN9yomK+q7kTZJkX2kMx7G850lPR8CneXZT6bIOfck</code></div>
<div class="line"><code class="plain">Dw3PqQiroMNx2+gzC/f/wTXsF92aujyG+IZx1FIcNg/MoHXBWG7T8YrjnQ==</code></div>
<div class="line"><code class="plain">-----END CERTIFICATE-----</code></div>
</div>
    </div>
<p   
>You can treat an internal CA (a CA residing on the same EJBCA instance as another CA) as an external CA. From the SubCA this works just like the normal case, but on the RootCA you will issue the SubCA as an end entity.</p>
<p   
>This can be useful if you have an HSM setup where only one set of keys can be active at one time, for example using nCipher with two different, non-persistence, operator cards sets for the RootCA and the SubCA. Using the SubCA as an external CA you can still create the PKI but with only one CA active at a time.</p>
    </div>
    </div>
    <div class="section section-1" id="src-16230030_id-.CreatingaSubCASignedbyanExternalCAv6.13.0-CreatingaCASignedbyanExternalCAUsingtheCLI">
        <h1 class="heading "><span>Creating a CA Signed by an External CA Using the CLI</span></h1>
<p   
>To create a CA signed by an external CA using the CLI, follow the steps below:</p>
<ul class=" "><li class=" "><p   
>Create the CA generating a CSR. Note that the Crypto token password is set to <code class=" ">foo123</code>:</p>
</li></ul>    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">bin/ejbca.sh ca init CaSignedByExteral </code><code class="string">"CN=This CA is Signed by an external CA"</code><code class="plain"> soft foo123 secp256r1 ECDSA </code><code class="value">365</code><code class="plain"> </code><code class="keyword">null</code><code class="plain"> SHA256withECDSA --signedby External -externalcachain chain.pem</code></div>
</div>
    </div>
<p   style="margin-left:30px;"
>The file <code class=" ">chain.pem</code> contains the certificate chain of the external CA, as described above. Running the above command, a CSR named <code class=" ">CaSignedByExteral_csr.der</code> is saved to your disk, containing a PKCS#10 CSR in binary format. Send the CSR to the external CA and get the signed sub CA certificate returned back.</p>
<ul class=" "><li class=" "><p   
>Import the sub CA certificate, activating your CA:</p>
</li></ul>    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">bin/ejbca.sh ca importcacert CaSignedByExteral subcacertificate.pem</code></div>
</div>
    </div>
<p   
>The file <code class=" ">subcacertificate.pem</code> contains the received sub CA certificate.</p>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="Converting_an_OpenSSL_CA.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Converting an OpenSSL CA</span>
        </a>
                <a href="Creating_CA%27s.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Creating CA's</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

</body>
</html>
