<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>EJBCA 6.6 Upgrade Notes - EJBCA - Documentation Space</title>

    
            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="85921598">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_6.15.2.6_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=26772565"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_6.15.2.6_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Release_Information.html">EJBCA Release Information</a></li>
                                                                                     <li><a href="EJBCA_Upgrade_Notes.html">EJBCA Upgrade Notes</a></li>
                                                            </ul>
</div>            <h1 id="src-26772565"> <span>EJBCA 6.6 Upgrade Notes</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

<hr>
    <div class="section section-1" id="src-26772565_id-.EJBCA6.6UpgradeNotesv6.15.1-EJBCA6.5.xtoEJBCA6.6.1">
        <h1 class="heading p1"><span>EJBCA 6.5.x to EJBCA 6.6.1</span></h1>
<p   
>The following lists important notes on upgrading to EJBCA 6.6.x versions:</p>
<p   
></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-26772565_id-.EJBCA6.6UpgradeNotesv6.15.1-EJBCA6.6.0toEJBCA6.6.1">EJBCA 6.6.0 to EJBCA 6.6.1</a></p>
</li><li class=" "><p   
><a   href="#src-26772565_id-.EJBCA6.6UpgradeNotesv6.15.1-EJBCA6.5.xtoEJBCA6.6.0">EJBCA 6.5.x to EJBCA 6.6.0</a></p>
</li></ul><p  class="confluence-link" 
>For upgrade instructions and information on upgrade paths, see <a   href="Upgrading_EJBCA.html">Upgrading EJBCA</a>.</p>
<p   
>For details of the new features and improvements in the releases, see the <a   href="EJBCA_6.0_Release_Notes.html">EJBCA 6 Release Notes</a>.</p>
    <div class="section section-2" id="src-26772565_id-.EJBCA6.6UpgradeNotesv6.15.1-EJBCA6.6.0toEJBCA6.6.1">
        <h2 class="heading p1"><span>EJBCA 6.6.0 to EJBCA 6.6.1</span></h2>
<hr>
<p  class="p1" 
>The upgrade to EJBCA 6.6.1 enables seconds precision for CA and user certificate configuration and allows the issuance of short living certificates. To achieve this, for the CA and the certificate profile a new field for the validity is implemented. This field is populated when a CA and certificate profile is loaded from data object for the first time.</p>
<p  class="p1" 
>Furthermore, the handling of leap years was changed. Previously, EJBCA would take leap years into account when creating a CA or certificate profile when a validity was specified in terms of years (with &quot;10y&quot; syntax), and add extra days accordingly. Since 6.6.1, EJBCA always counts a year as 365 days, so if you need to account for leap years, then you need to specify them manually, for example as &quot;10y 2d&quot;. CAs and certificate profiles from earlier versions will keep their existing validity times unchanged.</p>
    </div>
    <div class="section section-2" id="src-26772565_id-.EJBCA6.6UpgradeNotesv6.15.1-EJBCA6.5.xtoEJBCA6.6.0">
        <h2 class="heading p1"><span>EJBCA 6.5.x to EJBCA 6.6.0</span></h2>
<hr>
<p  class="p1" 
>Upgrading to 6.6.0 will require replacing the approval settings in CAs and certificate profiles with approval profiles. If approvals are used in any capacity, you need to run the following command after deploying the new version of EJBCA and restart JBoss. If approvals are currently not in use, this step is not needed.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ ant upgrade</code></div>
</div>
    </div>
<p  class="p1" 
>Upgrading to 6.6.0 involves the following changes:</p>
<p  class="p1" 
></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-26772565_id-.EJBCA6.6UpgradeNotesv6.15.1-ChangestoCertificateData">Changes to CertificateData</a></p>
</li><li class=" "><p   
><a   href="#src-26772565_id-.EJBCA6.6UpgradeNotesv6.15.1-ChangestoApprovalData">Changes to ApprovalData</a></p>
</li><li class=" "><p   
><a   href="#src-26772565_id-.EJBCA6.6UpgradeNotesv6.15.1-PublicWebSelfRegistration">Public Web Self Registration</a></p>
</li><li class=" "><p   
><a   href="#src-26772565_safe-id-aWQtLkVKQkNBNi42VXBncmFkZU5vdGVzdjYuMTUuMS1SZW1vdmFsb2Z0aGVhY2Nlc3NydWxlL2NhX2Z1bmN0aW9uYWxpdHkvc3RvcmVfY2VydGlmaWNhdGU">Removal of the access rule /ca_functionality/store_certificate</a></p>
</li><li class=" "><p   
><a   href="#src-26772565_safe-id-aWQtLkVKQkNBNi42VXBncmFkZU5vdGVzdjYuMTUuMS0xMDAlVXBncmFkZVVwdGltZU5vdGVz">100% Upgrade Uptime Notes</a></p>
</li></ul>    <div class="section section-3" id="src-26772565_id-.EJBCA6.6UpgradeNotesv6.15.1-ChangestoCertificateData">
        <h3 class="heading p1"><span>Changes to CertificateData</span></h3>
<p  class="p2" 
>CertificateData has three new columns &quot;notBefore&quot;, &quot;endEntityProfileId&quot; and &quot;subjectAltName&quot;.</p>
<p  class="p1" 
>CertificateData is for storing issued certificates and can be quite large. Even though deploying the new version EJBCA will eventually performthe schema change on larger installations, we strongly recommend that you manually alter the table before deploying the new version of EJBCA. (Otherwise you might need to force a restart of the application server.) Since CertificateData is used by EJBCA running as a Validation Authority, you need to make this database schema change to your VAs as well before upgrading for publishing to work.</p>
<p  class="p1" 
>See src/upgrade/650_660/650_660-upgrade-&lt;database&gt;.sql for the correct SQL ALTER statement.</p>
<p  class="p1" 
>In the case where the endEntityProfileId and subjectAltName has not changed for End Entities since certificate issuance, you can copy this value using a SQL statement like (consult your DBA for the proper syntax and feasibility of executing this query on your production database):</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">UPDATE</code><code class="plain"> CertificateData </code><code class="keyword">AS</code><code class="plain"> a </code><code class="keyword">INNER</code><code class="plain"> </code><code class="color1">JOIN</code><code class="plain"> UserData </code><code class="keyword">AS</code><code class="plain"> b </code><code class="keyword">ON</code><code class="plain"> a.username = b.username</code></div>
<div class="line"><code class="keyword">SET</code><code class="plain"> a.endEntityProfileId = b.endEntityProfileId, a.subjectAltName = b.subjectAltName </code><code class="keyword">WHERE</code><code class="plain"> a.endEntityProfileId </code><code class="keyword">IS</code><code class="plain"> </code><code class="color1">NULL</code><code class="plain">;  </code></div>
</div>
    </div>
    </div>
    <div class="section section-3" id="src-26772565_id-.EJBCA6.6UpgradeNotesv6.15.1-ChangestoApprovalData">
        <h3 class="heading p1"><span>Changes to ApprovalData</span></h3>
<p  class="p2" 
>ApprovalData has a new approval profile concept. Approvals created prior to 6.6.0 will still be available, but performing approvals on nodes running EJBCA versions prior to 6.6.0 on an upgraded database (i.e during upgrade) is not supported. As part of this change, approval notifications are now configured per approval partition instead of globally. Check your Approval Profile afterdeploying the new code.</p>
    </div>
    <div class="section section-3" id="src-26772565_id-.EJBCA6.6UpgradeNotesv6.15.1-PublicWebSelfRegistration">
        <h3 class="heading p2"><span>Public Web Self Registration</span></h3>
<p  class="p1" 
>If you have been using the Self Registration in the old Public Web you need to create an Approval Profile, and select to use this for &quot;Add/Edit End Entity&quot;actions either in the CA configuration or in the Certificate Profile configuration.</p>
<p  class="p1" 
>Changes to WebService Approvals</p>
<p  class="p1" 
>If you have been using Approvals with the WebService API you have configured approval settings in jaxws.properties (only related to calls to genTokenCertificates and/or viewHardToken). This configuration setting has changed as part of the new approval profile concept. Look at jaxws.properties and configure a new approval profile for the WebService Approvals.</p>
    </div>
    <div class="section section-3" id="src-26772565_safe-id-aWQtLkVKQkNBNi42VXBncmFkZU5vdGVzdjYuMTUuMS1SZW1vdmFsb2Z0aGVhY2Nlc3NydWxlL2NhX2Z1bmN0aW9uYWxpdHkvc3RvcmVfY2VydGlmaWNhdGU">
        <h3 class="heading p1"><span>Removal of the access rule /ca_functionality/store_certificate </span></h3>
<p  class="p2" 
>The access rule /ca_functionality/store_certificate has been removed for the simple reason that it wasn't actually used. It will not be cleaned from anyexisting roles due to being harmless (and invasive to remove).</p>
    </div>
    <div class="section section-3" id="src-26772565_safe-id-aWQtLkVKQkNBNi42VXBncmFkZU5vdGVzdjYuMTUuMS0xMDAlVXBncmFkZVVwdGltZU5vdGVz">
        <h3 class="heading p1"><span>100% Upgrade Uptime Notes</span></h3>
    <div class="section section-4" id="src-26772565_id-.EJBCA6.6UpgradeNotesv6.15.1-ApprovalProfiles">
        <h4 class="heading p1"><span>Approval Profiles</span></h4>
<p  class="p2" 
>Approval profiles (of the Accumulative Approval Profile type) will during startup of the first upgraded node be automatically created and set for CAs and Certificate Profiles using approvals. During the upgrade, approval requests may roll in from un-upgraded nodes, and these will automatically be re-parsed when they are read from the upgraded ones, in other words set to use the same profile as if they'd been created on an upgraded node. For the sake of 100% uptime, this means that all actions (enrollment, revocation, CA activation, etc) may continue during the upgrade, and they may be processed from the upgraded nodes. On the other hand, un-upgraded nodes will not be able to approve actions created by or read by the upgraded nodes until the upgrade process is complete.</p>
<p   
></p>
<hr>
    </div>
    </div>
    </div>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="EJBCA_6.7_Upgrade_Notes.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>EJBCA 6.7 Upgrade Notes</span>
        </a>
                <a href="EJBCA_6.5_Upgrade_Notes.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>EJBCA 6.5 Upgrade Notes</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

</body>
</html>
