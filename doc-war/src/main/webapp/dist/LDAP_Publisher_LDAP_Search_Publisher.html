<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>LDAP Publisher/LDAP Search Publisher - EJBCA - Documentation Space</title>

    
            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="85921598">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_6.15.2.6_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=26772930"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_6.15.2.6_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Documentation.html">EJBCA Documentation</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Operations.html">EJBCA Operations</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Concept_Guide.html">EJBCA Concept Guide</a></li>
                                                                                     <li><a href="Publishers.html">Publishers</a></li>
                                                            </ul>
</div>            <h1 id="src-26772930"> <span>LDAP Publisher/LDAP Search Publisher</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

<p   
></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtTERBUE5hbWluZ0xEQVBfTmFtaW5n">LDAP Naming</a></p>
</li><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtTERBUEJhc2ljc0xEQVBfQmFzaWNz">LDAP Basics</a></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtVXNpbmdMREFQVXNpbmdfTERBUA">Using LDAP</a></p>
</li></ul></li><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ29uZmlndXJlTERBUFB1Ymxpc2hlcnNDb25maWd1cmVfTERBUF9QdWJsaXNoZXJz">Configure LDAP Publishers</a></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ29uZmlndXJpbmdFSkJDQUNvbmZpZ3VyaW5nX0VKQkNB">Configuring EJBCA</a></p>
</li><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtU2V0dGluZ3VwQ2VydGlmaWNhdGVQcm9maWxlc1NldHRpbmdfdXBfY2VydGlmaWNhdGVfcHJvZmlsZXM">Setting up Certificate Profiles</a></p>
</li><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtRGlmZmVyZW50TERBUFB1Ymxpc2hlcnNEaWZmZXJlbnRfTERBUF9wdWJsaXNoZXJz">Different LDAP Publishers</a></p>
</li><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtV2hhdEVKQkNBc3RvcmVzL2NyZWF0ZXMvbW9kaWZpZXNXaGF0X0VKQkNBX3N0b3Jlcy9jcmVhdGVzL21vZGlmaWVz">What EJBCA stores/creates/modifies</a></p>
</li></ul></li><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ29uZmlndXJlT3BlbkxEQVBDb25maWd1cmVfT3BlbkxEQVA">Configure OpenLDAP</a></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ29uZmlndXJlU1NMQ29uZmlndXJlX1NTTA">Configure SSL</a></p>
</li><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtU2FtcGxlVWJ1bnR1aW5zdGFsbGF0aW9uU2FtcGxlX1VidW50dV9pbnN0YWxsYXRpb24">Sample Ubuntu installation</a></p>
</li></ul></li><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtT3BlbkRKT3BlbkRK">OpenDJ</a></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtSW5zdGFsbGluZ09wZW5ESkluc3RhbGxpbmdfT3BlbkRK">Installing OpenDJ</a></p>
</li><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ29uZmlndXJlU1NML1RMU0NvbmZpZ3VyZV9TU0wvVExT">Configure SSL/TLS</a></p>
</li></ul></li><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ3VzdG9tU2NoZW1hc0N1c3RvbV9zY2hlbWFz">Custom Schemas</a></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ2VydGlmaWNhdGVTZXJpYWxOdW1iZXJDZXJ0aWZpY2F0ZV9zZXJpYWxfbnVtYmVy">Certificate Serial Number</a></p>
</li><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtRXh0cmFEZXZpY2VTY2hlbWFFeHRyYV9kZXZpY2Vfc2NoZW1h">Extra Device Schema</a></p>
</li><li class=" "><p   
><a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtSW5zdGFsbGF0aW9uSW5zdGFsbGF0aW9u">Installation</a></p>
</li></ul></li></ul>    <div class="section section-1" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtTERBUE5hbWluZ0xEQVBfTmFtaW5n">
        <h1 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtTERBUF9OYW1pbmc" class="confluence-anchor-link"></span><span>LDAP Naming </span></h1>
<p   
>The recommended method of choosing a naming suffix is the one described in <a  class="external-link" href="http://www.ietf.org/rfc/rfc2247.txt">RFC2247</a> that maps a DNS domain to a DN. If my DNS domain is <a  class="external-link" href="http://bigcorp.com">bigcorp.com</a> it will map to the DN &quot;dc=bigcorp,dc=com&quot;. The top node in my LDAP directory will then be &quot;dc=bigcorp,dc=com&quot;. For more information and to understand LDAP naming, we recommend the book <i class=" ">Understanding and Deploying LDAP Directory Services</i>.</p>
<p   
>The dc component support is mandated by all of the X.509 RFCs now. For example, if I have this directory:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="functions">dc</code><code class="plain">=bigcorp,</code><code class="functions">dc</code><code class="plain">=com</code></div>
<div class="line"><code class="plain">    |</code></div>
<div class="line"><code class="plain">    +-</code><code class="functions">dc</code><code class="plain">=</code><code class="keyword">fi</code></div>
<div class="line"><code class="plain">    |</code></div>
<div class="line"><code class="plain">    |</code></div>
<div class="line"><code class="plain">    +-</code><code class="functions">dc</code><code class="plain">=se</code></div>
<div class="line"><code class="plain">        |</code></div>
<div class="line"><code class="plain">        +-cn=Mike Jackson </code></div>
</div>
    </div>
<p   
>The most understandable method is taking the subject name in forward order, like: cn=Mike Jackson,dc=se,dc=bigcorp,dc=com</p>
<p   
>If the DN is ordered like this it should be published to the correct object in the tree.</p>
<p   
>If the DN is ordered reverse, like: dc=bigcorp,dc=com,dc=se,cn=Mike Jackson EJBCA will reorder it incorrectly to forward order, so the publishing will be wrong.</p>
<p   
>Thus, use forward order like this: 'cn=Mike Jackson,dc=se,dc=bigcorp,dc=com' if using the dc model or 'cn=Mike Jackson,o=bigcorp,c=se' if using the o,c model.</p>
<p   
>Making unique LDAP DNs is the next challenge. If you are in a small organization having the CN will probably work fine, but in a larger organization there are probably several people with the same name. Somehow the names must be made unique, and one way is to introduce numbers, initials etc in the CN. Another way that we recommend is to use uid in the LDAP DN instead. LDAP DNs will then look like &quot;uid=tomas,dc=bigcorp,dc=com&quot;. Uid is the username, normally used for login etc, and you probably already have some procedure to create unique usernames already.</p>
    </div>
    <div class="section section-1" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtTERBUEJhc2ljc0xEQVBfQmFzaWNz">
        <h1 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtTERBUF9CYXNpY3M" class="confluence-anchor-link"></span><span>LDAP Basics </span></h1>
<p   
>If you are not used to X.500 style naming, the LDAP structure of branches and leaf nodes may seem unusual. You can't just drop an object anywhere you like; You need to create the framework to support it. Sort of like if you wanted to put entries in /etc/hosts if the directory /etc did not exist.</p>
<p   
>First you mkdir /etc, then you create the file. Then you start putting things in the file. The difference with LDAP and x.500 is that instead of paths separate by slashes, you have paths separated by commas and '=' signs.</p>
<p   
>For example, if you want to make an object &quot;cn=ldaphost,ou=hosts,dc=yourdom,dc=com&quot;, you first have to make sure &quot;dc=yourdom,dc=com&quot; exists. Then make sure &quot;ou=hosts,dc=yourdom,dc=com&quot; exists. THEN you can try &quot;cn=ldaphost,ou=hosts,dc=yourdom,dc=com&quot;</p>
<p   
>EJBCA does not create branches in LDAP. You have to put them there with other means before you start publishing.</p>
    <div class="section section-2" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtVXNpbmdMREFQVXNpbmdfTERBUA">
        <h2 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtVXNpbmdfTERBUA" class="confluence-anchor-link"></span><span>Using LDAP </span></h2>
<p   
>In Firefox you can for example enter a URL like: ldap://ip-address-of-ldap-server:389/cn=Tomas Gustavsson,dc=se,dc=bigcorp,dc=com and it will fetch an address book entry with the information about the user, including the certificate.</p>
<p   
>The LDAP url format is described in <a  class="external-link" href="http://www.ietf.org/rfc/rfc2255.txt">RFC2255</a>.</p>
<p   
>To use LDAP top fetch user certificates and use them for encrypting email there seems to be a requirement to use SSL connection to the LDAP server (<strong class=" ">Account Options &gt; Compositions &amp; Addressing &gt; Edit directories &gt; Edit &gt; Use Secure Connection</strong>), see also below how to configure OpenLDAP for SSL.</p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>When fetching certificates from LDAP with Firefox, for example with URL: ldap://ldap-server-host/dc=bigcorp,dc=com??sub?(cn=MyName)?(objectclass=*), the CA certificate must be installed in the Windows truststore, not only in Firefox's, to enable a checkbox at the fetched certificate.</p>
        </div>
    </div>
<p   
>To use SSL against an LDAP server with MS Outlook you must make sure the CN in the LDAP servers certificate is the same as the hostname. An example of adding a user for the LDAP server with the CLI interface is:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">bin</code><code class="plain">/ejbca</code><code class="plain">.sh ra addendentity ldap password </code><code class="string">"C=SE,O=Foo,CN=ldap.foo.se"</code><code class="plain"> MyCA 1 PEM SERVER</code></div>
</div>
    </div>
<p   
>where <strong class=" "><a  class="external-link" href="http://ldap.foo.se">ldap.foo.se</a></strong> is the hostname of the LDAP server that Outlook should use.</p>
<p   
>The CA certificate must also be imported into Windows properly.</p>
    </div>
    </div>
    <div class="section section-1" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ29uZmlndXJlTERBUFB1Ymxpc2hlcnNDb25maWd1cmVfTERBUF9QdWJsaXNoZXJz">
        <h1 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ29uZmlndXJlX0xEQVBfUHVibGlzaGVycw" class="confluence-anchor-link"></span><span>Configure LDAP Publishers </span></h1>
<p   
>A Publisher is a session bean that implements the IPublishSession interface and is used to store certificates and CRLs for entities. EJBCA have support for endless number of publishers simply by defining publishers in the Admin GUI. The user of EJBCA can implement own publishers, but EJBCA already comes with a publisher for LDAP.</p>
<p   
>EJBCA uses a notion of base DN to publish to different LDAP structures. The DN used in the certificate can be different from the LDAP structure.</p>
    <div class="section section-2" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ29uZmlndXJpbmdFSkJDQUNvbmZpZ3VyaW5nX0VKQkNB">
        <h2 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ29uZmlndXJpbmdfRUpCQ0E" class="confluence-anchor-link"></span><span>Configuring EJBCA </span></h2>
<p   
>To configure the publisher for LDAP:</p>
<ol class=" "><li class=" "><p   
>Select <strong class=" ">Admin GUI</strong> &gt; <strong class=" ">Edit Publishers</strong>.</p>
</li><li class=" "><p   
>Add a new publisher by specifying a name, edit the publisher and specify the necessary fields.</p>
</li></ol><p   
>The following lists generic parameters to the LDAP Publisher:</p>
    <div  class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col />
                                    <col />
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Field</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Description</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Hostnames</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>';' separated list of the hosts where the LDAP servers are located. E.g. &quot;ldap.company.com&quot; or &quot;ldap1.company.com;ldap2.company.com&quot;. Only the first available of the listed hosts will be used.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Port</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Port on which the LDAP server listens, default non-SSL is 389. Available choices:<br/>Plaintext Connection: unencrypted connection, the easiest to get started with, and the mosts robust if network is secure.<br/>STARTTLS Extension: this gives the server and client a chance to negotiate a TLS (encrypted) connection if the server supports encrypted connections. It starts with a plaintext connection, and upgrades to a TLS connection using the same port as plaintext connection. Requires configuration both on the server (TLS server key and certificate) and on the client (CA certificate in truststore).<br/>TLS Connection: this always uses an encrypted TLS connection and fails if it is not available. Requires TLS configuration both on the server (TLS server key and certificate) and on the client (CA certificate in truststore).</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Login DN</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>The DN of a user on the LDAP server with permissions to add and update entities.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Login Password</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Password for the user above.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Connection timeout</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Number of milliseconds a server has to respond before it is considered unavailable and the next server in the list of hostnames (if any) is used instead. This timeout is used to probe LDAP servers, to create connections, to bind and to disconnect.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Read timeout</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Number of milliseconds a server has to complete a LDAP search or read operation before it times out and fails.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Store timeout</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Number of milliseconds a server has to complete a LDAP store operation before it times out and fails. This can take a little longer if you store very large CRLs in LDAP.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Create Nonexisting Users</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Defines if an LDAP object should be created by EJBCA if it is no existing object when EJBCA publishes the certificate.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Modify Existing Users</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Defines if attributes (such as email) in existing LDAP objects are replaced with new values and/or added when an entry is updated with a new certificate. If this option is not activated, existing users will not be touched at all, even not updated with a new certificate.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Overwrite Existing Attributes when Modify Existing Users is set to true</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Whether to change values of attributes when they already exist.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Add Nonexisting Attributes when Modify Existing Users is set to true</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Whether to add attributes when they do not already exist.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Add multiple certificates per user</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Defines if we should use multiple certificate entries for each user or only one. Default only one certificate is added to a user entry in LDAP and if the user gets a new certificate the old one is deleted and replaced with the new one. If this checkbox is checked certificates are instead appended in LDAP so each user can have multiple certificate entries in LDAP. Make sure your applications can handle this before enabling this option. Revoking a user will remove all certificates entries for the user.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Remove certificates when revoked</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>If selected, causes the publisher to remove a certificate from LDAP when the certificate is revoked or suspended.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Remove ldap user when certificate revoked</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>If selected, causes the publisher to remove the whole LDAP user entry when a certificate is revoked or suspended.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Set userPassword attribute</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Specifies if the LDAP publisher should set the userPassword attribute in the LDAP object. If a user entry with a non-null password is published, and this checkbox is checked, the userPassword attribute will be populated with the user's password.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>User Object Class</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>The objectclass for the LDAP entries for users, where user certificates are published. The entry is hierarchical separated by ';' to build a structure like: objectclass: top objectclass: person objectclass: organizationalPerson objectclass: inetOrgPerson This objectclass must allow the attribute userCertificate;binary. Default top;person;organizationalPerson;inetOrgPerson</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>CA Object Class</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>The objectclass for the LDAP entries for CAs, where CA certificates and CRLs are published. The entry is hierarchical separated by ';' to build a structure. This objectclass must allow the attributes cACertificate;binary, certificateRevocationList;binary and authorityRevocationList;binary. Default top;applicationProcess;certificationAuthority</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>User Certificate Attribute</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Attribute name, in the userObjectClass, for the user certificate. Default userCertificate;binary.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>CA Certificate Attribute</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Attribute name, in the cAObjectClass, for the CAs certificate. Default cACertificate;binary.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>CRL Attribute</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Attribute name, in the cAObjectClass, for CRLs (user CRLs) publisher by the CA. Default certificateRevocationList;binary.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>ARL Attribute</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Attribute name, in the cAObjectClass, for ARLs (CA CRLs) publisher by the CA. Default authorityRevocationList;binary (note that pure ARLs are not implemented yet in EJBCA).</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>LDAP location fields from cert DN</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>When configuring the LDAP publisher the BaseDN will be used as the base for the DN published in LDAP, and it will be appended to the LDAP location fields selected to be used. example: If the user DN in EJBCA is &quot;cn=tomas gustavsson, uid=tomasg, O=PrimeKey Solutions AB, C=SE&quot; and the BaseDN is &quot;dc=PrimeKey,dc=SE&quot; and the selected LDAP location fields are &quot;CN&quot;. The LDAP DN used for publishing will be &quot;cn=tomas gustavsson, dc=PrimeKey, dc=SE&quot;, and the &quot;uid=tomasg&quot; will be added as an attribute in LDAP. The certificate stored under &quot;cn=tomas gustavsson, dc=PrimeKey, dc=SE&quot; will have the subjectDN &quot;cn=tomas gustavsson, uid=tomasg, O=PrimeKey Solutions AB, C=SE&quot;.</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    <div class="section section-2" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtU2V0dGluZ3VwQ2VydGlmaWNhdGVQcm9maWxlc1NldHRpbmdfdXBfY2VydGlmaWNhdGVfcHJvZmlsZXM">
        <h2 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtU2V0dGluZ191cF9jZXJ0aWZpY2F0ZV9wcm9maWxlcw" class="confluence-anchor-link"></span><span>Setting up Certificate Profiles </span></h2>
    <div  class="confbox admonition admonition-warning">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>To allow publishing in LDAP, you must create an EJBCA custom Certificate profile.</p>
        </div>
    </div>
<p   
>To publish in LDAP, you must create a Certificate profile in EJBCA that publishes to LDAP. If the publisher for LDAP is configured according to <a   href="#src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ29uZmlndXJpbmdfRUpCQ0E">Configuring EJBCA</a> above, there will be a section for <strong class=" ">Publishers</strong> available when creating/editing a certificate profile (with <strong class=" ">Edit Certificate Profiles</strong>).</p>
<p   
>Choose this, and then when adding end-entities, make sure they use the new certificate profile and voila, the certs will be published.</p>
    </div>
    <div class="section section-2" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtRGlmZmVyZW50TERBUFB1Ymxpc2hlcnNEaWZmZXJlbnRfTERBUF9wdWJsaXNoZXJz">
        <h2 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtRGlmZmVyZW50X0xEQVBfcHVibGlzaGVycw" class="confluence-anchor-link"></span><span>Different LDAP Publishers </span></h2>
<p   
><strong class=" ">LDAP Publisher</strong></p>
<p   
>The regular LDAP Publisher works by searching the DN in LDAP.</p>
<p   
>When EJCA creates an object to publish a certificate to LDAP it firsts builds the DN from the baseDN and 'LDAP location fields for cert DN'. It checks if the entry exists in the LDAP and either creates or modifies the entry.</p>
<p   
>Example: The certificate DN is &quot;CN=Tomas Gustavsson,O=Foo,C=SE&quot;, the BaseDN in the publisher is &quot;DC=primekey,DC=se&quot; and the CN is selected in &quot;LDAP location fields from cert DN&quot;. The resulting DN that EJBCA will search for in the LDAP and create if it does not already exist is &quot;CN=Tomas Gustavsson,DC=primekey,DC=se&quot;.</p>
<p   
>Using this publisher, if you have multiple trees in your LDAP (for example &quot;ou=foo,dc=primekey,dc=se&quot; and &quot;ou=bar,dc=primekey,dc=se&quot;) you can either:</p>
<ol class=" "><li class=" "><p   
>Include both CN and OU in 'LDAP location fields from cert DN' and have your cert DNs like &quot;CN=Tomas,OU=foo,O=MyOrg,C=SE.</p>
</li><li class=" "><p   
>Use different publishers for ou=foo and ou=bar and issue certificates for the different OUs with different certificate profiles.</p>
</li></ol><p   
><strong class=" ">LDAP Search Publisher</strong></p>
<p   
>The LDAP Search Publisher works by searching the LDAP for existing entries using a user defined search filter. If no entries exist in the LDAP when searching for an entry, one is created just like in the regular LDAP Publisher.</p>
<p   
>The search filter is defined in the following fields under <strong class=" ">LDAP search settings</strong>:</p>
<ul class=" "><li class=" "><p   
>Suffix base DN of LDAP Search - the base for your search filter.</p>
</li><li class=" "><p   
>LDAP filter of the search - your LDAP filter.</p>
</li></ul><p   
>If you build your search filter on DN components, you also have to select those components as <strong class=" ">LDAP location fields</strong>.</p>
<p   
>The best example of such a search filter is if base is &quot;dc=primekey,dc=se&quot; and filter is &quot;uid=$USERNAME&quot;. The search done by EJBCA will be equal to the search:ldapsearch -x -b &quot;dc=primekey,dc=se&quot; &quot;(uid=$USERNAME)&quot;</p>
<p   
>$USERNAME is replaced by the EJBCA username of the user that has had a new certificate just generated. Other variables apart from $USERNAME is $EMAIL, $UID, $CN, $O, $OU and $C where these values are taken from the certificate DN.</p>
<p   
>When a certificate is generated for say user &quot;ldap&quot; EJBCA will perform the search:<br/>ldapsearch -x -b &quot;dc=primekey,dc=se&quot; &quot;(uid=ldap)&quot;</p>
<p   
>The certificate generated for LDAP will be published in the object returned by the search. This is very useful if you want to publish certificates to an LDAP directory where your users already exists such as an email directory. The DN in the LDAP does not have to match the DN in the certificates at all.</p>
<p   
>If more than one entry matches the search, the first returned search result will be used.</p>
    </div>
    <div class="section section-2" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtV2hhdEVKQkNBc3RvcmVzL2NyZWF0ZXMvbW9kaWZpZXNXaGF0X0VKQkNBX3N0b3Jlcy9jcmVhdGVzL21vZGlmaWVz">
        <h2 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtV2hhdF9FSkJDQV9zdG9yZXMvY3JlYXRlcy9tb2RpZmllcw" class="confluence-anchor-link"></span><span>What EJBCA stores/creates/modifies </span></h2>
<p   
>Apart from the DN in the entry, a number of attributes are also stored. Some are required by schema, some are optional. EJBCA find attributes in the certificate, if it is an OU (organizational unit) in the certificate EJBCA uses that to populate the OU attribute in the LDAP entry.</p>
<p   
>When updating an entry that already exists EJBCA uses replace on the existing attributes, so if an email attributes already exists and EJBCA finds an email address in the certificate, the email attribute in LDAP is replaced with the email address from the certificate.</p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>Attributes are only replaced/updated if the flag <strong class=" ">Modify Existing Users</strong> in the Publisher is active. The certificate attribute is always updated though. Attributes that are part of the DN, i.e. that reflects the location of the entry in LDAP is not modified, since this is usually not allowed.</p>
        </div>
    </div>
<p   
>The attributes that EJBCA creates or replaces are:</p>
<ul class=" "><li class=" "><p   
>cn (common name)</p>
</li><li class=" "><p   
>l (locality)</p>
</li><li class=" "><p   
>ou (organizational unit)</p>
</li><li class=" "><p   
>sn (surname)</p>
</li><li class=" "><p   
>gn (givenname)</p>
</li><li class=" "><p   
>st (state)</p>
</li><li class=" "><p   
>o (organization)</p>
</li><li class=" "><p   
>uid (user id)</p>
</li><li class=" "><p   
>initials</p>
</li><li class=" "><p   
>title</p>
</li><li class=" "><p   
>serialnumber - If we have selected to use the <strong class=" ">SN</strong> (serialNUmber DN field) in <strong class=" ">Ldap Location fields</strong>, we will also add it as an attribute.</p>
</li></ul>    </div>
    </div>
    <div class="section section-1" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ29uZmlndXJlT3BlbkxEQVBDb25maWd1cmVfT3BlbkxEQVA">
        <h1 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ29uZmlndXJlX09wZW5MREFQ" class="confluence-anchor-link"></span><span>Configure OpenLDAP </span></h1>
<p   
>The objectclass <strong class=" ">inetOrgPerson</strong> is used by default to store certificates.</p>
<p   
>Example:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">dn: cn=Mike Jackson,ou=people,</code><code class="functions">dc</code><code class="plain">=company,</code><code class="functions">dc</code><code class="plain">=com</code></div>
<div class="line"><code class="plain">objectclass: </code><code class="functions">top</code></div>
<div class="line"><code class="plain">objectclass: person</code></div>
<div class="line"><code class="plain">objectclass: organizationalPerson</code></div>
<div class="line"><code class="plain">objectclass: inetOrgPerson</code></div>
<div class="line"><code class="plain">cn: Mike Jackson</code></div>
<div class="line"><code class="plain">sn: Jackson</code></div>
<div class="line"><code class="plain">userCertificate;binary::</code></div>
</div>
    </div>
<p   
>CAs are published in the form:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">dn: cn=ejbca,</code><code class="functions">dc</code><code class="plain">=jackson,</code><code class="functions">dc</code><code class="plain">=net</code></div>
<div class="line"><code class="plain">objectClass: </code><code class="functions">top</code></div>
<div class="line"><code class="plain">objectClass: applicationProcess</code></div>
<div class="line"><code class="plain">objectClass: certificationAuthority</code></div>
<div class="line"><code class="plain">cn: ejbca</code></div>
<div class="line"><code class="plain">cACertificate;binary:</code></div>
<div class="line"><code class="plain">certificateRevocationList;binary:</code></div>
<div class="line"><code class="plain">authorityRevocationList;binary:</code></div>
</div>
    </div>
<p   
>To configure OpenLDAP (version 2.2.5) to include the <strong class=" ">inetOrgPerson</strong>, add the following lines to slapd.conf. This is already the default in recent releases:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">include </code><code class="plain">/etc/ldap/schema/cosine</code><code class="plain">.schema</code></div>
<div class="line"><code class="plain">include </code><code class="plain">/etc/ldap/schema/inetorgperson</code><code class="plain">.schema</code></div>
</div>
    </div>
<p   
>Add the top object by creating an LDIF file (org.ldif):</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">dn: o=AnaTom,c=SE</code></div>
<div class="line"><code class="plain">objectclass: dcObject</code></div>
<div class="line"><code class="plain">objectclass: organization</code></div>
<div class="line"><code class="plain">o: AnaTom</code></div>
<div class="line"><code class="functions">dc</code><code class="plain">: AnaTom </code></div>
<div class="line"><code class="plain">dn: cn=Admin,o=AnaTom,c=SE</code></div>
<div class="line"><code class="plain">objectclass: organizationalRole</code></div>
<div class="line"><code class="plain">cn: Admin</code></div>
</div>
    </div>
<p   
>And using the command:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">ldapadd -x -D </code><code class="string">"cn=Admin,o=AnaTom,c=SE"</code><code class="plain"> -W -f org.ldif</code></div>
</div>
    </div>
<p   
>Check what you have in the LDAP by:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">ldapsearch -x -b </code><code class="string">'o=AnaTom,c=SE'</code><code class="plain"> </code><code class="string">'(objectclass=*)'</code></div>
</div>
    </div>
    <div class="section section-2" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ29uZmlndXJlU1NMQ29uZmlndXJlX1NTTA">
        <h2 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ29uZmlndXJlX1NTTA" class="confluence-anchor-link"></span><span>Configure SSL </span></h2>
<p   
>Create a user in EJBCA (this example is for adding a user with the cli interface, adding a user with the admin-GUI works just as fine). In the mail EJBCA directory type (use simply 'ra' on windows):</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">bin</code><code class="plain">/ejbca</code><code class="plain">.sh ra addendentity ldap foo123 </code><code class="string">"C=SE,O=Foo,CN=ldap"</code><code class="plain"> null ManagementCA null 1 PEM SERVER</code></div>
<div class="line"><code class="plain">bin</code><code class="plain">/ejbca</code><code class="plain">.sh ra setclearpwd ldap foo123</code></div>
</div>
    </div>
<p   
>Where foo123 is the ldap users password, C=SE... is the users DN and ManagementCA is the name you chose for your CA. The user type is end-user (1), keystore type is PEM, and if using the admin-GUI check <strong class=" ">use batch</strong>).</p>
<p   
>Batch generate the PEM keystore:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">bin</code><code class="plain">/ejbca</code><code class="plain">.sh batch</code></div>
</div>
    </div>
<p   
>Copy the resulting files p12/pem/ldap.pem, p12/pem/ldap-CA.pem and p12/pem/ldap-Key.pem to your LDAP server. In this example the slapd.conf is located in /etc/ldap so we copy the files to that directory. Protect these files so they are only readable by the LDAP server.</p>
<p   
>Add the following to your slapd.conf:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="comments"># Use SSL</code></div>
<div class="line"><code class="plain">TLSCipherSuite HIGH:MEDIUM:+SSLv3</code></div>
<div class="line"><code class="plain">TLSCertificateFile </code><code class="plain">/etc/ldap/ldap</code><code class="plain">.pem</code></div>
<div class="line"><code class="plain">TLSCertificateKeyFile </code><code class="plain">/etc/ldap/ldap-Key</code><code class="plain">.pem</code></div>
<div class="line"><code class="plain">TLSCACertificateFile </code><code class="plain">/etc/ldap/ldap-CA</code><code class="plain">.pem </code></div>
</div>
    </div>
<p   
>Restart slapd:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">.</code><code class="plain">/slapd</code><code class="plain"> -h </code><code class="string">"ldap:/// ldaps:///"</code></div>
</div>
    </div>
<p   
>and check that it is running with <strong class=" ">ps -ef|grep slapd</strong>.</p>
<p   
>On SuSE, if using the built-in OpenLDAP you have to enable ldaps in /etc/sysconfig/openldap:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">OPENLDAP_START_LDAPS=</code><code class="string">"yes"</code></div>
</div>
    </div>
<p   
>and then run:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">SuSEconfig</code></div>
</div>
    </div>
<p   
>and then:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">rcldap start</code></div>
</div>
    </div>
<p   
>Configure your LDAP publisher in EJBCA to use SSL by checking the checkbox <strong class=" ">TLS Connection</strong>, the port should change to port 636.</p>
<p   
>Note! The CA certificate of the (root)CA used to sign the LDAP server certificate must be present in the java trust cert store ($JAVA_HOME/jre/lib/security/cacerts). Otherwise you will have to add it using something like: First get the CA cert:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">bin</code><code class="plain">/ejbca</code><code class="plain">.sh ca getcacert MyCA myca.der -der</code></div>
</div>
    </div>
<p   
>Then add it to the java trust store:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">keytool -</code><code class="functions">import</code><code class="plain"> -trustcacert -</code><code class="functions">alias</code><code class="plain"> MyCA -keystore $JAVA_HOME</code><code class="plain">/jre/lib/security/cacerts</code><code class="plain"> -storepass changeit -</code><code class="functions">file</code><code class="plain"> myca.der</code></div>
</div>
    </div>
<p   
>You have to re-start JBoss after adding anything to the java trust store.</p>
<p   
>For more information on configuring OpenLDAP on Solaris, refer to <a  class="external-link" href="http://www.bolthole.com/solaris/LDAP.html">bolthole.com</a></p>
    </div>
    <div class="section section-2" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtU2FtcGxlVWJ1bnR1aW5zdGFsbGF0aW9uU2FtcGxlX1VidW50dV9pbnN0YWxsYXRpb24">
        <h2 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtU2FtcGxlX1VidW50dV9pbnN0YWxsYXRpb24" class="confluence-anchor-link"></span><span>Sample Ubuntu installation </span></h2>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">- </code><code class="functions">sudo</code><code class="plain"> apt-get </code><code class="functions">install</code><code class="plain"> slapd ldap-utils</code></div>
<div class="line"><code class="plain">- </code><code class="functions">sudo</code><code class="plain"> dpkg-reconfigure slapd</code></div>
<div class="line"><code class="plain">  </code></div>
<div class="line"><code class="plain">Configure slapd with your domain and admin password (primekey.com </code><code class="keyword">in</code><code class="plain"> this </code><code class="keyword">case</code><code class="plain">).</code></div>
<div class="line"><code class="plain">- </code><code class="functions">sudo</code><code class="plain"> </code><code class="plain">/etc/init</code><code class="plain">.d</code><code class="plain">/slapd</code><code class="plain"> restart</code></div>
<div class="line"><code class="plain">- </code><code class="string">'ps -ef|grep slap'</code><code class="plain"> </code></div>
<div class="line"><code class="plain">  should show a slapd running</code></div>
<div class="line"><code class="plain">- ldapsearch -x -b </code><code class="string">'dc=primekey,dc=se'</code><code class="plain"> </code><code class="string">'(objectclass=*)'</code></div>
<div class="line"><code class="plain">  </code></div>
<div class="line"><code class="plain">To </code><code class="functions">look</code><code class="plain"> at the results</code></div>
<div class="line"><code class="plain">- slapcat -l backup.ldif</code></div>
<div class="line"><code class="plain">  </code></div>
<div class="line"><code class="plain">Make backup</code></div>
<div class="line"><code class="plain">- slapadd -l backup.ldif</code></div>
<div class="line"><code class="plain">- </code><code class="plain">/etc/init</code><code class="plain">.d</code><code class="plain">/slapd</code><code class="plain"> restart</code></div>
<div class="line"><code class="plain">  </code></div>
<div class="line"><code class="plain">Restore backup </code></div>
</div>
    </div>
<p   
>Run the following command to add new LDAP nodes:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">- ldapadd -x -D </code><code class="string">"cn=admin,dc=PrimeKey,dc=com"</code><code class="plain"> -W -f primekey.ldif</code></div>
<div class="line"><code class="plain">  where primekey.ldif is:</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">dn: </code><code class="functions">dc</code><code class="plain">=PrimeKey,</code><code class="functions">dc</code><code class="plain">=com</code></div>
<div class="line"><code class="functions">dc</code><code class="plain">: PrimeKey</code></div>
<div class="line"><code class="plain">objectclass: dcObject</code></div>
<div class="line"><code class="plain">objectclass: organization</code></div>
<div class="line"><code class="plain">o: PrimeKey Solutions AB</code></div>
<div class="line"><code class="plain">description: Parent Object </code><code class="keyword">for</code><code class="plain"> PrimeKey LDAP Directory</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">dn: ou=Standard,</code><code class="functions">dc</code><code class="plain">=PrimeKey,</code><code class="functions">dc</code><code class="plain">=com</code></div>
<div class="line"><code class="plain">ou: Standard</code></div>
<div class="line"><code class="plain">objectClass: </code><code class="functions">top</code></div>
<div class="line"><code class="plain">objectClass: organizationalUnit</code></div>
<div class="line"><code class="plain">description: Parent Object </code><code class="keyword">for</code><code class="plain"> all Standard Certificates</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">dn: ou=High,</code><code class="functions">dc</code><code class="plain">=PrimeKey,</code><code class="functions">dc</code><code class="plain">=com</code></div>
<div class="line"><code class="plain">ou: High</code></div>
<div class="line"><code class="plain">objectClass: </code><code class="functions">top</code></div>
<div class="line"><code class="plain">objectClass: organizationalUnit</code></div>
<div class="line"><code class="plain">description: Parent Object </code><code class="keyword">for</code><code class="plain"> all High Certificates </code></div>
</div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtT3BlbkRKT3BlbkRK">
        <h1 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtT3BlbkRK" class="confluence-anchor-link"></span><span>OpenDJ </span></h1>
<p   
><a  class="external-link" href="http://opendj.forgerock.org/">OpenDJ</a> is a modern, standards compliant, java based, LDAP server that is easy to set up and use. It also comes with GUI tools to manage and query.</p>
    <div class="section section-2" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtSW5zdGFsbGluZ09wZW5ESkluc3RhbGxpbmdfT3BlbkRK">
        <h2 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtSW5zdGFsbGluZ19PcGVuREo" class="confluence-anchor-link"></span><span>Installing OpenDJ </span></h2>
<p   
>This example uses OpenDJ 2.5.0 as an example, but other versions should work similarly.</p>
<ul class=" "><li class=" "><p   
>unzip OpenDJ-2.5.0-Xpress1.zipthe Control Panel</p>
</li><li class=" "><p   
>cd OpenDJ-2.5.0-Xpress1</p>
</li><li class=" "><p   
>./setup</p>
<ul class=" "><li class=" "><p   
>This launches graphical setup, you can run <strong class=" ">setup --cli</strong> to install without GUI.</p>
</li><li class=" "><p   
>Use default Root User DN: cn=Directory Manager</p>
</li><li class=" "><p   
>Directory Base DN: dc=example,dc=com)</p>
</li><li class=" "><p   
>If you want to be able to run OpenDJ on the same server as JBoss/EJBCA, choose another port for management, i.e. 5555 instead of 4444.</p>
</li></ul></li><li class=" "><p   
>You can end by starting Launch Control Panel, or you can start it later with bin/control-panel.</p>
</li></ul><p   
>An EJBCA publisher for a default installation is then configured with:</p>
<ul class=" "><li class=" "><p   
>Base DN: dc=example,dc=com</p>
</li><li class=" "><p   
>Administrator: cn=Directory Manager</p>
</li></ul><p   
>The graphical LDAP browser is accessible from the <strong class=" ">Control Panel &gt; Manage Entries</strong>. You can start/stop OpenDJ from within the Control Panel or with bin/start-ds and stop-ds.</p>
<p   
>Management tasks such as creating new attributes and object types easy to do in the Control Panel GUI.</p>
<p   
>OpenDJ listens to port 1389 by default, but it also occupies other ports stopping it from running on the same server as JBoss. If you want to change the management port (default 4444) after installation you can edit confif/config.ldif and config/tools.properties.</p>
    </div>
    <div class="section section-2" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ29uZmlndXJlU1NML1RMU0NvbmZpZ3VyZV9TU0wvVExT">
        <h2 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ29uZmlndXJlX1NTTC9UTFM" class="confluence-anchor-link"></span><span>Configure SSL/TLS </span></h2>
<p   
>For information on configuring SSL/TLS with OpenDJ, refer to <a  class="external-link" href="http://opendj.forgerock.org/doc/admin-guide/index/chap-listeners.html">OpenDJ documentation</a>.</p>
<p   
>If you run setup using the command line (--cli) you will be prompted with TLS questions, having the possibility to set up TLS directly.</p>
    </div>
    </div>
    <div class="section section-1" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ3VzdG9tU2NoZW1hc0N1c3RvbV9zY2hlbWFz">
        <h1 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ3VzdG9tX3NjaGVtYXM" class="confluence-anchor-link"></span><span>Custom Schemas </span></h1>
<p   
>See doc/ldapschema for files with custom schemas and attribute types to add to your LDAP schema.</p>
    <div class="section section-2" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ2VydGlmaWNhdGVTZXJpYWxOdW1iZXJDZXJ0aWZpY2F0ZV9zZXJpYWxfbnVtYmVy">
        <h2 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtQ2VydGlmaWNhdGVfc2VyaWFsX251bWJlcg" class="confluence-anchor-link"></span><span>Certificate Serial Number </span></h2>
<p   
>This is an attribute and a schema extension to allow storage of certificate serial number in the inetOrgPerson LDAP object, for end user entries. This is done by adding an extension to inetOrgPerson called inetOrgPersonWithCertSerno with a new optional attribute called certificateSerialNumber.</p>
<p   
>Once you have installed the new schema in the LDAP server you use it by configuring the LDAP publisher with:</p>
<ul class=" "><li class=" "><p   
>User Object Class: top;person;organizationalPerson;inetOrgPerson;inetOrgPersonWithCertSerno</p>
</li></ul><p   
>instead of the befault value:</p>
<ul class=" "><li class=" "><p   
>User Object Class: top;person;organizationalPerson;inetOrgPerson</p>
</li></ul><p   
>The certificateSerialNumber attribute will then automatically be added/modified when publishing to LDAP.</p>
    </div>
    <div class="section section-2" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtRXh0cmFEZXZpY2VTY2hlbWFFeHRyYV9kZXZpY2Vfc2NoZW1h">
        <h2 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtRXh0cmFfZGV2aWNlX3NjaGVtYQ" class="confluence-anchor-link"></span><span>Extra Device Schema </span></h2>
<p   
>To store certificates for devices (e.g. routers, toasters etc) in LDAP it is no really suitable standard object class. inetOrgPerson requires surnames etc, and the device objectclass does not include a certificate attribute.</p>
<p   
>Mike Jackson has kindly contributed additional objects that extend the standard device class with a certificate attribute. The ejbcaDevice uses object ids from PrimeKey Solutions AB.</p>
    </div>
    <div class="section section-2" id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtSW5zdGFsbGF0aW9uSW5zdGFsbGF0aW9u">
        <h2 class="heading "><span id="src-26772930_safe-id-aWQtLkxEQVBQdWJsaXNoZXIvTERBUFNlYXJjaFB1Ymxpc2hlcnY2LjE1LjEtSW5zdGFsbGF0aW9u" class="confluence-anchor-link"></span><span>Installation </span></h2>
<p   
>For the Netscape/SUN servers, on UNIX, copy the 85ejbca.ldif file into:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/usr/netscape/servers/slapd-hostname/config/schema/</code></div>
</div>
    </div>
<p   
>and restart the LDAP server.</p>
<p   
>For OpenLDAP, copy the ejbca.schema file into, e.g.:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/etc/ldap/schema/</code></div>
</div>
    </div>
<p   
>and edit slapd.conf to add the following line:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">include </code><code class="plain">/etc/ldap/schema/ejbca</code><code class="plain">.schema</code></div>
</div>
    </div>
<p   
>then restart the server.</p>
    </div>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="Customer_Specific_Publisher_for_a_PKD-like_Catalog.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Customer Specific Publisher for a PKD-like Catalog</span>
        </a>
                <a href="Multi_Group_Publisher.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Multi Group Publisher</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

</body>
</html>
