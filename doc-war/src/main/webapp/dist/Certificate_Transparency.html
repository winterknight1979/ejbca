<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Certificate Transparency - EJBCA - Documentation Space</title>

    
            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="85921598">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_6.15.2.6_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=16232490"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_6.15.2.6_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Documentation.html">EJBCA Documentation</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Operations.html">EJBCA Operations</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_User_Guide.html">EJBCA User Guide</a></li>
                                                                                                         <li class="shortcut"><a href="CA_Operations_Guide.html">CA Operations Guide</a></li>
                                                                                     <li><a href="Managing_Certificate_Profiles.html">Managing Certificate Profiles</a></li>
                                                            </ul>
</div>            <h1 id="src-16232490"> <span>Certificate Transparency</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

<p   
></p>
<p   
><span class="status blue " >ENTERPRISE</span>
 This is an EJBCA Enterprise feature.</p>
<p  class="reference" 
>Certificate Transparency (CT) is an experimental Internet security standard and open source framework for monitoring and auditing digital certificates. The standard creates a system of public logs that seek to eventually record all certificates issued by publicly trusted certificate authorities, allowing efficient identification of mistakenly or maliciously issued certificates. This section covers the following:</p>
<p  class="reference" 
></p>
<ul class="toc-indentation "></ul>    <div class="section section-1" id="src-16232490_id-.CertificateTransparencyv6.14.0-Introduction">
        <h1 class="heading "><span>Introduction</span></h1>
<p   
>EJBCA implements Certificate Transparency (CT) as specified in <a  class="external-link" href="http://tools.ietf.org/html/rfc6962">RFC 6962</a>. The purpose of CT is to create public audit logs of all certificates issued by the public SSL/TLS CAs. The presence of audit records is required for EV certificates in Google Chrome as of 2015 (and other web browsers and non-EV certificates to follow). Note that CT is only relevant for CAs issuing <i class=" ">public SSL/TLS</i> certificates, other types of CAs should not use CT. More information can be found on the <a  class="external-link" href="http://www.certificate-transparency.org/">Certificate Transparency website</a>.</p>
<p   
>From a CA's point of view, CT works by publishing certificates from the CA to the log servers and retrieving Signed Certificate Timestamps (SCTs) in response. This is a single operation, so requesting an SCT for a certificate also publishes it. The resulting SCTs can then be sent to end-users in a TLS handshake in different ways: in a certificate extension, in a stapled OCSP response, and/or in a TLS extension. EJBCA supports all of these, including combinations. The following sections describe how to configure EJBCA in one or more of these modes.</p>
    </div>
    <div class="section section-1" id="src-16232490_id-.CertificateTransparencyv6.14.0-Prerequisites">
        <h1 class="heading "><span>Prerequisites</span></h1>
<p   
>Your EJBCA installation needs the EJBCA Enterprise Edition only <strong class=" ">ct</strong> module. Depending on the CT modes you require, there are some extra preparations.</p>
    <div class="section section-2" id="src-16232490_id-.CertificateTransparencyv6.14.0-CTinCertificatesCT_in_certificates">
        <h2 class="heading "><span id="src-16232490_id-.CertificateTransparencyv6.14.0-CT_in_certificates" class="confluence-anchor-link"></span><span>CT in Certificates </span></h2>
<p   
>No extra preparations are needed. Just configure the logs and enable CT in the certificate profiles as described in the sections <a   href="#src-16232490_id-.CertificateTransparencyv6.14.0-Adding_CT_logs">Adding CT Logs</a> and <a   href="#src-16232490_id-.CertificateTransparencyv6.14.0-Activating_CT">Activating CT</a>.</p>
    </div>
    <div class="section section-2" id="src-16232490_id-.CertificateTransparencyv6.14.0-CTinOCSPResponsesCT_in_OCSP_responses">
        <h2 class="heading "><span id="src-16232490_id-.CertificateTransparencyv6.14.0-CT_in_OCSP_responses" class="confluence-anchor-link"></span><span>CT in OCSP Responses </span></h2>
<p   
>EJBCA supports CT in OCSP responses, both in live OCSP responders and for pre-production of responses. By default, EJBCA will cache up to approximately 100 000 CT response extensions in memory. Excess cached response extensions that have not been requested for 10 seconds are randomly evicted from the cache. The parameters can be adjusted in the file <code class=" ">conf/cesecore.properties</code>.</p>
<p   
>To use CT OCSP you must also enable the corresponding extension in the OcspKeyBinding of the OCSP Responder:</p>
<ol class=" "><li class=" "><p   
>Select <strong class=" ">Admin Web &gt; Internal Key Bindings &gt; OcspKeyBindings</strong> and choose the Key Binding to edit.</p>
</li><li class=" "><p   
>Under <strong class=" ">OCSP Extensions</strong>, select <strong class=" ">Certificate Transparency SCT</strong>.</p>
</li><li class=" "><p   
>Click <strong class=" ">Add</strong> and then <strong class=" ">Save.</strong></p>
</li></ol><p   
></p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/16232490/sctExt.png" alt="images/download/attachments/16232490/sctExt.png" width="400"  />
    </p>
<p   
>Proceed with configuring CT logs and certificate profiles according to the sections <a   href="#src-16232490_id-.CertificateTransparencyv6.14.0-Adding_CT_logs">Adding CT Logs</a> and <a   href="#src-16232490_id-.CertificateTransparencyv6.14.0-Activating_CT">Activating CT</a>.</p>
    </div>
    <div class="section section-2" id="src-16232490_id-.CertificateTransparencyv6.14.0-CTinaTLSextensionCT_in_a_TLS_extension">
        <h2 class="heading "><span id="src-16232490_id-.CertificateTransparencyv6.14.0-CT_in_a_TLS_extension" class="confluence-anchor-link"></span><span>CT in a TLS extension </span></h2>
<p   
>In this mode, the certificate holder requests SCTs from the logs and includes them in a TLS extension. The CA is not required to do anything, but it is possible to reduce the time it takes until full (merged) audit log records are available by publishing certificates to the logs as soon as they are issued. For configuration details, see <a   href="#src-16232490_id-.CertificateTransparencyv6.14.0-Publishing_to_logs_without_using_the_SCT">Publishing to logs without using the SCTs </a>.</p>
    </div>
    <div class="section section-2" id="src-16232490_id-.CertificateTransparencyv6.14.0-PublishingtoLogsWithoutUsingtheSCTsPublishing_to_logs_without_using_the_SCT">
        <h2 class="heading "><span id="src-16232490_id-.CertificateTransparencyv6.14.0-Publishing_to_logs_without_using_the_SCT" class="confluence-anchor-link"></span><span>Publishing to Logs Without Using the SCTs </span></h2>
<p   
>EJBCA can asynchronously publish certificates to one or more CT logs, using a Custom Publisher. This feature is intended to be used mainly when using CT in TLS mode or OCSP mode.</p>
<p   
>To enable publishing to logs without using SCTS, do the following:</p>
<ol class=" "><li class=" "><p  class="auto-cursor-target" 
>Go to <strong class=" ">CA Functions&gt;Publishers</strong> and add a new publisher with the following configuration:</p>
    <div  class="tablewrap">
        <table class="relative-table wrapped confluenceTable">
                    <colgroup>
                                    <col  width="43%"/>
                                    <col  width="56%"/>
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p  class="_mce_tagged_br" 
>Field</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Value</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Publisher Type</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Custom Publisher</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Class Path</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>org.ejbca.code.model.ca.publisher.CTCustomPublisher</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Properties</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Leave blank</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>No direct publishing, only use queue</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Yes</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Keep successfully published items in database</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>No</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Use queue for CRLs</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>No</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Use queue for certificates</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Yes</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
</li><li class=" "><p   
>Click <strong class=" ">Save.<br/></strong><br/><img  class="emoticon emoticon-warning"  src="images/s/en_US/8100/b0984b7297905b7c7bd946458f753ce0130bfc8c/_/images/icons/emoticons/warning.svg" alt="images/s/en_US/8100/b0984b7297905b7c7bd946458f753ce0130bfc8c/_/images/icons/emoticons/warning.svg"   />
 Note that the publisher has to be enabled in the certificate profiles before publishing becomes active.</p>
</li><li class=" "><p  class="auto-cursor-target" 
>Next, to create a service for the publisher, specify the following under <strong class=" ">System Functions&gt;Services</strong>:</p>
    <div  class="tablewrap">
        <table class="relative-table wrapped confluenceTable">
                    <colgroup>
                                    <col  width="19%"/>
                                    <col  width="80%"/>
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Field</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Description</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Worker</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Publisher Queue Process Worker</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Publishers to check</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>The previously created publisher.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Period</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Default is 5 minutes and can be changed to several hours.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Active</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Yes.</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
</li></ol>    </div>
    </div>
    <div class="section section-1" id="src-16232490_id-.CertificateTransparencyv6.14.0-AddingCTLogsAdding_CT_logs">
        <h1 class="heading "><span id="src-16232490_id-.CertificateTransparencyv6.14.0-Adding_CT_logs" class="confluence-anchor-link"></span><span>Adding CT Logs </span></h1>
<p   
>CT log servers are configured under <strong class=" ">System Configuration</strong>. Note that the CT log servers will not be active until enabled per certificate profile.</p>
<p   
>The following parameters have to be configured in a log:</p>
    <div  class="tablewrap">
        <table class="wrapped relative-table confluenceTable">
                    <colgroup>
                                    <col  width="9%"/>
                                    <col  width="90%"/>
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Field</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Value</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Log URL</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>The log URL, for example https://ct.googleapis.com/testtube/.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Public Key</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>The log's public key, in PEM or DER format. Usually this is an Elliptic Curve key.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Timeout</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Connection timeout in milliseconds, default 5 seconds. Note that certificate issuance and/or OCSP response generation must wait for the log server to respond, so do not set it too high. Note that zero is not a valid value for the timeout.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Label</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Specify which label to place the log under. See <a   href="#src-16232490_id-.CertificateTransparencyv6.14.0-CT_log_labels">CT Log Labels</a>.</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
<p   
>The log server needs to accept certificates issued by your CAs. For local testing you can install your own instance of the sample log server from the <a  class="external-link" href="https://code.google.com/p/certificate-transparency/">CT open source project</a>, and add your root CA to the list of trusted CAs. For a production system (or testing of one), you must contact the log operator to have your root CA added.</p>
<p   
>For redundancy, it is recommended to add more logs to each label than the minimum required. That way certificate issuance will not fail if a single log is down. It is also a good idea to specify a short timeout value and/or enable the <strong class=" ">ct.fastfail.enabled</strong> option in <code class=" ">conf/cesecore.properties</code>, so a failing log does not slow down all requests.</p>
<p   
>Regarding performance, EJBCA will connect to every log having one of the labels selected in the certificate profile, in the order they have been added and in parallel. It will keep fetching SCTs until <strong class=" ">Maximum number of SCTs</strong> is reached. EJBCA will fail issuance if it is unable to fetch at least the number of SCTs given by the parameter <strong class=" ">Minimum number of SCTs</strong> specified in the certificate profile. If the number of retrieved SCTs exceeds the max value, the log(s) last in order will be excluded.</p>
<p   
>To change the order in which the logs are contacted, reorganize the logs on the <strong class=" ">System Configuration</strong> page.</p>
    <div class="section section-2" id="src-16232490_id-.CertificateTransparencyv6.14.0-ExpirationTimeBasedCTLogsExpiration_Time_Based_CT_Logs">
        <h2 class="heading "><span id="src-16232490_id-.CertificateTransparencyv6.14.0-Expiration_Time_Based_CT_Logs" class="confluence-anchor-link"></span><span>Expiration Time Based CT Logs </span></h2>
<p   
>As part of the Google CT policy requirements for April 2018, some logs will only accept certificates expiring within a specific year.</p>
<p   
>To configure an expiration year, click <strong class=" ">Edit</strong> for the log after adding it. When configured, EJBCA will only submit to this log if the certificate expired within the year specified for the log.</p>
    </div>
    <div class="section section-2" id="src-16232490_id-.CertificateTransparencyv6.14.0-CTLogLabelsCT_log_labels">
        <h2 class="heading "><span id="src-16232490_id-.CertificateTransparencyv6.14.0-CT_log_labels" class="confluence-anchor-link"></span><span>CT Log Labels </span></h2>
<p   
>It may be a requirement to publish to certain logs and a certain number of logs before issuing a certificate. For example, Google Chrome requires that all EV certificates issued after 1st of January 2015 must be published to at least one CT log operated by Google, at least one log not operated by Google, and to a certain number of logs in total, where the total amount of logs depends on the lifetime of the certificate. This is achieved by grouping logs using labels in 'System Configuration' page. All logs with the same label forms a log group. EJBCA will fail issuance unless it receives at least one SCT from each log group. Log groups are enabled/disabled by selecting/deselecting labels in the certificate profile.</p>
<p   
>The parameters <strong class=" ">Minimum number of SCTs</strong> and <strong class=" ">Maximum number of SCTs</strong> can be configured for each certificate profile, either manually or by certificate validity according to CT policy. An example setup complying to Chrome's CT policy could contain the following:</p>
<ul class=" "><li class=" "><p   
>A <strong class=" ">Google logs</strong> label containing a set of logs operated by Google, and a label <strong class=" ">Unlabeled</strong> containing a set of logs not operated by Google.</p>
</li><li class=" "><p   
>A certificate profile with:</p>
<ul class=" "><li class=" "><p   
>The labels <strong class=" ">Google logs</strong> and <strong class=" ">Unlabeled</strong> selected.</p>
</li><li class=" "><p   
>The parameter <strong class=" ">Minimum number of SCTs</strong> set to <strong class=" ">By validity</strong> to let EJBCA select a minimum dynamically based on Chrome's CT Policy.</p>
</li><li class=" "><p   
>The parameter <strong class=" ">Maximum number of SCTs</strong> set to <strong class=" ">By validity</strong> to only include the number of SCT's required based on Chrome's CT Policy in the certificate.</p>
</li></ul></li></ul>    </div>
    </div>
    <div class="section section-1" id="src-16232490_id-.CertificateTransparencyv6.14.0-EJBCAAuditLoggingEJBCA_audit_logging">
        <h1 class="heading "><span id="src-16232490_id-.CertificateTransparencyv6.14.0-EJBCA_audit_logging" class="confluence-anchor-link"></span><span>EJBCA Audit Logging </span></h1>
<p   
>The submission of pre-certificates is logged to the EJBCA audit log. When a pre-certificate has been submitted to the required number of CT log servers, then a SUCCESS is audit logged. Otherwise a FAILURE is logged. If the <i class=" ">generation</i> of the pre-certificate fails, then no CT log submission is performed, and nothing is logged.</p>
    </div>
    <div class="section section-1" id="src-16232490_id-.CertificateTransparencyv6.14.0-ActivatingCTActivating_CT">
        <h1 class="heading "><span id="src-16232490_id-.CertificateTransparencyv6.14.0-Activating_CT" class="confluence-anchor-link"></span><span>Activating CT </span></h1>
<p   
>CT logs must be activated in your certificate profiles. For more information, see <a   href="#">Certificate Transparency</a>.</p>
    </div>
    <div class="section section-1" id="src-16232490_id-.CertificateTransparencyv6.14.0-RedactingDNSlabelsinSubjectAlternativeNameRedacting_DNS_labels_in_SubjectAlternati">
        <h1 class="heading "><span id="src-16232490_id-.CertificateTransparencyv6.14.0-Redacting_DNS_labels_in_SubjectAlternati" class="confluence-anchor-link"></span><span>Redacting DNS labels in SubjectAlternativeName </span></h1>
<p   
>In the SubjectAlternativeName extension, if part of the DNS should be a secret, that part can be redacted and replaced by the String &quot;(PRIVATE)&quot; in the pre-certificate that will be published to the Certificate Transparency Log. For more information, see <a   href="#">Certificate Transparency</a>.</p>
    </div>
    <div class="section section-1" id="src-16232490_id-.CertificateTransparencyv6.14.0-UsinganOutgoingProxyServertoSendtoCTLogsUsing_an_outgoing_proxy_server_to_send_t">
        <h1 class="heading "><span id="src-16232490_id-.CertificateTransparencyv6.14.0-Using_an_outgoing_proxy_server_to_send_t" class="confluence-anchor-link"></span><span>Using an Outgoing Proxy Server to Send to CT Logs </span></h1>
<p   
>For security reasons, a common request is using an outgoing proxy server from the CA to the CT logs. The CT log function uses the Java/JBoss proxy configurations and the proxy properties in JBoss can be configured in one of the following ways:</p>
<ul class=" "><li class=" "><p   
>In standalone.sh append to JAVA_OPTS:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">-Dhttp.proxyHost=HostName/IPaddress</code></div>
<div class="line"><code class="plain">-Dhttp.proxyPort=PortNumber</code></div>
<div class="line"><code class="plain">-Dhttps.proxyHost=HostName/IPaddress</code></div>
<div class="line"><code class="plain">-Dhttps.proxyPort=PortNumber</code></div>
</div>
    </div>
</li></ul><ul class=" "><li class=" "><p   
>In standalone.xml append to system-properties:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">property</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"http.proxyHost"</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"HostName/IPaddress"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">&lt;</code><code class="keyword">property</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"http.proxyPort"</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"PortNumber"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">&lt;</code><code class="keyword">property</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"https.proxyHost"</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"HostName/IPaddress"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">&lt;</code><code class="keyword">property</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"https.proxyPort"</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"PortNumber"</code><code class="plain">/&gt;</code></div>
</div>
    </div>
</li></ul><p   
>Ensure to reconfigure the proxy settings if you upgrade/change the JBoss instance.</p>
    </div>
    <div class="section section-1" id="src-16232490_id-.CertificateTransparencyv6.14.0-Troubleshooting">
        <h1 class="heading "><span>Troubleshooting</span></h1>
<p   
>Problems submitting to CT logs may be caused by a number of reasons. You may still be able to issue the certificate even if you experience issues, since EJBCA may be able to retrieve SCTs from any other logs you have configured.</p>
    <div  class="confbox admonition admonition-note">
                    <p class="title">TLS Session Reuse</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>When contacting a CT log, an HTTP POST request with a JSON payload containing the certificate chain is sent. This payload is typically about 4-6 kB large. Note that EJBCA as of version 6.11 supports TLS session reuse, allowing multiple certificate chains to be submitted over the same TLS session. Consequently, if you inspect the traffic sent between EJBCA and the CT log server you may note that the packets are substantially larger than expected. This is the expected behavior.</p>
        </div>
    </div>
    <div class="section section-2" id="src-16232490_id-.CertificateTransparencyv6.14.0-Connectionreset">
        <h2 class="heading "><span>Connection reset</span></h2>
<p   
>This symptom is diagnosed using log entries with &quot;Connection reset&quot; when submitting a certificate to CT logs as shown below:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">Error making POST request to https:</code><code class="comments">//&lt;log server&gt;/ct/v1/add-pre-chain: Connection reset: java.util.concurrent.ExecutionException</code></div>
</div>
    </div>
<p   
>To troubleshoot this issue, check the following:</p>
<ol class=" "><li class=" "><p   
>Some log servers require TLS v1.2 which is not supported by some older versions of Java. Java 8 uses TLS v1.2 by default. If the CT submission failed because of a TLS error, you will see something like this in the log:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">Caused by: java.net.SocketException: Connection reset</code></div>
<div class="line"><code class="plain">	at java.net.SocketInputStream.read(SocketInputStream.java:</code><code class="value">196</code><code class="plain">) [rt.jar:</code><code class="value">1.7</code><code class="plain">.0_85]</code></div>
<div class="line"><code class="plain">	at java.net.SocketInputStream.read(SocketInputStream.java:</code><code class="value">122</code><code class="plain">) [rt.jar:</code><code class="value">1.7</code><code class="plain">.0_85]</code></div>
<div class="line"><code class="plain">	at sun.security.ssl.InputRecord.readFully(InputRecord.java:</code><code class="value">442</code><code class="plain">) [jsse.jar:</code><code class="value">1.7</code><code class="plain">.0_85]</code></div>
<div class="line"><code class="plain">	at sun.security.ssl.InputRecord.read(InputRecord.java:</code><code class="value">480</code><code class="plain">) [jsse.jar:</code><code class="value">1.7</code><code class="plain">.0_85]</code></div>
<div class="line"><code class="plain">	at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:</code><code class="value">946</code><code class="plain">) [jsse.jar:</code><code class="value">1.7</code><code class="plain">.0_85]</code></div>
<div class="line"><code class="plain">	at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:</code><code class="value">1344</code><code class="plain">) [jsse.jar:</code><code class="value">1.7</code><code class="plain">.0_85]</code></div>
<div class="line"><code class="plain">	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:</code><code class="value">1371</code><code class="plain">) [jsse.jar:</code><code class="value">1.7</code><code class="plain">.0_85]</code></div>
<div class="line"><code class="plain">	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:</code><code class="value">1355</code><code class="plain">) [jsse.jar:</code><code class="value">1.7</code><code class="plain">.0_85]</code></div>
</div>
    </div>
<p   
>This means the TLS handshake failed and the CT log server closed the connection.</p>
</li><li class=" "><p   
>Make sure your firewall is configured properly, e.g. allows EJBCA to send HTTPS traffic to the CT logs you are using.</p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>To test the communication between EJBCA and the CT log server, issue the following command on the EJBCA machine:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&gt; curl </code><code class="string">'https://&lt;log server&gt;/ct/v1/add-pre-chain'</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">  </code><code class="string">"error_message"</code><code class="plain">: </code><code class="string">"Unable to parse request."</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"success"</code><code class="plain">: </code><code class="functions">false</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&quot;Unable to parse request&quot; means that the CT log server received your request successfully and the communication between EJBCA and the CT log server should work correctly.</p>
        </div>
    </div>
</li></ol><p  class="auto-cursor-target" 
>HTTP 400 Bad Request</p>
<p   
>This symptom is diagnosed using log entries with &quot;HTTP 400 Bad Request&quot; when submitting a certificate to CT logs as shown below:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">Unhandled exception when retrieving SCT for 'primekey.com' from CT log https://&lt;log server&gt;/ct/v1/. Error: org.certificatetransparency.ctlog.comm.LogCommunicationException: </code></div>
<div class="line"><code class="plain">Error making POST request to https://&lt;log server&gt;/ct/v1/add-pre-chain: HTTP 400 Bad Request: java.util.concurrent.ExecutionException</code></div>
</div>
    </div>
<p   
>To troubleshoot this issue, check the following:</p>
<ol class=" "><li class=" "><p   
>Make sure your root CA certificate is added to the CT log's truststore by the CT log operator.</p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>To check which roots are accepted by a CT log, send a GET request to <strong class=" ">    <span style="color: #000000;">
https://&lt;log server&gt;/ct/v1/get-roots    </span>
</strong>    <span style="color: #000000;">
 as explained in RFC 6962, section     </span>
4.7 Retrieve Accepted Root Certificates. For more information, refer to <a  class="external-link" href="https://tools.ietf.org/html/rfc6962#section-4.7">RFC 6962</a>.</p>
        </div>
    </div>
</li><li class=" "><p  class="auto-cursor-target" 
>All certificates are not accepted by all logs. In particular, some CT logs like Google's Argon logs and Cloudflare's Nimbus logs only accept certificates with a certain year for the output. When you add these logs, you should always enable &quot;Output Limit&quot; as explained in <a   href="#src-16232490_id-.CertificateTransparencyv6.14.0-Expiration_Time_Based_CT_Logs">Expiration Time Based CT Logs</a>. If you are unsure which certificates a particular log accepts, contact the CT log operator.</p>
</li><li class=" "><p  class="auto-cursor-target" 
>Inspect the logs and look for the JSON error message returned from the CT log server. This message is logged at INFO level as of EJBCA 6.14 and looks something like the following example:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="value">2018</code><code class="plain">-</code><code class="value">06</code><code class="plain">-</code><code class="value">01</code><code class="plain"> </code><code class="value">13</code><code class="plain">:</code><code class="value">37</code><code class="plain">:</code><code class="value">00</code><code class="plain">,</code><code class="value">000</code><code class="plain"> INFO [org.cesecore.certificates.certificatetransparency.HttpPostTimeoutInvoker] (pool-</code><code class="value">30</code><code class="plain">-thread-</code><code class="value">3</code><code class="plain">) Error content from CT log was: {</code></div>
<div class="line"><code class="plain">  </code><code class="string">"error_message"</code><code class="plain">: </code><code class="string">"Foo."</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"success"</code><code class="plain">: </code><code class="keyword">false</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>The log entry will only be written to the log if you receive an HTTP response from the CT log with an HTTP status code x, 200 &le; x &le; 299. That is, if the CT submission failed due to a TLS error, this message will not be written to the log.</p>
</li><li class=" "><p   
>CT log servers have built-in rate-limiting. Some rate-limiters are global and may affect you even if your submission rate is low. CT issues caused by rate-limiting can be hard to troubleshoot since errors appear sporadically and seemingly at random. If the error message from the log server contains something like &quot;invalid request&quot; or &quot;rate limit&quot; you may be a victim of rate-limiting. To make sure EJBCA can issue the certificate even if some of the CT logs are unable to fulfill your request, you should add additional log servers to your CT log configuration.</p>
</li></ol>    </div>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="Import_Export_Certificate_Profiles.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Import/Export Certificate Profiles</span>
        </a>
                <a href="Managing_Crypto_Tokens.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Managing Crypto Tokens</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

</body>
</html>
