<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Services - EJBCA - Documentation Space</title>

    
            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="85921598">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_6.15.2.6_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=26774175"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_6.15.2.6_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Documentation.html">EJBCA Documentation</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Operations.html">EJBCA Operations</a></li>
                                                                                     <li><a href="EJBCA_Concept_Guide.html">EJBCA Concept Guide</a></li>
                                                            </ul>
</div>            <h1 id="src-26774175"> <span>Services</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

<p   
>The EJBCA framework for timer services handles procedures that run on a timely basis. The following services types are available:</p>
<ul class=" "><li class=" "><p   
><a   href="#src-26774175_id-.Servicesv6.15.1-CRL_Updater_Service">CRL Updater Service</a>: Checks if any of the configured CAs need a new CRL and generates it if necessary.</p>
</li><li class=" "><p  class="confluence-link" 
><a   href="#src-26774175_id-.Servicesv6.15.1-CertificateExpirationCheckService">Certificate Expiration Check Service</a>: Checks if a CA has certificates about to expire and sends an email notification to the end user and/or the administrator.</p>
</li><li class=" "><p   
><a   href="#src-26774175_id-.Servicesv6.15.1-Certificate_Expiration_Check_Service">User Password Expire Service</a>: Checks if a user has not enrolled for a new certificate within a specified amount of time after the user was last edited. If the user has not enrolled within this time, the user's status is set to <strong class=" ">Generated</strong> and the user will not be able to enroll.</p>
</li><li class=" "><p   
><a   href="#src-26774175_id-.Servicesv6.15.1-RenewCAService">Renew CA Service</a>: Checks if CA certificates are about to expire and automatically renews them.</p>
</li><li class=" "><p   
><a   href="#src-26774175_id-.Servicesv6.15.1-PublisherQueueProcessService">Publisher Queue Process Service</a>: Retries failed publishing operations.</p>
</li><li class=" "><p   
><a   href="#src-26774175_id-.Servicesv6.15.1-HSMKeepaliveService">HSM Keepalive Service</a>: Periodically tests all available Crypto Tokens to avoid connection timeouts.</p>
</li><li class=" "><p   
><a   href="#src-26774175_id-.Servicesv6.15.1-RemoteInternalKeyBindingUpdater">Remote Internal Key Binding Updater</a>: Automatically renews expiring OCSP signing certificates and keys at a connected VA.</p>
</li><li class=" "><p   
><a   href="#src-26774175_id-.Servicesv6.15.1-CRLDownloadandCRLUpdateService">CRL Download and CRL Update Service</a>: Periodically downloads a CRL from the provided URL and imports it into EJBCA, also updating any revocation information for the certificates.</p>
</li><li class=" "><p   
><a   href="#src-26774175_id-.Servicesv6.15.1-CertificateandCRLReaderService">Certificate and CRL Reader Service</a>: Reads certificates and CRLs written to a local directory from a CA using the <a   href="SCP_Publisher.html">SCP Publisher</a>.</p>
</li></ul><p   
>EJBCA also allows you to write plug-ins for customized services. For more information, see <a   href="#src-26774175_id-.Servicesv6.15.1-WritingCustomizedServices">Writing Customized Services</a>.</p>
<p   
>The following provides information on services in the following sections:</p>
<p   
></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-26774175_id-.Servicesv6.15.1-ServiceConfiguration">Service Configuration</a></p>
</li><li class=" "><p   
><a   href="#src-26774175_id-.Servicesv6.15.1-MultipleServicesandClusteringMultiple_services_and_clustering">Multiple Services and Clustering</a></p>
</li><li class=" "><p   
><a   href="#src-26774175_id-.Servicesv6.15.1-CurrentlyAvailableServicesCurrently_Available_Services">Currently Available Services</a></p>
</li><li class=" "><p   
><a   href="#src-26774175_id-.Servicesv6.15.1-WritingCustomizedServicesWriting_Customized_Services">Writing Customized Services</a></p>
</li></ul>    <div class="section section-1" id="src-26774175_id-.Servicesv6.15.1-ServiceConfiguration">
        <h1 class="heading "><span>Service Configuration</span></h1>
<p   
>A service consists of the following components: a <strong class=" ">worker</strong> doing the actual work, an <strong class=" ">interval</strong> determining the time to the next time the service should run, and an optional <strong class=" ">action</strong> of what should be performed if a certain condition occurs.</p>
    <div class="section section-2" id="src-26774175_id-.Servicesv6.15.1-WorkersWorkers">
        <h2 class="heading "><span id="src-26774175_id-.Servicesv6.15.1-Workers" class="confluence-anchor-link"></span><span>Workers </span></h2>
<p   
>The worker is the class that will be executed when the service runs. Each worker can have different worker specific configuration.</p>
    </div>
    <div class="section section-2" id="src-26774175_id-.Servicesv6.15.1-IntervalsIntervals">
        <h2 class="heading "><span id="src-26774175_id-.Servicesv6.15.1-Intervals" class="confluence-anchor-link"></span><span>Intervals </span></h2>
    <div class="section section-3" id="src-26774175_id-.Servicesv6.15.1-PeriodicalInterval">
        <h3 class="heading "><span>Periodical Interval</span></h3>
<p   
>Defines in days/hours/minutes/seconds of how often the worker will be run. <strong class=" "><i class=" ">A worker should never be configured to run more often than the time a single invocation takes.</i></strong></p>
    </div>
    </div>
    <div class="section section-2" id="src-26774175_id-.Servicesv6.15.1-ActionsActions">
        <h2 class="heading "><span id="src-26774175_id-.Servicesv6.15.1-Actions" class="confluence-anchor-link"></span><span>Actions </span></h2>
    <div class="section section-3" id="src-26774175_id-.Servicesv6.15.1-MailAction">
        <h3 class="heading "><span>Mail Action</span></h3>
<p   
>Action that sends an email notification when the service is executed and has the following settings:</p>
<ul class=" "><li class=" "><p   
><strong class=" ">Sender Address</strong>: The from-address used in the email.</p>
</li><li class=" "><p   
><strong class=" ">Receiver Address</strong>: The to-address of the email of not specified by the worker.</p>
</li></ul>    </div>
    </div>
    <div class="section section-2" id="src-26774175_safe-id-aWQtLlNlcnZpY2VzdjYuMTUuMS1QaW50b1NwZWNpZmljTm9kZShzKVBpbl90b19TcGVjaWZpY19Ob2RlKHMp">
        <h2 class="heading "><span id="src-26774175_safe-id-aWQtLlNlcnZpY2VzdjYuMTUuMS1QaW5fdG9fU3BlY2lmaWNfTm9kZShzKQ" class="confluence-anchor-link"></span><span>Pin to Specific Node(s) </span></h2>
<p   
>Allows choosing on which nodes the service is allowed to execute. By not choosing any nodes in the list, the service can be executed on any of the nodes.</p>
<p   
>On EJBCA startup, each node adds its hostname to the list of nodes. The list can also be manually edited on the System Configuration page.</p>
    </div>
    <div class="section section-2" id="src-26774175_id-.Servicesv6.15.1-RunonallNodesRun_on_all_Nodes">
        <h2 class="heading "><span id="src-26774175_id-.Servicesv6.15.1-Run_on_all_Nodes" class="confluence-anchor-link"></span><span>Run on all Nodes </span></h2>
<p   
>By default, services execute on only one node in a cluster, or one of the pinned nodes. However, certain services like the HSM Keepalive service should be run on all nodes.</p>
<p   
>Selecting <strong class=" ">Run on all nodes</strong> disables checking if a service has been running on another node and executes the service on all nodes.</p>
    <div  class="confbox admonition admonition-warning">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>The <strong class=" ">Run on all nodes</strong> option should normally <i class=" ">only</i> be enabled for the HSM Keepalive service. Do not select the option for any other service unless you are absolutely sure you know what you are doing.</p>
        </div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-26774175_id-.Servicesv6.15.1-MultipleServicesandClusteringMultiple_services_and_clustering">
        <h1 class="heading "><span id="src-26774175_id-.Servicesv6.15.1-Multiple_services_and_clustering" class="confluence-anchor-link"></span><span>Multiple Services and Clustering </span></h1>
<p   
>A service worker should never run simultaneously on two nodes, or simultaneously on one node. To avoid running more than one instance on a single node there is a semaphore that inhibits more than one instance of the worker to run in a single JVM. If a worker starts and another worker is already running the worker is rescheduled to run on the next planned interval, and immediately terminated. To avoid running any two services on two nodes simultaneously, the service has a time stamp that is set when it runs and schedules the next run before the actual work is started. This time stamp makes it possible for another node to determine of the service is already running on another node and not start running.</p>
<p   
>In practice what this leads to is that a service will always run on a single node, the same node every time, but the running node may switch at times.</p>
<p   
>For most cases you do not have to pin a service to a specific node. Some reasons to pin nodes are:</p>
<ul class=" "><li class=" "><p   
>HSM Keepalive services: This service should have one service running on each node, since it should keep the local PKCS#11 session alive.</p>
</li><li class=" "><p   
>External RA service: If having multiple RAs and running very often there may be a race condition with services competing to run. Pinning services to run on different cluster nodes towards different External RAs can increase performance and enhance simplicity.</p>
</li></ul>    </div>
    <div class="section section-1" id="src-26774175_id-.Servicesv6.15.1-CurrentlyAvailableServicesCurrently_Available_Services">
        <h1 class="heading "><span id="src-26774175_id-.Servicesv6.15.1-Currently_Available_Services" class="confluence-anchor-link"></span><span>Currently Available Services </span></h1>
    <div class="section section-2" id="src-26774175_id-.Servicesv6.15.1-CRLUpdaterServiceCRL_Updater_Service">
        <h2 class="heading "><span>CRL Updater Service </span></h2>
<p   
>The CRL Updater checks if any of the configured CAs need a new CRL and generates it if necessary. The worker has no additional settings and only supports the periodical interval and no action.</p>
<p   
>The CRL Updater Service runs at Periodic Interval and generates new CRLs if any of the following conditions hold:</p>
<ul class=" "><li class=" "><p   
>Current Time + Periodic Interval     <span style="color: #222222;">
&ge;    </span>
 CRL Next Update - CRL Overlap</p>
</li><li class=" "><p   
>If CRL Issue Interval = 0</p>
<ul class=" "><li class=" "><p   
>Current Time + Periodic Interval     <span style="color: #222222;">
&ge; CRL Next Update    </span>
</p>
</li></ul></li><li class=" "><p   
>If CRL Issue Interval &gt; 0</p>
<ul class=" "><li class=" "><p   
>Current Time + Periodic Interval     <span style="color: #222222;">
&ge; CRL Creation Date + CRL Issue Interval    </span>
</p>
</li></ul></li><li class=" "><p   
>    <span style="color: #222222;">
If Delta CRL Period &gt; 0    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #222222;">
Current Time + Periodic Interval     <span style="color: #222222;">
&ge; Delta CRL Next Update    </span>
    </span>
</p>
</li></ul></li></ul><p   
>    <span style="color: #222222;">
    <span style="color: #222222;">
Depending on the settings in the CA, different CRL generation times will be triggered. Especially when using the CRL Issue Interval, the issuing interval may not be exactly as configured, depending on how the Periodic Interval of the service is configured. It is important to not delay the CRL issuance longer than desired, as it may cause a CRL expiry with no new CRL.     </span>
    </span>
Therefore, a new CRL will be issued while running the service, if an issuance time would normally occur between this run and the next time the service is run.    <span style="color: #222222;">
    <span style="color: #222222;">
 It is recommended to issue a CRL slightly too early than slightly too late.<br/>    </span>
    </span>
</p>
    <div  class="confbox admonition admonition-warning">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>The CRL Updater Service stores the generated CRLs in the CA's database. <strong class=" ">It does not publish the CRL anywhere. </strong>If you want to publish information about revoked certificates to an External VA, <strong class=" ">you must </strong>create a <a   href="Validation_Authority_Peer_Publisher.html">Validation Authority Peer Publisher</a>.</p>
        </div>
    </div>
    </div>
    <div class="section section-2" id="src-26774175_id-.Servicesv6.15.1-CertificateExpirationCheckServiceCertificate_Expiration_Check_Service">
        <h2 class="heading "><span id="src-26774175_id-.Servicesv6.15.1-Certificate_Expiration_Check_Service" class="confluence-anchor-link"></span><span>Certificate Expiration Check Service </span></h2>
<p   
>The <strong class=" ">Certificate Expiration Check Service</strong> worker checks if a CA has certificates that are about to expire and sends an email notification to the end user and/or administrator.</p>
<p   
>The following lists available worker settings:</p>
<ul class=" "><li class=" "><p   
>CAs to Check: Select here which CAs that should be searched for expiring certificates.</p>
</li><li class=" "><p   
>Certificate Profiles to Check: If any certificate profile is selected from this list, the notification service will require that certificates are issued by the selected CAs AND that they are issued using one of the selected certificate profiles. Leaving this list empty will cause the service to search for certificates just based on the CA selection.</p>
</li><li class=" "><p   
>Time before notification is sent: The number of Days/Hours/Minutes/Seconds that should remain of the certificates validity before the notification is sent.</p>
</li><li class=" "><p   
>Send notification to end user: Check this if a notification should be sent to the owner of the certificate. Note that the end user must have an email set in the user database (not necessarily in the certificate) in order for the service to send the notification.</p>
</li><li class=" "><p   
>Notification Subject to End User: The e-mail subject.</p>
</li><li class=" "><p   
>End User Message - Message body of the notification. Substitution variables can be used here as defined in the <a   href="E-mail_Notifications.html">E-mail Notifications</a> section.</p>
</li><li class=" "><p   
>Send notification to Administrator: Check this if a notification should be sent to some defined administrator-mail address. The address of the administrator is configured in the Mail Action component.</p>
</li><li class=" "><p   
>Notification Subject to Administrator: The e-mail subject.</p>
</li><li class=" "><p   
>Administrator Message: Message body of the notification. Substitution variables can be used here as defined in the <a   href="E-mail_Notifications.html">E-mail Notifications</a> section.</p>
</li></ul>    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>You may configure <i class=" ">multiple<u class=" "> </u></i>certificate expiration services specified with different <strong class=" ">Time before notification is sent </strong>values to further alert the user or administrator that a certificate is about to expire.</p>
        </div>
    </div>
    </div>
    <div class="section section-2" id="src-26774175_id-.Servicesv6.15.1-UserPasswordExpireService">
        <h2 class="heading "><span>User Password Expire Service</span></h2>
<p   
>A worker that checks if a user has not enrolled for a new certificate within a specified amount of time after the user was last edited. If the user has not enrolled within this time, the user's status is set to <strong class=" ">Generated</strong> and the user will not be able to enroll. The worker has the same basic setting as the <strong class=" ">Certificate Expiration Check Service</strong>, except for <strong class=" ">Time before notification is sent</strong> which is replaced by:</p>
<ul class=" "><li class=" "><p   
>Time until user password expires: The number of Days/Hours/Minutes/Seconds that a user should be able to enroll for a certificate, i.e. the time before the user's password expire.</p>
</li></ul>    </div>
    <div class="section section-2" id="src-26774175_id-.Servicesv6.15.1-RenewCAService">
        <h2 class="heading "><span>Renew CA Service</span></h2>
<p   
>The renew CA service can be used to automatically renew CAs that are about to expire. This might be used for SubCAs that are valid only short periods of time. The specific settings are:</p>
<ul class=" "><li class=" "><p   
>CAs to Check: CAs to be checked and renewed if they are about to expire.</p>
</li><li class=" "><p   
>Time before CA expires to renew: Amount of time before the CA actually expires, that the service should renew the CA.</p>
</li></ul><p   
>For CAs using soft keystores and not using the default password, auto-activation is required.</p>
    </div>
    <div class="section section-2" id="src-26774175_id-.Servicesv6.15.1-PublisherQueueProcessService">
        <h2 class="heading "><span>Publisher Queue Process Service</span></h2>
<p   
>The publisher queue process service processes the publisher queue. In the publisher queue, entries where publishing failed is collected. This service will try to re-publish entries from this queue. The specific settings are:</p>
<ul class=" "><li class=" "><p   
>Publishers to check: Publishers this service should check and re-publish for. You can run one service for each publisher, or one service for all publishers.</p>
</li></ul>    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>If you run one service for each publisher, you should only configure one publisher in every service. Do not let two services handle the same publisher.</p>
        </div>
    </div>
<p   
>To read on how the algorithm to prevent excessive database load etc is done, the easiest way is to read in the java file for class PublishQueueProcessWorker.</p>
<p   
>The same algorithm as for the CRL update worker is used to make sure the service only runs in one instance on one node.</p>
    </div>
    <div class="section section-2" id="src-26774175_id-.Servicesv6.15.1-HSMKeepaliveService">
        <h2 class="heading "><span>HSM Keepalive Service</span></h2>
<p   
>The service periodically (with configured interval) goes through all available Crypto Tokens and makes a test signature if the following conditions are met:</p>
<ul class=" "><li class=" "><p   
>The crypto token is a PKCS#11 crypto token, i.e. has a PKCS#11 library path configured.</p>
</li><li class=" "><p   
>The crypto token is active.</p>
</li><li class=" "><p   
>The crypto token has a key with alias 'testKey'.</p>
</li></ul><p   
>If these conditions are met, a test signature with the <strong class=" ">testKey</strong> is performed. In addition, if security audit log protection is configured, a test string is protected with the security audit log protection, also testing this crypto token (which is not available in the crypto tokens in the GUI).</p>
<p   
>This will ensure that all configured PKCS#11 slots are used regularly, preventing connection timeouts that could lead to service downtime. You only need to enable this service if you encounter HSM timeouts. The occurrence of such timeouts depends on the specific HSM used, networking equipment etc.</p>
    </div>
    <div class="section section-2" id="src-26774175_id-.Servicesv6.15.1-RemoteInternalKeyBindingUpdater">
        <h2 class="heading "><span>Remote Internal Key Binding Updater</span></h2>
<p   
>The service periodically (with configured interval) connects to the configured peer system using a <a   href="Peer_Systems.html">Peer Connector</a> and checks expiration of visible, usable and enabled Internal Key Bindings' certificates. For renewal to work, the issuing CA has to be usable on the system where this service is running and the same end entity that was used to issue the previous certificate must still exist.</p>
<ul class=" "><li class=" "><p   
>Time before certificate expires: How long before the current bound certificate expires it should be renewed.</p>
</li><li class=" "><p   
>Renew key pair: Option to renew the key pair automatically before issuing a new certificate.</p>
</li></ul>    </div>
    <div class="section section-2" id="src-26774175_id-.Servicesv6.15.1-CRLDownloadandCRLUpdateService">
        <h2 class="heading "><span>CRL Download and CRL Update Service</span></h2>
<p   
>The service periodically downloads a CRL from the provided URL and imports it into EJBCA, also updating any revocation information for the certificates. For more information on how to use this on a Validation Authority, see <strong class=" ">Populating the OCSP Responder Database using the CRL Download Service</strong> in <a   href="OCSP_Management.html">OCSP Management</a>.</p>
<ul class=" "><li class=" "><p   
>CAs to Check: Select the imported CA (or select <strong class=" ">ANY</strong> to process all external X509 CAs with a configured external CDP).</p>
</li><li class=" "><p   
>Ignore nextUpdate and always download the CRL: Select to force a download of the CRL whenever the service is executed instead of only downloading the CRL when the last known CRL indicates that a new one will be available.</p>
</li><li class=" "><p   
>Maximum allowed size to download (bytes): The Service will refuse to process CRLs that exceed this limit.</p>
</li><li class=" "><p   
>Period: How often the Service should check if a new CRL needs to be downloaded.</p>
</li><li class=" "><p   
>Active: Select to activate the service.</p>
</li></ul><p   
>When the service is executed, there will be log entries showing if the CRL download and processing was successful.</p>
<p   
>If the downloaded CRL from the external CDP contains the Freshest CRL extension, the service will try to download and process any such URL that uses &quot;http&quot; as protocol.</p>
    </div>
    <div class="section section-2" id="src-26774175_id-.Servicesv6.15.1-CertificateandCRLReaderService">
        <h2 class="heading "><span>Certificate and CRL Reader Service</span></h2>
<p   
></p>
<p   
><span class="status blue " >ENTERPRISE</span>
 This is an EJBCA Enterprise feature.</p>
<p   
>The Certificate and CRL Reader allows for populating a VA from a CA using the <a   href="SCP_Publisher.html">SCP Publisher</a>. CRLs will be written in cleartext while certificates are serialized as <code class=" ">org.ejbca.scp.publisher.ScpContainer</code> objects, in order to retain revocation details and other pertinent information. Just like from the SCP Publisher, revocations can either be injected with complete information (including the certificate) or minimal (only the issuer, serial number and status). Upon successfully writing to the database, the certificate/CRL files will be removed automatically. If any error occurs, they will be left for future reads.</p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>Note that the publishing CA's certificates need to be imported as External CAs prior to importing certificates in order to verify the signatures.</p>
        </div>
    </div>
<p   
><img  class="confluence-embedded-image image-center"                 style="display:block; margin-left: auto; margin-right: auto;"
     src="images/download/attachments/26774175/Screenshot_2018-11-14_at_16.16.15.png" alt="images/download/attachments/26774175/Screenshot_2018-11-14_at_16.16.15.png" width="800"  />
    </p>
<p   
>The following lists configurable fields:</p>
    <div  class="tablewrap">
        <table class="relative-table wrapped confluenceTable">
                    <colgroup>
                                    <col  width="27%"/>
                                    <col  width="72%"/>
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Field Name</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Description</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Local Directory containing Certificates</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>A directory containing certificate output. Note that the application server must have read/write rights to this directory.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>    <span style="color: #000000;">
Local Directory containing CRLs    </span>
</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>A directory containing CRL output. Note that the application server must have read/write rights to this directory.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>    <span style="color: #000000;">
Certificate Signing CA (if any)    </span>
</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>If a CA was selected to sign the certificate output files prior to writing. The public certificate will be used to verify the signature on the envelope.</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    </div>
    <div class="section section-1" id="src-26774175_id-.Servicesv6.15.1-WritingCustomizedServicesWriting_Customized_Services">
        <h1 class="heading "><span id="src-26774175_id-.Servicesv6.15.1-Writing_Customized_Services" class="confluence-anchor-link"></span><span>Writing Customized Services </span></h1>
<p   
>It is possible to write customized component plug-ins that can be used with other standard (or customized plug-ins) and this section explains the steps necessary.</p>
<p   
>Common for all the components is that it is required to create a class implementing the components interface. Then you have to create a special jar containing the necessary plug-in classes and meta-data (described below) and deploy it to application server so it is included in the class-path. The next step is to create a service using the custom class and optionally the custom properties used by the component. The properties field has the same syntax as a regular Java property file.</p>
<p   
>The Jar must contain meta-data that describes which classes implement which interfaces. This is necessary since EJBCA enumerates all implementations using the <a  class="external-link" href="https://docs.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html">ServiceLoader</a> facility of Java. For each implemented interface the Jar must contain a file named META-INF/services/name.of.interface, for example META-INF/services/org.ejbca.core.model.services.IWorker. Each such file should contain a list of implementing classes, one per line. For example:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain"># Example file. Should be named META-INF/services/org.ejbca.core.model.services.IWorker</code></div>
<div class="line"><code class="plain">com.example.ejbca.MyWorker</code></div>
<div class="line"><code class="plain">com.example.ejbca.MyOtherWorker</code></div>
</div>
    </div>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>It is not possible to hot-deploy EJBCA when customized services are used.</p>
        </div>
    </div>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>Service components made for EJBCA 5.0 and earlier do not use the ServiceLoader facility and will not be auto-detected. To use a service component made for version 5.0 please set web.manualclasspathsenabled to true in conf/web.properties and specify the qualified class name manually (i.e. including package name).</p>
        </div>
    </div>
    <div class="section section-2" id="src-26774175_id-.Servicesv6.15.1-CustomWorkerCustomWorker">
        <h2 class="heading "><span id="src-26774175_id-.Servicesv6.15.1-CustomWorker" class="confluence-anchor-link"></span><span>CustomWorker </span></h2>
<p   
>A Custom worker must implement the org.ejbca.core.model.services.IWorker interface. But a simpler way is to inherit the BaseWorker class. Then you have to implement one method 'void work()' doing the actual work every time the service framework decides it is time. The work method can make a call to the action (optional) component by 'getAction().performAction(someActionInfo);' The action info can vary depending on the action component, but it must implement the ActionInfo interface.</p>
<p   
>If something goes wrong during the work should a ServiceExecutionFailedException be thrown with a good error message.</p>
<p   
>See org.ejbca.core.model.services.workers.DummyWorker for an example implementation.</p>
    </div>
    <div class="section section-2" id="src-26774175_id-.Servicesv6.15.1-CustomIntervalCustomInterval">
        <h2 class="heading "><span id="src-26774175_id-.Servicesv6.15.1-CustomInterval" class="confluence-anchor-link"></span><span>CustomInterval </span></h2>
<p   
>A Custom Interval must implement the org.ejbca.core.model.services.IInterval interface. But a simpler way is to inherit the BaseInterval class. You then have to implement one method 'public long getTimeToExecution();' which should return the time in seconds until the next time the service is run. Or it should return DONT_EXECUTE if the service should stop running.</p>
<p   
>See org.ejbca.core.model.services.intervals.DummyInterval for an example implementation.</p>
    </div>
    <div class="section section-2" id="src-26774175_id-.Servicesv6.15.1-CustomActionCustomAction">
        <h2 class="heading "><span id="src-26774175_id-.Servicesv6.15.1-CustomAction" class="confluence-anchor-link"></span><span>CustomAction </span></h2>
<p   
>A Custom Action must implement the org.ejbca.core.model.services.IAction interface.</p>
<p   
>A simpler way is to inherit the BaseAction class. Then only the method 'performAction(ActionInfo actionInfo)' needs to be implemented. The methods should perform the action according to the defined properties and the ActionInfo (all optional). If something goes wrong during the processing of the action should a ActionException be thrown.</p>
<p   
>See org.ejbca.core.model.services.actions.DummyAction for an example implementation.</p>
    </div>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="Extended_Key_Usages.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Extended Key Usages</span>
        </a>
                <a href="Peer_Systems.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Peer Systems</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

</body>
</html>
