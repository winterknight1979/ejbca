<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Maximizing Performance - EJBCA - Documentation Space</title>

    
            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="85921598">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_6.15.2.6_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=16237729"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_6.15.2.6_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Documentation.html">EJBCA Documentation</a></li>
                                                                                     <li><a href="EJBCA_Installations.html">EJBCA Installations</a></li>
                                                            </ul>
</div>            <h1 id="src-16237729"> <span>Maximizing Performance</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

<p   
>EJBCA is used to issue billions of certificates under very high transaction load (hundreds per second). As with any large scale system you need to design the solution to support such a use case, both with the solution design and the IT infrastructure. For smaller use cases both design and IT is rather easy, but for huge use cases there are many things to take into consideration, and much expertise is needed (as it is for any IT system with huge amounts of data and tough requirements).</p>
    <div class="section section-1" id="src-16237729_id-.MaximizingPerformancev6.15.0-General_Performance_TipsGeneralPerformanceTips">
        <h1 class="heading "><span id="src-16237729_id-.MaximizingPerformancev6.15.0-General_Performance_Tips" class="confluence-anchor-link"></span><span>General Performance Tips</span></h1>
<p   
>Normally in a PKI extreme performance is not really an issue. A default installation of EJBCA can easily issue tenths, even up to hundreds, of certificates per second, which is more than enough even for very large installations. For OCSP it is more important, but OCSP is also more lightweight so the default performance there is hundreds of requests per second.</p>
<p   
>In more specialized PKI installations there can however be the need to issue hundreds of certificates per second. Therefore we provide a list of configuration items that can maximize performance of EJBCA to issue more than 100 certificates per second (depending on hardware etc).</p>
<ul class=" "><li class=" "><p   
>Disable logging to database in cesecore.properties, only use Log4jLogDevice. This removes a database insert and gives a big boost.</p>
</li><li class=" "><p   
>Configure Log4j to log only to file, not console, and use only INFO or ERROR logging, not DEBUG. This can give a small improvement.</p>
</li><li class=" "><p   
>Disable use of CertReqHistory in CA configuration (Use Certificate Request History). This removes a database insert and gives a big boost. The default setting is to have this disabled</p>
</li><li class=" "><p   
>Disable finishUser in CA configuration. Verify that this is ok first by reading the documentation for this feature. This can save a database read and update.</p>
</li><li class=" "><p   
>Enable all caches in cache.properties. If you cache indefinitely you can use the CLI command 'bin/ejbca.sh clearcache' if configuration changes are made. This can give a small improvement. See also info about the <a   href="Clearing_System_Caches.html">clear all caches button</a>.</p>
</li><li class=" "><p   
>Do not enforce any uniqueness (keys, DN, Subject DN SerialNumber) in CA configuration. This will ensure no extra selects are made and can give a small improvement.</p>
</li><li class=" "><p   
>Minimize the number of indexes in the database, only use the ones that are absolutely needed. This makes inserts in the database a bit faster and can give additional 10%.</p>
</li><li class=" "><p   
>Use the native JBoss connectors for http and https. This can give an additional 10%.</p>
</li><li class=" "><p   
>If you have a lot of certificates (&gt;100M) it might be a good idea to use a separate table for the storage of the encoded certificates. See the database.useSeparateCertificateTable property in ./conf/database.properties.sample</p>
</li></ul>    </div>
    <div class="section section-1" id="src-16237729_id-.MaximizingPerformancev6.15.0-SolutionDesignConsideration">
        <h1 class="heading "><span>Solution Design Consideration</span></h1>
<p   
>In a high speed, high volume environment you don't want to design your solution to synchronize around a single object/row in the database as that will just limit your throughput. Instead you want to use non-conflicting transactions as much as possible.</p>
<p   
>To maintain speed in parallel use cases, EJBCA (and most other application) use optimistic locking in the database. With optimistic locking using the same object (end entity) for multiple parallel threads is not a good idea as there will be a race condition on this object. While you <i class=" ">could</i> configure the database/EJBCA to synchronize harder, but that will only lead to congestion and wait times.</p>
<p   
>In practice this means that you should not make parallel requests using the same end entity if you want to have good performance without having to serialize around the end entity object. A better design for maximizing performance is to use:</p>
<ul class=" "><li class=" "><p   
>a unique end entity per thread (serialized to the same end entity), or</p>
</li><li class=" "><p   
>a unique end entity per request</p>
</li></ul><p   
>You can use random end entities created per request, enabling very large parallelism.</p>
    </div>
    <div class="section section-1" id="src-16237729_id-.MaximizingPerformancev6.15.0-Throw_away_CAThrowAwayCA">
        <h1 class="heading "><span id="src-16237729_id-.MaximizingPerformancev6.15.0-Throw_away_CA" class="confluence-anchor-link"></span><span>Throw Away CA</span></h1>
<p   
>EJBCA can be configured to function as a <strong class=" ">Throw Away CA</strong>. In this mode EJBCA simply functions as a high speed certificate factory, issuing certificates but not storing any trace of them in the local database.</p>
<p   
>Using EJBCA in <strong class=" ">Throw Away CA</strong>-mode curtails some functionality, foremost the following:</p>
<ul class=" "><li class=" "><p   
>You cannot search for issued certificates.</p>
</li><li class=" "><p   
>You cannot enable certain limitations such as <a   href="CA_Fields.html#src-23859254_id-.CAFieldsv6.15.0-Enforce_unique_DN">Enforce unique DN</a> or <a   href="CA_Fields.html#src-23859254_id-.CAFieldsv6.15.0-Enforce_unique_public_keys">Enforce unique public keys</a>.</p>
</li><li class=" "><p   
>You may revoke certificates. However it requires specific CA configuration and only limited certificate data will be persisted upon revocation. For more information, see <strong class=" ">Accept Revocations for Non-Existing Entries</strong> in <a   href="CA_Fields.html">CA Fields</a>.</p>
</li></ul><p   
>If these limitations are acceptable you can gain some benefits by using <strong class=" ">Throw Away CA</strong>-mode:</p>
<ul class=" "><li class=" "><p   
>Maximum performance since no database queries are done. Enable to maximum caching and EJBCA will not make a single call to the database.</p>
</li><li class=" "><p   
>Minimal storage requirements. Since no issued certificates are stored in the database only EJBCA configuration needs storage.</p>
</li></ul>    </div>
    <div class="section section-1" id="src-16237729_id-.MaximizingPerformancev6.15.0-LimitingDatabaseQuerySizeLimiting_Database_Query_Size">
        <h1 class="heading "><span id="src-16237729_id-.MaximizingPerformancev6.15.0-Limiting_Database_Query_Size" class="confluence-anchor-link"></span><span>Limiting Database Query Size </span></h1>
<p   
>Certain types of queries can, whether intentionally or not, generate massive results. In order to not clog up the database driver, EJBCA has a default maximum value of 500 results for certain tables, which affects the following data sets:</p>
<ul class=" "><li class=" "><p   
>Certificates</p>
</li><li class=" "><p   
>End Entities</p>
</li><li class=" "><p   
>Hard Token Usernames</p>
</li></ul><p   
>You can change the query limit under <strong class=" ">System Configuration</strong>. For safety, there is still a hard upper limit of 25,000 entries.</p>
    </div>
    <div class="section section-1" id="src-16237729_id-.MaximizingPerformancev6.15.0-LimitingDatabaseQueryTimeoutLimiting_Database_Query_Timeout">
        <h1 class="heading "><span id="src-16237729_id-.MaximizingPerformancev6.15.0-Limiting_Database_Query_Timeout" class="confluence-anchor-link"></span><span>Limiting Database Query Timeout </span></h1>
<p   
>Certain types of searches can, whether intentionally or not, generate database heavy queries (even full table scans). In order to not overload the database, EJBCA will try to limit for how long a query is allowed to run for certain searches before aborting. For such limitations to work, both you database and Java DataBase Connector (JDBC) driver must support this. This setting currently affects the following searches:</p>
<ul class=" "><li class=" "><p   
>RA GUI Search for certificates</p>
</li><li class=" "><p   
>RA GUI Search for end entities</p>
</li></ul><p   
>You can lower or raise the default of 10000 ms (10 seconds) in the query timeout under <strong class=" ">System Configuration.</strong> Setting the value to 0 means that EJBCA will not try to enforce any query timeout and will default to you application server and database configuration.</p>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="High_Availability_%28HA%29%2C_a.k.a_Clustering.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>High Availability (HA), a.k.a Clustering</span>
        </a>
                <a href="Transaction_Timeouts.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Transaction Timeouts</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

</body>
</html>
