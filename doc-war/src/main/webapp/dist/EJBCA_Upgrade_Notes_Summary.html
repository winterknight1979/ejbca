<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>EJBCA Upgrade Notes Summary - EJBCA - Documentation Space</title>

    
            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="85921598">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_6.15.2.6_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=85926584"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_6.15.2.6_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Release_Information.html">EJBCA Release Information</a></li>
                                                                                     <li><a href="EJBCA_Upgrade_Notes.html">EJBCA Upgrade Notes</a></li>
                                                            </ul>
</div>            <h1 id="src-85926584"> <span>EJBCA Upgrade Notes Summary</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

<hr>
<p   
>The following lists important notes on upgrading to EJBCA for all released versions. For upgrade instructions and information on upgrade paths, see <a   href="Upgrading_EJBCA.html">Upgrading EJBCA</a>.</p>
<p   
>For details of new features and improvements in a respective release, see the <a   href="EJBCA_6.11_Release_Notes.html">EJBCA Release Notes</a>.</p>
<p   
></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.14toEJBCA6.15.0">EJBCA 6.14 to EJBCA 6.15.0</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.13toEJBCA6.14.0">EJBCA 6.13 to EJBCA 6.14.0</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.12toEJBCA6.13.0">EJBCA 6.12 to EJBCA 6.13.0</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.11toEJBCA6.12.0">EJBCA 6.11 to EJBCA 6.12.0</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.10toEJBCA6.11.0">EJBCA 6.10 to EJBCA 6.11.0</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.9.xtoEJBCA6.10.0">EJBCA 6.9.x to EJBCA 6.10.0</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.8.xtoEJBCA6.9.0">EJBCA 6.8.x to EJBCA 6.9.0</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.7.xtoEJBCA6.8.0">EJBCA 6.7.x to EJBCA 6.8.0</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.6.1toEJBCA6.7.0">EJBCA 6.6.1 to EJBCA 6.7.0</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.5.xtoEJBCA6.6.0">EJBCA 6.5.x to EJBCA 6.6.0</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.4.2toEJBCA6.5.0">EJBCA 6.4.2 to EJBCA 6.5.0</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.3.2uptoEJBCA6.4.0">EJBCA 6.3.2 up to EJBCA 6.4.0</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.2.7uptoEJBCA6.3.0">EJBCA 6.2.7 up to EJBCA 6.3.0</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA5.0.xtoEJBCA6.0.x">EJBCA 5.0.x to EJBCA 6.0.x</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA4.0.xtoEJBCA5.0.x">EJBCA 4.0.x to EJBCA 5.0.x</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.11.xtoEJBCA4.0.x">EJBCA 3.11.x to EJBCA 4.0.x</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.9.xtoEJBCA3.10.x">EJBCA 3.9.x to EJBCA 3.10.x</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.8.xtoEJBCA3.9.x">EJBCA 3.8.x to EJBCA 3.9.x</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.7.xtoEJBCA3.8.x">EJBCA 3.7.x to EJBCA 3.8.x</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.6.xtoEJBCA3.7.x">EJBCA 3.6.x to EJBCA 3.7.x</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.5.xtoEJBCA3.6.x">EJBCA 3.5.x to EJBCA 3.6.x</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.4.xtoEJBCA3.5.x">EJBCA 3.4.x to EJBCA 3.5.x</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.3.xtoEJBCA3.4.x">EJBCA 3.3.x to EJBCA 3.4.x</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.2.xtoEJBCA3.3.x">EJBCA 3.2.x to EJBCA 3.3.x</a></p>
</li><li class=" "><p   
><a   href="#src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.1.xtoEJBCA3.2">EJBCA 3.1.x to EJBCA 3.2</a></p>
</li></ul><hr>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.14toEJBCA6.15.0">
        <h1 class="heading p1"><span>EJBCA 6.14 to EJBCA 6.15.0</span></h1>
<hr>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-DatabaseChanges">
        <h2 class="heading "><span>Database Changes</span></h2>
<p   
>With the introduction of ACME protocol support in EJBCA 6.15, we've had to introduce the following new tables to EJBCA:</p>
<ul class=" "><li class=" "><p   
><strong class=" ">AcmeAccountData</strong></p>
</li><li class=" "><p   
><strong class=" ">AcmeAuthorizationData</strong></p>
</li><li class=" "><p   
><strong class=" ">AcmeChallengeData</strong></p>
</li><li class=" "><p   
><strong class=" ">AcmeNonceData</strong></p>
</li><li class=" "><p   
><strong class=" ">AcmeOrderData</strong></p>
</li></ul><p   
>As always, these can either be created automatically if database user rights are sufficient or created manually using the bundled creation scripts.</p>
<p   
>We've created indexes for:</p>
<ul class=" "><li class=" "><p   
><strong class=" ">AcmeAccountData</strong></p>
</li><li class=" "><p   
><strong class=" "><strong class=" ">AcmeAuthorizationData</strong></strong></p>
</li><li class=" "><p   
><strong class=" "><strong class=" "><strong class=" ">AcmeChallengeData</strong></strong></strong></p>
</li><li class=" "><p   
><strong class=" "><strong class=" ">AcmeOrderData</strong></strong></p>
</li></ul><p   
>The indexes are found in <tt class=" ">doc/sql-scripts/create-index-ejbca.sql</tt> and we recommend applying them on any production environment using ACME.</p>
    </div>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-BehavioralChanges">
        <h2 class="heading "><span>Behavioral Changes</span></h2>
    <div class="section section-3" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-CustomCertificateExtensions">
        <h3 class="heading "><span>Custom Certificate Extensions</span></h3>
<p   
>With the introduction of wildcards and non-required CCEs, we've tightened how extensions in enrollment requests are handled. Where in prior versions undefined extensions in the request would simply be dropped from the final certificate, in 6.15 and later requests containing unmatched extensions will be treated as erroneous and rejected.</p>
    </div>
    </div>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.15.XtoEJBCA6.15.2.5">
        <h2 class="heading p1"><span>EJBCA 6.15.X to EJBCA 6.15.2.5</span></h2>
    <div class="section section-3" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-BehavioralChanges.1">
        <h3 class="heading "><span>Behavioral Changes</span></h3>
    <div class="section section-4" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-SCEPSecurityFix-MoreRestrictiveCAAccess">
        <h4 class="heading "><span>SCEP Security Fix - More Restrictive CA Access</span></h4>
<p   
>In earlier versions of EJBCA, the CA for SCEP enrollment was only restricted by the configured End Entity Profile and Certificate Profile. The <strong class=" ">RA CA Name</strong> option was used as a the default CA, if no CA was specified in the request.</p>
<p   
>As of EJBCA 6.15.2.5 (as well as versions 7.3.1.1 and 7.4.0), a SCEP alias will only allow issuance using the CA selected as <strong class=" ">RA CA Name</strong>. Note that this CA must still be selected in the configured End Entity Profile and the Certificate Profile.</p>
    </div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.13toEJBCA6.14.0">
        <h1 class="heading p1"><span>EJBCA 6.13 to EJBCA 6.14.0</span></h1>
<hr>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-AccessRulesChanges">
        <h2 class="heading "><span>Access Rules Changes </span></h2>
<p   
>The access rule requirements for generating CSRs from the UI for internal keybindings have been changed from <i class=" ">    <span style="color: #000000;">
/cryptotoken/keys/    </span>
    <span style="color: #000000;">
generate/    </span>
</i> to <i class=" ">    <span style="color: #000000;">
/cryptotoken/    </span>
</i>    <span style="color: #000000;">
<i class=" ">use/</i> in order allow for these roles to be separated.    </span>
</p>
    </div>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-ChangestoEJBCAWS">
        <h2 class="heading p1"><span>Changes to EJBCAWS</span></h2>
    <div class="section section-3" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EjbcaWS.getRemainingNumberOfApprovals">
        <h3 class="heading "><span>EjbcaWS.getRemainingNumberOfApprovals</span></h3>
<p   
>The method <tt class=" ">org.ejbca.core.protocol.ws.common.IEjbcaWS.getRemainingNumberOfApprovals(int)</tt> has changed behavior to conform to real world requirements. The previous javadoc stated:</p>
    <div  class="confbox programlisting">
                <div class="content">
        <pre><code>/**
 *
 * @param requestId the ID of an approval request
 * @return the number of remaining approvals required, or STATUS_REJECTED (-1) if request was rejected
 * @throws ApprovalException if a request of the given ID didn't exist
 * @throws AuthorizationDeniedException if the current requester wasn't authorized. 
 * @throws ApprovalRequestExpiredException if sought approval request has expired
 * 
 */</code></pre>
        </div>
    </div>
<p   
>This was incorrect as <tt class=" ">ApprovalDataVO.STATUS_REJECTED</tt> is actually -2. In order to stay true to the API we have changed the return value to be -1 for rejected results. The new javadoc states as following:</p>
    <div  class="confbox programlisting">
                <div class="content">
        <pre><code>/**
 * 
 * @param requestId the ID of an approval request
 *
 @return the remaining number of approvals for this request (with 0 
meaning that the request has passed) or -1 if the request has been 
denied
 * @throws ApprovalException if a request of the given ID didn't exist
 * @throws AuthorizationDeniedException if the current requester wasn't authorized.
 * @throws ApprovalRequestExpiredException if approval request was expired before having a definite status
 * 
 */</code></pre>
        </div>
    </div>
<p   
>The additional change is that the older implementation would throw an exception for approvals that had expired after being approved. Since 6.14, this method will return 0 if the approval has passed (or -1 if it has been rejected), even if it has since then expired.</p>
<p   
></p>
    </div>
    <div class="section section-3" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EjbcaWS.getProfiles">
        <h3 class="heading "><span>EjbcaWS.getProfiles</span></h3>
<p   
>This method was found to potentially leak information about end entity profiles and CA ID's that the requesting admin wasn't authorized to. If requesting an End Entity Profile, the requesting user must be authorized to the following rules:</p>
<ul class=" "><li class=" "><p  class="p1" 
><tt class=" ">/ra_functionality/view_end_entity_profiles</tt></p>
</li><li class=" "><p   
>to any CAs that are referenced in the EEP</p>
</li><li class=" "><p   
>to any CAs that are referenced in any Certificate Profiles referenced to in the EEP</p>
</li></ul><p   
>If requesting a Certificate Profile, the requesting user must be authorized to the following rules:</p>
<ul class=" "><li class=" "><p  class="p1" 
><tt class=" ">/ca_functionality/view_certificate_profiles</tt></p>
</li><li class=" "><p   
>to any CAs that are referenced in the Certificate Profile</p>
</li></ul>    </div>
    </div>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-UpgradingCAAValidators">
        <h2 class="heading "><span>Upgrading CAA Validators</span></h2>
<p   
>A minor bug was found in 6.13 where the list of ignored Top Level Domains was reduced to a single entry if the validator has been edited or saved. EJBCA will automatically upgrade the validators when they are edited in 6.14, but for this reason it's required that CAA Validators are not edited during the upgrade. Besides that, CAA Validators will otherwise function entirely as normal.</p>
    </div>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.12toEJBCA6.13.0">
        <h1 class="heading "><span>EJBCA 6.12 to EJBCA 6.13.0</span></h1>
<hr>
    <div class="section section-2" id="src-85926584_EJBCA6.13UpgradeNotes-CreationoftheNoConflictCertificateDataTable">
        <h2 class="heading p1"><span>Creation of the NoConflictCertificateData Table</span></h2>
<p   
>Upgrading to EJBCA 6.13.0 requires the creation of the table NoConflictCertificateData. The table will either be created automatically by the application server if the database user has creation rights, or can be created manually using the standard database creation scripts in EJBCA. This table is only used by installations using the Oracle database using asynchronous setups, and will only be used if any certificates are configured for <a   href="Maximizing_Performance.html">Throw Away</a> mode.</p>
    </div>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.11toEJBCA6.12.0">
        <h1 class="heading p1"><span>EJBCA 6.11 to EJBCA 6.12.0</span></h1>
<hr>
    <div class="section section-2" id="src-85926584_EJBCA6.12UpgradeNotes-RARoleManagement">
        <h2 class="heading p1"><span>RA Role Management</span></h2>
<p  class="p1" 
>EJBCA 6.12 changes how role namespaces works for administrators with access to the <i class=" ">&quot;/&quot;</i>-access rule. In previous version Prior to 6.12, access to the <i class=" ">&quot;/&quot;</i>-rule would implicitly grant access to all Role Namespaces, even if the administrator was only added to roles in one or more specific namespaces. As of 6.12, this is no longer the case, and administrators must be explicitly added to roles under the namespaces they should be able to access. Note that the <i class=" ">Super Administrator</i> role by default has access to the root namespace, and is not affected by this change, unless the role has been moved to a different namespace.</p>
    </div>
    <div class="section section-2" id="src-85926584_EJBCA6.12UpgradeNotes-UnidFnr">
        <h2 class="heading p1"><span>UnidFnr</span></h2>
<p   
>In previous versions of EJBCA, <i class=" ">trustdir</i> and <i class=" ">CA Certificate</i> were defined in ocsp.properties for the UnidFnr OCSP Extension. During upgrade to EJBCA 6.12.0, the extensions defined by OID in <i class=" ">ocsp.properties</i> will added to each OCSP Key Binding. Additionally, each certificate in the specified UnidFnr <i class=" ">trustdir</i> will be imported as trust entries for each Key Binding. If UnidFnr is enabled in your installation, the CA certificate pointed to by &quot;<i class=" ">ocsp.unidcacert</i>&quot; <strong class=" ">MUST</strong> be imported into EJBCA before upgrading.</p>
    </div>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.10toEJBCA6.11.0">
        <h1 class="heading p1"><span>EJBCA 6.10 to EJBCA 6.11.0</span></h1>
<hr>
<p  class="p1" 
>EJBCA 6.11 introduces the EST protocol to EJBCA. Note that as a security measure the EST responder is by default turned off (as will all new protocols from now on) and needs to be activated under System Configuration.</p>
<p  class="p1" 
>EJBCA 6.11 upgrades the Peers Protocol with information about protocol (CMP, ETC, etc) rights. Due to a minor bug in the protocol versioning system it's highly recommended to upgrade RAs/VAs before the CAs, though the consequences for performing the upgrade in the incorrect order is merely that any CMP or WS proxying will cease to work during the upgrade.</p>
<p  class="p1" 
>We've made running external scripts from within EJBCA (the new External Command Certificate Validator, and the old General Purpose Custom Publisher) configurable under System Configuration. This setting will be turned off by default, mostly to avoid confusion in environments where they can't be applied. If you're currently running a General Purpose Custom Publisher, this setting will be set to active during upgrade.</p>
<p  class="p1" 
>SHA1WithRSA and SHA1WithECDSA are no longer acceptable signature algorithms for an OCSP responder. If you are running a legacy responder that still need to use these deprecated algorithms, you have to configure these in the setting 'ocsp.signaturealgorithm' in conf/ocsp.properties.</p>
<p  class="p1" 
>Incorrectly padded base64 encoded strings are no longer accepted by Bouncy Castle's base64 decoder used in EJBCA.</p>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.10.0toEJBCA6.10.1">
        <h2 class="heading p1"><span>EJBCA 6.10.0 to EJBCA 6.10.1</span></h2>
<hr>
<p  class="p1" 
>Upgrading to 6.10.1 will only affect users who write to Certificate Transparency logs during certificate issuance. 6.10.1 introduces the concept of LABELS, which allow CAs to order CT logs into different groups. Labels replace the 'Mandatory' checkbox introduced in 6.10, allowing CA's to be more fine grained as to which logs they need to write to. The upgrade process will add labels automatically; any logs belonging to Google or checked as mandatory will be labeled as 'MANDATORY', while all others will be labeled as 'UNLABELED'. After upgrade, post-upgrade needs to be run in order to clean the logs of old references.</p>
    </div>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.9.xtoEJBCA6.10.0">
        <h1 class="heading p1"><span>EJBCA 6.9.x to EJBCA 6.10.0</span></h1>
<hr>
<p  class="p1" 
>There are no upgrade operations required when upgrading from 6.9.x to 6.10.</p>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.8.xtoEJBCA6.9.0">
        <h1 class="heading p1"><span>EJBCA 6.8.x to EJBCA 6.9.0</span></h1>
<hr>
<p  class="p1" 
>When upgrading to EJBCA 6.9.0, all changes are automatically performed and no post-upgrade step is required.</p>
<p  class="p1" 
>On the database, the only change is the creation of the table BlacklistData. This table is empty by default, but can be filled with data to validate requests against a blacklist using the new Validators feature. If this table is expected to contain much data, there is a recommended index to apply in the create-index-ejbca.sql file.</p>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.7.xtoEJBCA6.8.0">
        <h1 class="heading p1"><span>EJBCA 6.7.x to EJBCA 6.8.0</span></h1>
<hr>
<p  class="p1" 
>When upgrading to EJBCA 6.8.0, the initial upgrade will occur automatically when 6.8.0 is deployed. All in all the following changes will have takenplace, or will take place in the post-upgrade step. Note that complete descriptions of these steps follow:</p>
<p  class="p1" 
>1. Post-upgrade can now be performed in the Admin GUI<br/>2. The role, role member and access rule implementations have changed<br/>3. Approval Profiles can now be set per action in CA and Certificate Profile</p>
<p  class="p1" 
>Besides this, branches and custom implementations based on EJBCA code need to take the following changes into account:</p>
<p  class="p1" 
>4. AuthenticationTokens are now loaded dynamically and custom implementations will need modification.</p>
<p  class="p1" 
>Lastly, the following behavioral changes should be taken into account:</p>
<p  class="p1" 
>5. The ability to search for information in the 'Details' column of the audit log has been removed<br/>6. WebService API has changed for approvals<br/>7. The CLI command 'role addadmin' has been renamed 'role addrolemember'<br/>8. In the CMP protocol, more stringent chain validation of certificate in the extraCerts fields (used in 3GPP Vendor mode and RA mode) has been introduced.</p>
    <div class="section section-2" id="src-85926584_safe-id-aWQtLkVKQkNBVXBncmFkZU5vdGVzU3VtbWFyeXY2LjE1LjIuNi1Db21wbGV0ZURlc2NyaXB0aW9uc29mQ2hhbmdlczo">
        <h2 class="heading p1"><span>Complete Descriptions of Changes:</span></h2>
    <div class="section section-3" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-1.Post-upgradecannowbeperformedintheAdminGUI">
        <h3 class="heading p1"><span>1. Post-upgrade can now be performed in the Admin GUI</span></h3>
<p  class="p1" 
>From 6.8.0 and onwards, the &quot;System Upgrade&quot; menu option will be available in the UI when the system is in need of a post-upgrade-step. Post-upgradecan be triggered from here instead of from the CLI.</p>
    </div>
    <div class="section section-3" id="src-85926584_safe-id-aWQtLkVKQkNBVXBncmFkZU5vdGVzU3VtbWFyeXY2LjE1LjIuNi0yLlRoZXJvbGUscm9sZW1lbWJlcmFuZGFjY2Vzc3J1bGVpbXBsZW1lbnRhdGlvbnNoYXZlY2hhbmdlZA">
        <h3 class="heading p1"><span>2. The role, role member and access rule implementations have changed</span></h3>
<p  class="p1" 
>All rules are now recursive and during upgrade the existing access rules are converted to grant the same access. Note that when new objects are created under a recursive accept rule, access will be automatically granted.</p>
<p  class="p2" 
>After a post-upgrade, authentication sessions (i.e. administrators) that match multiple Roles will have the combined access from all the Roles.In previous versions different authentication methods had different priority in the case where authenticated session could belong to multiple Roles.</p>
<p  class="p1" 
>The &quot;Not equals case sensitive&quot; and &quot;Not equals case insensitive&quot; match operators are no longer allowed. If you use currently use them, you needto reconfigure your roles to be able to proceed past the post-upgrade</p>
<p  class="p1" 
>Each match key now implies if the match should be case sensitive or not. You are recommended to use the default match value operator for existing rules (usually this means &quot;Equals case sensitive&quot;).</p>
<p  class="p1" 
>For the new implementation, two new tables have been introduced: RoleData and RoleMemberData. The tables AdminGroupData, AdminEntityData and AccessRulesData will no longer be updated with new data, but are retained for upgrade and 100% uptime reasons.</p>
    </div>
    <div class="section section-3" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-3.ApprovalProfilescannowbesetperactioninCAandCertificateProfile">
        <h3 class="heading p1"><span>3. Approval Profiles can now be set per action in CA and Certificate Profile</span></h3>
<p  class="p1" 
>CAs and Certificate Profiles will automatically be upgraded, using the same profiles for the same actions as before.</p>
<p  class="p2" 
>Be aware that exported certificate profiles from 6.6 and 6.7 can be imported, but not from prior versions.</p>
    </div>
    <div class="section section-3" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-4.AuthenticationTokensarenowloadeddynamicallyandcustomimplementationswillneedmodification.">
        <h3 class="heading p1"><span>4. AuthenticationTokens are now loaded dynamically and custom implementations will need modification.</span></h3>
<p  class="p1" 
>Authentication token implementations now implement the AuthenticationTokenMetaData marker interface, which is used to load them dynamically using service manifests.</p>
    </div>
    <div class="section section-3" id="src-85926584_safe-id-aWQtLkVKQkNBVXBncmFkZU5vdGVzU3VtbWFyeXY2LjE1LjIuNi01LlRoZWFiaWxpdHl0b3NlYXJjaGZvcmluZm9ybWF0aW9uaW50aGUnRGV0YWlscydjb2x1bW5vZnRoZWF1ZGl0bG9naGFzYmVlbnJlbW92ZWQu">
        <h3 class="heading p1"><span>5. The ability to search for information in the 'Details' column of the audit log has been removed.</span></h3>
<p  class="p1" 
>This is due to the fact that search was not delivering results for rows that contain accented characters, which gave inconsistent behavior. This functionality will be reintroduced when the search always delivers the same results.</p>
    </div>
    <div class="section section-3" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-6.WebServiceAPIhaschangedforapprovals">
        <h3 class="heading p1"><span>6. WebService API has changed for approvals </span></h3>
<p  class="p1" 
>During the rework of Approvals in EJBCA 6.7.0, the exception class WaitingForApprovalException was changed, where the attribute approvalId was changed to the more usable requestId. Since this value was of little use for webservice calls we judged that there was little harm in changing it, but any 3rd party implementations of the WS API should be aware of this change.</p>
<p  class="p1" 
>NOTE: There is now a possibility to store subject alternative names in CertificateData, and search for certificates based on that. This feature is disabled by default and you need to enable it with 'Search enabled' for 'Subject Alternative Name' in old Certificate Profiles.</p>
    </div>
    <div class="section section-3" id="src-85926584_safe-id-aWQtLkVKQkNBVXBncmFkZU5vdGVzU3VtbWFyeXY2LjE1LjIuNi03LlRoZUNMSWNvbW1hbmQncm9sZWFkZGFkbWluJ2hhc2JlZW5yZW5hbWVkJ3JvbGVhZGRyb2xlbWVtYmVyJw">
        <h3 class="heading p1"><span>7. The CLI command 'role addadmin' has been renamed 'role addrolemember'</span></h3>
<p  class="p1" 
>Besides this, the command is identical to previous versions.</p>
    </div>
    <div class="section section-3" id="src-85926584_safe-id-aWQtLkVKQkNBVXBncmFkZU5vdGVzU3VtbWFyeXY2LjE1LjIuNi04LkludGhlQ01QcHJvdG9jb2wsbW9yZXN0cmluZ2VudGNoYWludmFsaWRhdGlvbm9mY2VydGlmaWNhdGVpbnRoZWV4dHJhQ2VydHNmaWVsZHModXNlZGluM0dQUFZlbmRvcm1vZGVhbmRSQW1vZGUpaGFzYmVlbmludHJvZHVjZWQu">
        <h3 class="heading p1"><span>8. In the CMP protocol, more stringent chain validation of certificate in the extraCerts fields (used in 3GPP Vendor mode and RA mode) has been introduced.</span></h3>
<p  class="p1" 
>If you have been using CMP clients which have previously slipped by sending incomplete or bad chains in this field, they may now be rejected. This could for example happen if your vendor of eNodeB's use a vendor CA that issues certificates invalid according to the RFC5280 standard.</p>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.6.1toEJBCA6.7.0">
        <h1 class="heading p1"><span>EJBCA 6.6.1 to EJBCA 6.7.0</span></h1>
<hr>
<p  class="p1" 
>EJBCA 6.7.0 removes the value ocsp.responderidtype as read from ocsp.properties. The responder ID type (default keyhash) has, since the introduction of Internal Key Bindings back in EJBCA 6.0.0, been set for each OCSP keybinding individually, and thus the value from ocsp.properties has only been used for CAs acting as their own responders. From EJBCA 6.7.0 this value will be set from the OCSP Keybindings tab instead of in ocsp.properties.</p>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.6.0toEJBCA6.6.1">
        <h2 class="heading p1"><span>EJBCA 6.6.0 to EJBCA 6.6.1</span></h2>
<hr>
<p  class="p1" 
>The upgrade to EJBCA 6.6.1 enables seconds precision for CA and user certificate configuration and allows the issuance of short living certificates. To achieve this, for the CA and the certificate profile a new field for the validity is implemented. This field is populated when a CA and certificate profile is loaded from data object for the first time.</p>
<p  class="p1" 
>Furthermore, the handling of leap years was changed. Previously, EJBCA would take leap years into account when creating a CA or certificate profile when a validity was specified in terms of years (with &quot;10y&quot; syntax), and add extra days accordingly. Since 6.6.1, EJBCA always counts a year as 365 days, so if you need to account for leap years, then you need to specify them manually, for example as &quot;10y 2d&quot;. CAs and certificate profiles from earlier versions will keep their existing validity times unchanged.</p>
    </div>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.5.xtoEJBCA6.6.0">
        <h1 class="heading p1"><span>EJBCA 6.5.x to EJBCA 6.6.0</span></h1>
<hr>
<p  class="p1" 
>Upgrading to 6.6.0 will require replacing the approval settings in CAs and certificate profiles with approval profiles. If approvals are used in any capacity, you need to run the following command after deploying the new version of EJBCA:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ ant upgrade</code></div>
</div>
    </div>
<p  class="p1" 
>and restart JBoss. If approvals are currently not in use, this step is not needed.</p>
<p  class="p1" 
>Upgrading to 6.6.0 involves the following changes:</p>
<ol class=" "><li class="p1 "><p   
><strong class=" ">Changes to CertificateData</strong></p>
</li><li class="p1 "><p   
><strong class=" ">Changes to ApprovalData</strong></p>
<ol class=" "><li class="p1 "><p   
><strong class=" ">Public Web Self Registration<br/></strong></p>
</li></ol></li><li class="p1 "><p   
><strong class=" ">Changes to WebService Approvals</strong></p>
</li><li class="p1 "><p   
><strong class=" ">Removal of the access rule /ca_functionality/store_certificate</strong></p>
</li><li class="p1 "><p   
><strong class=" ">100% Upgrade Uptime Notes</strong></p>
<ol class=" "><li class="p1 "><p   
><strong class=" ">Approval Profiles</strong></p>
</li></ol></li></ol>    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-1.ChangestoCertificateData">
        <h2 class="heading p1"><span>1. Changes to CertificateData</span></h2>
<p  class="p2" 
>CertificateData has three new columns &quot;notBefore&quot;, &quot;endEntityProfileId&quot; and &quot;subjectAltName&quot;.</p>
<p  class="p1" 
>CertificateData is for storing issued certificates and can be quite large. Even though deploying the new version EJBCA will eventually performthe schema change on larger installations, we strongly recommend that you manually alter the table before deploying the new version of EJBCA. (Otherwise you might need to force a restart of the application server.) Since CertificateData is used by EJBCA running as a Validation Authority, you need to make this database schema change to your VAs as well before upgrading for publishing to work.</p>
<p  class="p1" 
>See src/upgrade/650_660/650_660-upgrade-&lt;database&gt;.sql for the correct SQL ALTER statement.</p>
<p  class="p1" 
>In the case where the endEntityProfileId and subjectAltName has not changed for End Entities since certificate issuance, you can copy this value using a SQL statement like (consult your DBA for the proper syntax and feasibility of executing this query on your production database):</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">UPDATE</code><code class="plain"> CertificateData </code><code class="keyword">AS</code><code class="plain"> a </code><code class="keyword">INNER</code><code class="plain"> </code><code class="color1">JOIN</code><code class="plain"> UserData </code><code class="keyword">AS</code><code class="plain"> b </code><code class="keyword">ON</code><code class="plain"> a.username = b.username</code></div>
<div class="line"><code class="keyword">SET</code><code class="plain"> a.endEntityProfileId = b.endEntityProfileId, a.subjectAltName = b.subjectAltName </code><code class="keyword">WHERE</code><code class="plain"> a.endEntityProfileId </code><code class="keyword">IS</code><code class="plain"> </code><code class="color1">NULL</code><code class="plain">;  </code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-2.ChangestoApprovalData">
        <h2 class="heading p1"><span>2. Changes to ApprovalData</span></h2>
<p  class="p2" 
>ApprovalData has a new approval profile concept. Approvals created prior to 6.6.0 will still be available, but performing approvals on nodes running EJBCA versions prior to 6.6.0 on an upgraded database (i.e during upgrade) is not supported. As part of this change, approval notifications are now configured per approval partition instead of globally. Check your Approval Profile afterdeploying the new code.</p>
    <div class="section section-3" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-a.PublicWebSelfRegistration">
        <h3 class="heading p1"><span> a. Public Web Self Registration</span></h3>
<p  class="p1" 
>If you have been using the Self Registration in the old Public Web you need to create an Approval Profile, and select to use this for &quot;Add/Edit End Entity&quot;actions either in the CA configuration or in the Certificate Profile configuration.</p>
    </div>
    </div>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-3.ChangestoWebServiceApprovals">
        <h2 class="heading p1"><span>3. Changes to WebService Approvals </span></h2>
<p  class="p1" 
>If you have been using Approvals with the WebService API you have configured approval settings in jaxws.properties (only related to calls to genTokenCertificates and/or viewHardToken). This configuration setting has changed as part of the new approval profile concept. Look at jaxws.properties and configure a new approval profile for the WebService Approvals.</p>
    </div>
    <div class="section section-2" id="src-85926584_safe-id-aWQtLkVKQkNBVXBncmFkZU5vdGVzU3VtbWFyeXY2LjE1LjIuNi00LlJlbW92YWxvZnRoZWFjY2Vzc3J1bGUvY2FfZnVuY3Rpb25hbGl0eS9zdG9yZV9jZXJ0aWZpY2F0ZQ">
        <h2 class="heading p1"><span>4. Removal of the access rule /ca_functionality/store_certificate </span></h2>
<p  class="p2" 
>The access rule /ca_functionality/store_certificate has been removed for the simple reason that it wasn't actually used. It will not be cleaned from anyexisting roles due to being harmless (and invasive to remove).</p>
    </div>
    <div class="section section-2" id="src-85926584_safe-id-aWQtLkVKQkNBVXBncmFkZU5vdGVzU3VtbWFyeXY2LjE1LjIuNi01LjEwMCVVcGdyYWRlVXB0aW1lTm90ZXM">
        <h2 class="heading p1"><span>5. 100% Upgrade Uptime Notes</span></h2>
    <div class="section section-3" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-a.ApprovalProfiles">
        <h3 class="heading p1"><span>a. Approval Profiles</span></h3>
<p  class="p2" 
>Approval profiles (of the Accumulative Approval Profile type) will during startup of the first upgraded node be automatically created and set for CAs and Certificate Profiles using approvals. During the upgrade, approval requests may roll in from un-upgraded nodes, and these will automatically be re-parsed when they are read from the upgraded ones, in other words set to use the same profile as if they'd been created on an upgraded node. For the sake of 100% uptime, this means that all actions (enrollment, revocation, CA activation, etc) may continue during the upgrade, and they may be processed from the upgraded nodes. On the other hand, un-upgraded nodes will not be able to approve actions created by or read by the upgraded nodes until the upgrade process is complete.</p>
    </div>
    </div>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.5.1toEJBCA6.5.3">
        <h2 class="heading p1"><span>EJBCA 6.5.1 to EJBCA 6.5.3</span></h2>
<hr>
<p  class="p1" 
>6.5.3 involves a minor change to the CLI command &quot;ca editca&quot;. The &quot;-listFields&quot; and &quot;-getValue&quot; flags have been removed, and have been replaced with</p>
<p  class="p1" 
>the &quot;ca listcafields&quot; and &quot;ca getcafield&quot; commands instead.</p>
    </div>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.5.0toEJBCA6.5.1">
        <h2 class="heading p1"><span>EJBCA 6.5.0 to EJBCA 6.5.1</span></h2>
<hr>
<p  class="p1" 
>EJBCA 6.5.1 involves two minor change to CMP aliases:</p>
<p  class="p1" 
>1. End Entity Profiles (for RA configurations) were referred to by name instead of by ID. Since End Entity Profile Names are both volatile and</p>
<p  class="p1" 
>not guaranteed unique, this led to issues where renaming a profile could cause a CMP alias to enter an error state. 6.5.1 will automatically</p>
<p  class="p1" 
>convert existing CMP aliases to the new format while preserving the old value for 100% uptime needs. CMP will function, no configuration</p>
<p  class="p1" 
>changes should be made during the upgrade.</p>
<p  class="p1" 
>2. As a result of this, EJBCA no longer supports the ra.endentityprofile=KeyId or ra.certificateprofile=KeyId configuration values, which was deprecated in 2013 (ECA-2948).</p>
    </div>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.4.2toEJBCA6.5.0">
        <h1 class="heading p1"><span>EJBCA 6.4.2 to EJBCA 6.5.0</span></h1>
<hr>
<p  class="p1" 
>Upgrading to 6.5.0 involves the following changes:</p>
<p  class="p1" 
>1. Key algorithm constraints in certificate profiles</p>
<p  class="p1" 
>2. Configuration changes in CMP Proxy</p>
<p  class="p1" 
>3. Database maximum query count</p>
<p  class="p1" 
>4. CMP error message</p>
<p  class="p1" 
>5. healthcheck.publisherconnections property</p>
<p  class="p1" 
>These changes are documented at length below:</p>
<p  class="p1" 
>1. Key algorithm constraints in certificate profiles</p>
<p  class="p2" 
>EJBCA 6.5.0 allows configuration of key algorithm constraints in certificate profiles and by default any type compatible with the current allowed</p>
<p  class="p1" 
>key lengths will be preselected during the upgrade. If you allow 1024 bits, both RSA and DSA will be allowed and since it is now possible to</p>
<p  class="p1" 
>request tokens using any allowed key algorithm from the public web, requesting a DSA 1024 keystore will be allowed compared to earlier when only RSA</p>
<p  class="p1" 
>was available over this interface.</p>
<p  class="p1" 
>2. Configuration changes in CMP Proxy</p>
<p  class="p2" 
>For those running the CMP Proxy, the following values have changed names in cmpProxy.properties:</p>
<p  class="p1" 
>From: To:</p>
<p  class="p1" 
>cmp.backend.extra.caservicecertpath cmp.backend.caservicecertpath</p>
<p  class="p1" 
>cmp.backend.extra.issuerchainpath cmp.backend.issuerchainpath</p>
<p  class="p1" 
>cmp.backend.extra.keystorepath cmp.backend.keystorepath</p>
<p  class="p1" 
>cmp.backend.extra.keystorepwd cmp.backend.keystorepwd</p>
<p  class="p1" 
>The old values will continue to function for the time being, but will get dropped at a future date.</p>
<p  class="p1" 
>3. Database maximum query count</p>
<p  class="p2" 
>The maximum query count (maximum number of object retrieval from the database in a single request), previously several predefine constants, can now</p>
<p  class="p1" 
>be set from the web UI (in the Systems Configuration screen).</p>
<p  class="p1" 
>4. CMP error message</p>
<p  class="p1" 
>A couple of error messages for CMP have been changed.</p>
<p  class="p1" 
>- When submitting a request with a URL that does not match an existing CMP alias, a HTTP 404 (not found) is returned instead of a CMP badRequest error message.</p>
<p  class="p1" 
>- When trying to revoke a certificate that has already been revoked, a CMP certRevoked error message is returned instead of a CMP badRequest error message.</p>
<p  class="p1" 
>5. healthcheck.publisherconnections property</p>
<p  class="p1" 
>The property healthcheck.publisherconnections was documented as defaulting to false, but actually defaulted to true. This has now been corrected to default to false.</p>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.4.0toEJBCA6.4.2">
        <h2 class="heading p1"><span>EJBCA 6.4.0 to EJBCA 6.4.2</span></h2>
<hr>
<p  class="p1" 
>EJBCA 6.4.2 adds a couple of additional rules to any existing Auditors introduced since 6.4.0, as well as their analogs (i.e. an admin with edit rights will be given view rights as well). This upgrade will happen automatically and the database version will be set to 6.4.2.</p>
<p  class="p1" 
>The changes will be as follows. Any roles matching up to the 6.4.0 Auditors will be given the full set of rules, while non-auditors will be handled as follows:</p>
<p  class="p1" 
>Currently accessed rules: Future accessed rules:</p>
<p  class="p1" 
>/system_functionality/edit_systemconfiguration /system_functionality/view_systemconfiguration</p>
<p  class="p1" 
>/system_functionality/edit_available_extended_key_usages /system_functionality/view_available_extended_key_usages</p>
<p  class="p1" 
>/system_functionality/edit_available_custom_certificate_extensions /system_functionality/view_available_custom_certificate_extensions</p>
<p  class="p1" 
>/system_functionality/edit_administrator_privileges /system_functionality/view_administrator_privileges</p>
<p  class="p1" 
>Auditors will receive all of the above rules, in addition to:</p>
<p  class="p1" 
>/ra_functionality/view_end_entity</p>
<p  class="p1" 
>The additional pages available to the Auditor are the following:</p>
<p  class="p1" 
>Page Name: Notes:</p>
<p  class="p1" 
>Search End Entities</p>
<p  class="p1" 
>Administrator Roles</p>
<p  class="p1" 
>CMP Configuration</p>
<p  class="p1" 
>SCEP Configuration</p>
<p  class="p1" 
>System Configuration</p>
    </div>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.3.2uptoEJBCA6.4.0">
        <h1 class="heading p1"><span>EJBCA 6.3.2 up to EJBCA 6.4.0</span></h1>
<hr>
<p  class="p1" 
>Upgrading to 6.4.0 will require some minor additions of access rules, which will be performed in post-upgrade. All additions create more granularity, so while role will be given access to anything they didn't have before the upgrade, rules can be restricted manually after the upgrade to make access control more restrictive.</p>
<p  class="p1" 
>Upgrading to 6.4.0 involves the following changes:</p>
<p  class="p1" 
>1. New Access rules for Auditors</p>
<p  class="p1" 
>2. XKMS no longer supported</p>
<p  class="p1" 
>3. Extended Key Usages and Custom Certificate Extension are imported to the database from the previously static configuration files</p>
<p  class="p1" 
>4. New Access rules to update Extended Key Usages and Custom Certificate Extensions</p>
<p  class="p1" 
>5. Changes to Custom Certificate Extensions</p>
<p  class="p2" 
></p>
<p  class="p1" 
>1. New Access rules for Auditors:</p>
<p  class="p1" 
>A new default Role has been added named &quot;Auditor&quot;, which is a role which has view access to all pages but not rights to make any changes or perform any actions. Some new rules had to be added to accommodate this role, and authorization to certain GUI pages has been made more fine grained as a result. During upgrade, all roles which previously had access rights using the previous rules will automatically be given access to the new rule. These are as follows:</p>
<p  class="p1" 
>Any roles which had access to: Now also have access to:</p>
<p  class="p1" 
>/ca_functionality/basic_functions/activate_ca or /ca_functionality/view_ca</p>
<p  class="p1" 
>/ca_functionality/ (recursive)</p>
<p  class="p1" 
>/ca_functionality/edit_certificate_profiles /ca_functionality/view_certificate_profiles</p>
<p  class="p1" 
>/ca_functionality/edit_publisher /ca_functionality/view_publisher</p>
<p  class="p1" 
>/ra_functionality/edit_end_entity_profiles /ra_functionality/view_end_entity_profiles</p>
<p  class="p1" 
>/ /services/edit and /services/view</p>
<p  class="p3" 
>/internalkeybinding /internalkeybinding/view (recursive)</p>
<p  class="p2" 
></p>
<p  class="p1" 
>The pages that will be available to this new role are the following:</p>
<p  class="p1" 
>Page Name: Notes:</p>
<p  class="p1" 
>CA Activation</p>
<p  class="p1" 
>CA Structure &amp; CRLs</p>
<p  class="p1" 
>Certificate Profiles Certificate Profiles previously not accessible (due to lack of access to CAs or</p>
<p  class="p1" 
>root access) will be rendered view only.</p>
<p  class="p1" 
>Certification Authorities All CA's will now be listed (instead of only the ones which the admin had access to, but</p>
<p  class="p1" 
>ones without access will be greyed out.</p>
<p  class="p1" 
>End Entity Profiles</p>
<p  class="p1" 
>Publishers</p>
<p  class="p1" 
>Crypto Tokens</p>
<p  class="p1" 
>Services</p>
<p  class="p1" 
>Internal Key Bindings</p>
<p  class="p2" 
></p>
<p  class="p1" 
>2. XKMS no longer supported</p>
<p  class="p1" 
>Support for XKMS was removed and is no longer available. When upgrading to EJBCA 6.4.0, internal keystores for XKMS will be removed and is upgrading in a 100% uptime cluster, the XKMS option in older versions of EJBCA will also disappear.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>3. Extended Key Usages and Custom Certificate Extension are imported to the database from the previously static configuration files:</p>
<p  class="p1" 
>The configuration files 'extendedkeyusage.properties' and 'certextensions.properties' are automatically read into EJBCA database during deployment of the new code. Future changes to Extended Key Usages and Custom Certificate Extensions will have to be done through the AdminGUI under 'System Configuration'-&gt;'Extended Key Usages' and 'System Configuration'-&gt;'Custom Certificate Extensions'</p>
<p  class="p2" 
></p>
<p  class="p1" 
>In the case of Custom Certificate Extension, only the extensions with 'id&lt;ID&gt;.used=true' are imported into the database. Please note that extensions related to OCSP responses are not effected. Only the handling the content of 'extendedkeyusage.properties' and 'certextensions.properties' files is effected.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>4. New Access rules to update Extended Key Usages and Custom Certificate Extensions:</p>
<p  class="p1" 
>New Access Rules has been added to add, remove or edit Extended Key Usages and Custom Certificate Extensions. During upgrade, all roles which previously had the access right '/system_functionality/edit_systemconfiguration', will automatically be given access to the new rules '/system_functionality/edit_available_extended_key_usages' and '/system_functionality/edit_available_custom_certificate_extensions'</p>
<p  class="p1" 
></p>
<p  class="p1" 
>5. Changes to Custom Certificate Extensions.</p>
<p  class="p1" 
>Several changes have been implemented in how Custom Certificate Extensions are handled:</p>
<p  class="p1" 
></p>
<p  class="p1" 
>5.a Available Custom Certificate Extensions are no longer limited to only 255 extensions:</p>
<p  class="p1" 
>The limitation on how many Custom Certificate Extensions EJBCA can have available at one time has now been removed.</p>
<p  class="p1" 
></p>
<p  class="p1" 
>5.b Used Custom Certificate Extensions in a Certificate Profile are now identified by their OIDs:</p>
<p  class="p1" 
>The Used Custom Certificate Extensions in a Certificate Profile used to be a list of numbers representing the extensions' IDs. This has now been changed to a list of Strings representing the extensions' OIDs instead. This is done by adding a new field containing the OIDs of the Used Custom Certificate Extensions. The field containing the list of IDs is not changed, but all functions are now referencing the new field containing the list of OIDs. This way, an older version of EJBCA can still work on a newer database content without disrupting any functions.</p>
<p  class="p1" 
></p>
<p  class="p1" 
>5.c Custom Certificate Extensions must implement the CustomCertificatExtension marker interface.</p>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.3.1uptoEJBCA6.3.2">
        <h2 class="heading p1"><span>EJBCA 6.3.1 up to EJBCA 6.3.2</span></h2>
<hr>
<p  class="p1" 
>As the VA Publisher was shifted from Community to Enterprise in EJBCA 6.3.1.1, it had to change baseclass, so will thus require a database upgrade. To keep to the 100% uptime requirement, please follow the following procedure:</p>
<p  class="p1" 
>1. Upgrade EJBCA on all nodes. The old publishers will still function on the new nodes, but they won't be editable in the GUI during the</p>
<p  class="p1" 
>upgrade procedure.</p>
<p  class="p1" 
>2. Run 'ant post-upgrade' on any one of the nodes and enter &quot;6.3.1&quot; (as this is will be the current database version). This operation</p>
<p  class="p1" 
>will replace all of the old publishers with the new ones.</p>
<p  class="p1" 
>3. Verify that the publishers are correctly configured and can publish certificates and CRLs.</p>
    </div>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.2.xuptoEJBCA6.3.1.1">
        <h2 class="heading p1"><span>EJBCA 6.2.x up to EJBCA 6.3.1.1</span></h2>
<hr>
<p  class="p1" 
>EJBCA 6.3.1.1 is the Community release of EJBCA 6.3. Besides including all upgrade steps in previous releases, the biggest database change in EJBCA 6.3.1.1 is that the VA Publisher has been moved from Community Edition into Enterprise Edition. Since the previous class (and code supporting it) no longer exist in Community, a placeholder class retaining all the old data will replace old publishers to retain the data, but publishing using this class will do nothing. Should any Community Users wish to migrate to the Enterprise Edition, the placeholder will be replaced by the new VA Publisher.</p>
<p  class="p2" 
>External RA has also been removed from the Community Edition for 6.3.1.1. If you are running Community and require these features, please contact a sales representative at Primekey Solutions.</p>
    </div>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.2.7uptoEJBCA6.3.0">
        <h1 class="heading p1"><span>EJBCA 6.2.7 up to EJBCA 6.3.0</span></h1>
<hr>
<p  class="p1" 
>EJBCA 6.3.0 introduces one new table, PeerData. This table is automatically created at deployment to the appserver. If you prefer to do the database upgrade manually, see src/upgrade for SQL scripts for your specific database.</p>
<p  class="p2" 
>Certain features have been shifted from the Community to Enterprise version of EJBCA, among these are SCEP RA Mode, CMP Proxy and EV Certificate specific DN fields. If you are running Community and require these features, please contact a sales representative at Primekey Solutions.</p>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.2.7toEJBCA6.2.8">
        <h2 class="heading p1"><span>EJBCA 6.2.7 to EJBCA 6.2.8</span></h2>
<hr>
<p  class="p1" 
>A very minor change has been made to how the &quot;EMPTY&quot; (default) End Entity Profile is handled. Previous versions required root access (access to &quot;/&quot; in the admin rules tree) to use this profile, but since we since a few versions back generate rights for this profile like any other, those are now used instead.</p>
<p  class="p2" 
>The signature of OCSP responses are only verified for the first created response per issuer after a OCSP signer cache reload. Previously we always checked each response. (This is intended to detect failing HSMs. The security aspect of response validation is the OCSP client's responsibility.) Use the health check to detect failing HSMs if you cache the OCSP signers for a long time and want to detect this.</p>
<p  class="p1" 
>Rules for using the GUI have been made for fine grained.</p>
<p  class="p1" 
>Differences are:</p>
<p  class="p1" 
>* End Entity Profiles are access via &quot;/endentityprofilesrules&quot; instead of the deprecated &quot;/super_administrator&quot;</p>
<p  class="p1" 
>* The &quot;EMPTY&quot; end entity profile has access rules like any other profile.</p>
<p  class="p1" 
>* System Configuration is now accessed via /system_functionality/edit_systemconfiguration instead of &quot;/&quot; in previous versions</p>
<p  class="p1" 
>* The rule /ca_functionality/edit_publishers is now all that is required to access the Publisher's page in the GUI, and all publishers assigned</p>
<p  class="p1" 
>to a CA that the admin has access to, or unassigned to any CA, will show up on the list. The &quot;CA Administrator&quot; role template has been given access to this rule.</p>
<p  class="p1" 
>These changes require no action during or after upgrade. Since earlier rules were either lower level or non-selectable due to deprecation, any user with access to those rules much have access to the new ones as well. Since the new rules are more specific than the old ones, any users gaining access to the affected resources is presumed to be intentional, but testing should be made for any custom roles.</p>
    </div>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.2.xtoEJBCA6.2.7">
        <h2 class="heading p1"><span>EJBCA 6.2.x to EJBCA 6.2.7</span></h2>
<hr>
<p  class="p1" 
>Behavior of OCSP responder has been changed slightly in order to improve performance. Status of the OCSP signing certificate's CA is now only checked when the cache is reloaded, instead of at every request. If unsure how long the timeout is set for, check the value ocsp.signingCertsValidTime in ocsp.properties.</p>
    </div>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.2.xtoEJBCA6.2.4">
        <h2 class="heading p1"><span>EJBCA 6.2.x to EJBCA 6.2.4</span></h2>
<hr>
<p  class="p1" 
>The configuration from for the OCSP default responder has been moved from ocsp.properties into the global configuration, into a new cache with ID=OCSP.</p>
<p  class="p1" 
>The old value will automatically be committed into the database by the first upgraded node. If ocsp.properties didn't point to a subject DN matching an existent CA or OCSP keybinding, the old value will be retained until either a CA or keybinding matching it has been created or a valid CA or keybinding has been selected in the GUI.</p>
<p  class="p1" 
>Default behavior of the default responder has been modified to automatically reply for all externally imported CAs which lack specific OCSP keybindings. Be aware that this may cause unexpected behavior in the case of where an inactivated (due to responder certificate being revoked or expiring) keybinding exists, and that keybinding has a different behavior in regards to unknown certificates than the default responder.</p>
    </div>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.1.xtoEJBCA6.1.y">
        <h2 class="heading p1"><span>EJBCA 6.1.x to EJBCA 6.1.y</span></h2>
<hr>
<p  class="p1" 
>See the procedure, and notes, for upgrading from 6.0.x to 6.0.x.</p>
<p  class="p1" 
>In EJBCA 6.1.2, the SCEP configuration handling has been rewritten. SCEP configurations are no longer read from conf/scep.properties file, instead, SCEP configurations will be set through the command line (execute './bin/ejbca.sh config scep' from EJBCA home directory for command line documentation).</p>
<p  class="p1" 
>If you do use SCEP, you need to upload your old scep.properties file to EJBCA after upgrade. You can do that by executing the following command in EJBCA home directory:</p>
<p  class="p1" 
>./bin/ejbca.sh config scep uploadfile conf/scep.properties scep</p>
<p  class="p1" 
>The new URL will be:</p>
<p  class="p1" 
><a  class="external-link" href="http://HOSTPORT">http://HOST:PORT/ejbca/publicweb/apply/scep/CONFIGURATION_ALIAS/pkiclient.exe</a></p>
<p  class="p1" 
>It you use the URL:</p>
<p  class="p1" 
><a  class="external-link" href="http://HOSTPORT">http://HOST:PORT/ejbca/publicweb/apply/scep/noca/pkiclient.exe</a></p>
<p  class="p1" 
>or the URL:</p>
<p  class="p1" 
><a  class="external-link" href="http://HOSTPORT">http://HOST:PORT/ejbca/publicweb/apply/scep/ra/noca/pkiclient.exe</a></p>
<p  class="p1" 
>You need to set the property 'ALIAS.includeca' to 'false' in the command line by executing the followingfrom EJBCA home directory:</p>
<p  class="p1" 
>./bin/ejbca.sh config scep updatealias ALIAS includeca false</p>
<p  class="p1" 
>If you are using External RA, please note that the name of the scep.properties file has been changed to scepra.properties</p>
    </div>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA6.0.xtoEJBCA6.1.x">
        <h2 class="heading p1"><span>EJBCA 6.0.x to EJBCA 6.1.x</span></h2>
<hr>
<p  class="p1" 
>Upgrade from EJBCA 6.0 to 6.1 consists of a simple database change in the table KeyRecoveryData. If the database user used for EJBCA has alter table privileges the upgrade will be done automatically when deploying the new version of EJBCA (plug-in upgrade) and starting JBoss. If you prefer to do the database upgrade manually, see src/upgrade for SQL scripts for your specific database.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>100% up-time upgrade notes:</p>
<p  class="p1" 
>There should be no issues moving between EJBCA 6.0 and 6.1, older versions of EJBCA will run with the additional database columns added to KeyRecoveryData.</p>
<p  class="p1" 
>If you had existing KeyrecoveryData, you need to set the new column cryptoTokenId to 0 (see src/upgrade/600_610).</p>
<p  class="p1" 
>update KeyRecoveryData set cryptoTokenId=0;</p>
<p  class="p1" 
>Since EJBCA 6.1.0 OCSP responses no longer include the Root CA Certificate, unless the Root CA is the OCSP signer, and it is configured to include the signer certificate. Having OCSP responses as small as possible is an important performance feature, and since the client must have the root certificate as trusted there is no need to include the root certificate in the chain.</p>
<p  class="p1" 
>If you get a &quot;java.lang.NoSuchMethodError&quot; in the admin GUI it is because JBoss (5) does not clean temporary files very well. Delete the directories JBOSS_HOME/server/default/tmp and JBOSS_HOME/server/default/work and restart JBoss to get it working.</p>
    </div>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA5.0.xtoEJBCA6.0.x">
        <h1 class="heading p1"><span>EJBCA 5.0.x to EJBCA 6.0.x</span></h1>
<hr>
<p  class="p1" 
>See release notes for more details on changes.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>Index:</p>
<p  class="p1" 
>1. Basic Upgrade Procedure for EJBCA</p>
<p  class="p1" 
>2. Basic Upgrade Procedure for Validation Authorities</p>
<p  class="p1" 
>a. Notable Changes</p>
<p  class="p1" 
>b. Upgrade Process</p>
<p  class="p1" 
>c. Post Upgrade</p>
<p  class="p1" 
>3. 100% Uptime Upgrade Notes</p>
<p  class="p1" 
>a. Upgrading CryotoTokens</p>
<p  class="p1" 
>b. Upgrading the OCSP CA Extended Service</p>
<p  class="p1" 
>4. CMP Configuration Handling</p>
<p  class="p1" 
>5. CLI Commands Renamed</p>
<p  class="p1" 
>6. Miscellaneous Issues</p>
<p  class="p2" 
></p>
<p  class="p1" 
>1. Basic Upgrade Procedure for EJBCA:</p>
<p  class="p1" 
>The 'ant bootstrap' target has been deprecated, and now it's covered by the 'ant</p>
<p  class="p1" 
>deploy' target. Behavior for the 'ant deploy' has been changed, and the old</p>
<p  class="p1" 
>command is equivalent to the following sequence:</p>
<p  class="p2" 
></p>
<p  class="p1" 
>- ant deploy</p>
<p  class="p1" 
>- ant deploy-keystore</p>
<p  class="p1" 
>- ant web-configure</p>
<p  class="p2" 
></p>
<p  class="p1" 
>(there is also an ant deployear target that only deploys an updated ejbca.ear file, excellent for upgrading or changing configuration)</p>
<p  class="p2" 
></p>
<p  class="p1" 
>For more information about new deployment instructions and ant targets, please</p>
<p  class="p1" 
>refer to EJBCA installation guide.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>Backup your database first! If the upgrade fails, you can always go back to the earlier version.</p>
<p  class="p1" 
>If you are upgrading a cluster, update the software on all the nodes.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>1. Copy conf/*.properties from the earlier installation into the conf directory of the new release.</p>
<p  class="p1" 
>Or better yet, use the ejbca-custom feature for easier upgrades, see User Guide.</p>
<p  class="p1" 
>NOTE: if you are using the default Hypersonic database in JBoss 5, you now need to configure this in database.properties (default test database is now for JBoss 7/EAP6).</p>
<p  class="p1" 
>2. Copy the directory 'p12' from the earlier installation.</p>
<p  class="p1" 
>3. If using JBoss 5.1 or older, then shut down JBoss.</p>
<p  class="p1" 
>4. Run the 'ant deploy' target with new version.</p>
<p  class="p1" 
>5. Run the 'ant deploy-keystore' target with new version (not needed if deploying to same JBoss instance as the old version).</p>
<p  class="p1" 
>6. Run the 'ant web-configure' target with new version (not needed if deploying to same JBoss instance as the old version).</p>
<p  class="p1" 
>7. Clear the tmp and work directories in the servers, then restart JBoss.</p>
<p  class="p1" 
>8. If you are running in a cluster, you should now upgrade on all cluster nodes.</p>
<p  class="p1" 
>The newly deployed nodes should be running now.</p>
<p  class="p1" 
>9. Restart JBoss to flush all caches.</p>
<p  class="p1" 
>10. Go into the Admin GUI and verify your settings.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>If you get a &quot;java.lang.NoSuchMethodError&quot; in the admin GUI it is because JBoss 5 does not clean temporary files very well.</p>
<p  class="p1" 
>Delete the directories JBOSS_HOME/server/default/tmp and JBOSS_HOME/server/default/work and restart JBoss to get it working.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>If you are upgrading from EJBCA 4.x, you also need to run additional upgrade targets, see upgrade notes from EJBCA 4 to EJBCA 5.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>2. Basic Upgrade Procedure for Validation Authorities:</p>
<p  class="p1" 
>***********************************************************</p>
<p  class="p1" 
>2.a. Notable Changes:</p>
<p  class="p1" 
>*****************************</p>
<p  class="p1" 
>The external Validation Authority build has been removed and external VA deployments are now full EJBCA deployments.</p>
<p  class="p1" 
>- Database privileges on the VA host must be the same as used by the CA (all tables must exist).</p>
<p  class="p1" 
>- Key-stores, certificates and trust-stores (both soft and HSM based) will be automatically converted on first startup.</p>
<p  class="p1" 
>(or as soon as the password has been made available using clientToolBox if ocsp.activation.doNotStorePasswordsInMemory=true)</p>
<p  class="p1" 
>to CryptoTokens and OcspKeyBindings.</p>
<p  class="p1" 
>- Trusted certificates (ocsp.signtrustdir) must be imported in EJBCA as &quot;External CAs&quot;, for example using the &quot;bin/ejbca.sh ca importcacert&quot;</p>
<p  class="p1" 
>command.</p>
<p  class="p1" 
>- Health-check URL is now the same as for CA installations, and it will check the usability of ACTIVE OcspKeyBindings.</p>
<p  class="p1" 
>- OcspKeyBindings and CryptoTokens can still be managed without the AdminGUI using the EJB CLI (bin/ejbca.sh).</p>
<p  class="p1" 
>- OCSP signing or re-keying certificates no longer need to be present in the HSM slot (migrated to the CertificateData table).</p>
<p  class="p1" 
>- Using a manually activated CryptoToken replaces the use of ocsp.activation.doNotStorePasswordsInMemory.</p>
<p  class="p1" 
>- Behavior of OCSP responses (like untilNextUpdate etc) can now be configured per OcspKeyBinding.</p>
<p  class="p1" 
>(Certificate Profile or URL specific settings in ocsp.properties has highest priority, then the OcspKeyBinding properties</p>
<p  class="p1" 
>and finally the default configuration in ocsp.properties).</p>
<p  class="p1" 
>- The re-keying key-store will be migrated to an AuthenticationKeyBinding.</p>
<p  class="p1" 
>- Management of *KeyBindings and CryptoTokens will be audit logged. Configure it before the upgrade to have proper traceability</p>
<p  class="p1" 
>from this point on.</p>
<p  class="p1" 
>- The 'ejbca.productionmode' property should be set to 'true' or 'false'. 'va' or 'ocsp' options are no longer supported.</p>
<p  class="p1" 
>- Some configuration options in ocsp.properties have moved to (or been deprecated by) web.properties. You should migrate these configuration</p>
<p  class="p1" 
>changes. You will be warned during build if you are using these options and have not migrated them.</p>
<p  class="p1" 
>- Usage of Crypto Tokens, where you can configure multiple tokens to be used. The responder is not longer limited to one PKCS#11 configuration in</p>
<p  class="p1" 
>ocsp.properties.</p>
<p  class="p1" 
>- Usage of Internal Key Binding, where you can configure specific key pairs matching specific certificates in the database. This enables flexible</p>
<p  class="p1" 
>and simple configuration of OCSP responder keys and certificates. It is no longer necessary to import the OCSP signer certificate into a slot on</p>
<p  class="p1" 
>the HSM.</p>
<p  class="p1" 
>- Usage of the Admin GUI. You can now use the EJBCA Admin GUI to manage Crypto Tokens and Key Bindings, making configuration and administration of</p>
<p  class="p1" 
>the OCSP responder so much easier.</p>
<p  class="p1" 
>- The OCSP healthcheck has been integrated into the standard EJBCA healtcheck, so no separate call is required.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>All this means that the upgrade from an earlier version of EJBCA OCSP is a process. Naturally EJBCA 6 handles all the upgrade for you and will try to</p>
<p  class="p1" 
>automatically import your old configuration seamlessly. To benefit from all the new features you should read the VA Installation, OCSP Installation</p>
<p  class="p1" 
>and User Guide in the documentation.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>2.b. Upgrade Process:</p>
<p  class="p1" 
>*****************************</p>
<p  class="p1" 
>1. Copy configuration files, database.properties, ocsp.properties and web.properties from your old installation.</p>
<p  class="p1" 
>2. Note that there can be some deprecated properties (j2ee.web-noconfigure). You will be notified of this during build.</p>
<p  class="p1" 
>3. Configure logging in conf/cesecore.properties if you do not want to audit log security events in the database (see OCSP Installation).</p>
<p  class="p1" 
>4. Build and configure the EJBCA VA as described in &quot;Standalone VA Installation&quot;.</p>
<p  class="p1" 
>5. When JBoss is started the first time new database tables will be created. These are the same tables as exist in an EJBCA installation. If</p>
<p  class="p1" 
>your database user has restricted access, you can create the tables manually from the database scripts in doc/sql-scripts.</p>
<p  class="p1" 
>6. The next step involves creating OCSP Key Bindings, which are objects that represent an external OCSP responder.</p>
<p  class="p1" 
>a. If passwords are allowed to be store in memory (ocsp.activation.doNotStorePasswordsInMemory=true in ocsp.properties) then all key</p>
<p  class="p1" 
>bindings are created automatically. When JBoss is started the first time your ocsp.properties will be read and upgraded into crypto</p>
<p  class="p1" 
>tokens and ocsp key bindings. This will create objects in your database in the CryptoTokenData and InternalKeyBindingData. Also initial</p>
<p  class="p1" 
>access rules will be created, see &quot;OCSP Installation&quot; for more information about this.</p>
<p  class="p1" 
>b. If passwords are not stored in memory, the slot has to be opened up. To do this, make a call via the OCSPActivate command in</p>
<p  class="p1" 
>clientToolBox, and the internal key binding will be created automatically at the first call.</p>
<p  class="p1" 
>7. If you are requiring signed requests, verified by specific CAs, you need to import those CA certificates as &quot;External CAs&quot; in EJBCA, and</p>
<p  class="p1" 
>configure the trust anchors in the OCSP Key Binding (use bin/ejbca.sh ca importcacert or the Admin GUI).</p>
<p  class="p2" 
></p>
<p  class="p1" 
>2.c. Post Upgrade:</p>
<p  class="p1" 
>*****************************</p>
<p  class="p1" 
>Once all OCSP Responders have been recreated as OCSP Key Bindings and crypto tokens, the following properties can be removed from ocsp.properties</p>
<p  class="p1" 
>* ocsp.restrictsignatures</p>
<p  class="p1" 
>* ocsp.restrictsignaturesbymethod</p>
<p  class="p1" 
>* ocsp.signtrustdir</p>
<p  class="p1" 
>* ocsp.signtrustvalidtime</p>
<p  class="p1" 
>* ocsp.keys.dir</p>
<p  class="p1" 
>* ocsp.keys.storePassword</p>
<p  class="p1" 
>* ocsp.keys.keyPassword</p>
<p  class="p1" 
>* ocsp.activation.doNotStorePasswordsInMemory</p>
<p  class="p1" 
>* ocsp.p11.sharedLibrary</p>
<p  class="p1" 
>* ocsp.p11.sunConfigurationFile</p>
<p  class="p1" 
>* ocsp.p11.p11password</p>
<p  class="p1" 
>* ocsp.p11.slot</p>
<p  class="p2" 
></p>
<p  class="p1" 
>3. 100% Uptime Upgrade Notes:</p>
<p  class="p1" 
>***********************************************************</p>
<p  class="p2" 
></p>
<p  class="p1" 
>3.a. Upgrading CryotoTokens:</p>
<p  class="p1" 
>*****************************</p>
<p  class="p1" 
>The CryptoToken concept has extended the internal CA Token concept. CA's now reference a named set of keys in a CryptoToken and CA Service and</p>
<p  class="p1" 
>CryptoToken activation are clearly separated. Upgrades are made during first startup. Older EJBCA nodes will continue to function during a 100%</p>
<p  class="p1" 
>up-time upgrade, as long as newer instances has been deployed with &quot;db.keepinternalcakeystores&quot; set to true. For 100% up-time upgrade, or possibility</p>
<p  class="p1" 
>to back out of upgrade, set db.keepinternalcakeystores to true (default is false).</p>
<p  class="p1" 
>Settings relevant for 100% up-time upgrades are:</p>
<p  class="p1" 
>- db.keepinternalcakeystores (5.0-&gt;5.2)</p>
<p  class="p1" 
>- db.keepjbossserialization (4.0-&gt;5.0)</p>
<p  class="p1" 
>- app.version.effective (3.11-&gt;4.0)</p>
<p  class="p2" 
></p>
<p  class="p1" 
>3.b. Upgrading the OCSP CA Extended Service:</p>
<p  class="p1" 
>*****************************</p>
<p  class="p1" 
>The service for running OCSP services on internal CAs has now become an integral part of the OCSP responder. For this reason, the old</p>
<p  class="p1" 
>CA Extended Service will be removed at first upstart when a system has been upgraded from 5.0 to 6.0. The result of this is that for nodes sharing</p>
<p  class="p1" 
>a database, those nodes that haven't been upgraded to 6.0 will lose OCSP services until they've been upgraded as well. In order to keep internal</p>
<p  class="p1" 
>OCSP services running (external OCSP services are not affected) on the entire cluster during the whole upgrade process, set &quot;ca.keepocspextendedservice&quot;</p>
<p  class="p1" 
>to 'true' for all nodes except the last one, which then finally remove the service from the database.</p>
<p  class="p1" 
>- ca.keepocspextendedservice (5.0 -&gt; 6.0)</p>
<p  class="p2" 
></p>
<p  class="p1" 
>4. CMP Configuration Handling:</p>
<p  class="p1" 
>***********************************************************</p>
<p  class="p1" 
>In EJBCA 6.0.0, the CMP configuration handling has been rewritten. CMP configurations are no longer read from conf/cmp.properties file, instead, CMP</p>
<p  class="p1" 
>configurations can be set either in the admin GUI or in the command line (execute './bin/ejbca.sh config cmp' from EJBCA home directory for command</p>
<p  class="p1" 
>line documentation). If you do use CMP, you can upload your old cmp.properties file by executing the following command in EJBCA home directory:</p>
<p  class="p2" 
></p>
<p  class="p1" 
>$ ./bin/ejbca.sh config cmp uploadfile --file conf/cmp.properties --alias cmp</p>
<p  class="p2" 
></p>
<p  class="p1" 
>In the adminGUI -&gt; CMP Configuration, you will see the alias 'cmp' among the list of CMP alias. This alias will contain all your old CMP</p>
<p  class="p1" 
>configurations (except for one, see next note) and should be used to manage your CMP configurations in the future.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>For CMP users who use NestedMessageContent in RA mode and use EndEntityCertificate as an authentication module: if you now skip performing some</p>
<p  class="p1" 
>verifications on the certificate in extraCert field by setting the authentication parameter of EndEntityCertificate to '-', this will no longer be</p>
<p  class="p1" 
>possible in EJBCA 6.0.0. Instead, a new configuration variable should be set to reflect this option. After uploading the conf/cmp.properties file</p>
<p  class="p1" 
>according to the instructions above, go to the admin GUI -&gt; CMP Configurations; in the page for editing the CMP alias 'cmp', check the box that says</p>
<p  class="p1" 
>'Omit Verifications in EndEntityCertificate Authentication Module'</p>
<p  class="p2" 
></p>
<p  class="p1" 
>For CMP users who use KeyUpdateRequest in RA mode, in EJBCA 6.0.0, the authentication module EndEntityCertificate would have to be set among the</p>
<p  class="p1" 
>configured authentication modules, otherwise, the request will fail.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>In EJBCA 6.0.0, TCP configurations have been moved from conf/cmp.properties file (which has been removed) to conf/cmptcp.properties. So if you are</p>
<p  class="p1" 
>using TCP (a deprecated protocol in EJBCA and the RFC), you should set your TCP configuration values in the new file. You should also upload</p>
<p  class="p1" 
>conf/cmp.properties file according to the instructions above, and rename the alias 'cmp' to 'tcp'. See Admin Guide -&gt; CMP -&gt; 'CMP over TCP' and</p>
<p  class="p1" 
>execute './bin/ejbca.sh config cmp' for details.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>5. CLI Commands Renamed:</p>
<p  class="p1" 
>***********************************************************</p>
<p  class="p1" 
>CLI commands have been updated to reflect the new nomenclature introduced in EJBCA 5.0. This mainly involves the change of the command</p>
<p  class="p1" 
>'admins' -&gt; 'roles' (to reflect that Admin Groups have been renamed Roles) and to the subcommmands under 'ra' which have been renamed to reflect the</p>
<p  class="p1" 
>name change from 'User' to 'End Entity' (e.g. adduser -&gt; addendentity). The old commands have been deprecated but are still functional, and may be</p>
<p  class="p1" 
>removed entirely in a future version.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>6. Miscellaneous Issues:</p>
<p  class="p1" 
>***********************************************************</p>
<p  class="p1" 
>- batchtool.properties is no longer searched for in bin/ but in conf/ instead. Note that everything in this file is commented out by default, so</p>
<p  class="p1" 
>it can be removed if it hasn't been modified.</p>
<p  class="p1" 
>- In EJBCA 6.0.0 new versions of BouncyCastle jars are included. If you have been copying ejbca/lib/bc*.jar files to JBoss</p>
<p  class="p1" 
>(jboss/server/default/lib), you must remove the old jars from JBoss and copy new jars from EJBCA.</p>
<p  class="p1" 
>- In EJBCA 6.0.0 the API for custom certificate extensions was changed. If you have created your own custom certificate extension java classes,</p>
<p  class="p1" 
>you need to update the API with one new argument (can be null). There is no effect if you used standard custom extensions in the</p>
<p  class="p1" 
>certextensions.properties, only custom java classes.</p>
<p  class="p1" 
>- In EJBCA 6.0.5 the Public Web interface logo filename was changed. If you have customized your own logo, you need to rename the logo filename</p>
<p  class="p1" 
>from 'logotype.png' or 'ejbca_pki_by_primekey_logo.png' to 'banner_ejbca-public.png'.</p>
<p  class="p1" 
>- Starting with EJBCA 6.0.0 custom services and publishers are automatically detected using meta-data in the Jar files, and class names can no</p>
<p  class="p1" 
>longer be specified manually. If you need to use old custom classes from before 6.0 (i.e. not autodetected classes) you can enable manual entry</p>
<p  class="p1" 
>with the option web.manualclasspathsenabled=true in web.properties.</p>
<p  class="p1" 
>- The class CliAuthenticationToken and associated classes have been moved from the CLI module to reside next to the other</p>
<p  class="p1" 
>authentication classes under src. This means that approval requests using the CliAuthenticationToken created in 5.0.x will not</p>
<p  class="p1" 
>be forwards compatible.</p>
<p  class="p1" 
>- PKCS#11 libraries for presentation in the AdminGUI are autodetected. If you have a library that is not automatically detected by</p>
<p  class="p1" 
>EJBCA you can add it to the configuration. See web.properties.sample for PKCS#11 library auto-detection configuration.</p>
<p  class="p1" 
>- HSM configuration options have been updated to support different slot reference types (slot id, index or label).</p>
<p  class="p1" 
>See Admin Guide, databaseprotection.properties.sample, ocsp.properties.sample and catoken.properties.sample for information and examples how to</p>
<p  class="p1" 
>update you current PKCS#11 configuration in these files. Configuration in the Admin GUI should be automatically upgraded.</p>
<p  class="p1" 
>- If you are using the default Hypersonic database in JBoss 5 for testing, you now need to configure this in database.properties. The default test database</p>
<p  class="p1" 
>(when no database.properties is configured) is now H2 for JBoss 7/EAP6.</p>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA4.0.xtoEJBCA5.0.x">
        <h1 class="heading p2"><span>EJBCA 4.0.x to EJBCA 5.0.x</span></h1>
<hr>
<p  class="p1" 
>100% up-time upgrade notes:</p>
<p  class="p1" 
>For some serialized classes serialization is changed to a portable format. For 100% up-time upgrade, or possibility to back out of upgrade, set db.keepjbossserialization to true (default is false). After all nodes have been upgraded, db.keepjbossserialization can be set to false again.</p>
<p  class="p1" 
>Support for the old LogEntryData has been dropped in EJBCA 5.0 and is replaced by a new AuditRecordData. If you need to old audit records export the logs before upgrading. There is also a tool to export them after upgrade. The new audit log function have the capability for audit record protection, at the same time as being cluster friendly.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>EJBCA 5.0 introduces a new access control mechanism that can provide more functionality and more well defined operations. Some of the older access rules, such as the super administrator, has changed and needs to be modified in the post-upgrade step. It is recommended that you verify that your access roles and rules after an upgrade.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>Backup your database first! If the upgrade fails, you can always go back to the earlier version. If you are upgrading a cluster, update the software on all the nodes.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>1. Copy conf/*.properties from the earlier installation into the conf directory of the new release.</p>
<p  class="p1" 
>Or better yet, use the ejbca-custom feature for easier upgrades, see User Guide.</p>
<p  class="p1" 
>2. Copy the directory 'p12' from the earlier installation.</p>
<p  class="p1" 
>3. Shut down JBoss and do 'ant bootstrap' with the new version.</p>
<p  class="p1" 
>4. Start up JBoss.</p>
<p  class="p1" 
>5. Issue the command 'ant upgrade' from EJBCA_HOME.</p>
<p  class="p1" 
>This will upgrade access rules to rules that are compatible with the new access control system.</p>
<p  class="p1" 
>6. If you are running in a cluster, you should now upgrade (ant bootstrap) on all cluster nodes.</p>
<p  class="p1" 
>The newly deployed nodes should be running now.</p>
<p  class="p1" 
>7. Do 'ant post-upgrade' on one of the nodes.</p>
<p  class="p1" 
>This will make the necessary database updates.</p>
<p  class="p1" 
>Note: On some application server you may have to upgrade the database manually, see below.</p>
<p  class="p1" 
>This will also upgrade CertificateProfile objects and possible CA objects in the database.</p>
<p  class="p1" 
>After this upgrade, it may not be possible to downgrade to EJBCA 4.0.x again.</p>
<p  class="p1" 
>8. Stop JBoss, clear the tmp and work directories in the servers, then start JBoss again to flush all caches.</p>
<p  class="p1" 
>9. Go into the Admin GUI and verify you settings.</p>
<p  class="p2" 
>The database schema upgrade is normally done automatically for you when you run 'ant post-upgrade'.</p>
<p  class="p1" 
>Some application servers will not let you deploy unless the database is in sync though (or your database user may not have privileges for schema updates), so you may have to run the SQL commands manually.</p>
<p  class="p1" 
>Check src/upgrade/400_500 to find the correct sql files(s) for your database.</p>
<p  class="p1" 
>A practical note is that when upgrading from EJBCA 4.0 you can not use the CLI in EJBCA 5.0 before you have finished migrating all your 4.0 nodes and run post-upgrade.</p>
<p  class="p1" 
>NOTE:</p>
<p  class="p1" 
>If you need to downgrade EJBCA to 4.0.x again after a completed 'ant post-upgrade', you must add back the</p>
<p  class="p1" 
>dropped database column (caId in AdminEntityData, value 0 is fine) in the database.</p>
<p  class="p1" 
>If should be possible to downgrade to 4.0.4 again after an 'ant post-upgrade' in EJBCA 5.0.</p>
<p  class="p1" 
>You should be able to upgrade from EJBCA 3.11.x directly to 5.0.x, by following the same instructions as above (this upgrade is not thoroughly tested though).</p>
<p  class="p1" 
>NOTE: Some configuration options in ejbca.properties has moved to cesecore.properties. You should migrate these configuration changes.</p>
<p  class="p1" 
>You will be warned during build if you are using these options and have not migrated them.</p>
<p  class="p1" 
>If you get a &quot;java.lang.NoSuchMethodError&quot; in the admin GUI it is because JBoss does not clean temporary files very good.</p>
<p  class="p1" 
>Delete the directories JBOSS_HOME/server/default/tmp and JBOSS_HOME/server/default/work and restart JBoss to get it working.</p>
<p  class="p1" 
>NOTE: You may see 'new' administrator roles after upgrade.</p>
<p  class="p1" 
>* DEFAULT - This role can be safely deleted. It was used internally by EJBCA.</p>
<p  class="p1" 
>* Public Web Users - This role can be safely deleted. It was used internally by EJBCA.</p>
<p  class="p1" 
>* Super Administrator Role - This role contains the ejbca cli user. If you remove rights for the ejbca user you will not be able to use the CLI.</p>
<p  class="p1" 
>Note for upgrade to 5.0.6:</p>
<p  class="p1" 
>In EJBCA 5.0.6 new versions of BouncyCastle jars are included. If you have been copying ejbca/lib/bc*.jar files to JBoss (jboss/server/default/lib), you must remove the old jars from JBoss and copy new jars from EJBCA.</p>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.11.xtoEJBCA4.0.x">
        <h1 class="heading p1"><span>EJBCA 3.11.x to EJBCA 4.0.x</span></h1>
<hr>
<p  class="p1" 
>If you installed fresh on or upgraded to EJBCA 3.11.0 or EJBCA 3.11.1 on MySQL, start by reading the next section before continuing.</p>
<p  class="p1" 
>Support for ProtectedLog that was deprecated in EJBCA 3.10.0 has been dropped. If you use this feature, export the logs before upgrading. When the data from these tables are securely stored elsewhere or if you never used this feature, these tables and indexes can be dropped.</p>
<p  class="p1" 
>Support for table protection (configured in proptecion.properties) that was deprecated in EJBCA 3.11 has now been dropped. If you don't have any data in these tables, the indexes and tables can be dropped.</p>
<p  class="p1" 
>EJBCA 4.0 requires an application server supporting JEE5. For JBoss this means at least JBoss 5.1.x.</p>
<p  class="p1" 
>For details on how the application server should be configured, see the installation document.</p>
<p  class="p1" 
>*Notes for on-line upgrades*</p>
<p  class="p1" 
>1. If you were running an earlier version of EJBCA on an older JBoss (4.2.3 was recommended for EJBCA 3.x), *and* you need to do an on-line upgrade (upgrade one cluster node while another is running) you should first upgrade your cluster to run on JBoss 5.1.x before upgrading any of the cluster nodes to EJBCA 4.</p>
<p  class="p1" 
>2. Configure &quot;app.version.effective=3.11.x&quot; in conf/ejbca.properties for all but the last node that you deploy with EJBCA 4.0.x. Comment out the property and redeploy the other nodes again. This will ensure that the JBoss serialization still works for the deployed EJBCA 3.11.x nodes during the migration.</p>
<p  class="p1" 
>The values of &quot;customAvailableAccessRules&quot; and &quot;RNGAlgorithm&quot; (Random Number Generator) are now configurable from conf/ejbca.properties instead of being read through the ENC.</p>
<p  class="p1" 
>The '<a  class="external-link" href="http://database.name">database.name</a>' property in database.properties changed from mssql2000 to mssql for MS-SQL Server.</p>
<p  class="p1" 
>The 'database.url' property in database.properties no longer needs XML escaping for '&amp;'-characters.</p>
<p  class="p1" 
>The 'ocsp-database.url' property in ocsp.properties no longer needs XML escaping for '&amp;'-characters.</p>
<p  class="p1" 
>Backup your database first! If the upgrade fails, you can always go back to the earlier version.</p>
<p  class="p1" 
>If you are upgrading a cluster, update the software on all the nodes.</p>
<p  class="p1" 
>1. Copy conf/*.properties from the earlier installation into the conf directory of the new release.</p>
<p  class="p1" 
>Or better yet, use the ejbca-custom feature for easier upgrades, see User Guide.</p>
<p  class="p1" 
>2. Copy the directory 'p12' from the earlier installation.</p>
<p  class="p1" 
>3. Shut down JBoss and do 'ant bootstrap' with the new version.</p>
<p  class="p1" 
>4. Start up JBoss.</p>
<p  class="p1" 
>5. If you are upgrading on JBoss, do 'ant post-upgrade' on one of the nodes. This will convert all</p>
<p  class="p1" 
>JBoss serialized objects into regular Java serialized objects and allow you to switch</p>
<p  class="p1" 
>application server in the future.</p>
<p  class="p1" 
>6. Restart JBoss again to flush all caches.</p>
<p  class="p1" 
>7. Go into the Admin GUI and verify you settings.</p>
<p  class="p1" 
>New in EJBCA 4.0 is that we have a well defined database schema, that is functionally equal for all supported databases. You can verify that your database schema is correct by comparing it to the SQL table create script for your database ('doc/sql-scripts/create-tables-ejbca4-{database name}.sql').</p>
<p  class="p1" 
>Note: Some deprecated methods have been removed in 4.0. For example in the publisher API. If you used those methods to create custom publishers you need to update your code to match the new interfaces. To make it easy there is onlynew parameters that are not needed to use.</p>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.11.0or3.11.1toEJBCA3.11.x">
        <h2 class="heading p1"><span>EJBCA 3.11.0 or 3.11.1 to EJBCA 3.11.x</span></h2>
<hr>
<p  class="p1" 
>Read RELEASE_NOTES carefully in order to see if any particular changes might effect your upgrade.</p>
<p  class="p1" 
>Normally upgrades within a major release are plug-in upgrades.</p>
<p  class="p1" 
>Simply copy conf/*.properties from the earlier installation (if not using ejbca-custom).</p>
<p  class="p1" 
>Merge changes (if there are any) from *.properties.sample into your *.properties.</p>
<p  class="p1" 
>Copy the directory 'p12' from the earlier installation and do 'ant deploy' with the new version.</p>
<p  class="p1" 
>Note the possibility to use 'ejbca-custom' directory since EJBCA 3.5.x, this can simplify upgrades.</p>
<p  class="p1" 
>See Admin Guide</p>
<p  class="p1" 
>* There is one issue that only affects installations upgraded to or freshly installed on EJBCA 3.11.0.</p>
<p  class="p1" 
>The database mapping for KeyRecoveryData.certSN on _MySQL_ in 3.11.0 was wrong and can be corrected by running:</p>
<p  class="p1" 
>ALTER TABLE KeyRecoveryData MODIFY certSN varchar(80) binary NOT NULL DEFAULT '';</p>
<p  class="p1" 
>The database mapping for UserData.cardNumber in the table create script on _MySQL_ in 3.11.0 and</p>
<p  class="p1" 
>UPGRADE notes in 3.11.1 was wrong and can be corrected by running:</p>
<p  class="p1" 
>ALTER TABLE UserData MODIFY cardNumber varchar(250) binary NULL DEFAULT NULL;</p>
<p  class="p1" 
>The database mapping for ServiceData.nextRunTimeStamp and runTimeStamp was inconsistent on _Sybase_ in 3.11.0 and can be corrected by running:</p>
<p  class="p1" 
>ALTER TABLE ServiceData MODIFY nextRunTimeStamp DECIMAL(20,0) DEFAULT 0 NOT NULL;</p>
<p  class="p1" 
>ALTER TABLE ServiceData MODIFY runTimeStamp DECIMAL(20,0) DEFAULT 0 NOT NULL;</p>
    </div>
    <div class="section section-2" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.10.xtoEJBCA3.11.x">
        <h2 class="heading p1"><span>EJBCA 3.10.x to EJBCA 3.11.x</span></h2>
<hr>
<p  class="p1" 
>Backup your database first! If the upgrade fails, you can always go back to the earlier version.</p>
<p  class="p1" 
>If you are upgrading a cluster, you should run the upgrade process with only one node running, and then simply update the software on the other nodes.</p>
<p  class="p1" 
>1. Copy conf/*.properties from the earlier installation into the conf directory of the new release.</p>
<p  class="p1" 
>Or better yet, use the ejbca-custom feature for easier upgrades, see User Guide.</p>
<p  class="p1" 
>2. Copy the directory 'p12' from the earlier installation.</p>
<p  class="p1" 
>3. Shut down JBoss and do 'ant bootstrap' with the new version.</p>
<p  class="p1" 
>4. Start up JBoss. You might see some errors during startup due to that the database is not upgraded yet.</p>
<p  class="p1" 
>5. Issue the command 'ant upgrade' from EJBCA_HOME. This will make the necessary database updates.</p>
<p  class="p1" 
>Note: On some application server you may have to upgrade the database manually, see below.</p>
<p  class="p1" 
>6. Do 'ant post-upgrade' to make sure the new database columns in table ServiceData are populated,</p>
<p  class="p1" 
>and add new database column to PublisherQueueData.</p>
<p  class="p1" 
>7. Restart JBoss again to flush all caches.</p>
<p  class="p1" 
>8. Go into the Admin GUI and verify you settings.</p>
<p  class="p1" 
>The database upgrade is normally done automatically for you when you run 'ant upgrade' and 'ant post-upgrade'. Some application servers will not let you deploy unless the database is in sync though, so you may have to run the SQL commands manually. Check src/upgrade/310_311 to find the correct sql files for your database.</p>
<p  class="p1" 
>You should be able to upgrade from EJBCA 3.2.x directly to 3.11.x, by following the same instructions as above (this upgrade is not thoroughly tested though). Also see instructions below for additional issues when upgrading all the way from a much older version.</p>
<p  class="p1" 
>*This is very important, depending on your database version you may have to do some additional steps for some of the upgrades.*</p>
    </div>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.9.xtoEJBCA3.10.x">
        <h1 class="heading p1"><span>EJBCA 3.9.x to EJBCA 3.10.x</span></h1>
<hr>
<p  class="p1" 
>Backup your database first! If the upgrade fails, you can always go back to the earlier version.</p>
<p  class="p1" 
>If you are upgrading a cluster, you should run the upgrade process with only one node running,</p>
<p  class="p1" 
>and then simply update the software on the other nodes.</p>
<p  class="p1" 
>1. Copy conf/*.properties from the earlier installation into the conf directory of the new release.</p>
<p  class="p1" 
>Or better yet, use the ejbca-custom feature for easier upgrades, see User Guide.</p>
<p  class="p1" 
>2. Copy the directory 'p12' from the earlier installation.</p>
<p  class="p1" 
>3. Shut down JBoss and do 'ant bootstrap' with the new version.</p>
<p  class="p1" 
>4. Start up JBoss. You might see some errors during startup due to that the database is not upgraded yet.</p>
<p  class="p1" 
>5. Issue the command 'ant upgrade' from EJBCA_HOME. This will make the necessary database updates.</p>
<p  class="p1" 
>Note: On some application server you may have to upgrade the database manually, see below.</p>
<p  class="p1" 
>6. Restart JBoss again to flush all caches.</p>
<p  class="p1" 
>7. Go into the Admin GUI and verify you settings.</p>
<p  class="p1" 
>8. Do 'ant post-upgrade' if you want &quot;Enforce unique public keys&quot; to check against old certificate (see below).</p>
<p  class="p1" 
>In EJBCA 3.10 some unused code related to the &quot;protection.keyref&quot; property in conf/protection.properties has been dropped. This also means a small database change where the unused column TableProtectData.keyRef is dropped. To see which database structural changes are made you can find the SQL commands for your database in src/upgrade/39_310/39_310-upgrade-&lt;&lt;database name&gt;&gt;.sql.</p>
<p  class="p1" 
>Approvals that are pending during the upgrade process will be upgraded automatically. These are Java Objects and cannot be upgraded manually using custom SQL. If you need to perform a manual SQL update all pending approvals should be taken care of before the upgrade.</p>
<p  class="p1" 
>A quick fix for the LogEntryData table that was spread in the wild in 2005 will also be corrected in this release. The column &quot;comment&quot; (or &quot;comment_&quot; on Oracle) will change name to &quot;logComment&quot; for all databases. Since older versions of DB2 than 9.7 cannot rename columns, it requires a massive UPDATE operation on this database. DB2 9.7+ users can alter src/upgrade/39_310/39_310-upgrade-db2.sql to use &quot;ALTER TABLE LogEntryData RENAME COLUMN comment TO logComment;&quot; instead. For all other databases thisrenaming will be handled automatically by &quot;ant upgrade&quot;. Please note that logging to the OldLogDevice will not work during this upgrade.</p>
<p  class="p1" 
>The database upgrade is normally done automatically for you when you run 'ant upgrade'.</p>
<p  class="p1" 
>Some application servers will not let you deploy unless the database is in sync though, so you may have to run the SQL commands manually.</p>
<p  class="p1" 
>The ProtectedLogDevice has been deprecated, since it's hard to configure right and extremely inefficient. There are currently plans to create a LogDevice aiming at non-repudiation rather than detection of missing log-entries.</p>
<p  class="p1" 
>The option to use a separate soft keystore for the internal OCSP responder is no longer available. The upgrade will remove the soft keystore and OCSP requests will be signed directly by the CA signing certificate (currently the default behavior). External OCSP installations are not affected.</p>
<p  class="p1" 
>To improve testing there is a new configuration option to allow changing used properties through Remote EJB access using conf/ejbca.properties#ejbca.productionmode. Default is to not allow configuration changes, but some of the development system tests will fail until this is allowed.</p>
<p  class="p1" 
>The External RA module is now a part of the main EJBCA bundle and uses JPA for persistence. DataSources used by the workers are configured in conf/externalra.properties. Properties for each worker are configured under Services in the Admin GUI. Also the external SCEP RA application is now built from the main bundle and is configured in conf/scep.properties. The documentation is available as a part of the generated doc. The API as such has not changed and old client should still work, but External RA workers in EJBCA have to be reconfigured.</p>
<p  class="p1" 
>Note that this version contains an inevitable API change for custom extensions because the CA key used to sign certificates does not have to be the same as the currently active CA key.If you have created any custom extensions Java classes, you must add:</p>
<p  class="p1" 
>&quot;PublicKey caPublicKey&quot;</p>
<p  class="p1" 
>to the parameter list in the getValue method. The value does not have to be handled.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>Two more checks are now done before adding a certificate. See</p>
<p  class="p1" 
><a  class="external-link" href="https://ejbca.org/docs/userguide.html#Enforce%20unique%20public%20keys">https://ejbca.org/docs/userguide.html#Enforce%20unique%20public%20keys</a> and</p>
<p  class="p1" 
><a  class="external-link" href="https://ejbca.org/docs/userguide.html#Enforce%20unique%20DN">https://ejbca.org/docs/userguide.html#Enforce%20unique%20DN</a></p>
<p  class="p1" 
>These checks are enabled on all CA:s that existed before the upgrading. It should not be any problem to have them enabled (different users do not normally share same keys or subject DN) in most installations. But if you know that your users shares subject DNs or keys with each other they could be disabled.</p>
<p  class="p2" 
>A new column in the database (subjectKeyId) for &quot;Enforce unique public keys&quot; is added when 'ant upgrade' is executed. To check the public key in new certificates against certificates issued before the upgrade this column has to be set (after upgrade all rows of the column is null). The columns is set by 'ant post-upgrade' (see step 8 above). Please note that 'post-upgrade' might take some minutes if there are many certificates in the database. After the upgrade, two new indexes for the enforcing uniqueness should be applied:</p>
<p  class="p1" 
>create index certificatedata_idx9 on CertificateData(subjectKeyId,issuerDN);</p>
<p  class="p1" 
>create index certificatedata_idx10 on CertificateData(subjectDN,issuerDN);</p>
<p  class="p1" 
>To be able to use the OCSP monitoring tool the 'subjectKeyId' column should be added to the External OCSP responders, but it does not have to be populated. See src/upgrade/39_310/39_310-upgrade-&lt;&lt;database name&gt;&gt;.sql for the exact syntax to use for your OCSP database.</p>
<p  class="p1" 
>You should be able to upgrade from EJBCA 3.2.x directly to 3.10.x, by following the same instructions as above (this upgrade is not thoroughly tested though). Also see instructions below for additionalissues when upgrading all the way from a much older version.</p>
<p  class="p1" 
>If you are using some databases, specifically an older version of Derby, you may have to manually upgrade your database. See src/upgrade/39_310/39_310-upgrade-derby.sql.</p>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.8.xtoEJBCA3.9.x">
        <h1 class="heading p1"><span>EJBCA 3.8.x to EJBCA 3.9.x</span></h1>
<hr>
<p  class="p1" 
>Backup your database first! If the upgrade fails, you can always go back to the earlier version.</p>
<p  class="p1" 
>If you are upgrading a cluster, you should run the upgrade process with only one node running, and then simply update the software on the other nodes.</p>
<p  class="p1" 
>1. Copy conf/*.properties from the earlier installation into the conf directory of the new release.</p>
<p  class="p1" 
>Or better yet, use the ejbca-custom feature for easier upgrades, see User Guide.</p>
<p  class="p1" 
>2. Copy the directory 'p12' from the earlier installation.</p>
<p  class="p1" 
>3. Shut down JBoss and do 'ant bootstrap' with the new version.</p>
<p  class="p1" 
>4. Start up JBoss. You will see some errors during startup due to that the database is not upgraded yet.</p>
<p  class="p1" 
>5. Issue the command 'ant upgrade' from EJBCA_HOME. This will make the necessary database updates.</p>
<p  class="p1" 
>Note: On some application server you may have to upgrade the database manually, see below.</p>
<p  class="p1" 
>6. Restart JBoss again to flush all caches.</p>
<p  class="p1" 
>7. Go into the admin-GUI and verify the settings.</p>
<p  class="p1" 
>In EJBCA 3.9 there are new possibilities for filtering certificates on certificateProfileId and tags.</p>
<p  class="p1" 
>This requires a small database change. To see which database structural changes are made you can find</p>
<p  class="p1" 
>the SQL commands for your database in src/upgrade/38_39/38_39-upgrade-&lt;&lt;database name&gt;&gt;.sql.</p>
<p  class="p1" 
>The database upgrade is normally done automatically for you when you run 'ant upgrade'.</p>
<p  class="p1" 
>Some application servers will not let you deploy unless the database is in sync though, so you may have to run</p>
<p  class="p1" 
>the SQL commands manually. The assigned certificateProfileId for each new CertificateData is default 0.</p>
<p  class="p1" 
>If you want to assign the last used certificateProfileId used for the same user you can manually execute</p>
<p  class="p1" 
>UPDATE CertificateData SET certificateProfileId=(SELECT certificateProfileId FROM UserData</p>
<p  class="p1" 
>WHERE CertificateData.username=UserData.username);</p>
<p  class="p1" 
>UPDATE CertificateData SET certificateProfileId=0 where certificateProfileId is null;</p>
<p  class="p1" 
>but this will take a *very* long time for a large population.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>EJBCA 3.9 also has a new table in the database. If you are using JBoss this is created automatically for you. If you are using another application server, created the table in your database using the create statement for the table PublisherQueueData from one of the create-tables scripts in doc/howto.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>You should be able to upgrade from EJBCA 3.2.x directly to 3.9.x, by following the same instructions as above (this upgrade is not thoroughly tested though). Also see instructions below for additional issues when upgrading all the way from a much older version.</p>
<p  class="p1" 
>Note! If you are using the external RA you need to upgrade to ExtRA 3.9 and follow upgrade instructions in the ExtRA package.</p>
<p  class="p1" 
>Note! If you have changed the 'tomcat' username for the JBoss SSL server certificate you should check the certificate profile used.</p>
<p  class="p1" 
>This is because the old ENDUSER certificate profile can no longer be used for SSL server certificates.</p>
<p  class="p1" 
>The corresponding upgrade sql in the normal upgrade script is:</p>
<p  class="p1" 
>update UserData set certificateProfileId=9 where username='tomcat' and certificateProfileId=1;</p>
<p  class="p1" 
>Note! If you are using an external OCSP responder using EJBCA's publishing from EJBCA to the responder, you need to update the responders database table CertificateData using the SQL commands above.</p>
<p  class="p1" 
>Note! If you are using JBoss 5.x. Don't forget to copy new BC jars from EJBCA_HOME/lib/bc*.jar to JBOSS_HOME/server/default/lib, replacing to old ones that you copied there from the old version of EJBCA.</p>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.7.xtoEJBCA3.8.x">
        <h1 class="heading p1"><span>EJBCA 3.7.x to EJBCA 3.8.x</span></h1>
<hr>
<p  class="p1" 
>Note that if using JBoss, you need JBoss 4.2.x or later to run EJBCA 3.8.x.</p>
<p  class="p1" 
>From EJBCA 3.8.0 you are able to mix administrators from different CAs in the same Administrator Group. This improvement requires a small database change.</p>
<p  class="p1" 
>The &quot;Administrator&quot; flag on end entities has been dropped, so if you match administrators on CN and uses this to distinguish between admins and nonadmins, you should switch to using certificate serial number or another unique identifier instead.</p>
<p  class="p1" 
>Backup your database first! If the upgrade fails, you can always go back to the earlier version.</p>
<p  class="p1" 
>If you are upgrading a cluster, you should run the upgrade process with only one node running, and then simply update the software on the other nodes.</p>
<p  class="p1" 
>1. Copy conf/*.properties from the earlier installation into the conf directory of the new release.</p>
<p  class="p1" 
>Or better yet, use the ejbca-custom feature for easier upgrades, see User Guide.</p>
<p  class="p1" 
>2. Merge changes from *.properties.sample into your *.properties files.</p>
<p  class="p1" 
>3. Copy the directory 'p12' from the earlier installation.</p>
<p  class="p1" 
>4. Shut down JBoss and do 'ant deploy' with the new version.</p>
<p  class="p1" 
>5. Start up JBoss. You could see some errors during startup due to that the database is not upgraded yet.</p>
<p  class="p1" 
>6. Issue the command 'ant upgrade' from EJBCA_HOME. This will make the necessary database updates.</p>
<p  class="p1" 
>Note: On some application server you may have to upgrade the database manually, see below.</p>
<p  class="p1" 
>7. Go into the admin-GUI and verify you settings.</p>
<p  class="p1" 
>8. Restart JBoss again to flush all caches.</p>
<p  class="p1" 
>Ant upgrade is needed to make the database changes in the authorization module.To see which database structural changes are made you can find the SQL commands for your database in src/upgrade/37_38/37_38-upgrade-&lt;&lt;database name&gt;&gt;.sql. Note that ant upgrade does more than these sql lines.</p>
<p  class="p1" 
>You should be able to upgrade from EJBCA 3.1.x directly to 3.8.x, by following the same instructions as above (this upgrade is not thoroughly tested though). Also see instructions below for additional issues when upgrading all the way from a much older version.</p>
<p  class="p1" 
>If an upgrade option for your database is not included, take a look in src/upgrade/37_38 where upgrade sql scripts are located. We will happily include upgrade scripts for other databases as well.</p>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.6.xtoEJBCA3.7.x">
        <h1 class="heading p1"><span>EJBCA 3.6.x to EJBCA 3.7.x</span></h1>
<hr>
<p  class="p1" 
>Upgrade from EJBCA 3.6.x to 3.7.x is a plug-in upgrade.</p>
<p  class="p1" 
>If you are upgrading a cluster, you should run the upgrade process with only one node running, and then simply update the software on the other nodes.</p>
<p  class="p1" 
>1. Copy conf/*.properties from the earlier installation into the conf directory of the new release.</p>
<p  class="p1" 
>Or better yet, use the ejbca-custom feature for easier upgrades, see User Guide.</p>
<p  class="p1" 
>2. Copy the directory 'p12' from the earlier installation.</p>
<p  class="p1" 
>3. Shut down JBoss and do 'ant bootstrap' with the new version.</p>
<p  class="p1" 
>4. Start up JBoss.</p>
<p  class="p1" 
>5. Go into the admin-GUI and verify you settings.</p>
<p  class="p1" 
>You should be able to upgrade from EJBCA 3.1.x directly to 3.7.x, by following the same instructions as above, but answering yes to the second question (this upgrade is not thoroughly tested though).</p>
<p  class="p1" 
>Also see instructions below for additional issues when upgrading all the way from a much older version.</p>
<p  class="p1" 
>If you are using PrimeCardHSM you need to upgrade to a new version, matching EJBCA 3.7.</p>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.5.xtoEJBCA3.6.x">
        <h1 class="heading p1"><span>EJBCA 3.5.x to EJBCA 3.6.x</span></h1>
<hr>
<p  class="p1" 
>Backup your database first! If the upgrade fails, you can always go back to the earlier version.</p>
<p  class="p1" 
>Upgrade from EJBCA 3.5.x to EJBCA 3.6.x requires one small database change.</p>
<p  class="p1" 
>If you are upgrading a cluster, you should run the upgrade process with only one node running, and then simply update the software on the other nodes.</p>
<p  class="p1" 
>1. Copy conf/*.properties from the earlier installation into the conf directory of the new release.</p>
<p  class="p1" 
>Or better yet, use the ejbca-custom feature for easier upgrades, see User Guide.</p>
<p  class="p1" 
>2. Merge changes from *.properties.sample into your *.properties files.</p>
<p  class="p1" 
>3. Copy the directory 'p12' from the earlier installation.</p>
<p  class="p1" 
>4. Shut down JBoss and do 'ant bootstrap' with the new version.</p>
<p  class="p1" 
>5. Start up JBoss. You could see some errors during startup due to that the database is not upgraded yet.</p>
<p  class="p1" 
>6. Issue the command 'ant upgrade' from EJBCA_HOME. This will make the necessary database updates.</p>
<p  class="p1" 
>If you are upgrading from EJBCA 3.4 or 3.5, answer 'no' to the second and third question.</p>
<p  class="p1" 
>Note: On some application server you may have to upgrade the database manually, see below.</p>
<p  class="p1" 
>7. Go into the admin-GUI and verify you settings.</p>
<p  class="p1" 
>8. Restart JBoss again to flush all caches.</p>
<p  class="p1" 
>If you don't want to do step 6 above (doing step 6 is the recommended way though) and instead want to do the upgrade</p>
<p  class="p1" 
>of the database manually, you can simply issue the following sql command:</p>
<p  class="p1" 
>MySQL:</p>
<p  class="p1" 
>alter table CRLData add deltaCRLIndicator int(11) NOT NULL DEFAULT -1;</p>
<p  class="p1" 
>PostgreSQL:</p>
<p  class="p1" 
>alter table CRLData add deltaCRLIndicator INT;</p>
<p  class="p1" 
>update CRLData set deltaCRLIndicator = -1;</p>
<p  class="p1" 
>alter table CRLData alter column deltaCRLIndicator set not null;</p>
<p  class="p1" 
>alter table CRLData alter column deltaCRLIndicator set default -1;</p>
<p  class="p1" 
>Oracle:</p>
<p  class="p1" 
>alter table CRLData add deltaCRLIndicator NUMBER(10) default -1;</p>
<p  class="p1" 
>If you are using another application server than JBoss, you need to create new tables in the database manually. Create the new tables ProtectedLogData, ProtectedLogExportData and ProtectedLogTokenData fromone of the database scripts in doc/howto/create-tables-xxx.sql.</p>
<p  class="p1" 
>You should be able to upgrade from EJBCA 3.1.x directly to 3.6.x, by following the same instructions as above, but answering yes to the second question (this upgrade is not thoroughly tested though).</p>
<p  class="p1" 
>Also see instructions below for additional issues when upgrading all the way from a much older version.</p>
<p  class="p1" 
>If an upgrade option for your database is not included, take a look in src/upgrade/35_36 where upgrade sql scripts are located. We will happily include upgrade scripts for other databases as well.</p>
<p  class="p1" 
>The JBoss Mbean create CRL service has been removed in EJBCA 3.6. It has been replaced with the much easier, more portable etc CRL Update Service configured in the Admin-GUI. See the User Guide about CRL creation for details.</p>
<p  class="p1" 
>If you are using PrimeCardHSM you need to upgrade to a new version, matching EJBCA 3.6.</p>
<p  class="p1" 
>Note. In EJBCA 3.6 we changed the case of some database column to get full Sybase compatibility. This will not affect other database (in that case you would have had problems already), but it can be good to know.</p>
<p  class="p1" 
>Column cases changed for most columns in ApprovalData, for cAId in LogEntryData, and for cAId in ProtectedLogData.</p>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.4.xtoEJBCA3.5.x">
        <h1 class="heading p1"><span>EJBCA 3.4.x to EJBCA 3.5.x</span></h1>
<hr>
<p  class="p1" 
>See release notes for details between certain versions.</p>
<p  class="p2" 
>EJBCA 3.5 is a plug-in upgrade from EJBCA 3.4.x. A few steps are still needed for upgrade though.</p>
<p  class="p1" 
>Simply copy conf/*.properties from the earlier installation.</p>
<p  class="p1" 
>Merge changes (if there are any) from *.properties.sample into your *.properties.</p>
<p  class="p1" 
>Copy the directory 'p12' from the earlier installation and do 'ant deploy' with the new version.</p>
<p  class="p1" 
>The new root-less install on linux systems makes it much easier to have control of you Java truststore (which CAs that are allowed for administrator certificates) both on linux and windows.</p>
<p  class="p1" 
>You must make these steps during upgrade on both linux and windows:</p>
<p  class="p1" 
>- copy $JAVA_HOME/jre/lib/security/cacerts $EJBCA_HOME/p12/truststore.jks</p>
<p  class="p1" 
>- ant clean; ant deploy</p>
<p  class="p2" 
></p>
<p  class="p1" 
>In EJBCA 3.5 when you run the command 'ant javatruststore' or 'ant -<a  class="external-link" href="http://Dca.name">Dca.name</a>=MyCAName javatruststore' it is now the file $EJBCA_HOME/p12/truststore.jks that will be updated and copied to $JBOSS_HOME/server/default/conf/keystore.</p>
<p  class="p1" 
>You should also read about the new external merge directory 'ejbca-custom', where you can collect all your own files. See 'Handling changes in a separate tree' in the User's guide.</p>
<p  class="p1" 
>There are some parameter name changes in ejbca.properties and web.properties. These parameters are only used when freshly installing EJBCA though. If you plan to do this using old configuration files, you should merge changes from ejbca.properties.sample and web.properties.sample.No worry if you forget though, since you will be prompted for the values instead.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>You should be able to upgrade from EJBCA 3.1.x directly to 3.5.x, by following the same instructions for database upgrade as for EJBCA 3.4.</p>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.3.xtoEJBCA3.4.x">
        <h1 class="heading p1"><span>EJBCA 3.3.x to EJBCA 3.4.x</span></h1>
<hr>
<p  class="p1" 
>Backup your database first! If the upgrade fails, you can always go back to the earlier version.</p>
<p  class="p1" 
>Upgrade from EJBCA 3.3.x to EJBCA 3.4.x requires one small database change.</p>
<p  class="p1" 
>If you are upgrading a cluster, you should run the upgrade process with only one node running, and then simply update the software on the other nodes.</p>
<p  class="p1" 
>1. Copy ejbca.properties from the earlier installation into the conf directory of the new release.</p>
<p  class="p1" 
>Or better yet, split up your ejbca.properties file to match the new improved conf structure.</p>
<p  class="p1" 
>2. Merge changes from *.properties.sample into your *.properties files.</p>
<p  class="p1" 
>3. Copy the directory 'p12' from the earlier installation.</p>
<p  class="p1" 
>4. Shut down JBoss and do 'ant deploy' with the new version.</p>
<p  class="p1" 
>5. Start up JBoss. You will see some errors during startup due to that the database is not upgraded yet.</p>
<p  class="p1" 
>6. Issue the command 'ant upgrade' from EJBCA_HOME. This will make the necessary database updates.</p>
<p  class="p1" 
>If you are upgrading from EJBCA 3.2 or 3.3, answer 'no' to the second question.</p>
<p  class="p1" 
>Note: On weblogic you have to upgrade the database manually, see below.</p>
<p  class="p1" 
>7. Go into the admin-GUI and verify you settings, specially verify the DN encoding in 'Edit Certificate Authorities'</p>
<p  class="p1" 
>as noted below.</p>
<p  class="p1" 
>8. Restart JBoss again to flush all caches.</p>
<p  class="p2" 
></p>
<p  class="p1" 
>If you don't want to do step 6 above (doing step 6 is the recommended way though) and instead want to do the upgrade of the database manually, you can simply issue the following sql command:</p>
<p  class="p1" 
>MySQL:</p>
<p  class="p1" 
>alter table CAData add updateTime bigint NOT NULL DEFAULT 0;</p>
<p  class="p1" 
>PostgreSQL:</p>
<p  class="p1" 
>alter table CAData add updateTime INT8;</p>
<p  class="p1" 
>update cadata set updateTime = 0;</p>
<p  class="p1" 
>alter table cadata alter column updateTime set not null;</p>
<p  class="p1" 
>alter table cadata alter column updateTime set default 0;</p>
<p  class="p1" 
>Oracle:</p>
<p  class="p1" 
>alter table CAData add updateTime NUMBER(19) default 0;</p>
<p  class="p2" 
></p>
<p  class="p1" 
>Note: Since the default DN encoding changed to UTF8, there is an option in the CA configuration (Edit Certificate authorities) called 'Use PrintableString encoding in DN'. Checking this checkbox causes the old behaviour to be used, using PrintableString as the default encoding. The upgrade process tries to guess how this value should be set (upgrading an old CA we usually want to keep the old behaviour).After the upgrade process, check your CA configuration to verify that the option is set to your liking.</p>
<p  class="p1" 
>Note: If you intend to use the XKMS service or the CMS service (log signing), then you should go into the Admin-GUI after upgrading and press the button &quot;Republish CA Certificates&quot; for all CAs. Otherwise you will not be able to revoke the certificates issued to these services, or view the certificates in the GUI.</p>
<p  class="p2" 
>You should be able to upgrade from EJBCA 3.1.x directly to 3.4.x, by following the same instructions as above, but answering yes to the second question (this upgrade is not thoroughly tested though).</p>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.2.xtoEJBCA3.3.x">
        <h1 class="heading p1"><span>EJBCA 3.2.x to EJBCA 3.3.x</span></h1>
<hr>
<p  class="p1" 
>Upgrade from EJBCA 3.2.x to EJBCA 3.3.x is a plug-in upgrade, because there are no database changes, or the database changes are only new tables and not changed ones.</p>
<p  class="p1" 
>You should still follow this advice:</p>
<p  class="p1" 
>Backup your database first! If the upgrade fails, you can always go back to the earlier version.</p>
<p  class="p1" 
>Simply keep/copy ejbca.properties from the earlier installation.</p>
<p  class="p1" 
>Merge changes from ejbca.properties.sample into your ejbca.properties.</p>
<p  class="p1" 
>Copy the directory 'p12' from the earlier installation and 'ant deploy' (or deploywithjbossservice) this new one.</p>
<p  class="p1" 
>You should be able to upgrade from EJBCA 3.1.x directly to 3.3.x, by following the same instructions as when upgrading from 3.1.x to 3.2.x (untested though).</p>
<p  class="p1" 
>If you are using Eracom HSM, please notice that property names have changed for determining which key is used.</p>
<p  class="p1" 
>After upgrading EJBCA, you must go into CA configuration and update your HSM properties.</p>
<p  class="p1" 
>The property names are now the same for all different HSMs.</p>
    </div>
    <div class="section section-1" id="src-85926584_id-.EJBCAUpgradeNotesSummaryv6.15.2.6-EJBCA3.1.xtoEJBCA3.2">
        <h1 class="heading p1"><span>EJBCA 3.1.x to EJBCA 3.2</span></h1>
<hr>
<p  class="p1" 
>Support for this upgrade is no longer available from EJBCA 3.9.x. Please use the latest EJBCA release from the 3.8-branch as a first step if you need to upgrade from all the way from here.</p>
<p   
></p>
<hr>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="EJBCA_6.0_Upgrade_Notes.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>EJBCA 6.0 Upgrade Notes</span>
        </a>
        </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

</body>
</html>
