<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>OCSP Management - EJBCA - Documentation Space</title>

    
            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="85921598">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_6.15.2.6_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=23859469"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_6.15.2.6_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Documentation.html">EJBCA Documentation</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Operations.html">EJBCA Operations</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_User_Guide.html">EJBCA User Guide</a></li>
                                                                                     <li><a href="CA_Operations_Guide.html">CA Operations Guide</a></li>
                                                            </ul>
</div>            <h1 id="src-23859469"> <span>OCSP Management</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>For an in depth description of how EJBCA handles OCSP, see the <a   href="OCSP.html">OCSP Overview</a>.</p>
        </div>
    </div>
<p   
></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-23859469_id-.OCSPManagementv6.15.0-BuildingandConfiguringtheOCSPResponderBuildingandConfiguringtheOCSPResponder">Building and Configuring the OCSP Responder</a></p>
</li><li class=" "><p   
><a   href="#src-23859469_id-.OCSPManagementv6.15.0-PopulatingtheOCSPDatabaseonaRemoteVA">Populating the OCSP Database on a Remote VA</a></p>
</li><li class=" "><p   
><a   href="#src-23859469_id-.OCSPManagementv6.15.0-SettingtheDefaultResponderDefault_Responder">Setting the Default Responder</a></p>
</li><li class=" "><p   
><a   href="#src-23859469_id-.OCSPManagementv6.15.0-SettingResponderIDTypeforCAsResponder_ID_Type_for_CAs">Setting Responder ID Type for CAs</a></p>
</li><li class=" "><p   
><a   href="#src-23859469_id-.OCSPManagementv6.15.0-CheckingtheStatusoftheOCSPResponderusingtheEJBCAClientToolbox">Checking the Status of the OCSP Responder using the EJBCA Client Toolbox</a></p>
</li><li class=" "><p   
><a   href="#src-23859469_id-.OCSPManagementv6.15.0-ConfiguringOCSPExtensionsOCSP_Extension">Configuring OCSP Extensions</a></p>
</li><li class=" "><p   
><a   href="#src-23859469_id-.OCSPManagementv6.15.0-UsingHTTPGETandRFC5019">Using HTTP GET and RFC5019</a></p>
</li><li class=" "><p   
><a   href="#src-23859469_id-.OCSPManagementv6.15.0-OCSPStressTesting">OCSP Stress Testing</a></p>
</li><li class=" "><p   
><a   href="#src-23859469_id-.OCSPManagementv6.15.0-MonitoringOCSPDatabases">Monitoring OCSP Databases</a></p>
</li><li class=" "><p   
><a   href="#src-23859469_safe-id-aWQtLk9DU1BNYW5hZ2VtZW50djYuMTUuMC1TaWduYXR1cmVUb2tlbkFjdGl2YXRpb24oVXBncmFkZXNvbmx5KQ">Signature Token Activation (Upgrades only)</a></p>
</li></ul><p   
>Examples:</p>
<ul class="childpages-macro "><li class=" "><p   
><a   href="Setting_up_a_Responder_Using_the_CLI.html">Setting up a Responder Using the CLI</a></p>
</li></ul><p   
>This page covers all aspects of managing an OCSP Responder, whether situated locally on the same machine as the CA or remotely on a VA.</p>
    <div class="section section-1" id="src-23859469_id-.OCSPManagementv6.15.0-BuildingandConfiguringtheOCSPResponderBuildingandConfiguringtheOCSPResponder">
        <h1 class="heading "><span id="src-23859469_id-.OCSPManagementv6.15.0-BuildingandConfiguringtheOCSPResponder" class="confluence-anchor-link"></span><span>Building and Configuring the OCSP Responder </span></h1>
    <div class="section section-2" id="src-23859469_id-.OCSPManagementv6.15.0-UsingtheUIonaRemoteVA">
        <h2 class="heading "><span>Using the UI on a Remote VA</span></h2>
<p   
>The OCSP responder has the same UI as the CA, so you can manage all your Crypto Tokens and Key Bindings using the Admin GUI (or the CLI see below).</p>
<p   
>In an OCSP responder, you normally only use a few functions of the Admin GUI, although all of them are available. The important functions for an OCSP responder are:</p>
<ul class=" "><li class=" "><p   
>Crypto Tokens</p>
</li><li class=" "><p   
>Internal Key Bindings</p>
</li></ul><p   
>Prerequisites for Admin GUI access:</p>
<ul class=" "><li class=" "><p   
>Available TLS keystores as p12/tomcat.jks and p12/truststore.jks (copies from the EJBCA CA), to be deployed with deploy-keystore and web-configure (may require configuration of keystore password in conf/web.properties).</p>
</li><li class=" "><p   
>An imported Management CA certificate (the certificate of the CA that issues administrator certificates).</p>
</li><li class=" "><p   
>Configured Administrators with access rules.</p>
</li></ul><p   
>If you only want to set up a super administrator, the initial super administrator access rule is automatically set up during the initial startup (see database tables AdminGroupData and AccessRulesData). You can run the following commands to import a Management CA certificate and add a SuperAdmin, that has a certificate with &quot;CN=SuperAdmin&quot; issued from this CA (this will create a record in database table AdminEntityData).</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">bin</code><code class="plain">/ejbca</code><code class="plain">.sh ca importcacert ManagementCA </code><code class="plain">/home/user/adminca1</code><code class="plain">.pem</code></div>
<div class="line"><code class="plain">bin</code><code class="plain">/ejbca</code><code class="plain">.sh roles addmember </code><code class="string">"Super Administrator Role"</code><code class="plain"> ManagementCA WITH_COMMONNAME TYPE_EQUALCASE SuperAdmin</code></div>
</div>
    </div>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>If you do not want to import the administrator certificate into EJBCA, you can configure <strong class=" ">web.reqcertindb=</strong><i class=" ">false</i> in <strong class=" ">conf/web.properties</strong>.</p>
<p   
>Otherwise the administrator certificate must be present in the database (can be imported using the CLI).</p>
        </div>
    </div>
    </div>
    <div class="section section-2" id="src-23859469_id-.OCSPManagementv6.15.0-SettinguptheOCSPResponderKeys">
        <h2 class="heading "><span>Setting up the OCSP Responder Keys </span></h2>
<p   
>If working on a remote VA, make sure to import the CA that is meant to be the OCSP responder from the EJBCA CA.</p>
<p   
>The keys used to sign the OCSP response are referenced through Crypto Tokens (that could be either soft or HSM/PKCS#11 based). There should be one key for each CA, and one OCSP signing certificate must be issued from each CA the responder answers for.</p>
<p   
>The certificate profile could be the same for all issued OCSP signing certificates.</p>
<p   
>To issue an OCSP signer certificate from EJBCA, define a new certificate profile and clone the built-in certificate profile 'OCSPSIGNER'. This certificate profile is like a normal end entity profile, but with the following key usages:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">- Key Usage: Digital Signature</code></div>
<div class="line"><code class="plain">- Extended Key Usage: OCSPSigner</code></div>
</div>
    </div>
<p   
>Configure the newly created certificate profile to use the OCSP publisher defined above. You also need to create a new End Entity Profile to use the new Certificate Profile. You should then create a user for each CA using this certificate profile. Use the token type <strong class=" ">User generated</strong>.</p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>The OCSP responders certificate(s) AND the CA certificate(s) need to be published from the CA to the OCSP responder. For the CA you do this by setting the CRL publisher to the OCSP publisher.</p>
        </div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-23859469_id-.OCSPManagementv6.15.0-PopulatingtheOCSPDatabaseonaRemoteVA">
        <h1 class="heading "><span>Populating the OCSP Database on a Remote VA</span></h1>
<p   
>By design, a standalone VA is designed to be stateful as a connection to the CA can't be presumed, and such a connection can't be relied upon to be constant. For that reason the VA's database is populated with certificate information, allowing it to function independently of the CA. This can be done in several ways. While we strongly recommend using the <a   href="Validation_Authority_Peer_Publisher.html">EJBCA Peer Publisher</a> as the most secure and easy way, we provide options for populating the VA from a CRL produced by a non-EJBCA CA, or producing your own custom publisher and writing straight to the EJBCA database as well.</p>
    <div class="section section-2" id="src-23859469_id-.OCSPManagementv6.15.0-UsingaPublisherontheCA">
        <h2 class="heading "><span>Using a Publisher on the CA</span></h2>
<p   
>We currently provide two publishers, the <a   href="Validation_Authority_Peer_Publisher.html">EJBCA Peer Publisher</a> which publishes certificates synchronously over TLS and the <a   href="Validation_Authority_Publisher_%28Legacy%29.html">Legacy VA Publisher</a> which uses direct database publishing.</p>
    <div class="section section-3" id="src-23859469_id-.OCSPManagementv6.15.0-UsingtheEJBCAPeerPublisher">
        <h3 class="heading "><span>Using the EJBCA Peer Publisher</span></h3>
<p   
></p>
<p   
><span class="status blue " >ENTERPRISE</span>
 This is an EJBCA Enterprise feature.</p>
<p   
>Follow the steps to set up a new OCSP Signer using an EJBCA Peer System:</p>
<p   
>These instructions assume that there already is a Peer System connecting the CA and the VA machines, that the connection is already tested and that there is already a remote identity representing the CA among the &quot;Incoming Connections&quot; in the VA's Peer Systems. For information on setting up Peer Systems, see <a   href="Peer_Systems.html">Peer Systems</a>.</p>
<ol class=" "><li class=" "><p   
>Go to AdminGUI of OCSP &gt; <strong class=" ">Crypto Tokens</strong> and create a new Crypto Token (unless you want to reuse an existing).</p>
</li><li class=" "><p   
>Go to AdminGUI of OCSP &gt; <strong class=" ">Crypto Tokens</strong> &gt; <i class=" ">Your created Crypto Token</i> and generate a new key pair.</p>
</li><li class=" "><p   
>Go to AdminGUI of OCSP &gt; <strong class=" ">Internal Key Bindings</strong> &gt; <strong class=" ">OcspKeyBindings</strong> tab and create a new OcspKeyBinding that references the Crypto Token and key pair.</p>
</li><li class=" "><p   
>Go to AdminGUI of OCSP &gt; <strong class=" ">Peer Systems</strong> &gt; Click on <strong class=" ">Modify Role</strong> for the peer connector representing the CA and set access rules for the newly created OcspKeyBinding (&quot;view only&quot; or &quot;Renew certificate&quot;).</p>
</li><li class=" "><p   
>Go to AdminGUI of CA &gt; <strong class=" ">Add End Entity</strong>, create an End Entity for issuing the OCSP signing certificate (use an OCSP Signer certificate profile).</p>
</li><li class=" "><p   
>Go to AdminGUI of CA &gt; <strong class=" ">Peer Systems</strong> &gt; Click <strong class=" ">Manage</strong> for the peer connector representing the VA &gt; Remote Key Bindings, fill in the credentials for the OCSP signing End Entity in the newly created OcspKeyBinding and click <strong class=" ">Issue Signing Certificate</strong>.</p>
</li><li class=" "><p   
>Go to Admin GUI of OCSP &gt; <strong class=" ">Internal Key Binding</strong> &gt; <strong class=" ">OcspKeyBindings</strong> tab and verify that the OCSP key binding have a certificate and has been activated.</p>
</li></ol>    </div>
    <div class="section section-3" id="src-23859469_id-.OCSPManagementv6.15.0-UsingtheLegacyVAPublisher">
        <h3 class="heading "><span>Using the Legacy VA Publisher</span></h3>
<p   
></p>
<p   
><span class="status blue " >ENTERPRISE</span>
 This is an EJBCA Enterprise feature.</p>
<p   
>Follow the steps to set up a new OCSP Signer using a VA Publisher:</p>
<ol class=" "><li class=" "><p   
>Go to AdminGUI of OCSP &gt; <strong class=" ">Crypto Tokens</strong> and create a new Crypto Token (unless you want to reuse an existing).</p>
</li><li class=" "><p   
>Go to AdminGUI of OCSP &gt; <strong class=" ">Crypto Tokens</strong> &gt; <i class=" ">Your created Crypto Token</i> and generate a new key pair.</p>
</li><li class=" "><p   
>Go to AdminGUI of OCSP &gt; <strong class=" ">Internal Key Bindings</strong> &gt; <strong class=" ">OcspKeyBindings</strong> tab and create a new OcspKeyBinding the references the Crypto Token and key pair.</p>
</li><li class=" "><p   
>Go to AdminGUI of OCSP &gt; <strong class=" ">Internal Key Bindings</strong> and create a Certificate Signing Request for your new OcspKeyBinding. Save this file.</p>
</li><li class=" "><p   
>Go to PublicWeb of CA &gt; <strong class=" ">Create Certificate from CSR</strong> &gt; Use the credentials for issuing an OCSP signing certificate and upload the CSR.</p>
</li><li class=" "><p   
>...(CA publishes new OCSP signing certificate to OCSP instance)...</p>
</li><li class=" "><p   
>Go to AdminGUI of OCSP &gt; <strong class=" ">Internal Key Bindings</strong> and click <strong class=" ">Update</strong> for your new OcspKeyBinding. This will find the published certificate by matching the key pair with the certificate.</p>
</li><li class=" "><p   
>Go to AdminGUI of OCSP &gt; <strong class=" ">Internal Key Bindings</strong> and click <strong class=" ">Enable</strong> for your new OcspKeyBinding to start processing OCSP responses with it.</p>
</li></ol>    </div>
    </div>
    <div class="section section-2" id="src-23859469_id-.OCSPManagementv6.15.0-UsingtheCRLDownloadService">
        <h2 class="heading "><span>Using the CRL Download Service</span></h2>
<p   
>To configure a Service that automatically downloads and populates the mentioned fields from a CRL, do the following:</p>
<ul class=" "><li class=" "><p   
>Select <strong class=" ">Admin GUI &gt; Certification Authorities &gt; Import CA certificate</strong> for the CA that you want to serve OCSP responses for.</p>
</li><li class=" "><p   
>Select <strong class=" ">Admin GUI &gt; Certification Authorities &gt;</strong> <strong class=" ">Edit CA</strong> for the imported CA &gt; Configure an external CDP where the CA makes its CRLs available (must begin with &quot;http://&quot;).</p>
</li><li class=" "><p   
>Select <strong class=" ">Admin GUI &gt; Services</strong> and<strong class=" "> Add a new Service</strong> &quot;CRLDownloadService&quot;.</p>
</li><li class=" "><p   
>Select <strong class=" ">Admin GUI &gt; Services</strong> and <strong class=" ">Edit</strong> &quot;CRLDownloadService&quot;:</p>
<ul class=" "><li class=" "><p   
><strong class=" ">Select Worker:</strong> CRL Downloader.</p>
</li><li class=" "><p   
><strong class=" ">CAs to Check</strong>: Select the imported CA (or select ANY to process all external X509 CAs with a configured external CDP).</p>
</li><li class=" "><p   
><strong class=" ">Ignore nextUpdate and always download the CRL</strong>: Select this option to force a download of the CRL whenever the service is executed instead of only downloading the CRL when the last known CRL indicates that a new one will be available.</p>
</li><li class=" "><p   
><strong class=" ">Maximum allowed size to download</strong> (bytes): The Service will refuse to process CRLs that are larger than this limit.</p>
</li><li class=" "><p   
><strong class=" ">Period:</strong> How often the Service should check if a new CRL needs to be downloaded.</p>
</li><li class=" "><p   
><strong class=" ">Active:</strong> Select to activate the service.</p>
</li></ul></li></ul><p   
>The next time the service is executed, there will be log entries showing if the CRL download and processing was successful. After the first execution of the service you should be able to download the CRL from the VA's Public Web pages.</p>
<p   
>Next, setup an OcspKeyBinding as described for the case where direct database publishing is used. The only difference is that there is no way for the VA to know if a certificate has ever been issued, so it makes sense to respond OCSP status &quot;good&quot; for unknown certificates.</p>
<p   
>If the downloaded CRL from the external CDP contains the Freshest CRL extension, the service will try to download and process any such URL that uses &quot;http&quot; as protocol.</p>
    </div>
    <div class="section section-2" id="src-23859469_id-.OCSPManagementv6.15.0-UsingaCustomImplementation">
        <h2 class="heading "><span>Using a Custom Implementation</span></h2>
<p   
>When running the OCSP responder answering queries from CAs in an EJBCA installation, populate the database using the <strong class=" ">External OCSP Publisher</strong>. For more information, see <a   href="#src-23859469_id-.OCSPManagementv6.15.0-BuildingandConfiguringtheOCSPResponder">Building and Configuring the OCSP Responder</a>.</p>
<p   
>When using other CA software than EJBCA you can populate the database based on data from that system. The only thing needed is to insert data in the CertificateData table on the external OCSP responder.</p>
<p   
>The values used by the OCSP responder are:</p>
    <div  class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col />
                                    <col />
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Field</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Description</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>issuerDN</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Must be of &quot;EJBCA normalized&quot; form, as returned by <tt class=" ">org.cesecore.util.CertTools.getIssuerDN(cert)</tt>.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>serialNumber</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Is BigInteger.toString().</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>status</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Is from CertificateDataBean.CERT_REVOKED etc.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>revocationDate</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Date (in milliseconds since epoch) that the certificate was revoked on. Or 0 by default if not revoked.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>revocationReason</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Revocation reason. If from RevokedCertInfo.NOT_REVOKED etc.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>certificateProfileId</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Used if you configure things like <tt class=" ">ocsp.999.untilNextUpdate</tt> in <tt class=" ">ocsp.properties</tt>.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>expireDate</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Date (in milliseconds since epoch) that the certificate expires. Used to control when ArchiveCutoff (RFC6960 4.4.4) is included.</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
<p   
>CA certificates and OCSP signer certificates must also be in the database. For these certificates the fingerprint, subjectDN, and base64Cert fields must also be included.</p>
    </div>
    </div>
    <div class="section section-1" id="src-23859469_id-.OCSPManagementv6.15.0-SettingtheDefaultResponderDefault_Responder">
        <h1 class="heading subsection"><span id="src-23859469_id-.OCSPManagementv6.15.0-Default_Responder" class="confluence-anchor-link"></span><span>Setting the Default Responder </span></h1>
<p   
>The default responder is the valid CA or OCSP Keybinding set to sign responses to requests that come in for unknown issuers.</p>
<p   
>For all unknown issuers the default responder will reply with an 'UNKNOWN' response. For external CAs without dedicated OCSP keybindings the default responder will perform standard OCSP lookups. Be aware that this may cause unexpected behavior in the case of where an inactivated (due to responder certificate being revoked or expiring) keybinding exists, and that keybinding has a different behavior in regards to unknown certificates than the default responder.</p>
<p   
>If no default responder is defined, is defined incorrectly, or the chosen responder doesn't have a certificate, the responder will reply &quot;Unauthorized&quot; (as per RFC2560) with a null payload.</p>
    <div class="section section-2" id="src-23859469_id-.OCSPManagementv6.15.0-SettingtheDefaultResponderfromtheGUI">
        <h2 class="heading "><span>Setting the Default Responder from the GUI</span></h2>
<p   
>You can choose the default responder from the list menu in the OCSP Internal Keybindings page in the GUI, which will show all valid CAs and keybindings. It will also provide the option to choose none and allow retaining an old but unmatched value imported via migration from configurations earlier than version 6.2.4</p>
    </div>
    <div class="section section-2" id="src-23859469_id-.OCSPManagementv6.15.0-SettingtheDefaultResponderfromtheCLI">
        <h2 class="heading "><span>Setting the Default Responder from the CLI</span></h2>
<p   
>The default responder can also be chosen from the CLI with the following command.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">bin/ejbca.sh ocsp setdefaultresponder &lt;</code><code class="keyword">DN</code><code class="plain">&gt;</code></div>
</div>
    </div>
<p   
>To see a list of valid responders, run the command with the <tt class=" ">--help</tt> switch. This will also show the current chosen responder.</p>
    </div>
    </div>
    <div class="section section-1" id="src-23859469_id-.OCSPManagementv6.15.0-SettingResponderIDTypeforCAsResponder_ID_Type_for_CAs">
        <h1 class="heading subsection"><span id="src-23859469_id-.OCSPManagementv6.15.0-Responder_ID_Type_for_CAs" class="confluence-anchor-link"></span><span>Setting Responder ID Type for CAs </span></h1>
<p  class="subsection" 
>Local CA's will automatically answer OCSP responses for themselves, unless an OCSP Keybinding has been set up for them. This setting defines the general responder ID type for CA's acting as their own responders. Just like for an OCSP Keybinding, the responder ID type is either a Name (SubjectDN of the signing certificate used for response) or Keyhash (SHA-1 digest of the public key of the signing certificate used for response).</p>
    </div>
    <div class="section section-1" id="src-23859469_id-.OCSPManagementv6.15.0-CheckingtheStatusoftheOCSPResponderusingtheEJBCAClientToolbox">
        <h1 class="heading "><span>Checking the Status of the OCSP Responder using the EJBCA Client Toolbox </span></h1>
<p   
>Verification of a running responder can be done using the <a   href="EJBCA_Client_Toolbox.html">EJBCA Client Toolbox</a>.</p>
<p   
>To list all available OCSP commands, run the following:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$TOOLBOX_HOME/ejbcaClientToolBox.sh OCSP</code></div>
</div>
    </div>
    </div>
    <div class="section section-1" id="src-23859469_id-.OCSPManagementv6.15.0-ConfiguringOCSPExtensionsOCSP_Extension">
        <h1 class="heading "><span id="src-23859469_id-.OCSPManagementv6.15.0-OCSP_Extension" class="confluence-anchor-link"></span><span>Configuring OCSP Extensions </span></h1>
<p   
>The standard allows using extensions in OCSP requests and responses.</p>
<p   
><a   href="Extensions.html">OCSP extensions</a> can be configured individually per OCSP Keybinding in the UI, according to the following example:</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/23859469/Screen_Shot_2018-04-04_at_13.10.47.png" alt="images/download/attachments/23859469/Screen_Shot_2018-04-04_at_13.10.47.png" width="400"  />
    </p>
    <div class="section section-2" id="src-23859469_id-.OCSPManagementv6.15.0-Nonce">
        <h2 class="heading "><span>Nonce</span></h2>
<p   
>Nonce is the only standard extension defined. The nonce allows a client to verify that a response really is in response to the specific requests, and not a replayed response. It is recommended that if the OCSP requests contains the nonce extension, the OCSP response also contains the nonce. EJBCA includes the nonce from the client requests in the server response if the requests contain a nonce. The OCSP nonce extension can be disabled both per OCSP Keybinding, and also globally for all CAs acting as their own OCSP responders. Disabling nonces globally will not affect whether OCSP keybindings use the nonce extension in their responses.</p>
    </div>
    <div class="section section-2" id="src-23859469_id-.OCSPManagementv6.15.0-Fnr-UnidMappingExtension">
        <h2 class="heading "><span>Fnr-Unid Mapping Extension</span></h2>
<p   
>For information on the Unid functionality, see <a   href="Unid_FNR.html">Unid FNR</a>.</p>
    </div>
    <div class="section section-2" id="src-23859469_id-.OCSPManagementv6.15.0-CertHashOCSPExtension">
        <h2 class="heading "><span>CertHash OCSP Extension</span></h2>
<p   
>For information on the CertHash functionality, see <a   href="CertificateHash.html">CertificateHash</a>.</p>
    </div>
    </div>
    <div class="section section-1" id="src-23859469_id-.OCSPManagementv6.15.0-UsingHTTPGETandRFC5019">
        <h1 class="heading "><span>Using HTTP GET and RFC5019</span></h1>
<p   
>For HTTP get requests according to <a  class="external-link" href="http://www.ietf.org/rfc/rfc5019.txt">RFC5019</a> we can set HTTP headers in the response to allow caching proxies to cache responses. By default, these properties are set not to allow caching, which is the default behavior.</p>
<p   
>To enable caching in HTTP proxies you can tune a few properties in conf/ocsp.properties or in the an OcspKeyBinding.</p>
<ul class=" "><li class=" "><p   
>ocsp.untilNextUpdate: Number of seconds a response will be valid. This sets the nextUpdate field in the OCSP response.</p>
</li><li class=" "><p   
>ocsp.maxAge: How long a response will be cached, in seconds. Should be less than untilNextUpdate. This adds <a  class="external-link" href="http://www.ietf.org/rfc/rfc5019.txt">RFC5019</a> cache headers.</p>
</li></ul><p   
>You can also specify different nextUpdate values depending on which certificate profiles the certificate was issued by. This only works when you have published the certificate information using EJBCA 3.9.0 or later, where the certificateProfileId column in the CertificateData table is populated. You can find the certificateProfileId in the Admin GUI.</p>
<ul class=" "><li class=" "><p   
>ocsp.&lt;certificateProfileId&gt;.untilNextUpdate: Number of seconds a response will be valid for certificates issued with the specified certificate profile.</p>
</li><li class=" "><p   
>ocsp.&lt;certificateProfileId&gt;.maxAge: How long a response will be cached for certificates issued with the specified certificate profile. Should be less than untilNextUpdate.</p>
</li></ul><p   
>If no specific certificateProfileId is specified, the default values from ocsp.maxAge and ocsp.untilNextUpdate are used. Properties from an OcspKeyBinding will override the defaults, but never certificateProfileId specific settings.</p>
<p   
>However, in case of certificate status unknown, EJBCA attempts to avoid the caching of an OSCP GET response by setting the HTTP header &quot;Cache-Control&quot; to &quot;no-cache, must-revalidate&quot; (non-configurable).</p>
    </div>
    <div class="section section-1" id="src-23859469_id-.OCSPManagementv6.15.0-OCSPStressTesting">
        <h1 class="heading "><span>OCSP Stress Testing</span></h1>
<p   
>You can stress test your CAs and OCSP responders using the <a   href="EJBCA_Client_Toolbox.html">EJBCA Client Toolbox</a>.</p>
<p   
>To stress test, issue a large number of certificates from the CA using the web-service stress test, and then stress test the OCSP responder with a random selection of all the certificates issued.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$TOOLBOX_HOME/ejbcaClientToolBox.sh EjbcaWsRaCli stress ...</code></div>
<div class="line"><code class="plain">$TOOLBOX_HOME/ejbcaClientToolBox.sh OCSP stress ...</code></div>
</div>
    </div>
    </div>
    <div class="section section-1" id="src-23859469_id-.OCSPManagementv6.15.0-MonitoringOCSPDatabases">
        <h1 class="heading "><span>Monitoring OCSP Databases</span></h1>
<p   
>EJBCA Database CLI contains a standalone tool for monitoring OCSP databases. The tool is based on Java SE JPA and can be configured in:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">dist/ejbca-db-cli/META-INF/persistence.xml.</code></div>
</div>
    </div>
<p   
>Log4J is used for reporting and can be configured in:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain"> dist/ejbca-db-cli/log4j.xml.</code></div>
</div>
    </div>
<p   
>Once built, run the command with:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain"> ./run.sh ocspmon</code></div>
</div>
    </div>
<p   
>The tool operates using Certificate Profile IDs that are the internal representations of different Certificate Profiles in EJBCA. When running the tool, it outputs all the existing IDs in each OCSP. These IDs are also shown in the Admin GUI for each CertificateProfile.</p>
<p   
>The following inconsistencies are detected:</p>
<ul class=" "><li class=" "><p   
>Missing information about certificates in the OCSP database. (ERROR)</p>
</li><li class=" "><p   
>Additional information about certificates in the OCSP database. (ERROR)</p>
</li><li class=" "><p   
>Information about certificates in the OCSP database that has been tampered with. (ERROR)</p>
</li><li class=" "><p   
>If there are any extra certificates profiles in use on the OCSP besides those being checked. (WARN)</p>
</li></ul><p   
>Every detected inconsistency will also be reported in a summarizing final ERROR message and if there are too many errors, this final message will be truncated.</p>
<p   
>Instead of going through every single CertificateData row in a database, it is recommended to use indexes like the following example for both the CA database and each OCSP responder:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain"> create index certificatedata_idx7 on CertificateData(certificateProfileId);</code></div>
</div>
    </div>
    </div>
    <div class="section section-1" id="src-23859469_safe-id-aWQtLk9DU1BNYW5hZ2VtZW50djYuMTUuMC1TaWduYXR1cmVUb2tlbkFjdGl2YXRpb24oVXBncmFkZXNvbmx5KQ">
        <h1 class="heading "><span>Signature Token Activation (Upgrades only)</span></h1>
<p   
>If you are upgrading from an earlier EJBCA 5.0.x version, the activation password is required for migrating the OCSP signing key-stores. When activating you are prompted for a password and this password will then be used for all token password not configured.</p>
<p   
>To activate:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain"> $TOOLBOX_HOME/ejbcaClientToolBox.sh OCSPActivate</code></div>
</div>
    </div>
<p   
>After migrating the key-stores and certificates to Crypto Tokens and OcspKeyBindings, you must use the EJB CLI for activating your Crypto Tokens.</p>
<p   
></p>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="Managing_Crypto_Tokens.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Managing Crypto Tokens</span>
        </a>
                <a href="Setting_up_a_Responder_Using_the_CLI.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Setting up a Responder Using the CLI</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

</body>
</html>
