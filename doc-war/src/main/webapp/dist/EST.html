<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>EST - EJBCA - Documentation Space</title>

    
            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="85921598">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_6.15.2.6_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=26774327"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_6.15.2.6_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Documentation.html">EJBCA Documentation</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Operations.html">EJBCA Operations</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Concept_Guide.html">EJBCA Concept Guide</a></li>
                                                                                     <li><a href="Protocols.html">Protocols</a></li>
                                                            </ul>
</div>            <h1 id="src-26774327"> <span>EST</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

<p   
></p>
<p   
><span class="status blue " >ENTERPRISE</span>
 This is an EJBCA Enterprise feature.</p>
<p   
>The Enrollment over Secure Transport (EST) is a cryptographic protocol that describes an X.509 certificate management protocol targeting public key infrastructure (PKI) clients that need to acquire client certificates and associated certificate authority (CA) certificates.</p>
<p   
>This section covers the following:</p>
<p   
></p>
<ul class="toc-indentation "></ul>    <div class="section section-1" id="src-26774327_id-.ESTv6.15.1-IntroductiontoEST">
        <h1 class="heading "><span>Introduction to EST</span></h1>
<p   
>EJBCA supports the EST protocol as defined in <a  class="external-link" href="https://tools.ietf.org/html/rfc7030">RFC7030</a> as of EJBCA version 6.11.</p>
<p   
>EST provides a basic protocol for certificate enrollment and management similar to SCEP, with the following distinct advantages:</p>
<ul class=" "><li class=" "><p   
>While SCEP communicates over HTTP and ensures integrity by wrapping the payload in a cryptographic envelope, EST requests are always over TLS and thus inherently secure.</p>
</li><li class=" "><p   
>EST supports ECC, while SCEP does not.</p>
</li><li class=" "><p   
>While SCEP requires a shared secret to authenticate CSRs, in EST authentication is implicit when negotiating the TLS connection.</p>
</li><li class=" "><p   
>Certificate renewal is an integral part of EST, while in SCEP it is rather an afterthought.</p>
</li><li class=" "><p   
>EST supports server-side key generation, which SCEP does not (currently not supported in EJBCA).</p>
</li></ul>    </div>
    <div class="section section-1" id="src-26774327_id-.ESTv6.15.1-SupportedOperations">
        <h1 class="heading "><span>Supported Operations</span></h1>
<p   
>The following operations in EST are supported:</p>
    <div  class="tablewrap">
        <table class="wrapped relative-table confluenceTable">
                    <colgroup>
                                    <col  width="6%"/>
                                    <col  width="93%"/>
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Name</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Description</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>cacerts</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>A GET request that returns a cert-only pkcs#7 blob containing the CA certificate (and possible chain) for the given alias that is used to issuing certificates via enrollment operation. This operation requires no authentication.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>simpleenroll</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>A POST request with a CSR in PKCS#10 format and Base64 encoded to be signed by the specified CA for the given alias. May require an existing client certificate for authentication and/or HTTP Basic authentication via username and password.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>simplereenroll</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>A POST request with a CSR in PKCS#10 format and Base64 encoded to be signed by the specified CA for the given alias. Requires authenticating with the original certificate, which has to be valid (to establish a TLS connection) and not revoked.</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    <div class="section section-1" id="src-26774327_id-.ESTv6.15.1-Configuration">
        <h1 class="heading "><span>Configuration</span></h1>
    <div class="section section-2" id="src-26774327_id-.ESTv6.15.1-Access">
        <h2 class="heading "><span>Access</span></h2>
<p   
>The EJBCA EST implementation uses the Well-Known Uniform Resource Identifiers (URIs) definition codified in <a  class="external-link" href="https://tools.ietf.org/html/rfc5785">RFC 5785</a>.</p>
<p   
>Like SCEP and CMP, EJBCA supports using EST for multiple CAs by the use of aliases. Each alias is then accessible using:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ /.well-known</code><code class="plain">/est/</code><code class="plain">&lt;</code><code class="functions">alias</code><code class="plain">&gt;/&lt;operation&gt;</code></div>
</div>
    </div>
<p   
>When an alias with the name <strong class=" ">est</strong> is configured, this alias is available over the default EST URL, which is the URL used by the estclient, see <a   href="#src-26774327_id-.ESTv6.15.1-Testing">Testing</a>.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/.well-known/est/&lt;operation&gt;</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-26774327_id-.ESTv6.15.1-ConfiguringAliases">
        <h2 class="heading "><span>Configuring Aliases</span></h2>
<p   
>The following displays the EST alias configuration screen:</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/26774327/image2018-2-27_18-15-6.png" alt="images/download/attachments/26774327/image2018-2-27_18-15-6.png"  height="250" />
    </p>
<p   
>The following EST alias configuration options are available:</p>
    <div  class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col />
                                    <col />
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Value</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Description</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Default CA</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>The CA that this alias will issue certificate from.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>End Entity Profile</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>The End Entity Profile that enrolling end entities will have applied to them. This defines required DN and altName naming fields.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Certificate Profile</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>The Certificate Profile that enrolling end entities will have applied to them. This controls the certificate type, that is, key usage and other extensions.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Require Client Certificate</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Specifies if a client certificate is required to enroll. The client certificate does not need to be known by EJBCA (if the option <strong class=" ">web.reqcertindb</strong> in <strong class=" ">conf/web.properties</strong> is set to false), but the issuing CA is. The client certificate needs to belong to a Role with full RA rights.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Client username/password</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Sets a username and password to enroll. The username will be given full RA rights. If a client certificate is required, both client certificate and username/password will be checked for initial enrollment. For Renewal (re-enroll) username and password is never required, but client certificate is always required.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Certificate Renewal with Same Keys</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>If <strong class=" ">Allow</strong> is selected, a re-enrollment request may be performed for the same public key as before. Note that client certificate is always required for renewal, while username/password is never required, regardless of the settings above.</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    </div>
    <div class="section section-1" id="src-26774327_id-.ESTv6.15.1-Testing">
        <h1 class="heading "><span>Testing</span></h1>
<p   
>Clone <a  class="external-link" href="https://github.com/cisco/libest">libest</a> from Cisco and build according to instructions:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ </code><code class="functions">cd</code><code class="plain"> examples</code><code class="plain">/client</code></div>
<div class="line"><code class="plain">$ </code><code class="comments"># via environment specify the initial CA certificate to use for verifying TLS connection.</code></div>
<div class="line"><code class="plain">$ </code><code class="functions">cp</code><code class="plain"> &lt;path to server cert&gt; server.pem</code></div>
<div class="line"><code class="plain">$ </code><code class="functions">export</code><code class="plain"> EST_OPENSSL_CACERT=server.pem</code></div>
<div class="line"><code class="plain">$ </code><code class="comments"># Where to save certs</code></div>
<div class="line"><code class="plain">$ </code><code class="functions">mkdir</code><code class="plain"> certs</code></div>
<div class="line"><code class="plain">$ </code><code class="comments"># Optionally get new CA certificates</code></div>
<div class="line"><code class="plain">$ .</code><code class="plain">/estclient</code><code class="plain"> -g -s &lt;ip or </code><code class="functions">hostname</code><code class="plain"> to EJBCA&gt; -p 8442 -o certs --pem-output</code></div>
<div class="line"><code class="plain">$ </code><code class="comments"># certs should now contain a cacert-0-0.pem file</code></div>
<div class="line"><code class="plain">$ </code><code class="comments"># enroll with CA. publicCert.pem and privetKey.pem are the TLS client cert I wish to use for auth. RequestDN will be 'CN=myclient'</code></div>
<div class="line"><code class="plain">$ .</code><code class="plain">/estclient</code><code class="plain"> -e -s &lt;ip or </code><code class="functions">hostname</code><code class="plain"> to EJBCA&gt; -p 8442 -o certs -c publicCert.pem -k privateKey.pem --pem-output --common-name myclient</code></div>
<div class="line"><code class="plain">$ </code><code class="comments"># certs will now contain a cert-0-0.pem and key-x-x.pem</code></div>
<div class="line"><code class="plain">$ </code><code class="comments"># client cert is about to expire, reenroll</code></div>
<div class="line"><code class="plain">$ .</code><code class="plain">/estclient</code><code class="plain"> -r -s &lt;ip or </code><code class="functions">hostname</code><code class="plain"> to EJBCA&gt; -p 8442 -o tmp -c tmp</code><code class="plain">/cert-0-0</code><code class="plain">.pem -k tmp</code><code class="plain">/key-x-x</code><code class="plain">.pem --pem-output</code></div>
<div class="line"><code class="plain">$ </code><code class="comments"># certs should now contain an updated cert-0-0.pem	</code></div>
</div>
    </div>
<p   
>You can also test access to EST URLs with a <tt class=" ">curl</tt> command, using the <tt class=" ">cacerts</tt> method:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">curl https:</code><code class="comments">//&lt;hostname&gt;:8442/.well-known/est/cacerts -o cacerts.p7 --cacert ManagementCA.cacert.pem</code></div>
</div>
    </div>
<p   
>or with an apache proxy in front, if the /.well-known URL is proxied correctly:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">curl https:</code><code class="comments">//&lt;hostname&gt;/.well-known/est/cacerts -o cacerts.p7 --cacert ManagementCA.cacert.pem</code></div>
</div>
    </div>
<p   
>ManagementCA.cacert.pem is the Root CA certificate of the CA chain that issued the TLS server cert and need to be configured with curl in order for the TLS connection to be established. ManagementCA is the name in a default EJBCA installation and the cert can be downloaded from the Admin Web or RA Web.</p>
    <div class="section section-2" id="src-26774327_id-.ESTv6.15.1-WorkflowExample">
        <h2 class="heading "><span>Workflow Example</span></h2>
<p   
>Example enrollment, where a RA gets CA certificate first and then gets a client certificate, using username/password authentication (the EST client acts as an RA). Next, the client performs a renewal, authenticating with the client certificate issued previously.</p>
<p   
>EST configuration is an EST alias with the name <strong class=" ">est</strong> and the following settings:</p>
    <div  class="tablewrap">
        <table class="relative-table wrapped confluenceTable">
                    <colgroup>
                                    <col  width="28%"/>
                                    <col  width="71%"/>
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Setting</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Value</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Default CA</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>EST CA</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>End Entity Profile</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>EST EE Profile (with only CN required DN attribute)</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Certificate Profile</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Profile Default</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Require Client Certificate</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>false</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Client Username</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>estadmin</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Client Password</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>foo123</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Certificate Renewal with Same Keys</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>false</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
<p   
>Download the CA certificate of the EJBCA TLS connection (usually the default is Management CA), and set the environment variable needed for estclient:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="functions">export</code><code class="plain"> EST_OPENSSL_CACERT=</code><code class="plain">/tmp/ManagementCA</code><code class="plain">.cacert.pem</code></div>
</div>
    </div>
<p   
>Run the following estclient commands to generate a key and get a certificate from the CA:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ </code><code class="functions">mkdir</code><code class="plain"> certs</code></div>
<div class="line"> </div>
<div class="line"><code class="comments"># Get CA certificate, by "RA:</code></div>
<div class="line"><code class="plain">$ .</code><code class="plain">/estclient</code><code class="plain"> -g -s 127.0.0.1 -p 8442 -o certs --pem-output</code></div>
<div class="line"> </div>
<div class="line"><code class="comments"># Inspect the fetched CA certificate </code></div>
<div class="line"><code class="plain">$ openssl x509 -</code><code class="keyword">in</code><code class="plain"> certs</code><code class="plain">/cacert-0-0</code><code class="plain">.pem -text -noout</code></div>
<div class="line"> </div>
<div class="line"><code class="comments"># Get client certificate, by "RA", authenticated with username/password</code></div>
<div class="line"><code class="plain">$ .</code><code class="plain">/estclient</code><code class="plain"> -e -s 127.0.0.1 -p 8442 -o certs -u estadmin -h foo123 --pem-output --common-name myclient</code></div>
<div class="line"> </div>
<div class="line"><code class="comments"># Inspect the fetched client certificate </code></div>
<div class="line"><code class="plain">$ openssl x509 -</code><code class="keyword">in</code><code class="plain"> certs</code><code class="plain">/cert-0-0</code><code class="plain">.pem -text -noout</code></div>
<div class="line"> </div>
<div class="line"><code class="comments"># Re-enroll, directly by the client when certificate is about to expire, using the old client cert to authenticate with:</code></div>
<div class="line"><code class="plain">$ .</code><code class="plain">/estclient</code><code class="plain"> -r -s 127.0.0.1 -p 8443 -o certs -c certs</code><code class="plain">/cert-0-0</code><code class="plain">.pem -k certs</code><code class="plain">/key-x-x</code><code class="plain">.pem --pem-output</code></div>
<div class="line"> </div>
<div class="line"><code class="comments"># Inspect the new, renewed, client certificate  </code></div>
<div class="line"><code class="plain">$ openssl x509 -</code><code class="keyword">in</code><code class="plain"> certs</code><code class="plain">/cert-0-0</code><code class="plain">.pem -text -noout</code></div>
<div class="line"> </div>
<div class="line"><code class="comments"># Revoke the clients certificates by going to Admin GUI and using Search End Entities to find the end entity and revoke certificates.</code></div>
<div class="line"><code class="comments"># Try to re-enroll again, which will not work with a revoked client certificates.</code></div>
<div class="line"><code class="plain">$ .</code><code class="plain">/estclient</code><code class="plain"> -r -s 127.0.0.1 -p 8443 -o certs -c certs</code><code class="plain">/cert-0-0</code><code class="plain">.pem -k certs</code><code class="plain">/key-x-x</code><code class="plain">.pem --pem-output</code></div>
<div class="line"> </div>
<div class="line"><code class="comments"># Enroll with an EC key. First we have to generate the key, a Prime256v1 key on this case, and then use this key for enrollment.</code></div>
<div class="line"><code class="plain">openssl ecparam -name prime256v1 -genkey -noout -out prime256v1-key.pem</code></div>
<div class="line"><code class="plain">.</code><code class="plain">/estclient</code><code class="plain"> -e -s 127.0.0.1 -p 8442 -o certs -u estadmin -h foo123 --pem-output --common-name myclient -x prime256v1-key.pem</code></div>
<div class="line"><code class="plain">$ openssl x509 -</code><code class="keyword">in</code><code class="plain"> certs</code><code class="plain">/cert-0-0</code><code class="plain">.pem -text -noout</code></div>
<div class="line"> </div>
<div class="line"><code class="comments"># Re-enroll, also with EC, using the same key (using the same key can be dissalowed in the EST alias).</code></div>
<div class="line"><code class="plain">.</code><code class="plain">/estclient</code><code class="plain"> -r -s 127.0.0.1 -p 8443 -o certs -c certs</code><code class="plain">/cert-0-0</code><code class="plain">.pem -k prime256v1-key.pem --pem-output -x prime256v1-key.pem</code></div>
<div class="line"><code class="plain">$ openssl x509 -</code><code class="keyword">in</code><code class="plain"> certs</code><code class="plain">/cert-0-0</code><code class="plain">.pem -text -noout</code></div>
</div>
    </div>
    </div>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="CMP.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>CMP</span>
        </a>
                <a href="OCSP.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>OCSP</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

</body>
</html>
