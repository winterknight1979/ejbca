<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>EJBCA Development - EJBCA - Documentation Space</title>

    
            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="85921598">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_6.15.2.6_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=16226369"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_6.15.2.6_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Documentation.html">EJBCA Documentation</a></li>
                                                                                     <li><a href="EJBCA_Integration.html">EJBCA Integration</a></li>
                                                            </ul>
</div>            <h1 id="src-16226369"> <span>EJBCA Development</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

    <div class="section section-1" id="src-16226369_safe-id-aWQtLkVKQkNBRGV2ZWxvcG1lbnR2Ni4xMi4wLVJlbWVtYmVydGhpcyxzaG9ydGxpc3Q">
        <h1 class="heading "><span>Remember this, shortlist</span></h1>
<p   
>For all non-trivial commits to EJBCA (mostly doc and whitespace changes count as trivial):</p>
<ul class=" "><li class=" "><p   
>A JIRA issue must exist for what you are doing</p>
</li><li class=" "><p   
>Commits should have &quot;ECA-xxx&quot;, where xxx is the JIRA issue number in the svn comment. This allows Jira to track svn commits for the issue.</p>
</li><li class=" "><p   
>Only one issue per commit. Work on one feature at a time. This is critical for tracability and to be able to make good change logs.</p>
</li><li class=" "><p   
>JUnit tests must be there for all new features. Add also for bugfixes if possible. Backwards compatibility. All new features must be upgradeable from old version.</p>
</li><li class=" "><p   
>Either no upgrade is needed.</p>
<ul class=" "><li class=" "><p   
>Profiles etc (all UpgradeableDataHashMap) have auto-upgrade features.</p>
</li><li class=" "><p   
>'ant upgrade' framework for database changes.</p>
</li><li class=" "><p   
>Avoid code duplication, parameterize and re-factor code instead.</p>
</li></ul></li><li class=" "><p   
>Keep whitespace patches and commits separate from feature patches, so the whitespace changes does not clutter up and hide the feature diffs.</p>
</li><li class=" "><p   
>Think quality.</p>
</li></ul>    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-UsingtheIssueTracker">
        <h1 class="heading "><span>Using the Issue Tracker</span></h1>
<p   
>All check-ins to SVN must be followed by an issue in the issue tracker at <a  class="external-link" href="https://jira.primekey.se/secure/Dashboard.jspa">https://jira.primekey.se/secure/Dashboard.jspa</a>. This is needed to keep a good changelog, which is vital for a successful release.</p>
<p   
>The only exceptions to this rule are trivial internal fixes like typos, or removal of unused imports, constants and the like. Also documentation fixes do not need to be tracked in JIRA.</p>
<p   
>If submitting patches to EJBCA committers, they should be able to create JIRA issues if none exist.</p>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-GettingStartedwithEJBCADevelopment">
        <h1 class="heading "><span>Getting Started with EJBCA Development</span></h1>
    <div class="section section-2" id="src-16226369_id-.EJBCADevelopmentv6.12.0-DevelopmentTools">
        <h2 class="heading "><span>Development Tools</span></h2>
<ul class=" "><li class=" "><p   
>An operating system that can run Java (Linux, OSX, Windows..). Most developers use Ubuntu/Debian.</p>
</li><li class=" "><p   
>Eclipse JEE edition with an additional Subversion (SVN) plugin installed. OpenJDK</p>
</li><li class=" "><p   
>Apache Ant 1.9.x (with all the extras that comes with the zip from apache.org or 'ant-optional' Ubuntu package)</p>
</li><li class=" "><p   
>A supported application server (JBoss AS 7.1.1.GA, EAP6 etc)</p>
</li><li class=" "><p   
>A favorite database supported by EJBCA that is easy to work with (HSQL, MariaDB, MySQL, PostgreSQL).</p>
</li><li class=" "><p   
>A virtualization solution for testing additional combinations of application servers and databases and external OCSP responders etc.</p>
</li><li class=" "><p   
>Changes that affect the database requires more databases to test with, changes that affect the EJBs or setup requires additional application servers etc..</p>
</li></ul>    </div>
    <div class="section section-2" id="src-16226369_id-.EJBCADevelopmentv6.12.0-WhatyouneedtoknowtodevelopEJBCA">
        <h2 class="heading "><span>What you need to know to develop EJBCA</span></h2>
<ul class=" "><li class=" "><p   
>The tools described in the last section</p>
</li><li class=" "><p   
>Public Key Infrastructure and related technologies</p>
</li><li class=" "><p   
>Java</p>
</li><li class=" "><p   
>Java Enterprise Edition, excluding message beans</p>
<ul class=" "><li class=" "><p   
>Java Persistence API</p>
</li><li class=" "><p   
>Servlets, Java Server Faces (and still Java Server Pages)</p>
</li></ul></li><li class=" "><p   
>SQL databases</p>
</li><li class=" "><p   
>Web Services</p>
</li></ul>    </div>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-SendingPatches">
        <h1 class="heading "><span>Sending Patches</span></h1>
<p   
>If you are not a committer in SVN we are glad to accept patches. You can send us patches either in diff format (svn diff) or created with Eclipse.</p>
<p   
>You can also send us you complete files that you changed, we can see the diffs in Eclipse.</p>
<p   
>Follow these guidelines when submitting patches:</p>
<ul class=" "><li class=" "><p   
>Keep the patch limited, only change the parts related to your patch.</p>
</li><li class=" "><p   
>Do not change other lines, such as whitespace, adding line breaks to java doc etc. It will make it very very hard for us to review the patch.</p>
</li></ul>    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-UsingSubversion">
        <h1 class="heading "><span>Using Subversion</span></h1>
<p   
>How to connect to the EJBCA SVN repository is explained over at ejbca.org, <a  class="external-link" href="https://www.ejbca.org/repository.html">https://www.ejbca.org/repository.html</a>.</p>
<p   
>If you are using Eclipse we recommend the Subversive plug-in, now part of eclipse plug-in repositories.</p>
    <div class="section section-2" id="src-16226369_id-.EJBCADevelopmentv6.12.0-CheckingintoSVN">
        <h2 class="heading "><span>Checking in to SVN</span></h2>
<p   
>When checking in to SVN, make sure the following conditions are met:</p>
<ul class=" "><li class=" "><p   
>The checkin can be tracked to a JIRA issue</p>
</li><li class=" "><p   
>There is JUnit test coverage for the code.</p>
</li><li class=" "><p   
>There is sufficient documentation for the feature.</p>
</li></ul><p   
>When checking in to SVN you must use a checkin comment starting with JIRA issue (all commits should be linked to a JIRA issue). For example:</p>
<pre class=" ">    ECA-113: my comment here </pre><p   
>In this way JIRA can make a reference from an issue to specified SVN checkins, something that is very very useful.</p>
<p   
>When adding new files to SVN you must add a version header to the class javadoc header:</p>
<pre class=" ">    @version $Id$</pre><p   
>You must then set the Id keyword property:</p>
<pre class=" ">    svn propset svn:keywords 'Id' filename.java</pre><p   
>or for all files</p>
<pre class=" ">    find . -name &quot;*.java&quot; -exec svn propset svn:keywords &quot;Id&quot; {} \;</pre><p   
>or in Eclipse using Team&rarr;Keywords.</p>
    </div>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-Eclipse">
        <h1 class="heading "><span>Eclipse</span></h1>
<p   
>To build successfully using Eclipse, there are <strong class=" ">.classpath</strong> and <strong class=" ">.project</strong> files in svn. Simply check out EJBCA as a project, from svn, and you're almost set. To check out code you must first install the Subversive SVN plug-in in Eclipse. After this you can define a new SVN repository with repository location as found above. In the repository, browse to the desired branch or tag, right click on 'ejbca' and check out.</p>
<p   
>You must define the variable <strong class=" ">JBOSS7_HOME</strong> in <strong class=" ">Window-&gt;Preferences-&gt;Java-&gt;Build Path-&gt;Classpath Variables</strong>.</p>
<p   
>Some classes are generated during build, so you must also do an 'ant' for Eclipse to find all classes needed to build the project. After checking out the project, defining JBOSS7_HOME and running 'ant', you should simply refresh the project in Eclipse and voila!</p>
<p   
>To run 'ant' from the command line you still have to define the environment variable APPSRV_HOME, just like when you build from the distribution zip file.</p>
<p   
>You can build javadoc on all APIs used with</p>
<pre class=" ">ant javadoc</pre><p   
>If using the J2EE version of eclipse it tries to validate JSP ans JSP fragments. Unfortunately it fails miserably at this because it is not able to see relationships between JSP and JSP fragments.</p>
<p   
>In Eclipse you can disable JSP validation in <strong class=" ">Window-&gt;Preferences-&gt;Validation</strong>. I have disabled all Build validation for all JSF, JSP, XML, HTML and Seam.</p>
<p   
>You can configure the .classpath to work with different appservers. By default .classpath is configured for JBoss 7.1.1.GA.</p>
<p   
>Since appserver classpaths change frequently, there is no point in showing different configurations for different application server here. You have to experiment.</p>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-Debugging">
        <h1 class="heading "><span>Debugging</span></h1>
<p   
>You might notice that there is a j2ee:debug target, it will start JBoss in debug mode. Just fire up your debugger to the default transport and address display on your console and you're set. You can now debug your application.</p>
<p   
>You can also run JBoss from within Eclipse, this is perhaps even better.</p>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-DatabaseDevelopmentandChanges">
        <h1 class="heading "><span>Database Development and Changes</span></h1>
<p   
>See the <a   href="Database_Integration.html">Database Integration</a> section.</p>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-BouncyCastleProvider">
        <h1 class="heading "><span>BouncyCastle Provider</span></h1>
<p   
>EJBCA uses the BouncyCastle (BC) JCE provider.</p>
<p   
>To install the provider you must use the static method:<br/><span id="src-16226369_id-.EJBCADevelopmentv6.12.0-page5"></span>CertTools.installBCProvider()</p>
<p   
>This is done automatically when EJBCA starts from the StartServicesServlet, so if you are developing in EJBCA you don't have to bother with this.</p>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-APIDocumentation">
        <h1 class="heading "><span>API Documentation</span></h1>
<p   
>Being open source, EJBCA comes with the best API documentation there is for developers, source code.</p>
<p   
>Developers shouldn't need lengthy paper descriptions or UML diagrams. Source code and good examples are the best tools.</p>
<p   
>Getting familiar with the concepts are always good though, so read up on this site and ejbca.org first and familiarize yourself with the concepts and workings of EJBCA.</p>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-EJBAPI">
        <h1 class="heading "><span>EJB API</span></h1>
<p   
>The EJB API can be called from command line tools, web applications or other EJB applications.</p>
<p   
>Good samples can be found in the EJBCA command line interface: <strong class=" ">src/java/org/ejbca/ui/cli</strong>. The java classes are named logically so you should be able to figure out what they do simply by the name.</p>
<p   
>Another good sample is the EJBCA public web pages, or the servlets that drives it: <strong class=" ">src/java/org/ejbca/ui/web/pub</strong>.</p>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-WebserviceAPI">
        <h1 class="heading "><span>Webservice API</span></h1>
<p   
>The webservice API can be called fom any webservice client, locally or remotely. Good sample code can be found in the EJBCA webservice command line interface. src/java/org/ejbca/core/protocol/ws/client. Also here the java classes are named logically.</p>
<p   
>There is javadoc of the WebService API built when you run <code class=" ">ant doc</code>, look under tmp/htdocs/ws. It is also available online at <a  class="external-link" href="https://www.ejbca.org/docs/ws/index.html">https://www.ejbca.org/docs/ws/index.html</a>.</p>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-JUnittests">
        <h1 class="heading "><span>JUnit tests</span></h1>
<p   
>The last source of good example code is the JUnit tests. If you plan to contribute to EJBCA you should also learn to write your own JUnit tests.</p>
<p   
>Look in the directory src/test, there are plenty of java files under there.</p>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-SubjectandIssuerDNs">
        <h1 class="heading "><span>Subject and Issuer DNs</span></h1>
<p   
>Handling of subject and issuer DNs must be done in an extremely predictable way, and in the same way everywhere. Issue are ordering of DN elements, handling of localized strings (UTF8) etc. Because of this, there are a few methods in se.anatom.ejbca.util.CertTools that MUST be used when handling DNs:<span id="src-16226369_id-.EJBCADevelopmentv6.12.0-page6"></span></p>
<ul class=" "><li class=" "><p   
>stringToBCDNString() - when handling user input of a DN string to store od match</p>
</li><li class=" "><p   
>getSubjectDN(cert) - extracts subject DN from a certificate getIssuerDN(cert) - extracts issuer DN from a certificate</p>
</li><li class=" "><p   
>getIssuerDN(crl) - extracts issuer DN from a CRL</p>
</li></ul>    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-Logging">
        <h1 class="heading "><span>Logging</span></h1>
<p   
>Straight console output (System.out) MUST not be used in EJBCA except in cases of console admin utilities.</p>
<p   
>There are two types of logging in EJBCA:</p>
<ul class=" "><li class=" "><p   
>CA logs, defining important events. These logs end up in the database and can be searched through the administration Web-GUI.</p>
</li><li class=" "><p   
>Error and debug logs. These logs use Log4j and end up in a log file defined in JBoss.</p>
</li></ul>    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-UsetheUtils">
        <h1 class="heading "><span>Use the Utils</span></h1>
<p   
>For the most mundane repetitive tasks there are usually util classes in either <strong class=" ">org.ejbca.util</strong> or in the Apache commons classes that help avoid the same code being copied everywhere.</p>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-CALogs">
        <h1 class="heading "><span>CA Logs</span></h1>
<p   
>There are three important classes:</p>
<ul class=" "><li class=" "><p   
><strong class=" ">Admin</strong>: Defines the administrator that performed the action.</p>
</li><li class=" "><p   
><strong class=" ">LogEntry</strong>: Represents a line in the log database. Only the constants defined here are used.</p>
</li><li class=" "><p   
><strong class=" ">ILogSessionRemote/Local</strong>: The log functionality itself.</p>
</li></ul><p   
>To perform logging, first acquire the remote interface to the log session:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">ILogSessionLocalHome logsessionhome = (ILogSessionLocalHome) getLocator().getLocalHome(ILogSessionLocalHome.COMP_NAME); logsession = logsessionhome.create(); </code></div>
</div>
    </div>
<p   
>Next step is to log using the function 'log'. Parameters to the log function are:</p>
    <div  class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col />
                                    <col />
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Parameter</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Description</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>admin</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Of the class Admin and is created according to the following criteria:</p>
<ul class=" "><li class=" "><p   
>In case a client certificate exists, new Admin(certificate)</p>
</li><li class=" "><p   
>In other cases one of the types defined in Admin.TYPE_&hellip;<br/>For example: new Admin(Admin.TYPE_RACOMMANDLINE_USER, ip-adress). If possible, the IP adress should be passed.</p>
</li></ul>            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>module</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>One of the LogEntry.MODULE_ constants and defines in which module the event occurred.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>ex</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>LogEntry.MODULE_CA.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>time</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Time of the event.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>username</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>User (endentity) that is involved in the event. null in case no user can be considered to be involved.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>certificate</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Certificate involved in the event. null in case no certificate can be considered to be involved.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>event</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>One of the LogEntry.EVENT_ constants and defines which type of event occurred.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>comment</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>A comment to the event.</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
<p   
>If there are events that are not defined, add new events according to the following:</p>
<ol class=" "><li class=" "><p   
>Add an EVENT_INFO/ERROR constant to LogEntry</p>
</li><li class=" "><p   
>Add corresponding text in the constant LogEntry.EVENTNAMES_INFO/ERROR</p>
</li><li class=" "><p   
>Open the file src/ra/web/raadmin/languages/languagefile.en.properties in a text editor. Go through the constants until you come to the EVENT_INFO/ERROR&hellip; constants and add the English translation. Try to keep the list sorted in alphabetical order.</p>
</li></ol><p   
>If these steps are followed, the Web GUI will be automatically updated.</p>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-Erroranddebuglogs">
        <h1 class="heading "><span>Error and debug logs</span></h1>
<p   
>EJBCA uses the Apache Log4J package for debug-logging. This means that any class that wants to do logging or console output MUST define:</p>
    <div  class="confbox programlisting">
                <div class="content">
        <pre><code>/** Log4j instance */
 private static Logger log = Logger.getLogger(&lt;class&gt;.class); </code></pre>
        </div>
    </div>
<p   
>Logging is then added in the following:</p>
    <div  class="confbox programlisting">
                <div class="content">
        <pre><code>log.error(&quot;message&quot;);
 log.info(&quot;message&quot;);
 log.debug(&quot;message&quot;); </code></pre>
        </div>
    </div>
<p   
>There is also a version of the command that takes an additional Exception as argument, were the exception stack will be printed to the log.<br/>Where the log ends up is defined in 'log4j.properties'.<br/>Some classes have special pre-prepared logging constructs. They are:</p>
    <div  class="confbox programlisting">
                <div class="content">
        <pre><code>BaseSessionBean.java
BaseAdminCommand.java </code></pre>
        </div>
    </div>
<p   
>This means that classes inheriting from one of these classes do not have to define their own logger, but can use:</p>
    <div  class="confbox programlisting">
                <div class="content">
        <pre><code>error(&quot;message&quot;);
info(&quot;message&quot;);
debug(&quot;message&quot;);</code></pre>
        </div>
    </div>
<p   
><span id="src-16226369_id-.EJBCADevelopmentv6.12.0-page8"></span>Debugging output for entrance and exit in methods can be added in the following way:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">int</code><code class="plain"> myMethod(</code><code class="keyword">int</code><code class="plain"> arg) { </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (log.isTraceEnabled()) {</code></div>
<div class="line"><code class="plain">       log.trace(</code><code class="string">"&gt;myMethod("</code><code class="plain">arg</code><code class="string">")"</code><code class="plain">); </code></div>
<div class="line"><code class="plain">    } </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">int</code><code class="plain"> ret = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    ... </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (log.isTraceEnabled()) { </code></div>
<div class="line"><code class="plain">        log.trace(</code><code class="string">"&lt;myMethod: return "</code><code class="plain"> + ret);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> ret; </code></div>
<div class="line"><code class="plain">} </code></div>
</div>
    </div>
<p   
>Checking if trace is enabled first (it is rarely so) will avoid doing the String concatenations.</p>
    <div class="section section-2" id="src-16226369_id-.EJBCADevelopmentv6.12.0-ToaddanewcalltoEjbcaWSinEJBCA3.10andlater">
        <h2 class="heading "><span>To add a new call to EjbcaWS in EJBCA 3.10 and later</span></h2>
<ol class=" "><li class=" "><p   
>Add an abstract method to IEjbcaWS.java</p>
</li><li class=" "><p   
>Implement the method in EJbcaWS.java</p>
</li><li class=" "><p   
>run 'ant ejbca-ws-generate'</p>
</li><li class=" "><p   
>Redeploy EJBCA</p>
</li><li class=" "><p   
>Create JUnit tests.</p>
</li></ol>    </div>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-ClearorHashedPasswords">
        <h1 class="heading "><span>Clear or Hashed Passwords</span></h1>
<p   
>Passwords for users are normally stored BCrypt:ed in the database.</p>
<p   
>You can retrieve and use the password IF it is stored in clear text. Clear text password are however encrypted/obfuscated using the key conf/ejbca.properties#password.encryption.key</p>
<p   
>Use something like this to get the password (snip from BatchMakeP12.java):</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">IUserAdminSessionRemote admin = adminhome.create(); </code></div>
<div class="line"><code class="plain">UserAdminData data = admin.findUser(administrator, username);</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> ((data.getPassword() != </code><code class="keyword">null</code><code class="plain">) &amp;&amp; (data.getPassword().length() &gt; </code><code class="value">0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">    ... </code></div>
<div class="line"><code class="plain">} </code></div>
</div>
    </div>
<p   
>When creating the user, you must specify that the password should be in clear text, otherwise it will be stored in hashed form, which will obvoiusly be of no use to you.</p>
<ul class=" "><li class=" "><p   
>If using the Web-GUI there is a checkbox for storing the password in clear format.</p>
</li><li class=" "><p   
>If using the command line gui there is a command</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">ra setclearpwd</code></div>
</div>
    </div>
</li><li class=" "><p   
>If using programatically: In IUserAdminSession there is a flag <strong class=" ">clearpwd</strong> to the method <strong class=" ">addUser</strong>, or you can use the method <strong class=" ">setOpenPassword</strong> on the UserDataBean object returned from <strong class=" ">findUser</strong>.</p>
</li></ul>    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-SettingupaUtimacoHSMEmulator">
        <h1 class="heading "><span>Setting up a Utimaco HSM Emulator</span></h1>
<p   
>Utimaco have an emulator for their Cryptoserver LAN HSM, it works very good for testing and development.</p>
<p   
><span id="src-16226369_id-.EJBCADevelopmentv6.12.0-page10"></span>CryptoServer PKCS#11 Emulation installation:</p>
<ol class=" "><li class=" "><p   
>Install Windows in VmWare, or on your machine if you are running on windows. This will emulate the CryptoServer LAN module.</p>
</li><li class=" "><p   
>Run <strong class=" ">CESetup-2.4.exe</strong> in the Windows machine. After this the CryptoServer emulator will run in a DOS Window.</p>
</li><li class=" "><p   
>The CryptoServer LAN can now be reached at &lt;ip-of-emulation-machine&gt;:3001 The CryptoServer LAN emulator is already initialized for PKCS#11 usage.</p>
</li><li class=" "><p   
>Setup software and initialize pkcs11 slot:</p>
<ul class=" "><li class=" "><p   
>cd &lt;p11 directory&gt;</p>
</li><li class=" "><p   
>cp &lt;Utimaco-CD&gt;/Software/PKCS#11/lib/linux/* .</p>
</li><li class=" "><p   
>cp &lt;Utimaco-CD&gt;/Software/PKCS#11/p11tool/linux/p11tool . ln -s libcs2_pkcs11-1.4.0.so libcs2_pkcs11.so</p>
</li><li class=" "><p   
>vi cs2_pkcs11.ini</p>
</li><li class=" "><p   
>Device = TCP:3001@172.16.175.128</p>
</li><li class=" "><p   
>AppTimeout = 172800</p>
</li><li class=" "><p   
>sudo cp cs2_pkcs11.ini /etc/utimaco (location can also be set with environment variable CS2_PKCS11_INI)</p>
</li><li class=" "><p   
>./p11tool lib=./libcs2_pkcs11.so slot=1 InitToken=officer1</p>
</li><li class=" "><p   
>./p11tool lib=./libcs2_pkcs11.so slot=1 loginSO=officer1 initpin=user1</p>
</li></ul></li><li class=" "><p   
>Generate keys (password is user1 as initialized above):<br/>$EJBCA_HOME/bin/pkcs11HSM.sh generate ./libcs2_pkcs11.so 2048 defaultKey 1 $EJBCA_HOME/bin/pkcs11HSM.sh generate ./libcs2_pkcs11.so 2048 signKey 1 $EJBCA_HOME/bin/pkcs11HSM.sh generate ./libcs2_pkcs11.so 512 testKey 1</p>
</li><li class=" "><p   
>Create a CA in EJBCA:<br/>Restart JBoss if it was started. Important, you will get PKCS#11 error unless you restart JBoss after generating the keys.</p>
</li><li class=" "><p   
>Create a new CA in EJBCA with the following properties:</p>
</li><li class=" "><p   
>dfg</p>
</li></ol><ul class=" "><li class=" "><p   
>slot 1</p>
</li><li class=" "><p   
>defaultKey defaultKey certSignKey signKey crlSignKey signKey testKey testKey</p>
</li><li class=" "><p   
>pin user1</p>
</li><li class=" "><p   
>sharedLibrary &lt;p11 directory&gt;/libcs2_pkcs11.so</p>
</li></ul>    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-JBossPermGenSpace">
        <h1 class="heading "><span>JBoss PermGenSpace</span></h1>
<p   
>Relevant for JDK 7 only. PermGenSpace is not used in JDK 8.</p>
<p   
>When re-deploying EJBCA in JBoss, and also other application servers, they soon run out of PermGenSpace, so the whole application server must be restarted. Often even a hard kill must be done. To avoid this you can add the following to the JAVA_OPTS in run.conf in JBoss (or similar place for other app servers):</p>
<p   
>-XX:+UseConcMarkSweepGC -XX:+CMSClassUnloadingEnabled -XX:MaxPermSize=1024M</p>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-JBossHotRe-DeploywithbothEJBCAandSignServer">
        <h1 class="heading "><span>JBoss Hot Re-Deploy with both EJBCA and SignServer</span></h1>
<p   
>Both EJBCA and SignServer deploys some libraries such as the BouncyCastle and various commons-* libraries. In the default configuration of JBoss 4.2.3 (and other versions?) those are shared between the two applications (See <a  class="external-link" href="http://www.jboss.org/community/wiki/JBossClassLoadingUseCases">    <span style="color: #0000aa;">
<u class=" ">JBossClassLoadingUseCases</u>    </span>
</a>). This can cause problem if one of the applications is re-deployed. The result is that some Servlets fails during initialization and throws either an IllegalStateException (See <a  class="external-link" href="https://jira.jboss.org/jira/browse/JBAS-7183">    <span style="color: #0000aa;">
<u class=" ">JBAS-7183</u>    </span>
</a>) or a ClassNotFoundException with something like &quot;Invalid use of destroyed classloader, UCL destroyed&quot;. The workaround is to first undeploy the other application or simply to restart JBoss.</p>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-AddingCertificateExtensions">
        <h1 class="heading "><span>Adding Certificate Extensions</span></h1>
<ol class=" "><li class=" "><p   
>Add a new class with the OID and the ASN.1 encoding in org.ejbca.core.model.ca.certextensions.standard</p>
</li><li class=" "><p   
>Add the new extension to the HashMap standardCertificateExtensions in org.ejbca.core.model.ca.certextensions.CertificateExtensionFactory</p>
</li><li class=" "><p   
>Add the new extension to the HashMap useStandardCertificateExtensions in org.ejbca.core.model.ca.certificateprofiles.CertificateProfile</p>
</li><li class=" "><p   
>Add GUI stuff for selecting if the extension should be used or not, and if some values should be entered when registering users.</p>
</li></ol>    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-AddingaNewSignatureAlgorithmforCAs">
        <h1 class="heading "><span>Adding a New Signature Algorithm for CAs</span></h1>
<p   
>To make support for a new signature algorithm when creating CAs in the admin GUI is really simple.</p>
<ol class=" "><li class=" "><p   
>A a new constant in AlgorithmConstants</p>
</li><li class=" "><p   
>Add the new constant for AVAILABLE_SIGALGS in AlgorithmConstants</p>
</li><li class=" "><p   
>Check that AlgorithmTool returns the correct value.</p>
</li></ol><p   
>You can also play around with EC curve names. This is done in AlgorithmTools.getNamedEcCurvesMap.</p>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-BuildScripts">
        <h1 class="heading "><span>Build Scripts</span></h1>
<p   
>EJBCA uses Apache Ant 1.7 or later.</p>
<p   
>EJBCA 3.10 introduced improved modularisation. It should be possible to build each module separately and it should be clear what other modules it depends on.</p>
<p   
>EJBCA_HOME/build.xml: hold all references to all build targets regular EJBCA users should be exposed to. Invoking a build target from this file invokes the corresponding target in EJBCA_HOME/modules/build.xml EJBCA_HOME/modules/build.xml: keeps track of all target for building different modules and the dependencies required to build a specific module.<span id="src-16226369_id-.EJBCADevelopmentv6.12.0-page12"></span></p>
<ul class=" "><li class=" "><p   
>EJBCA_HOME/modules/build-properties.xml: Holds build variables, like the directories of different modules, location of resulting distributables, variables loaded from property files and path-declarations for different sets of libraries.</p>
</li><li class=" "><p   
>EJBCA_HOME/modules/module-name/build.xml: Build file for the module &quot;module-name&quot;. At least contains a default &quot;build&quot; target and a &quot;clean&quot; target.</p>
</li></ul><p   
>Module dependencies have to be added both to the module's target in modules/build.xml and the &quot;build&quot;-target in the modules directory.</p>
    </div>
    <div class="section section-1" id="src-16226369_id-.EJBCADevelopmentv6.12.0-ArchiveStandardComplianceVerification">
        <h1 class="heading "><span>Archive Standard Compliance Verification</span></h1>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>    <span style="color: #000000;">
Applies only to legacy versions on JEE5    </span>
</p>
        </div>
    </div>
<p   
>Glassfish contains a archive verification utility, which can take enterprise application and web archives (EAR, WAR, RAR, etc) and verify that they follow standard. To use it:</p>
<ol class=" "><li class=" "><p   
>Download Glassfish 2.1.1 from <a  class="external-link" href="https://javaee.github.io/glassfish/">GlassFish</a> and follow the installation instructions.</p>
</li><li class=" "><p   
>Build EJBCA and run the following:</p>
</li></ol>    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ /path-to-glassfish/bin/verifier -v /path-to-ejbca/dist/ejbca.ear</code></div>
</div>
    </div>
    </div>
    <div class="section section-1" id="src-16226369_safe-id-aWQtLkVKQkNBRGV2ZWxvcG1lbnR2Ni4xMi4wLVBsdWctaW5zLEFkZC1vbnNhbmRDdXN0b21pemF0aW9u">
        <h1 class="heading "><span>Plug-ins, Add-ons and Customization</span></h1>
<p   
>There are several plug-in interfaces where you can extend functionality using your own classes. For more information on customizing EJBCA, see <a   href="Customizing_EJBCA.html">Customizing EJBCA</a>.</p>
<p   
></p>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="Unbound_Key_Control.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Unbound Key Control</span>
        </a>
                <a href="Customizing_EJBCA.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Customizing EJBCA</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

</body>
</html>
