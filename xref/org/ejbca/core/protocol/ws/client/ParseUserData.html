<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>ParseUserData xref</title>
<link type="text/css" rel="stylesheet" href="../../../../../../stylesheet.css" />
</head>
<body>
<div id="overview"><a href="../../../../../../../apidocs/org/ejbca/core/protocol/ws/client/ParseUserData.html">View Javadoc</a></div><pre>
<a class="jxr_linenumber" name="L1" href="#L1">1</a>   <em class="jxr_javadoccomment">/*************************************************************************</em>
<a class="jxr_linenumber" name="L2" href="#L2">2</a>   <em class="jxr_javadoccomment"> *                                                                       *</em>
<a class="jxr_linenumber" name="L3" href="#L3">3</a>   <em class="jxr_javadoccomment"> *  EJBCA Community: The OpenSource Certificate Authority                *</em>
<a class="jxr_linenumber" name="L4" href="#L4">4</a>   <em class="jxr_javadoccomment"> *                                                                       *</em>
<a class="jxr_linenumber" name="L5" href="#L5">5</a>   <em class="jxr_javadoccomment"> *  This software is free software; you can redistribute it and/or       *</em>
<a class="jxr_linenumber" name="L6" href="#L6">6</a>   <em class="jxr_javadoccomment"> *  modify it under the terms of the GNU Lesser General Public           *</em>
<a class="jxr_linenumber" name="L7" href="#L7">7</a>   <em class="jxr_javadoccomment"> *  License as published by the Free Software Foundation; either         *</em>
<a class="jxr_linenumber" name="L8" href="#L8">8</a>   <em class="jxr_javadoccomment"> *  version 2.1 of the License, or any later version.                    *</em>
<a class="jxr_linenumber" name="L9" href="#L9">9</a>   <em class="jxr_javadoccomment"> *                                                                       *</em>
<a class="jxr_linenumber" name="L10" href="#L10">10</a>  <em class="jxr_javadoccomment"> *  See terms of license at gnu.org.                                     *</em>
<a class="jxr_linenumber" name="L11" href="#L11">11</a>  <em class="jxr_javadoccomment"> *                                                                       *</em>
<a class="jxr_linenumber" name="L12" href="#L12">12</a>  <em class="jxr_javadoccomment"> *************************************************************************/</em>
<a class="jxr_linenumber" name="L13" href="#L13">13</a>  
<a class="jxr_linenumber" name="L14" href="#L14">14</a>  <strong class="jxr_keyword">package</strong> org.ejbca.core.protocol.ws.client;
<a class="jxr_linenumber" name="L15" href="#L15">15</a>  
<a class="jxr_linenumber" name="L16" href="#L16">16</a>  <strong class="jxr_keyword">import</strong> java.io.PrintStream;
<a class="jxr_linenumber" name="L17" href="#L17">17</a>  <strong class="jxr_keyword">import</strong> java.math.BigInteger;
<a class="jxr_linenumber" name="L18" href="#L18">18</a>  <strong class="jxr_keyword">import</strong> java.util.LinkedList;
<a class="jxr_linenumber" name="L19" href="#L19">19</a>  <strong class="jxr_keyword">import</strong> java.util.List;
<a class="jxr_linenumber" name="L20" href="#L20">20</a>  
<a class="jxr_linenumber" name="L21" href="#L21">21</a>  <strong class="jxr_keyword">import</strong> org.ejbca.core.protocol.ws.client.gen.ExtendedInformationWS;
<a class="jxr_linenumber" name="L22" href="#L22">22</a>  <strong class="jxr_keyword">import</strong> org.ejbca.core.protocol.ws.client.gen.UserDataVOWS;
<a class="jxr_linenumber" name="L23" href="#L23">23</a>  <strong class="jxr_keyword">import</strong> org.ejbca.util.cert.OID;
<a class="jxr_linenumber" name="L24" href="#L24">24</a>  
<a class="jxr_linenumber" name="L25" href="#L25">25</a>  <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L26" href="#L26">26</a>  <em class="jxr_javadoccomment"> * Utility for parsing optional user data from the command arguments.</em>
<a class="jxr_linenumber" name="L27" href="#L27">27</a>  <em class="jxr_javadoccomment"> *  </em>
<a class="jxr_linenumber" name="L28" href="#L28">28</a>  <em class="jxr_javadoccomment"> * @author Lars Silv√©n</em>
<a class="jxr_linenumber" name="L29" href="#L29">29</a>  <em class="jxr_javadoccomment"> * $Id: ParseUserData.java 19902 2014-09-30 14:32:24Z anatom $</em>
<a class="jxr_linenumber" name="L30" href="#L30">30</a>  <em class="jxr_javadoccomment"> */</em>
<a class="jxr_linenumber" name="L31" href="#L31">31</a>  <strong class="jxr_keyword">class</strong> <a name="ParseUserData" href="../../../../../../org/ejbca/core/protocol/ws/client/ParseUserData.html#ParseUserData">ParseUserData</a> {
<a class="jxr_linenumber" name="L32" href="#L32">32</a>  	<strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String certificateSerialNumber=<span class="jxr_string">"CERTIFICATESERIALNUMBER"</span>;
<a class="jxr_linenumber" name="L33" href="#L33">33</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String hexPrefix = <span class="jxr_string">"0x"</span>;
<a class="jxr_linenumber" name="L34" href="#L34">34</a>  
<a class="jxr_linenumber" name="L35" href="#L35">35</a>  	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L36" href="#L36">36</a>  <em class="jxr_javadoccomment">	 * Updates the user data from optional properties defined by "&lt;key&gt;=&lt;value&gt;" on the command line.</em>
<a class="jxr_linenumber" name="L37" href="#L37">37</a>  <em class="jxr_javadoccomment">	 * @param args input from the command line</em>
<a class="jxr_linenumber" name="L38" href="#L38">38</a>  <em class="jxr_javadoccomment">	 * @param userData data to modify.</em>
<a class="jxr_linenumber" name="L39" href="#L39">39</a>  <em class="jxr_javadoccomment">	 * @param ps stream to print info for the user</em>
<a class="jxr_linenumber" name="L40" href="#L40">40</a>  <em class="jxr_javadoccomment">	 * @return args with optional arguments removed</em>
<a class="jxr_linenumber" name="L41" href="#L41">41</a>  <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L42" href="#L42">42</a>  	<strong class="jxr_keyword">static</strong> String[] getDataFromArgs(String args[], UserDataVOWS userData, PrintStream ps) {
<a class="jxr_linenumber" name="L43" href="#L43">43</a>  		<strong class="jxr_keyword">final</strong> List&lt;ExtendedInformationWS&gt; lei = <strong class="jxr_keyword">new</strong> LinkedList&lt;ExtendedInformationWS&gt;();
<a class="jxr_linenumber" name="L44" href="#L44">44</a>  		<strong class="jxr_keyword">final</strong> List&lt;String&gt; lArgs = <strong class="jxr_keyword">new</strong> LinkedList&lt;String&gt;();
<a class="jxr_linenumber" name="L45" href="#L45">45</a>  		<strong class="jxr_keyword">for</strong> ( <strong class="jxr_keyword">int</strong> i=0; i&lt;args.length; i++ ) {
<a class="jxr_linenumber" name="L46" href="#L46">46</a>  			<strong class="jxr_keyword">final</strong> String arg = args[i];
<a class="jxr_linenumber" name="L47" href="#L47">47</a>  			<strong class="jxr_keyword">final</strong> <strong class="jxr_keyword">int</strong> equalPos = arg.indexOf('=');
<a class="jxr_linenumber" name="L48" href="#L48">48</a>  			<strong class="jxr_keyword">if</strong> ( equalPos&lt;0 || equalPos+1&gt;arg.length() ) {
<a class="jxr_linenumber" name="L49" href="#L49">49</a>  				lArgs.add(arg);
<a class="jxr_linenumber" name="L50" href="#L50">50</a>  				<strong class="jxr_keyword">continue</strong>;
<a class="jxr_linenumber" name="L51" href="#L51">51</a>  			}
<a class="jxr_linenumber" name="L52" href="#L52">52</a>  			<strong class="jxr_keyword">final</strong> String key = arg.substring(0, equalPos).trim();
<a class="jxr_linenumber" name="L53" href="#L53">53</a>  			<strong class="jxr_keyword">final</strong> String value = arg.substring(equalPos+1,arg.length()).trim();
<a class="jxr_linenumber" name="L54" href="#L54">54</a>  			<strong class="jxr_keyword">if</strong> ( key.equalsIgnoreCase(certificateSerialNumber) ) {
<a class="jxr_linenumber" name="L55" href="#L55">55</a>  				<strong class="jxr_keyword">final</strong> <strong class="jxr_keyword">boolean</strong> isHex = value.substring(0, hexPrefix.length()).equalsIgnoreCase(hexPrefix);
<a class="jxr_linenumber" name="L56" href="#L56">56</a>  				<strong class="jxr_keyword">final</strong> BigInteger nr;
<a class="jxr_linenumber" name="L57" href="#L57">57</a>  				<strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L58" href="#L58">58</a>  					nr = isHex ? <strong class="jxr_keyword">new</strong> BigInteger(value.substring(hexPrefix.length()), 16) : <strong class="jxr_keyword">new</strong> BigInteger(value);
<a class="jxr_linenumber" name="L59" href="#L59">59</a>  				} <strong class="jxr_keyword">catch</strong>( NumberFormatException e ) {
<a class="jxr_linenumber" name="L60" href="#L60">60</a>  					ps.println(certificateSerialNumber+<span class="jxr_string">" '"</span>+value+<span class="jxr_string">"' is not a valid number"</span>);
<a class="jxr_linenumber" name="L61" href="#L61">61</a>  					System.exit(-1);<em class="jxr_comment">// problem with extension data. User info printed by ParseUserData.getDataFromArgs</em>
<a class="jxr_linenumber" name="L62" href="#L62">62</a>  					<strong class="jxr_keyword">return</strong> <strong class="jxr_keyword">null</strong>; <em class="jxr_comment">// this line will never be executed but prevents compilation error.</em>
<a class="jxr_linenumber" name="L63" href="#L63">63</a>  				}
<a class="jxr_linenumber" name="L64" href="#L64">64</a>  				userData.setCertificateSerialNumber(nr);
<a class="jxr_linenumber" name="L65" href="#L65">65</a>  				<strong class="jxr_keyword">continue</strong>;
<a class="jxr_linenumber" name="L66" href="#L66">66</a>  			}
<a class="jxr_linenumber" name="L67" href="#L67">67</a>  			<strong class="jxr_keyword">if</strong> ( OID.isStartingWithValidOID(key) ) {
<a class="jxr_linenumber" name="L68" href="#L68">68</a>  				lei.add(<strong class="jxr_keyword">new</strong> ExtendedInformationWS(key, value));
<a class="jxr_linenumber" name="L69" href="#L69">69</a>  				<strong class="jxr_keyword">continue</strong>;				
<a class="jxr_linenumber" name="L70" href="#L70">70</a>  			}
<a class="jxr_linenumber" name="L71" href="#L71">71</a>  			lArgs.add(arg);
<a class="jxr_linenumber" name="L72" href="#L72">72</a>  		}
<a class="jxr_linenumber" name="L73" href="#L73">73</a>  		<strong class="jxr_keyword">if</strong> ( lei.size()&gt;0 ) {
<a class="jxr_linenumber" name="L74" href="#L74">74</a>  			userData.setExtendedInformation(lei);
<a class="jxr_linenumber" name="L75" href="#L75">75</a>  		}
<a class="jxr_linenumber" name="L76" href="#L76">76</a>  		<strong class="jxr_keyword">return</strong> lArgs.toArray(<strong class="jxr_keyword">new</strong> String[lArgs.size()]);
<a class="jxr_linenumber" name="L77" href="#L77">77</a>  	}
<a class="jxr_linenumber" name="L78" href="#L78">78</a>  	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L79" href="#L79">79</a>  <em class="jxr_javadoccomment">	 * Prints info for the user about the optional user data arguments.</em>
<a class="jxr_linenumber" name="L80" href="#L80">80</a>  <em class="jxr_javadoccomment">	 * @param ps stream to print to.</em>
<a class="jxr_linenumber" name="L81" href="#L81">81</a>  <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="L82" href="#L82">82</a>  	<strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">void</strong> printCliHelp(PrintStream ps) {
<a class="jxr_linenumber" name="L83" href="#L83">83</a>  		ps.println(<span class="jxr_string">"Certificate serial number and certificate extension may be added as extra parameters. These parameters may be inserted at any position since they are removed before the other parameters (above) are parsed."</span>);
<a class="jxr_linenumber" name="L84" href="#L84">84</a>  		ps.println(<span class="jxr_string">"For certificate serial number the parameter looks like this '"</span>+certificateSerialNumber+<span class="jxr_string">"=&lt;serial number&gt;'. Start the number with '"</span>+hexPrefix+<span class="jxr_string">"' to indicated that it is hexadecimal. Example: "</span>+certificateSerialNumber+<span class="jxr_string">"=8642378462375036 "</span>+certificateSerialNumber+<span class="jxr_string">"=0x5a53875acdaf24"</span>);
<a class="jxr_linenumber" name="L85" href="#L85">85</a>  		ps.println(<span class="jxr_string">"For certificate extension the parameter look like this '&lt;oid&gt;[.&lt;type&gt;]=value'. The key '1.2.3.4' is same as '1.2.3.4.value'. Example: 1.2.840.113634.100.6.1.1=00aa00bb 1.2.3.4.value1=1234 1.2.3.4.value2=abcdef"</span>);
<a class="jxr_linenumber" name="L86" href="#L86">86</a>  	}
<a class="jxr_linenumber" name="L87" href="#L87">87</a>  }
</pre>
<hr/>
<div id="footer">Copyright &#169; 2020. All rights reserved.</div>
</body>
</html>