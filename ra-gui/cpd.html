<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.1 from org.apache.maven.plugins:maven-pmd-plugin:3.13.0:cpd at 2020-10-20
 | Rendered using Apache Maven Fluido Skin 1.9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.1" />
    <title>Registration Authority GUI &#x2013; CPD Results</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.9.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.9.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h2>Registration Authority GUI</h2>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2020-10-20<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.0.1-beta-2</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-down"></span>Project Reports</a>
     <ul class="nav nav-list">
      <li><a href="xref/index.html" title="Source Xref"><span class="none"></span>Source Xref</a></li>
      <li><a href="checkstyle.html" title="Checkstyle"><span class="none"></span>Checkstyle</a></li>
      <li><a href="spotbugs.html" title="SpotBugs"><span class="none"></span>SpotBugs</a></li>
      <li class="active"><a href="#"><span class="none"></span>CPD</a></li>
      <li><a href="pmd.html" title="PMD"><span class="none"></span>PMD</a></li>
      <li><a href="surefire-report.html" title="Surefire Report"><span class="none"></span>Surefire Report</a></li>
     </ul></li>
   <li class="nav-header">Parent Project</li>
    <li><a href="../index.html" title="EJB-CA"><span class="none"></span>EJB-CA</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<section>
<h2><a name="CPD_Results"></a>CPD Results</h2>
<p>The following document contains the results of PMD's  <a class="externalLink" href="https://pmd.github.io/latest/pmd_userdocs_cpd.html">CPD</a> 6.21.0.</p></section><section>
<h2><a name="Duplications"></a>Duplications</h2>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\EnrollMakeNewRequestBean.java</td>
<td><a href="./xref/org/ejbca/ra/EnrollMakeNewRequestBean.html#L1357">1357</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\EnrollWithRequestIdBean.java</td>
<td><a href="./xref/org/ejbca/ra/EnrollWithRequestIdBean.html#L599">599</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>        if (this.availableAlgorithmSelectItems == null) {
            final List&lt;SelectItem&gt; availableAlgorithmSelectItems = new ArrayList&lt;&gt;();
            final CertificateProfile certificateProfile = getCertificateProfile();
            if (certificateProfile!=null) {
                final List&lt;String&gt; availableKeyAlgorithms = certificateProfile.getAvailableKeyAlgorithmsAsList();
                final List&lt;Integer&gt; availableBitLengths = certificateProfile.getAvailableBitLengthsAsList();
                if (availableKeyAlgorithms.contains(AlgorithmConstants.KEYALGORITHM_DSA)) {
                    for (final int availableBitLength : availableBitLengths) {
                        if (availableBitLength == 1024) {
                            availableAlgorithmSelectItems.add(new SelectItem(AlgorithmConstants.KEYALGORITHM_DSA + &quot;_&quot; + availableBitLength,
                                    AlgorithmConstants.KEYALGORITHM_DSA + &quot; &quot; + availableBitLength + &quot; bits&quot;));
                        }
                    }
                }
                if (availableKeyAlgorithms.contains(AlgorithmConstants.KEYALGORITHM_RSA)) {
                    for (final int availableBitLength : availableBitLengths) {
                        if (availableBitLength &gt;= 1024) {
                            availableAlgorithmSelectItems.add(new SelectItem(AlgorithmConstants.KEYALGORITHM_RSA + &quot;_&quot; + availableBitLength,
                                    AlgorithmConstants.KEYALGORITHM_RSA + &quot; &quot; + availableBitLength + &quot; bits&quot;));
                        }
                    }
                }
                if (availableKeyAlgorithms.contains(AlgorithmConstants.KEYALGORITHM_ECDSA)) {
                    final Set&lt;String&gt; ecChoices = new HashSet&lt;&gt;();
                    if (certificateProfile.getAvailableEcCurvesAsList().contains(CertificateProfile.ANY_EC_CURVE)) {
                        for (final String ecNamedCurve : AlgorithmTools.getNamedEcCurvesMap(false).keySet()) {
                            if (CertificateProfile.ANY_EC_CURVE.equals(ecNamedCurve)) {
                                continue;
                            }
                            final int bitLength = AlgorithmTools.getNamedEcCurveBitLength(ecNamedCurve);
                            if (availableBitLengths.contains(Integer.valueOf(bitLength))) {
                                ecChoices.add(ecNamedCurve);
                            }
                        }
                    }
                    ecChoices.addAll(certificateProfile.getAvailableEcCurvesAsList());
                    ecChoices.remove(CertificateProfile.ANY_EC_CURVE);
                    final List&lt;String&gt; ecChoicesList = new ArrayList&lt;&gt;(ecChoices);
                    Collections.sort(ecChoicesList);
                    for (final String ecNamedCurve : ecChoicesList) {</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\RaSearchCertsBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchCertsBean.html#L412">412</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\RaSearchEesBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchEesBean.html#L369">369</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>            availableCps.add(new SelectItem(0, raLocaleBean.getMessage(&quot;search_certs_page_criteria_cp_optionany&quot;)));
            for (final Entry&lt;Integer,String&gt; entry : getAsSortedByValue(cpIdToNameMap.entrySet())) {
                availableCps.add(new SelectItem(entry.getKey(), &quot;- &quot; + entry.getValue()));
            }
        }
        return availableCps;
    }

    public int getCriteriaCaId() {
        return stagedRequest.getCaIds().isEmpty() ? 0 : stagedRequest.getCaIds().get(0);
    }
    public void setCriteriaCaId(int criteriaCaId) {
        if (criteriaCaId==0) {
            stagedRequest.setCaIds(new ArrayList&lt;Integer&gt;());
        } else {
            stagedRequest.setCaIds(new ArrayList&lt;&gt;(Arrays.asList(new Integer[]{ criteriaCaId })));
        }
    }
    public boolean isOnlyOneCaAvailable() { return getAvailableCas().size()==1; }
    public List&lt;SelectItem&gt; getAvailableCas() {
        if (availableCas.isEmpty()) {
            final List&lt;CAInfo&gt; caInfos = new ArrayList&lt;&gt;(raMasterApiProxyBean.getAuthorizedCas(raAuthenticationBean.getAuthenticationToken()));
            Collections.sort(caInfos, new Comparator&lt;CAInfo&gt;() {
                @Override
                public int compare(final CAInfo caInfo1, final CAInfo caInfo2) {
                    return caInfo1.getName().compareTo(caInfo2.getName());
                }
            });</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\RaSearchCertsBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchCertsBean.html#L390">390</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\RaSearchEesBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchEesBean.html#L347">347</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>            availableEeps.add(new SelectItem(0, raLocaleBean.getMessage(&quot;search_certs_page_criteria_eep_optionany&quot;)));
            for (final Entry&lt;Integer,String&gt; entry : getAsSortedByValue(eepIdToNameMap.entrySet())) {
                availableEeps.add(new SelectItem(entry.getKey(), &quot;- &quot; + entry.getValue()));
            }
        }
        return availableEeps;
    }

    public int getCriteriaCpId() {
        return stagedRequest.getCpIds().isEmpty() ? 0 : stagedRequest.getCpIds().get(0);
    }
    public void setCriteriaCpId(final int criteriaCpId) {
        if (criteriaCpId==0) {
            stagedRequest.setCpIds(new ArrayList&lt;Integer&gt;());
        } else {
            stagedRequest.setCpIds(new ArrayList&lt;&gt;(Arrays.asList(new Integer[]{ criteriaCpId })));
        }
    }
    public boolean isOnlyOneCpAvailable() { return getAvailableCps().size()==1; }
    public List&lt;SelectItem&gt; getAvailableCps() {
        if (availableCps.isEmpty()) {
            cpIdToNameMap = raMasterApiProxyBean.getAuthorizedCertificateProfileIdsToNameMap(raAuthenticationBean.getAuthenticationToken());
            availableCps.add(new SelectItem(0, raLocaleBean.getMessage(&quot;search_certs_page_criteria_cp_optionany&quot;)));</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\RaSearchCertsBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchCertsBean.html#L262">262</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\RaSearchEesBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchEesBean.html#L233">233</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>                    return o1.getExpires().compareTo(o2.getExpires()) * (sortAscending ? 1 : -1);
                case STATUS:
                    return o1.getStatus().compareTo(o2.getStatus()) * (sortAscending ? 1 : -1);
                case USERNAME:
                default:
                    return o1.getUsername().compareTo(o2.getUsername()) * (sortAscending ? 1 : -1);
                }
            }
        });
    }

    /** @return true if there were no matching search results for the current criteria. */
    public boolean isResultsNone() {
        return getFilteredResults().isEmpty() &amp;&amp; !isMoreResultsAvailable();
    }
    /** @return true if there might be more search results for the current criteria than shown here. */
    public boolean isResultsMoreAvailable() {
        return !getFilteredResults().isEmpty() &amp;&amp; isMoreResultsAvailable();
    }
    /** @return true if there more search results for the given criteria, but there are no result which we assume is caused by a search or peer timeout. */
    public boolean isResultsTimeout() {
        return getFilteredResults().isEmpty() &amp;&amp; isMoreResultsAvailable();
    }

    public String getSortedByProfile() { return getSortedBy(SortOrder.PROFILE); }
    public void sortByProfile() { sortBy(SortOrder.PROFILE, true); }
    public String getSortedByCa() { return getSortedBy(SortOrder.CA); }
    public void sortByCa() { sortBy(SortOrder.CA, true); }
    public String getSortedBySerialNumber() { return getSortedBy(SortOrder.SERIALNUMBER); }</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\RaRoleMembersBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaRoleMembersBean.html#L241">241</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\RaRolesBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaRolesBean.html#L168">168</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>    public void sortByDescription() { sortBy(SortBy.DESCRIPTION, true); }
    
    public String getSortColumn() {
        return sortBy.name();
    }
    
    public void setSortColumn(final String value) {
        try {
            sortBy = !StringUtils.isBlank(value) ? SortBy.valueOf(value.toUpperCase(Locale.ROOT)) : SortBy.ROLE;
        } catch (IllegalArgumentException e) {
            if (log.isDebugEnabled()) {
                log.debug(&quot;Invalid value for the 'sortColumn' parameter: '&quot; + value + &quot;'&quot;);
            }
            sortBy = SortBy.ROLE;
        }
    }
    
    private String getSortedBy(final SortBy sortBy) {
        if (this.sortBy.equals(sortBy)) {
            return isSortAscending() ? &quot;\u25bc&quot; : &quot;\u25b2&quot;;
        }
        return &quot;&quot;;
    }
    
    /** Set current sort column. Flip the order if the column was already selected. 
     * @param sortBy Column
     * @param defaultAscending Order */
    private void sortBy(final SortBy sortBy, final boolean defaultAscending) {
        if (this.sortBy.equals(sortBy)) {
            sortAscending = !isSortAscending();
        } else {
            sortAscending = defaultAscending;
        }
        this.sortBy = sortBy;
        sort();
    }
    
    public boolean isSortAscending() {
        return sortAscending;
    }
    
    public void setSortAscending(final boolean value) {
        sortAscending = value;
    }</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\EnrollWithRequestIdBean.java</td>
<td><a href="./xref/org/ejbca/ra/EnrollWithRequestIdBean.html#L549">549</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\EnrollWithUsernameBean.java</td>
<td><a href="./xref/org/ejbca/ra/EnrollWithUsernameBean.html#L189">189</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>        final String valueStr = value.toString();
        if (valueStr != null &amp;&amp; valueStr.length() &gt; EnrollMakeNewRequestBean.MAX_CSR_LENGTH) {
            log.info(&quot;CSR uploaded was too large: &quot;+valueStr.length());
            throw new ValidatorException(new FacesMessage(raLocaleBean.getMessage(&quot;enroll_invalid_certificate_request&quot;)));
        }
        PKCS10CertificationRequest pkcs10CertificateRequest = CertTools.getCertificateRequestFromPem(valueStr);
        if (pkcs10CertificateRequest == null) {
            throw new ValidatorException(new FacesMessage(raLocaleBean.getMessage(&quot;enroll_invalid_certificate_request&quot;)));
        }

        //Get public key algorithm from CSR and check if it's allowed in certificate profile
        final JcaPKCS10CertificationRequest jcaPKCS10CertificationRequest = new JcaPKCS10CertificationRequest(pkcs10CertificateRequest);
        try {
            final String keySpecification = AlgorithmTools.getKeySpecification(jcaPKCS10CertificationRequest.getPublicKey());
            final String keyAlgorithm = AlgorithmTools.getKeyAlgorithm(jcaPKCS10CertificationRequest.getPublicKey());
            // If we have an End Entity, use this to verify that the algorithm and keyspec are allowed
            final CertificateProfile certificateProfile = getCertificateProfile();
            if (certificateProfile != null) {
                if (!certificateProfile.isKeyTypeAllowed(keyAlgorithm, keySpecification)) {
                    throw new ValidatorException(new FacesMessage(raLocaleBean.getMessage(&quot;enroll_key_algorithm_is_not_available&quot;, keyAlgorithm + &quot;_&quot; + keySpecification)));
                }
            } else {
                if (log.isDebugEnabled()) {
                    log.debug(&quot;Ignoring algorithm validation on CSR because we can not find a Certificate Profile for request with ID: &quot; + requestId);</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\RaSearchCertsBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchCertsBean.html#L121">121</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\RaViewCertBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaViewCertBean.html#L80">80</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>        }
        @Override
        public boolean changeStatus(RaCertificateDetails raCertificateDetails, int newStatus, int newRevocationReason) throws ApprovalException, WaitingForApprovalException {
            final boolean ret = raMasterApiProxyBean.changeCertificateStatus(raAuthenticationBean.getAuthenticationToken(), raCertificateDetails.getFingerprint(),
                    newStatus, newRevocationReason);
            if (ret) {
                // Re-initialize object if status has changed
                final CertificateDataWrapper cdw = raMasterApiProxyBean.searchForCertificate(raAuthenticationBean.getAuthenticationToken(), raCertificateDetails.getFingerprint());
                raCertificateDetails.reInitialize(cdw, cpIdToNameMap, eepIdToNameMap, caSubjectToNameMap);
            }
            return ret;
        }
        @Override
        public boolean recoverKey(RaCertificateDetails raCertificateDetails) throws ApprovalException, CADoesntExistsException, AuthorizationDeniedException, WaitingForApprovalException,
                                    NoSuchEndEntityException, EndEntityProfileValidationException {
            final boolean ret = raMasterApiProxyBean.markForRecovery(raAuthenticationBean.getAuthenticationToken(), raCertificateDetails.getUsername(), raCertificateDetails.getPassword(),
                    EJBTools.wrap(raCertificateDetails.getCertificate()), false);
            return ret;
        }
        @Override
        public boolean keyRecoveryPossible(RaCertificateDetails raCertificateDetails) {
            final boolean ret = raMasterApiProxyBean.keyRecoveryPossible(raAuthenticationBean.getAuthenticationToken(), raCertificateDetails.getCertificate(), raCertificateDetails.getUsername());
            return ret;
        }
    };</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\RaSearchCertsBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchCertsBean.html#L540">540</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\RaSearchEesBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchEesBean.html#L444">444</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>                raLocaleBean.addMessageWarn(&quot;search_certs_page_warn_invaliddate&quot;);
            }
        }
        return defaultValue;
    }

    /** Set or remove the styleClass &quot;invalidInput&quot; on the label with a for-attribute matching the current input component. 
     * @param valid Valid */
    private void markCurrentComponentAsValid(final boolean valid) {
        final String STYLE_CLASS_INVALID = &quot;invalidInput&quot;;
        // UIComponent.getCurrentComponent only works when invoked via f:ajax
        final UIComponent uiComponent = UIComponent.getCurrentComponent(FacesContext.getCurrentInstance());
        final String id = uiComponent.getId();
        final List&lt;UIComponent&gt; siblings = uiComponent.getParent().getChildren();
        for (final UIComponent sibling : siblings) {
            if (sibling instanceof HtmlOutputLabel) {
                final HtmlOutputLabel htmlOutputLabel = (HtmlOutputLabel) sibling;
                if (htmlOutputLabel.getFor().equals(id)) {
                    String styleClass = htmlOutputLabel.getStyleClass();
                    if (valid) {
                        if (styleClass!=null &amp;&amp; styleClass.contains(STYLE_CLASS_INVALID)) {
                            styleClass = styleClass.replace(STYLE_CLASS_INVALID, &quot;&quot;).trim();
                        }
                    } else {
                        if (styleClass==null) {
                            styleClass = STYLE_CLASS_INVALID;
                        } else {
                            if (!styleClass.contains(STYLE_CLASS_INVALID)) {
                                styleClass = styleClass.concat(&quot; &quot; + STYLE_CLASS_INVALID);
                            }
                        }
                    }
                    htmlOutputLabel.setStyleClass(styleClass);
                }
            }
        }
    }

    public String getCriteriaStatus() {</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\EnrollMakeNewRequestBean.java</td>
<td><a href="./xref/org/ejbca/ra/EnrollMakeNewRequestBean.html#L1401">1401</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\EnrollWithRequestIdBean.java</td>
<td><a href="./xref/org/ejbca/ra/EnrollWithRequestIdBean.html#L639">639</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>                        availableAlgorithmSelectItems.add(new SelectItem(AlgorithmConstants.KEYALGORITHM_ECDSA + &quot;_&quot; + ecNamedCurve, AlgorithmConstants.KEYALGORITHM_ECDSA + &quot; &quot;
                                        + StringTools.getAsStringWithSeparator(&quot; / &quot;, AlgorithmTools.getAllCurveAliasesFromAlias(ecNamedCurve))));
                    }
                }
                for (final String algName : CesecoreConfiguration.getExtraAlgs()) {
                    if (availableKeyAlgorithms.contains(CesecoreConfiguration.getExtraAlgTitle(algName))) {
                        for (final String subAlg : CesecoreConfiguration.getExtraAlgSubAlgs(algName)) {
                            final String name = CesecoreConfiguration.getExtraAlgSubAlgName(algName, subAlg);
                            final int bitLength = AlgorithmTools.getNamedEcCurveBitLength(name);
                            if (availableBitLengths.contains(Integer.valueOf(bitLength))) {
                                availableAlgorithmSelectItems.add(new SelectItem(CesecoreConfiguration.getExtraAlgTitle(algName) + &quot;_&quot; + name,
                                        CesecoreConfiguration.getExtraAlgSubAlgTitle(algName, subAlg)));
                            } else {
                                if (log.isTraceEnabled()) {
                                    log.trace(&quot;Excluding &quot; + name + &quot; from enrollment options since bit length &quot; + bitLength + &quot; is not available.&quot;);
                                }
                            }
                        }
                    }
                }
                if (availableAlgorithmSelectItems.size()&gt;1 &amp;&amp; StringUtils.isEmpty(getSelectedAlgorithm(availableAlgorithmSelectItems))) {</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\RaSearchCertsBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchCertsBean.html#L297">297</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\RaSearchEesBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchEesBean.html#L264">264</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>    public void sortByExpiration() { sortBy(SortOrder.EXPIRATION, false); }
    public String getSortedByStatus() { return getSortedBy(SortOrder.STATUS); }
    public void sortByStatus() { sortBy(SortOrder.STATUS, true); }
    public String getSortedByUsername() { return getSortedBy(SortOrder.USERNAME); }
    public void sortByUsername() { sortBy(SortOrder.USERNAME, true); }

    /** @param sortOrder Order
     * @return an up or down arrow character depending on sort order if the sort column matches */
    private String getSortedBy(final SortOrder sortOrder) {
        if (sortBy.equals(sortOrder)) {
            return sortAscending ? &quot;\u25bc&quot; : &quot;\u25b2&quot;;
        }
        return &quot;&quot;;
    }
    /** Set current sort column. Flip the order if the column was already selected. 
     * @param sortOrder Order
     * @param defaultAscending Order */
    private void sortBy(final SortOrder sortOrder, final boolean defaultAscending) {
        if (sortBy.equals(sortOrder)) {
            sortAscending = !sortAscending;
        } else {
            sortAscending = defaultAscending;
        }
        this.sortBy = sortOrder;
        sort();
    }

    /** @return true if there might be more results in the back end than retrieved based on the current criteria. */
    public boolean isMoreResultsAvailable() {
        return lastExecutedResponse!=null &amp;&amp; lastExecutedResponse.isMightHaveMoreResults();
    }

    /** @return true of more search criteria than just the basics should be shown */
    public boolean isMoreOptions() { return moreOptions; };

    /** Invoked when more or less options action is invoked. */
    public void moreOptionsAction() {
        moreOptions = !moreOptions;
        // Reset any criteria in the advanced section
        stagedRequest.resetMaxResults();</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\RaSearchCertsBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchCertsBean.html#L153">153</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\RaSearchEesBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchEesBean.html#L132">132</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>    }

    /** Invoked action on search form post */
    public void searchAndFilterAction() {
        searchAndFilterCommon();
    }

    /** Invoked on criteria changes 
     * @param event Event */
    public void searchAndFilterAjaxListener(final AjaxBehaviorEvent event) {
        searchAndFilterCommon();
    }

    /** Determine if we need to query back end or just filter and execute the required action. */
    private void searchAndFilterCommon() {
        final int compared = stagedRequest.compareTo(lastExecutedRequest);
        boolean search = compared &gt; 0;
        if (compared != 0) {
            stagedRequest.setPageNumber(0);
        }
        if (compared&lt;=0 &amp;&amp; lastExecutedResponse!=null) {
            // More narrow search &#x2192; filter and check if there are sufficient results left
            if (log.isDebugEnabled()) {
                log.debug(&quot;More narrow criteria &#x2192; Filter&quot;);
            }
            filterTransformSort();
            // Check if there are sufficient results to fill screen and search for more
            if (resultsFiltered.size()&lt;lastExecutedRequest.getMaxResults() &amp;&amp; lastExecutedResponse.isMightHaveMoreResults()) {
                if (log.isDebugEnabled()) {
                    log.debug(&quot;Trying to load more results since filter left too few results &#x2192; Query&quot;);
                }
                search = true;
            } else {
                search = false;
            }
        }
        if (search) {
            // Wider search &#x2192; Query back-end
            if (log.isDebugEnabled()) {
                log.debug(&quot;Wider criteria &#x2192; Query&quot;);
            }</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\RaSearchCertsBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchCertsBean.html#L371">371</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\RaSearchEesBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchEesBean.html#L328">328</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>            ret.add(new SelectItem(value, raLocaleBean.getMessage(&quot;search_certs_page_criteria_results_option&quot;, value)));
        }
        return ret;
    }

    public int getCriteriaEepId() {
        return stagedRequest.getEepIds().isEmpty() ? 0 : stagedRequest.getEepIds().get(0);
    }
    public void setCriteriaEepId(final int criteriaEepId) {
        if (criteriaEepId==0) {
            stagedRequest.setEepIds(new ArrayList&lt;Integer&gt;());
        } else {
            stagedRequest.setEepIds(new ArrayList&lt;&gt;(Arrays.asList(new Integer[]{ criteriaEepId })));
        }
    }
    public boolean isOnlyOneEepAvailable() { return getAvailableEeps().size()==1; }
    public List&lt;SelectItem&gt; getAvailableEeps() {
        if (availableEeps.isEmpty()) {
            eepIdToNameMap = raMasterApiProxyBean.getAuthorizedEndEntityProfileIdsToNameMap(raAuthenticationBean.getAuthenticationToken());
            availableEeps.add(new SelectItem(0, raLocaleBean.getMessage(&quot;search_certs_page_criteria_eep_optionany&quot;)));</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\EnrollMakeNewRequestBean.java</td>
<td><a href="./xref/org/ejbca/ra/EnrollMakeNewRequestBean.html#L781">781</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\EnrollMakeNewRequestBean.java</td>
<td><a href="./xref/org/ejbca/ra/EnrollMakeNewRequestBean.html#L836">836</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>                } catch (EjbcaException e) {
                    errorCode = EjbcaException.getErrorCode(e);
                    if (errorCode != null) {
                        if (errorCode.equals(ErrorCode.USER_ALREADY_EXISTS)) {
                            raLocaleBean.addMessageError(&quot;enroll_username_already_exists&quot;, endEntityInformation.getUsername());
                            log.info(&quot;Client &quot; + raAuthenticationBean.getAuthenticationToken() + &quot; failed to add end entity since the username &quot; + endEntityInformation.getUsername() + &quot; already exists&quot;);
                        } else if (errorCode.equals(ErrorCode.CERTIFICATE_WITH_THIS_SUBJECTDN_ALREADY_EXISTS_FOR_ANOTHER_USER)) {
                            raLocaleBean.addMessageError(&quot;enroll_subject_dn_already_exists_for_another_user&quot;, subjectDn.getValue());
                            log.info(&quot;Subject DN &quot; + subjectDn.getValue() + &quot; already exists for another user&quot;, e);
                        } else if (errorCode.equals(ErrorCode.LOGIN_ERROR)) {
                            raLocaleBean.addMessageError(&quot;enroll_keystore_could_not_be_generated&quot;, endEntityInformation.getUsername(), errorCode);</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\RaSearchCertsBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchCertsBean.html#L629">629</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\RaSearchEesBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchEesBean.html#L502">502</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>    }

    private &lt;T&gt; List&lt;Entry&lt;T, String&gt;&gt; getAsSortedByValue(final Set&lt;Entry&lt;T, String&gt;&gt; entrySet) {
        final List&lt;Entry&lt;T, String&gt;&gt; entrySetSorted = new ArrayList&lt;&gt;(entrySet);
        Collections.sort(entrySetSorted, new Comparator&lt;Entry&lt;T, String&gt;&gt;() {
            @Override
            public int compare(final Entry&lt;T, String&gt; o1, final Entry&lt;T, String&gt; o2) {
                return o1.getValue().compareTo(o2.getValue());
            }
        });
        return entrySetSorted;
    }</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\RaRoleMembersBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaRoleMembersBean.html#L324">324</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\RaSearchEesBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchEesBean.html#L390">390</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>            final List&lt;CAInfo&gt; caInfos = new ArrayList&lt;&gt;(raMasterApiProxyBean.getAuthorizedCas(raAuthenticationBean.getAuthenticationToken()));
            Collections.sort(caInfos, new Comparator&lt;CAInfo&gt;() {
                @Override
                public int compare(final CAInfo caInfo1, final CAInfo caInfo2) {
                    return caInfo1.getName().compareTo(caInfo2.getName());
                }
            });
            caIdToNameMap = new HashMap&lt;&gt;();
            for (final CAInfo caInfo : caInfos) {
                caIdToNameMap.put(caInfo.getCAId(), caInfo.getName());
            }
            availableCas.add(new SelectItem(null, raLocaleBean.getMessage(&quot;role_members_page_criteria_ca_optionany&quot;)));</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\RaManageRequestsBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaManageRequestsBean.html#L265">265</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\RaRolesBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaRolesBean.html#L182">182</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>        }
    }

    private String getSortedBy(final SortBy sortBy) {
        if (this.sortBy.equals(sortBy)) {
            return isSortAscending() ? &quot;\u25bc&quot; : &quot;\u25b2&quot;;
        }
        return &quot;&quot;;
    }

    /** Set current sort column. Flip the order if the column was already selected. 
     * @param sortBy Column
     * @param defaultAscending Order */
    private void sortBy(final SortBy sortBy, final boolean defaultAscending) { 
        if (this.sortBy.equals(sortBy)) {
            sortAscending = !isSortAscending();
        } else {
            sortAscending = defaultAscending;
        }
        this.sortBy = sortBy;
        sort();
    }

    public boolean isSortAscending() {
        return sortAscending;
    }

    public void setSortAscending(final boolean value) {
        sortAscending = value;
    }

}</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\RaManageRequestsBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaManageRequestsBean.html#L265">265</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\RaRoleMembersBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaRoleMembersBean.html#L255">255</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>        }
    }

    private String getSortedBy(final SortBy sortBy) {
        if (this.sortBy.equals(sortBy)) {
            return isSortAscending() ? &quot;\u25bc&quot; : &quot;\u25b2&quot;;
        }
        return &quot;&quot;;
    }

    /** Set current sort column. Flip the order if the column was already selected. 
     * @param sortBy Column
     * @param defaultAscending Order */
    private void sortBy(final SortBy sortBy, final boolean defaultAscending) { 
        if (this.sortBy.equals(sortBy)) {
            sortAscending = !isSortAscending();
        } else {
            sortAscending = defaultAscending;
        }
        this.sortBy = sortBy;
        sort();
    }

    public boolean isSortAscending() {
        return sortAscending;
    }

    public void setSortAscending(final boolean value) {
        sortAscending = value;
    }</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org\ejbca\ra\RaSearchCertsBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchCertsBean.html#L517">517</a></td></tr>
<tr class="a">
<td>org\ejbca\ra\RaSearchEesBean.java</td>
<td><a href="./xref/org/ejbca/ra/RaSearchEesBean.html#L421">421</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>        searchForCertificates();
    }

    /** @param stagedValue Value
     * @param value Value
     * @param defaultValue Default  
     * @return the current value if the staged request value if the default value */
    private String getDateAsString(final String stagedValue, final long value, final long defaultValue) {
        if (value==defaultValue) {
            return stagedValue;
        }
        return ValidityDate.formatAsISO8601ServerTZ(value, TimeZone.getDefault());
    }
    /** @param input Input 
     * @param defaultValue Value
     * @return the staged request value if it is a parsable date and the default value otherwise */
    private long parseDateAndUseDefaultOnFail(final String input, final long defaultValue) {
        markCurrentComponentAsValid(true);
        if (!input.trim().isEmpty()) {
            try {
                return ValidityDate.parseAsIso8601(input).getTime();
            } catch (ParseException e) {
                markCurrentComponentAsValid(false);
                raLocaleBean.addMessageWarn(&quot;search_certs_page_warn_invaliddate&quot;);</pre></div></td></tr></table></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2020
</p>
        </div>
      </div>
    </footer>
  </body>
</html>