<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SimpleTime.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">CeSeCore Security Common Code</a> &gt; <a href="index.source.html" class="el_package">org.cesecore.util</a> &gt; <span class="el_source">SimpleTime.java</span></div><h1>SimpleTime.java</h1><pre class="source lang-java linenums">/*************************************************************************
 *                                                                       *
 *  CESeCore: CE Security Core                                           *
 *                                                                       *
 *  This software is free software; you can redistribute it and/or       *
 *  modify it under the terms of the GNU Lesser General Public           *
 *  License as published by the Free Software Foundation; either         *
 *  version 2.1 of the License, or any later version.                    *
 *                                                                       *
 *  See terms of license at gnu.org.                                     *
 *                                                                       *
 *************************************************************************/

package org.cesecore.util;

import java.util.Arrays;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
import org.apache.log4j.Logger;

/**
 * Helper class for handling user friendly format of time intervals.
 *
 * &lt;p&gt;The format is in the form 'y* mo* *d *h *m *s *ms' where * is a decimal
 * number and d=days, h=hours, m=minutes, s=seconds, ms=milliseconds. Spaces are
 * optional.
 *
 * @version $Id: SimpleTime.java 24744 2016-11-15 14:36:16Z anatom $
 */
public final class SimpleTime {

      /** Config. */
  public static final long MILLISECONDS_PER_YEAR = 31536000000L; // 365 days
  /** Config. */
  public static final long MILLISECONDS_PER_MONTH = 2592000000L; // 30 days
  /** Config. */
  public static final long MILLISECONDS_PER_DAY = 86400000L;
  /** Config. */
  public static final long MILLISECONDS_PER_HOUR = 3600000L;
  /** Config. */
  public static final long MILLISECONDS_PER_MINUTE = 60000L;
  /** Config. */
  public static final long MILLISECONDS_PER_SECOND = 1000L;

  /** Config. */
  public static final String TYPE_YEARS = &quot;y&quot;;
  /** Config. */
  public static final String TYPE_MONTHS = &quot;mo&quot;;
  /** Config. */
  public static final String TYPE_DAYS = &quot;d&quot;;
  /** Config. */
  public static final String TYPE_HOURS = &quot;h&quot;;
  /** Config. */
  public static final String TYPE_MINUTES = &quot;m&quot;;
  /** Config. */
  public static final String TYPE_SECONDS = &quot;s&quot;;
  /** Config. */
  public static final String TYPE_MILLISECONDS = &quot;ms&quot;;
  /** MS. */
  public static final String PRECISION_MILLISECONDS = &quot;milliseconds&quot;;
  /** Secs. */
  public static final String PRECISION_SECONDS = &quot;seconds&quot;;
  /** Days. */
  public static final String PRECISION_DAYS = &quot;days&quot;;

  /** Lost. */
<span class="fc" id="L68">  public static final List&lt;String&gt; AVAILABLE_PRECISIONS =</span>
<span class="fc" id="L69">      Arrays.asList(</span>
          new String[] {
            PRECISION_MILLISECONDS, PRECISION_SECONDS, PRECISION_DAYS
          });

  /** Map. */
<span class="fc" id="L75">  private static final Map&lt;String, Long&gt; MILLISECONDS_FACTOR =</span>
      new LinkedHashMap&lt;String, Long&gt;();

  static {
<span class="fc" id="L79">    MILLISECONDS_FACTOR.put(TYPE_YEARS, MILLISECONDS_PER_YEAR);</span>
<span class="fc" id="L80">    MILLISECONDS_FACTOR.put(TYPE_MONTHS, MILLISECONDS_PER_MONTH);</span>
<span class="fc" id="L81">    MILLISECONDS_FACTOR.put(TYPE_DAYS, MILLISECONDS_PER_DAY);</span>
<span class="fc" id="L82">    MILLISECONDS_FACTOR.put(TYPE_HOURS, MILLISECONDS_PER_HOUR);</span>
<span class="fc" id="L83">    MILLISECONDS_FACTOR.put(TYPE_MINUTES, MILLISECONDS_PER_MINUTE);</span>
<span class="fc" id="L84">    MILLISECONDS_FACTOR.put(TYPE_SECONDS, MILLISECONDS_PER_SECOND);</span>
<span class="fc" id="L85">    MILLISECONDS_FACTOR.put(TYPE_MILLISECONDS, 1L);</span>
  }

  /** Logger. */
<span class="fc" id="L89">  private static final Logger LOG = Logger.getLogger(SimpleTime.class);</span>

  /** Format. */
<span class="fc" id="L92">  private static final TimeUnitFormat DAYS_FORMAT_INSTANCE =</span>
      new TimeUnitFormat(
<span class="fc" id="L94">          Arrays.asList(new String[] {TYPE_YEARS, TYPE_MONTHS, TYPE_DAYS}),</span>
          MILLISECONDS_FACTOR);

  /** Format. */
<span class="fc" id="L98">  private static final TimeUnitFormat SECONDS_FORMAT_INSTANCE =</span>
      new TimeUnitFormat(
<span class="fc" id="L100">          Arrays.asList(</span>
              new String[] {
                TYPE_YEARS,
                TYPE_MONTHS,
                TYPE_DAYS,
                TYPE_HOURS,
                TYPE_MINUTES,
                TYPE_SECONDS
              }),
          MILLISECONDS_FACTOR);

  /** Limitation 'ms' (or 'mo') MUST NOT be configured
   * after units containing one
     of their characters 'm', 's' or 'o'! */
<span class="fc" id="L114">  private static final TimeUnitFormat MILLISECONDS_FORMAT_INSTANCE =</span>
      new TimeUnitFormat(
<span class="fc" id="L116">          Arrays.asList(</span>
              new String[] {
                TYPE_MILLISECONDS,
                TYPE_YEARS,
                TYPE_MONTHS,
                TYPE_DAYS,
                TYPE_HOURS,
                TYPE_MINUTES,
                TYPE_SECONDS
              }),
          MILLISECONDS_FACTOR);

  /** Long. */
<span class="fc" id="L129">  private long longTime = 0;</span>
  /** Y. */
<span class="fc" id="L131">  private long years = 0;</span>
  /** M. */
<span class="fc" id="L133">  private long months = 0;</span>
  /** D. */
<span class="fc" id="L135">  private long days = 0;</span>
  /** h. */
<span class="fc" id="L137">  private long hours = 0;</span>
  /** m. */
<span class="fc" id="L139">  private long minutes = 0;</span>
  /** s. */
<span class="fc" id="L141">  private long seconds = 0;</span>
  /** MS.*/
<span class="fc" id="L143">  private long milliSeconds = 0;</span>

  /** @param time milliseconds */
<span class="fc" id="L146">  private SimpleTime(final long time) {</span>
<span class="fc" id="L147">    setTime(time);</span>
<span class="fc" id="L148">  }</span>

  /**
   * @param time AdBhCmDsEu meaning A days, B hours, C minutes, D seconds and E
   *     milliseconds
   * @throws Exception if unable to parse a String
   */
<span class="fc" id="L155">  private SimpleTime(final String time) throws Exception {</span>
<span class="fc" id="L156">    setTime(parseMillies(time));</span>
<span class="fc" id="L157">  }</span>

  /**
   * @param otime AdBhCmDsEu meaning A days, B hours, C minutes, D seconds and E
   *     milliseconds
   * @param defaultTime AdBhCmDsEu meaning A days, B hours, C minutes, D seconds
   *     and E milliseconds
   * @throws Exception if unable to parse a String
   */
  private SimpleTime(
<span class="fc" id="L167">          final String otime, final String defaultTime) throws Exception {</span>
<span class="fc" id="L168">      String time = otime;</span>
<span class="fc bfc" id="L169" title="All 4 branches covered.">    if (time == null || time.trim().length() == 0) {</span>
<span class="fc" id="L170">      time = defaultTime;</span>
    }
<span class="fc" id="L172">    setTime(parseMillies(time));</span>
<span class="fc" id="L173">  }</span>

  /**
   * Get new instance of class.
   *
   * @param time milliseconds
   * @return new instance of class
   */
  public static SimpleTime getInstance(final long time) {
<span class="fc" id="L182">    return new SimpleTime(time);</span>
  }

  /**
   * Get new instance of class.
   *
   * @param time AdBhCmDsEu meaning A days, B hours, C minutes, D seconds and E
   *     milliseconds
   * @return new instance of class or null if there were errors
   */
  public static SimpleTime getInstance(final String time) {
<span class="fc" id="L193">    SimpleTime simpleTime = null;</span>
    try {
<span class="fc" id="L195">      simpleTime = new SimpleTime(time);</span>
<span class="fc" id="L196">    } catch (Exception e) {</span>
<span class="fc" id="L197">      LOG.info(&quot;Failed to parse time \&quot;&quot; + time + &quot;\&quot;. &quot; + e.getMessage());</span>
<span class="fc" id="L198">    }</span>
<span class="fc" id="L199">    return simpleTime;</span>
  }

  /**
   * Get new instance of class.
   *
   * @param time AdBhCmDsEu meaning A days, B hours, C minutes, D seconds and E
   *     milliseconds
   * @param defaultTime AdBhCmDsEu meaning A days, B hours, C minutes, D seconds
   *     and E milliseconds
   * @return new instance of class or null if there were errors
   */
  public static SimpleTime getInstance(
          final String time, final String defaultTime) {
<span class="fc" id="L213">    SimpleTime simpleTime = null;</span>
    try {
<span class="fc" id="L215">      simpleTime = new SimpleTime(time, defaultTime);</span>
<span class="fc" id="L216">    } catch (Exception e) {</span>
<span class="fc" id="L217">      LOG.info(</span>
          &quot;Failed to parse time or defaultTime \&quot;&quot;
              + time
              + &quot;\&quot;, \&quot;&quot;
              + defaultTime
              + &quot;\&quot;. &quot;
<span class="fc" id="L223">              + e.getMessage());</span>
<span class="fc" id="L224">    }</span>
<span class="fc" id="L225">    return simpleTime;</span>
  }

  /**
   * Gets the time unit formatter with the default formatting style for days
   * (with year(y), months (mo) and days (d)).
   *
   * @return a time unit formatter.
   */
  public static TimeUnitFormat getDaysFormat() {
<span class="fc" id="L235">    return DAYS_FORMAT_INSTANCE;</span>
  }

  /**
   * Gets the time unit formatter with the default formatting style for seconds
   * (with year(y), months (mo), days (d), hours (h), minutes (m) and seconds
   * (s)).
   *
   * @return a time unit formatter.
   */
  public static TimeUnitFormat getSecondsFormat() {
<span class="fc" id="L246">    return SECONDS_FORMAT_INSTANCE;</span>
  }

  /**
   * Gets the time unit formatter with the default formatting style for
   * milliseconds (with year(y), months (mo), days (d), hours (h), minutes (m),
   * seconds (s) and milliseconds (ms)).
   *
   * @return a time unit formatter.
   */
  public static TimeUnitFormat getMilliSecondsFormat() {
<span class="fc" id="L257">    return MILLISECONDS_FORMAT_INSTANCE;</span>
  }

  /**
   * Gets the TimeUnitFormat by precision.
   *
   * @param precision precision
   * @return the TimeUnitFormat with the desired precision if existent.
   * @throws IllegalArgumentException if invalid args
   * @see SimpleTime#AVAILABLE_PRECISIONS
   */
  public static TimeUnitFormat getTimeUnitFormatOrThrow(
      final String precision) throws IllegalArgumentException {
<span class="nc" id="L270">    TimeUnitFormat result = null;</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">    if (!AVAILABLE_PRECISIONS.contains(precision)) {</span>
<span class="nc" id="L272">      throw new IllegalArgumentException(</span>
          &quot;Could not get TimeUnitForm for precision: &quot; + precision);
    }
<span class="nc bnc" id="L275" title="All 4 branches missed.">    switch (precision) {</span>
      case SimpleTime.PRECISION_MILLISECONDS:
<span class="nc" id="L277">        result = SimpleTime.getMilliSecondsFormat();</span>
<span class="nc" id="L278">        break;</span>
      case SimpleTime.PRECISION_SECONDS:
<span class="nc" id="L280">        result = SimpleTime.getSecondsFormat();</span>
<span class="nc" id="L281">        break;</span>
      case SimpleTime.PRECISION_DAYS:
<span class="nc" id="L283">        result = SimpleTime.getDaysFormat();</span>
<span class="nc" id="L284">        break;</span>
      default:
<span class="nc" id="L286">        result = SimpleTime.getSecondsFormat();</span>
    }
<span class="nc" id="L288">    return result;</span>
  }

  /**
   * @param millis MS
   * @param zeroType Zero
   * @return string
   */
  public static String toString(
      final long millis, final String zeroType) {
<span class="fc" id="L298">    return SimpleTime.getMilliSecondsFormat()</span>
<span class="fc" id="L299">        .format(millis, MILLISECONDS_FACTOR, zeroType);</span>
  }

  /**
   * @param time MS
   * @return time
   * @throws NumberFormatException fail
   */
  public static long parseMillies(final String time)
      throws NumberFormatException {
<span class="fc" id="L309">    return SimpleTime.getMilliSecondsFormat().parseMillis(time);</span>
  }

  private void setTime(final long otime) {
<span class="fc" id="L313">    long time = otime;</span>
<span class="fc" id="L314">    longTime = time;</span>
<span class="fc" id="L315">    years = time / MILLISECONDS_PER_YEAR;</span>
<span class="fc" id="L316">    time %= MILLISECONDS_PER_YEAR;</span>
<span class="fc" id="L317">    months = time / MILLISECONDS_PER_MONTH;</span>
<span class="fc" id="L318">    time %= MILLISECONDS_PER_MONTH;</span>
<span class="fc" id="L319">    days = time / MILLISECONDS_PER_DAY;</span>
<span class="fc" id="L320">    time %= MILLISECONDS_PER_DAY;</span>
<span class="fc" id="L321">    hours = time / MILLISECONDS_PER_HOUR;</span>
<span class="fc" id="L322">    time %= MILLISECONDS_PER_HOUR;</span>
<span class="fc" id="L323">    minutes = time / MILLISECONDS_PER_MINUTE;</span>
<span class="fc" id="L324">    time %= MILLISECONDS_PER_MINUTE;</span>
<span class="fc" id="L325">    seconds = time / MILLISECONDS_PER_SECOND;</span>
<span class="fc" id="L326">    time %= MILLISECONDS_PER_SECOND;</span>
<span class="fc" id="L327">    milliSeconds = time;</span>
<span class="fc" id="L328">  }</span>

  /**
   * Get the total number of milliseconds for this time (including days, hours
   * etc).
   *
   * @return ms
   */
  public long getLong() {
<span class="fc" id="L337">    return longTime;</span>
  }

  /**
   * @return Y
   */
  public long getYears() {
<span class="fc" id="L344">    return years;</span>
  }

  /**
   * @return M
   */
  public long getMonths() {
<span class="fc" id="L351">    return months;</span>
  }

  /**
   * @return D
   */
  public long getDays() {
<span class="fc" id="L358">    return days;</span>
  }

  /**
   * @return h
   */
  public long getHours() {
<span class="fc" id="L365">    return hours;</span>
  }

  /**
   * @return m
   */
  public long getMinutes() {
<span class="fc" id="L372">    return minutes;</span>
  }

  /**
   * @return s
   */
  public long getSeconds() {
<span class="fc" id="L379">    return seconds;</span>
  }

  /**
   * @return ms
   */
  public long getMilliSeconds() {
<span class="fc" id="L386">    return milliSeconds;</span>
  }

  /**
   * Get nicely formatted form of this object using seconds as default type.
   *
   * @return time in the format AdBhCmDsEu meaning A days, B hours, C minutes, D
   *     seconds and E milliseconds or &quot;0s&quot; if time is 0.
   */
  public String toString() {
<span class="fc" id="L396">    return toString(TYPE_SECONDS);</span>
  }

  /**
   * @param zeroType the type of the returned value if '0'. One of the
   *     SimpleType.TYPE_ constants.
   * @return time in the format AdBhCmDsEu meaning A days, B hours, C minutes, D
   *     seconds and E milliseconds
   */
  public String toString(final String zeroType) {
<span class="fc" id="L406">    return SimpleTime.getMilliSecondsFormat()</span>
<span class="fc" id="L407">        .format(getLong(), MILLISECONDS_FACTOR, zeroType);</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>